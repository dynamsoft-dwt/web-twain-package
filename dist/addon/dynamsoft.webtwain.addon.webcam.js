/* 20200107
* Dynamsoft JavaScript Library
*
* Product: Dynamsoft Web Twain
* Web Site: http://www.dynamsoft.com
*
* Copyright 2020, Dynamsoft Corporation 
* Author: Dynamsoft R&D Department
*
* Version: 15.3
*
* Module: addon/webcam
* final js: build\addon\dynamsoft.webtwain.addon.webcam.js
*/
Dynamsoft.WebcamVerForActiveX="15.0.0.0625";Dynamsoft.WebcamVerInName="15.0.0.0625";var EnumDWT_VideoRotateMode={VRM_NONE:0,VRM_90_DEGREES_CLOCKWISE:1,VRM_180_DEGREES_CLOCKWISE:2,VRM_270_DEGREES_CLOCKWISE:3,VRM_FLIP_VERTICAL:4,VRM_FLIP_HORIZONTAL:5};var EnumDWT_VideoProperty={VP_BRIGHTNESS:0,VP_CONTRAST:1,VP_HUE:2,VP_SATURATION:3,VP_SHARPNESS:4,VP_GAMMA:5,VP_COLORENABLE:6,VP_WHITEBALANCE:7,VP_BACKLIGHTCOMPENSATION:8,VP_GAIN:9};var EnumDWT_CameraControlProperty={CCP_PAN:0,CCP_TILT:1,CCP_ROLL:2,CCP_ZOOM:3,CCP_EXPOSURE:4,CCP_IRIS:5,CCP_FOCUS:6};(function(a){a.WebcamErrors={InvalidParameter:function(b){b._errorCode=-10001;b._errorString="The parameter is invalid."},VideoNotPlayingWhenCapture:function(b){b._errorCode=-10002;b._errorString="To capture an image, the video must be playing."},VideoNotPlayingWhenGetURL:function(b){b._errorCode=-10003;b._errorString="To get the url for the current frame, the video must be playing."},Success:function(b){b._errorCode=0;b._errorString="Successful."}}})(Dynamsoft.Lib);(function(a){function b(c){var d=this;d._Count=0;d._resultlist=[];d._stwain=c}b.prototype.GetCount=function(){var c=this;a.WebcamErrors.Success(c._stwain);return c._Count-1};b.prototype.Get=function(d){var e=this,c=e._resultlist.length;if(d>=c-1||d<0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(e._stwain,"Get");return""}a.WebcamErrors.Success(e._stwain);return e._resultlist[d]};b.prototype.GetCurrent=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"GetCurrent");return""}a.WebcamErrors.Success(d._stwain);return d._resultlist[c-1]};a.NewWebcamValue=function(c){return new b(c)}})(Dynamsoft.Lib);(function(a){function b(c){var d=this;d._Count=0;d._resultlist=[];d._stwain=c}b.prototype.GetValue=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"");return""}a.WebcamErrors.Success(d._stwain);return d._resultlist[0].current};b.prototype.GetIfAuto=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"");return false}a.WebcamErrors.Success(d._stwain);return d._resultlist[0].auto=="true"?true:false};a.NewWebcamSetting=function(c){return new b(c)}})(Dynamsoft.Lib);(function(a){function b(c){var d=this;d._Count=0;d._resultlist=[];d._stwain=c}b.prototype.GetMinValue=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"");return""}return d._resultlist[0].min};b.prototype.GetMaxValue=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"");return""}return d._resultlist[0].max};b.prototype.GetSteppingDelta=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"");return 0}return d._resultlist[0].step};b.prototype.GetDefaultValue=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"");return 0}return d._resultlist[0].defaultValue};b.prototype.GetIfAuto=function(){var d=this,c=d._resultlist.length;if(c==0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(d._stwain,"");return false}return d._resultlist[0].auto=="true"?true:false};a.NewWebcamMoreSetting=function(c){return new b(c)}})(Dynamsoft.Lib);(function(a){var b=function(c){var d=a.html5.Funs;c._innerSetWebcamValue=function(f){var g=c,e;e=a.NewWebcamValue(c);if(f&&a.isArray(f)){e._resultlist=f;e._Count=f.length}return e};c._innerSetWebcamSetting=function(f){var g=c,e;e=a.NewWebcamSetting(c);if(f&&a.isArray(f)){e._resultlist=f;e._Count=f.length}return e};c._innerSetWebcamMoreSetting=function(f){var g=c,e;e=a.NewWebcamMoreSetting(c);if(f&&a.isArray(f)){e._resultlist=f;e._Count=f.length}return e}};if(a.DynamicLoadAddonFuns){a.DynamicLoadAddonFuns.push(b)}a.Addon_Events.push("OnFrameCaptured");a.Addon_Events.push("OnCaptureSuccess");a.Addon_Events.push("OnCaptureError")})(Dynamsoft.Lib);(function(a){if(!a.product.bChromeEdition){return}function b(e){var f=a.html5.Funs;e._innerWebcamValueFunction=function(g,i){var j=this,h;h=j._innerFunRaw(g,i,false,false);return j._innerSetWebcamValue(h)};e._innerWebcamSettingFunction=function(g,i){var j=this,h;h=j._innerFunRaw(g,i,false,false);return j._innerSetWebcamSetting(h)};e._innerWebcamMoreSettingFunction=function(g,i){var j=this,h;h=j._innerFunRaw(g,i,false,false);return j._innerSetWebcamMoreSetting(h)};e._OnCaptureSuccess=function(g){var h=this;if(Dynamsoft.Lib.isFunction(h.__OnCaptureSuccess)){h.__OnCaptureSuccess()}};e._OnCaptureError=function(h){var j=this,g=h[1],i=h[2];if(Dynamsoft.Lib.isFunction(j.__OnCaptureError)){j.__OnCaptureError(g,i)}};e._OnFrameCaptured=function(i){var n=this,l=Dynamsoft.Lib,m=n.__PlayVideoId;if(l.isString(m)&&m!=""&&!n.__videoLoading&&!n.__videoPause){var g=l.one("#"+m),j=n.__videoQuality;if(g&&g.length>0){var h=g.getEL().children[0];try{if(!j){j=60}h.src=n.GetImageURL(-1,-1,-1,0,j);n.__videoLoading=true;h.onload=function(){var r,o,p,q;r=h.parentNode.style.width;o=h.parentNode.style.height;p=h.width;if(p<=0){p=1}q=h.height;if(q<=0){q=1}if(a.isString(r)&&r.indexOf("%")>-1&&p>=q){h.style.width="100%";h.style.height=""}else{if(a.isString(o)&&o.indexOf("%")>-1&&p<q){h.style.width="";h.style.height="100%"}else{r=parseInt(r)-2;o=parseInt(o)-2;if(r<=0){r=1}if(o<=0){o=1}if(r/o<=p/q){h.style.width=r+"px";h.style.height=""}else{if(r/o>p/q){h.style.width="";h.style.height=o+"px"}else{h.style.width="100%";h.style.height=""}}}}n.__videoLoading=false;h.onload=null;h.onerror=null};h.onerror=function(){n.__videoLoading=false;h.onload=null;h.onerror=null}}catch(k){n.__videoLoading=false;h.onload=null;h.onerror=null}}}if(l.isFunction(n.__OnFrameCaptured)){n.__OnFrameCaptured(i)}}}function c(f,g){var e=g.length-1;while(e>=0&&g[e].p1>=f.p1){if(g[e].p1==f.p1&&g[e].p2<f.p2){break}g[e+1]=g[e];e--}g[e+1]=f}var d=function(g){var h=a.html5.Funs,f,e;if(a.env.bMac){e="DynamicWebcam_"+Dynamsoft.WebcamVerInName+".dylib"}else{if(a.env.bLinux){e="DynamicWebcam_"+Dynamsoft.WebcamVerInName+".so"}else{if(dynamsoft.dcp.b64bit){e="DynamicWebcamx64_"+Dynamsoft.WebcamVerInName+".dll"}else{e="DynamicWebcam_"+Dynamsoft.WebcamVerInName+".dll"}}}g._innerSend("GetAddOnVersion",h.makeParams("webcam",e),true,false,false);b(g);f={Webcam:{IsModuleInstalled:function(){var i=g._innerFun("GetAddOnVersion",h.makeParams("webcam",e));return(i!="")},Download:function(m,p,i){var l=g,n;Dynamsoft.Lib.cancelFrome=2;var k=function(){if(Dynamsoft.Lib.isFunction(p)){p()}return true},q=function(){if(Dynamsoft.Lib.isFunction(i)){i(g.ErrorCode,g.ErrorString)}return false};if(!a.License.checkProductKey(g,{Webcam:true},true)){return q()}if(this.IsModuleInstalled()){return k()}if(!m||m==""){Dynamsoft.Lib.Errors.Webcam_InvalidRemoteFilename(l);return q()}if(h.isServerInvalid(l)){q();return false}n="get";Dynamsoft.Lib.showProgress(l,"Download",true);var o=function(r){var s=(r.total===0)?100:Math.round(r.loaded*100/r.total),t=[r.loaded," / ",r.total].join("");l._OnPercentDone([0,s,"","http"])},j=true;l._OnPercentDone([0,-1,"Downloading Webcam Module...","http"]);if(!Dynamsoft.Lib.isFunction(p)){j=false}return h.loadHttpBlob(l,n,m,j,function(r){l._OnPercentDone([0,-1,"Loading..."]);var s=100;l.__LoadImageFromBytes(r,s,"",j,k,q)},function(){Dynamsoft.Lib.closeProgress("Download");q()},o)},GetSourceList:function(){if(!a.License.checkProductKey(g,{Webcam:true},true)){return[]}var i=g._innerFunRaw("GetWebcamSourceList");if(g.ErrorCode==0){i.splice(i.length-1,1)}return i},SelectSource:function(i){if(!a.License.checkProductKey(g,{Webcam:true},true)){return false}return g._innerFun("SelectWebcam",h.makeParams(i))},CloseSource:function(){this._clear();return g._innerFun("StopCapture")},GetFramePartURL:function(){if(!this._isPlaying()){a.WebcamErrors.VideoNotPlayingWhenGetURL(g);return""}return g.GetImageURL(-1,-1,-1,!0,g.__videoQuality)},GetFrameURL:function(){if(!this._isPlaying()){a.WebcamErrors.VideoNotPlayingWhenGetURL(g);return""}return g.GetImageURL(-1,-1,-1,0,g.__videoQuality)},PlayVideo:function(u,w,o,B,n){var A,r=Dynamsoft.Lib,K=60,t=false,s=this,k=function(){s._clear();if(Dynamsoft.Lib.isFunction(n)){n(g.ErrorCode,g.ErrorString)}return false};if(!u){Dynamsoft.Lib.Errors.ParameterCannotEmpty(g);return k()}if(!a.License.checkProductKey(g,{Webcam:true},true)){return k()}var z=u._strDWTControlContainerID;var G=r.one("#"+z),H;if(G&&G.length>0){H=r.one(".dynamsoft-dwt-container-box",G)}if(H&&H.length>0){var m=H.getEL(),F;for(F=0;F<m.children.length;F++){m.children[F].style.display="none"}if(m.children.length>1){A=m.children[m.children.length-1].id;m.children[m.children.length-1].style.display="table-cell"}if(!A||A==""){A="_dwtWebcam_VideoId_"+r.getRandom();var E=u.Width,l=u.Height,J=parseInt(E),p=parseInt(l),v=false,I=false,x=[];if(a.isString(E)&&E.indexOf("%")){v=E}if(a.isString(l)&&l.indexOf("%")){I=l}x.push('<div id="'+A+'" style="');if(v){x.push("width:"+v+";")}else{x.push("width:"+J+"px;")}if(I){x.push("height:"+I+";")}else{x.push("height:"+p+"px;")}x.push('line-height:0;border: 1px solid #CCC;text-align: center;vertical-align: middle;display: table-cell;">');x.push('<img style="width:100%;height:100%;border:0" /></div>');H.append(x.join(""))}if(g.__PlayVideoId==A){t=true}else{var y=g.__PlayVideoId;if(!r.isString(y)||y==""){g.__PlayVideoId=A}else{var C=r.one("#"+y);if(C&&C.length>0){var q=C.parent().getEL(),D;for(D=0;D<q.children.length;D++){q.children[D].style.display="table-cell"}C.remove()}g.__PlayVideoId=A}}}else{r.WebcamErrors.InvalidParameter(g);return k()}g.__videoLoading=false;if(r.isFunction(o)){g.__OnFrameCaptured=o}if(g.__videoPause){g.__videoPause=false;if(a.isFunction(B)){B()}return true}g.__videoPause=false;if(w){K=1*w;if(K<1){K=60}g.__videoQuality=K;if(t){if(a.isFunction(B)){B()}return true}}else{g.__videoQuality=K}return g._innerSend("PlayVideo",h.makeParams(true),true,B,k)},PauseVideo:function(){if(this._isPlaying()){g.__videoPause=true}return true},_clear:function(){var m=Dynamsoft.Lib;g.__videoPause=false;g.__OnFrameCaptured=false;g.__videoLoading=false;g.__videoQuality=60;var n=g.__PlayVideoId;if(m.isString(n)&&n!=""){var j=m.one("#"+n);if(j&&j.length>0){var l=j.parent().getEL(),k;for(k=0;k<l.children.length;k++){l.children[k].style.display="table-cell"}j.remove()}}g.__PlayVideoId=""},_isPlaying:function(){var i=g.__PlayVideoId;if(a.isString(i)&&i!=""){return true}return false},StopVideo:function(){this._clear();var i=g._innerFun("PlayVideo",h.makeParams(false,0));g._innerFun("StopCapture");return i},CaptureImage:function(l,j){if(!a.License.checkProductKey(g,{Webcam:true},true)){if(a.isFunction(j)){j(g._errorCode,g._errorString)}return false}var o=g,i="CaptureImage",n=function(){h.hideMask(i);if(a.isFunction(l)){setTimeout(l,0)}},k=function(){h.hideMask(i);if(a.isFunction(j)){j(o._errorCode,o._errorString)}};h.showMask(i);o.__OnCaptureSuccess=n;o.__OnCaptureError=k;return o._innerSend(i,h.makeParams(false),true,function(){if(o.ErrorCode<0){k(o.ErrorCode,o.ErrorString)}},k)},GetMediaType:function(){return g._innerWebcamValueFunction("GetMediaType")},SetMediaType:function(i){if(!a.isString(i)){a.Errors.InvalidValue(g);return false}return g._innerFun("SetMediaType",h.makeParams(i))},GetResolution:function(){var j=g._innerWebcamValueFunction("GetResolution");if(j&&j._resultlist){var k,q,p=j._resultlist,n=[],r=[],m;if(p.length>0){m=p[p.length-1]}if(m==""&&p.length>0){m=p[0]}for(k=0;k<p.length-1;k++){q=p[k];var l=q.toLowerCase().split("x");c({value:q,p1:parseInt(l[0]),p2:parseInt(l[1])},n)}for(k=0;k<n.length;k++){q=n[k].value;r.push(q)}if(m){r.push(m)}j._resultlist=r;n=null;r=null}return j},SetResolution:function(j){if(!a.isNumber(j)&&!a.isString(j)){a.Errors.InvalidValue(g);return false}var i=g._innerFun("SetResolution",h.makeParams(j));return i},GetFrameRate:function(){return g._innerWebcamValueFunction("GetFrameRate")},SetFrameRate:function(i){if(!a.isNumber(i)){a.Errors.InvalidValue(g);return false}return g._innerFun("SetFrameRate",h.makeParams(i))},GetVideoPropertySetting:function(i){return g._innerWebcamSettingFunction("GetWebcamVideoPropertySetting",h.makeParams(i))},GetVideoPropertyMoreSetting:function(i){return g._innerWebcamMoreSettingFunction("GetWebcamVideoPropertyMoreSetting",h.makeParams(i))},SetVideoPropertySetting:function(j,i,k){return g._innerFun("SetWebcamVideoPropertySetting",h.makeParams(j,i,k))},SetVideoRotateMode:function(i){return g._innerFun("SetVideoRotateMode",h.makeParams(i))},GetCameraControlPropertySetting:function(i){return g._innerWebcamSettingFunction("GetWebcamCameraControlSetting",h.makeParams(i))},GetCameraControlPropertyMoreSetting:function(i){return g._innerWebcamMoreSettingFunction("GetWebcamCameraControlMoreSetting",h.makeParams(i))},SetCameraControlPropertySetting:function(j,i,k){return g._innerFun("SetWebcamCameraControlPropertySetting",h.makeParams(j,i,k))}}};g.__addon=g.__addon||{};a.mix(g.__addon,f)};if(a.DynamicLoadAddonFuns){a.DynamicLoadAddonFuns.push(d)}})(Dynamsoft.Lib);(function(b){if(!b.product.bPluginEdition&&!b.product.bActiveXEdition){return}var a;function c(f){f._innerRead=function(h){var j=this,g;try{g=dynamsoft.lib.parse(h)}catch(i){}return g.result};f._innerWebcamValueFunctionPlugin=function(h){var i=this,g;g=i._innerRead(h);return i._innerSetWebcamValue(g)};f._innerWebcamSettingFunctionPlugin=function(h){var i=this,g;g=i._innerRead(h);return i._innerSetWebcamSetting(g)};f._innerWebcamMoreSettingFunctionPlugin=function(h){var i=this,g;g=i._innerRead(h);return i._innerSetWebcamMoreSetting(g)}}function d(g,h){var f=h.length-1;while(f>=0&&h[f].p1>=g.p1){if(h[f].p1==g.p1&&h[f].p2<g.p2){break}h[f+1]=h[f];f--}h[f+1]=g}var e=function(j){var k,i;if(j.getSWebTwain()&&j.getSWebTwain().Addon){}else{return false}if(b.env.bWin){var h=navigator.userAgent.toLowerCase(),f=!dynamsoft.navInfo.isX64||(h.indexOf("wow64")>=0);if(f){a="DynamicWebcam_"+Dynamsoft.WebcamVerForActiveX+".dll"}else{a="DynamicWebcamx64_"+Dynamsoft.WebcamVerForActiveX+".dll"}}else{}k=j.getSWebTwain();try{k.GetAddOnVersion("webcam",a)}catch(g){}c(j);i={Webcam:{IsModuleInstalled:function(){var l=k.GetAddOnVersion("webcam",a);b.setErrorString(j);return(l!="")},Download:function(q,l,o){var m=function(){if(Dynamsoft.Lib.isFunction(l)){l()}return true},p=function(){if(Dynamsoft.Lib.isFunction(o)){o(j.ErrorCode,j.ErrorString)}return false};if(!b.License.checkProductKey(j,{Webcam:true},true)){return p()}if(this.IsModuleInstalled()){return m()}if(!q||q==""){Dynamsoft.Lib.Errors.Webcam_InvalidRemoteFilename(j);return p()}var n=k.DownloadAddon(q);return b.wrapperRet(j,n,m,p)},GetSourceList:function(){if(!b.License.checkProductKey(j,{Webcam:true},true)){return[]}var m=k.GetWebcamSourceList(),l=[];b.setErrorString(j);if(j.ErrorCode==0){l=j._innerRead(m);if(l&&l.length>1){l.splice(l.length-1,1)}}return l},SelectSource:function(l){if(!b.License.checkProductKey(j,{Webcam:true},true)){return false}var m=k.SelectWebcam(l);b.setErrorString(j);return m},CloseSource:function(){j._playVideoDWT=null;var l=k.StopCapture();b.setErrorString(j);return l},GetFramePartURL:function(){if(!this._isPlaying()){b.WebcamErrors.VideoNotPlayingWhenGetURL(j);return""}var l=k.GetDIB(-1);b.setErrorString(j);return l},GetFrameURL:function(){return""},PlayVideo:function(r,q,o,l,m){var n=function(){j._playVideoDWT=null;if(Dynamsoft.Lib.isFunction(m)){m(j.ErrorCode,j.ErrorString)}return false};if(!r||!r.getSWebTwain()){Dynamsoft.Lib.WebcamErrors.InvalidParameter(j);return n()}if(!b.License.checkProductKey(j,{Webcam:true},true)){return n()}var p=r.getSWebTwain().CurrentHWND;if(!p){b.WebcamErrors.InvalidParameter(j);return n()}j._playVideoDWT=r;setTimeout(function(){var s=k.RunWebcamCmd("PlayVideo",p,null,null,o);b.wrapperRet(j,s,l,n)},0);return true},PauseVideo:function(){return true},StopVideo:function(){j._playVideoDWT=null;var l=k.RunWebcamCmd("StopVideo",0,null,null,null);b.setErrorString(j);k.StopCapture();return l},CaptureImage:function(o,m){var p=function(){if(b.isFunction(o)){setTimeout(o,0)}},n=function(){if(Dynamsoft.Lib.isFunction(m)){m(j.ErrorCode,j.ErrorString)}return false};if(!b.License.checkProductKey(j,{Webcam:true},true)){return n()}var l=k.RunWebcamCmd("Capture",0,p,n,null);b.setErrorString(j);return l},GetMediaType:function(){var l=j._innerWebcamValueFunctionPlugin(k.GetMediaType());b.setErrorString(j);return l},SetMediaType:function(m){if(!b.isString(m)){b.Errors.InvalidValue(j);return false}var l=k.SetMediaType(m);b.setErrorString(j);return l},GetResolution:function(){var l=j._innerWebcamValueFunctionPlugin(k.GetResolution());b.setErrorString(j);if(l&&l._resultlist){var m,s,r=l._resultlist,q=[],t=[],p;if(r.length>0){p=r[r.length-1]}for(m=0;m<r.length-1;m++){s=r[m];var n=s.toLowerCase().split("x");d({value:s,p1:parseInt(n[0]),p2:parseInt(n[1])},q)}for(m=0;m<q.length;m++){s=q[m].value;t.push(s)}if(p){t.push(p)}l._resultlist=t;q=null;t=null}return l},SetResolution:function(m){if(!b.isNumber(m)&&!b.isString(m)){b.Errors.InvalidValue(j);return false}var l=k.SetResolution(m);b.setErrorString(j);return l},GetFrameRate:function(){var l=j._innerWebcamValueFunctionPlugin(k.GetFrameRate());b.setErrorString(j);return l},SetFrameRate:function(m){if(!b.isNumber(m)){b.Errors.InvalidValue(j);return false}var l=k.SetFrameRate(m);b.setErrorString(j);return l},GetVideoPropertySetting:function(m){var l=k.GetWebcamVideoPropertySetting(m);b.setErrorString(j);return j._innerWebcamSettingFunctionPlugin(l)},GetVideoPropertyMoreSetting:function(m){var l=k.GetWebcamVideoPropertyMoreSetting(m);b.setErrorString(j);return j._innerWebcamMoreSettingFunctionPlugin(l)},SetVideoPropertySetting:function(n,m,o){var l=k.SetWebcamVideoPropertySetting(n,m,o);b.setErrorString(j);return l},SetVideoRotateMode:function(m){var l=k.SetVideoRotateMode(m);b.setErrorString(j);return l},GetCameraControlPropertySetting:function(m){var l=k.GetWebcamCameraControlSetting(m);b.setErrorString(j);return j._innerWebcamSettingFunctionPlugin(l)},GetCameraControlPropertyMoreSetting:function(m){var l=k.GetWebcamCameraControlMoreSetting(m);b.setErrorString(j);return j._innerWebcamMoreSettingFunctionPlugin(l)},SetCameraControlPropertySetting:function(n,m,o){var l=k.SetWebcamCameraControlPropertySetting(n,m,o);b.setErrorString(j);return l},_isPlaying:function(){if(j._playVideoDWT){return true}return false}}};j.Addon=j.Addon||{};b.mix(j.Addon,i)};if(b.DynamicLoadAddonFuns){b.DynamicLoadAddonFuns.push(e)}})(Dynamsoft.Lib);
