/*!
 * Date: 07/27/2020 18:38:13
 * Dynamsoft JavaScript Library
 * Product: Dynamsoft Web Twain Viewer
 * Web Site: http://www.dynamsoft.com
 * Copyright 2020, Dynamsoft Corporation
 * Author: Dynamsoft Support Team
 */!function(i){var o={};function n(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}n.m=i,n.c=o,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o="WebViewer_Error: ";e.default={extend:function(t,e){},isArray:function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isBoolean:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},isColor:function(t){var e=document.createElement("span");return e.style.background=t,!!e.style.background},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},addEvent:function(t,e,i,o){try{if(!t)throw new Error("element is not exit");t.addEventListener(e,i,o)}catch(t){}},mergeJSON:function(t,e){for(var i in t)void 0!==e[i]&&this.isObject(t[i])?this.mergeJSON(t[i],e[i]):e[i]=t[i]},ajax:function(t,e){},throttle:function(t,e){var i=this,o=!0;return function(){o&&(o=!1,setTimeout(function(){t.call(i),o=!0},e))}},stable:function(t,e,i){var o,n=this;return void 0===i&&(i=!1),function(){i?t.apply(n):(o&&clearTimeout(o),o=setTimeout(function(){t.apply(n)},e))}},throttleStable:function(e,i){var o=this,n=0,r=null;return function(){var t=+new Date;t-n<i?(clearTimeout(r),r=setTimeout(function(){n=t,e.apply(o)},i)):(n=t,e.apply(o))}},query:function(t){return document.querySelector(t)},queryAll:function(t){return Array.from?Array.from(document.querySelectorAll(t)):this.arrayFrom(document.querySelectorAll(t))},arrayFrom:function(t){var e=[];if(this.isObject(t))for(var i=Object.keys(t),o=0;o<i.length;o++)e.push(t[i[o]]);else for(var n=0;n<t.length;n++)e.push(t[n]);return e},stopBubble:function(t){t&&t.stopPropagation?t.stopPropagation():t&&(t.cancelBubble=!0)},preventDefault:function(t){try{t.preventDefault?t.preventDefault():t.returnValue=!1}catch(t){return!1}},id:function(t){return""===t||void 0===t?null:document.getElementById(t)},hiddenByQuery:function(t){var e=this.query(t);this.hiddenByDom(e)},hiddenByDom:function(t){t.classList.contains("DVS_nodisplay")||t.classList.add("DVS_nodisplay")},animation:function(t,e,i,o,n){if(void 0===o&&(o=200),void 0===n&&(n=13),!this.isString(e)||!this.isNumber(i))return!1;var r=!1;this.isString(t[e])&&-1!==t[e].indexOf("px")&&(r=!0);var s,a,l=parseInt(t[e]);this.isNumber(l)&&(s=(i-l)/n,a=setInterval(function(){0<s&&l<i||s<0&&i<l?l+=s:(clearInterval(a),l=i),t[e]=r?l+"px":l},o/n))},toggleHidden:function(t){t.classList.toggle("DVS_hidden")},toggleDisplayByDom:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=window.event);var o=!t.classList.toggle("DVS_nodisplay");return e&&this.stopBubble(i),o},toggleDisplayByQuery:function(t,e){void 0===e&&(e=!0);var i=this.query(t);return this.toggleDisplayByDom(i,e)},isFullscreen:function(){var t=window.document;return t.fullscreenElement||t.msFullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||!1},launchFullscreen:function(t){return t.requestFullscreen?(t.requestFullscreen(),!0):t.mozRequestFullScreen?(t.mozRequestFullScreen(),!0):t.msRequestFullscreen?(t.msRequestFullscreen(),!0):t.oRequestFullscreen?(t.oRequestFullscreen(),!0):t.webkitRequestFullscreen?(t.webkitRequestFullScreen(),!0):(alert("Your browser does not support full screen!"),!1)},exitFullscreen:function(){var t=window.document;return t.exitFullScreen?(t.exitFullScreen(),!0):t.mozCancelFullScreen?(t.mozCancelFullScreen(),!0):t.webkitExitFullscreen?(t.webkitExitFullscreen(),!0):t.msExitFullscreen?(t.msExitFullscreen(),!0):void 0},getIndex:function(t){for(var e=t.parentNode.children,i=0;i<e.length;i++)if(e[i]===t)return i},getByClass:function(t){return document.getElementsByClassName(t)},insertAfter:function(t,e){var i=e.parentNode;i.lastChild==e?i.appendChild(t):i.insertBefore(t,e.nextSibling)},throw:function(t){throw new Error(o+"ErrorCode: "+t.errorCode+" ErrorString: "+t.message)},error:function(t){},uid:function(t){var e=Math.random().toString(35).substr(2);return e.length<11&&(e+=Math.random().toString(35).substr(2)),t=Math.max(Math.min(Math.round(t),11),8),e=e.substr(0,t)},createCanvas:function(){var t=document.createElement("canvas"),e=t.getContext("2d");return{canvas:t,context:e}},deepCopy:function(t){var e=Array.isArray(t)?[]:{};for(var i in t)"object"==typeof t[i]?e[i]=this.deepCopy(t[i]):e[i]=t[i];return e},deepClone:function(t){var e;if(this.isArray(t))e=[];else{if(!this.isObject(t))return t;e={}}for(var i in t){var o=t[i];this.isArray(t)||this.isObject(t)?e[i]=this.deepClone(o):e[i]=o}return e},requestAnimationFrame:function(t){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=!!e;if(e&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(e.toString())&&(i=!1),i)return e(t);var o={},n=null,r=+new Date;return o[1]=t,null===n&&(n=setInterval(function(){var t=+new Date,e=o;for(var i in o={},e)Object.prototype.hasOwnProperty.call(e,i)&&(e[i](t),r=t);2500<t-r&&(clearInterval(n),n=null)},1e3/60)),1},devicePixelRatio:function(){var t=window;return t?t.devicePixelRatio?t.devicePixelRatio:t.screen.deviceXDPI&&t.screen.logicalXDPI?t.screen.deviceXDPI/t.screen.logicalXDPI:1:1},formatTime:function(t){var e=new Date,i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[o]:("00"+i[o]).substr((""+i[o]).length)));return t},formatLog:function(t,e,i){var o="";return 1===arguments.length&&(o+=t),2!==arguments.length&&3!==arguments.length||(o+="execute "+t,o+=e?" successful":" failed",3===arguments.length&&(o+=": "+i)),o},unique:function(t){for(var e=0;e<t.length;e++)for(var i=e+1;i<t.length;i++)t[e]==t[i]&&(t.splice(i,1),i--);return t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o="undefined"!=typeof window,n=o?window:{};o&&0 in window.document.documentElement,o&&0 in n;e.default={keyCodes:{SHIFT:16,CTRL:17,BACKSPACE:8,DEL:46,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,Y:89,Z:90},errorMessages:{OK:{code:0,message:"ok."},PARAMETER_TYPE:{code:80001,message:"The parameter type is wrong."},PARAMETER_RANGE:{code:80002,message:"The parameter is out of range."},IMG_NOT_EXIST:{code:80003,message:"The image dose not exist."},IMG_LOAD_FAILED:{code:80004,message:"The image load failed."},BACK_TO_TOP:{code:80005,message:"The current folder is root folder."},FILE_NOT_EXIST:{code:80006,message:"The file dose not exist."},IMG_HAVE_EXIST:{code:80007,message:"The image has existed."},EMPTY_IN_ARRAY:{code:80008,message:"There is some empty element in array."},TAG_NOT_EXIST:{code:80009,message:"Tag dose not exist."},TAG_HAVE_EXIST:{code:80010,message:"Tag has existed."},ELEMENT_NOT_EXIST:{code:80011,message:"Element dose not exist."},PAGE_NOT_EXIST:{code:80012,message:"Page dose not exist."},NO_IMAGE_EXIST:{code:80012,message:"There is no image."},PARAMETER_INVALID:{code:80013,message:"The parameter include invalid char."},URL_INVALID:{code:80014,message:"The url is invalid."},FOLDER_NOT_EXIST:{code:80015,message:"The folder dose not exist."},COLOR_INVALID:{code:80016,message:"The color is invalid."},IMG_STORAGE_FAILED:{code:80017,message:"Failed to save image to database."},IMG_REMOVE_FAILED:{code:80018,message:"Failed to remove image from database by uid."},PATH_ERROR:{code:80019,message:"The path of file or folder dose not exist."}},lineType:{FREE_LINE:0,STRAIGHT_LINE:1,BROKEN_LINE:2},dashType:{a:null,b:null},shapeType:{RECTANGLE:0,CIRCLE:1,TRIANGLE:2},operationMode:{HAND:0,CROP:1,CLICK_TO_ZOOM:2}}},function(t,e){var i,o,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var l,h=[],c=!1,u=-1;function d(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&p())}function p(){if(!c){var t=a(d);c=!0;for(var e=h.length;e;){for(l=h,h=[];++u<e;)l&&l[u].run();u=-1,e=h.length}l=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new f(t,e)),1!==h.length||c||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var l=o(i(0)),r=i(29);e.default={createVnode:function(t,e,i,o,n){if(void 0===e&&(e={}),void 0===i&&(i=[]),l.default.isObject(e)&&l.default.isArray(i))return new r.VNode(t,e,i,o,n)},sameVnode:function(t,e){return e.el===t.el||"IMG"===e.tagName&&"IMG"===t.tagName||e.data.key===t.data.key&&e.sel===t.sel&&e.text===t.text},createKeyHashList:function(t,e,i){for(var o,n,r={},s=e;s<=i;++s)(n=t[s])&&n.data&&(o=n.data.key)&&(r[o]=s);return r},removeVnodes:function(t,e,i,o){for(;i<=o;){var n=e[i];null!=n&&n.el&&("IMG"===n.tagName&&(n.el.onload=void 0,n.el.src=""),t.removeChild(n.el)),++i}},addVnodes:function(o,n,r,s,t){for(var a=this;s<=t;)!function(){var e,t,i=r[s];i&&(n?o.insertBefore(i.el,n):o.appendChild(i.el),e=i.el,l.default.arrayFrom(Object.keys(i.data)).forEach(function(t){e[t]||0===e[t]?"style"===t?e.getAttribute(t)?i.data[t]=e.getAttribute(t):e.setAttribute(t,i.data[t]):i.data[t]=e[t]:e[t]!==i.data[t]&&(e[t]=i.data[t])}),(t=i.children)&&t.length&&a.addVnodes(i.el,null,t,0,t.length)),++s}()},addOneVnode:function(t,e,i){if(!t||!t.children)return!1;var o=t.children[e]&&t.children[e].el;return t.children.splice(e,0,i),this.addVnodes(t.el,o,[i],0,0)},patchVnode:function(e,i){var t=i.el=e.el;Object.keys(i.data).forEach(function(t){e.el[t]!==i.data[t]&&(e.el[t]=i.data[t])});var o=e.children,n=i.children;e!==i&&(""!==e.text&&""!==i.text&&e.text!==i.text?t.textContent=i.text:(e.el=i.el,o.length&&n.length&&o!==n?this.updateChildren(t,o,n):n&&n.length?this.addVnodes(t,null,n,0,n.length):o&&o.length&&this.removeVnodes(t,o,0,o.length)))},updateChildren:function(t,e,i){for(var o,n,r,s,a=0,l=0,h=e.length-1,c=e[0],u=e[h],d=i.length-1,p=i[0],f=i[d];a<=h&&l<=d;)null==c?c=e[++a]:null==u?u=e[--h]:null==p?p=i[++l]:null==f?f=i[--d]:this.sameVnode(c,p)?(this.patchVnode(c,p),c=e[++a],p=i[++l]):this.sameVnode(u,f)?(this.patchVnode(u,f),u=e[--h],f=i[--d]):this.sameVnode(c,f)?(this.patchVnode(c,f),t.insertBefore(c.el,u.el.nextSibling),c=e[++a],f=i[--d]):p=(this.sameVnode(u,p)?(this.patchVnode(u,p),t.insertBefore(u.el,c.el),u=e[--h]):(void 0===o&&(o=this.createKeyHashList(e,a,h)),void 0===(n=o[p.data.key])?this.addVnodes(t,c.el,i,l,l):(r=e[n]).sel!==p.sel?this.addVnodes(t,c.el,e,n,n):(this.patchVnode(r,p),t.insertBefore(p.el,c.el),e[n]=null)),i[++l]);h<a?(s=null==i[d+1]?null:i[d+1].el,this.addVnodes(t,s,i,l,d)):d<l&&this.removeVnodes(t,e,a,h)},patch:function(t,e){var i,o;return this.sameVnode(t,e)?this.patchVnode(t,e):null!==(o=(i=t.el).parentNode)&&(o.insertBefore(e.el,i.nextSibling),o.removeChild(t.el),t=null),e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ErrorMessage:{OK:{code:0,message:"Successful"},HTTPS_REQUIRED:{code:-4201,message:"HTTPS is required for accessing cameras."},MEDIADEVICES_NOT_IMPL:{code:-4202,message:"The current browser has not implemented the MediaDevices interface."},GETUSERMEDIA_NOT_IMPL:{code:-4203,message:"The current browser has not implemented the getUserMedia interface."},NO_MEMORY:{code:-4204,message:"Not enough memory for this operation."},NO_CAMERA_SELECTED:{code:-4205,message:"No camera is selected."},VIDEO_ELEMENT_REQUIRED:{code:-4206,message:"A Video element is required for this operation."},CAMERA_PLUG_OUT:{code:-4207,message:"The camera is not plugged in."},CAMERA_NOT_OPEN:{code:-4208,message:"The camera is not open."},CAMERA_SETTINGS_NOT_SUPPORT:{code:-4209,message:"The current browser does not support camera settings."},FAILED_GET_USERMEDIA:{code:-4210,message:"Failed to get camera input."},SOURCE_NOT_FOUND:{code:-4211,message:"The camera source can not be found."},VIDEO_NOT_PLAY:{code:-4214,message:"The video must be playing for the capture operation to work."},VIDEO_NOT_STOP:{code:-4215,message:"The video is already playing. Please stop the video before attempting to play it again to a different container."},NO_CAMERA:{code:-4216,message:"No camera is found."}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.matrixMultiplication3x3=function(t,e){for(var i=[],o=0;o<3;o++)for(var n=0;n<3;n++){var r=t[3*o+0]*e[n]+t[3*o+1]*e[n+3]+t[3*o+2]*e[n+6];i.push(r)}return i},n.prototype.pushCropStack=function(t){this.cropStack.push(t)},n.prototype.popCropStack=function(){return this.cropStack.pop()},n.prototype.clearCropStack=function(){this.cropStack=[]},n.prototype.pushRotateAndFlipStack=function(t){this.rotateAndFlipStack.push(t)},n.prototype.popRotateAndFlipStack=function(){return this.rotateAndFlipStack.pop()},n.prototype.clearRotateAndFilpStack=function(){this.rotateAndFlipStack=[]},n.prototype.pushAllStepsStack=function(t){this.allStepsStack.push(t)},n.prototype.popAllStepsStack=function(){return this.allStepsStack.pop()},n.prototype.clearAllStepsStack=function(){this.allStepsStack=[]},n.prototype.pushResultStack=function(t){this.resultStack.push(t)},n.prototype.popResultStack=function(){return this.resultStack.pop()},n.prototype.clearResultStack=function(){this.resultStack=[]},n.prototype.rotateMatrix=function(t,e,i){t=t/180*Math.PI;var o=Math.sin(t),n=Math.cos(t);return[n,-o,(1-n)*e+i*o,o,n,(1-n)*i-e*o,0,0,1]},n.prototype.moveMatrix=function(t,e){return[1,0,t,0,1,e,0,0,1]},n.prototype.scaleMatrix=function(t){return[t,0,0,0,t,0,0,0,1]},n.prototype.flipMatrix=function(t,e){return[1-2*Math.pow(t,2),-2*t*e,0,-2*t*e,1-2*Math.pow(e,2),0,0,0,1]},n.prototype.convertToCanvasMatrix=function(t){for(var e=[0,3,1,4,2,5],i=[],o=0;o<e.length;o++)i.push(t[e[o]]);return i},n.prototype.getLatestResult=function(){return 0!==this.resultStack.length?this.resultStack[this.resultStack.length-1].slice():null},n.prototype.setTransform=function(t){for(var e,i=0;i<this.rotateAndFlipStack.length;i++)e=this.rotateAndFlipStack[i],e=this.convertToCanvasMatrix(e),t.transform.apply(t,e)},n.prototype.setPointTransform=function(t,e){for(var i,o=0;o<this.rotateAndFlipStack.length;o++){var n=t*(i=this.rotateAndFlipStack[o])[0]+e*i[3],r=t*i[1]+e*i[4];t=n,e=r}return{x:t,y:e}},n.prototype.pointRotate=function(t,e,i,o,n){return n=n/180*Math.PI,{x:(t-i)*Math.cos(n)-(e-o)*Math.sin(n)+i,y:(t-i)*Math.sin(n)+(e-o)*Math.cos(n)+o}},n.prototype.rectangleRotate=function(t,e,i,o,n){var r=t+i/2,s=e+o/2,a=this.pointRotate(t,e,r,s,n),l=this.pointRotate(t+i,e,r,s,n),h=this.pointRotate(t+i,e+o,r,s,n),c=this.pointRotate(t,e+o,r,s,n),u=[l.x,a.x,c.x,h.x].sort(function(t,e){return t-e}),d=[l.y,a.y,c.y,h.y].sort(function(t,e){return t-e});return{x:u[0],y:d[0],width:u[3]-u[0],height:d[3]-d[0]}},n.prototype.calcLineEquation=function(t,e){var i=e.y-t.y,o=t.x-e.x,n=e.x*t.y-t.x*e.y,r=i*i+o*o,s=[];return s.push((o*o-i*i)/r,-2*i*o/r,-2*i*n/r,-2*i*o/r,(i*i-o*o)/r,-2*o*n/r,0,0,1/r),s},n.prototype.flip=function(t){this.flipNum+=1;var e=this.totalAngle/180*Math.PI,i=Math.cos(e),o=-Math.sin(e),n=-Math.sin(e),r=-Math.cos(e);this.flipNumX%2&&(n=-n,r=-r),this.flipNumY%2&&(i=-i,o=-o);var s={x:i,y:o},a={x:n,y:r},l={x:0,y:0},h=null;if(0===t)this.flipNumX+=1,h=this.calcLineEquation(s,l);else{if(1!==t)return;this.flipNumY+=1,h=this.calcLineEquation(a,l)}this.pushRotateAndFlipStack(h),this.pushAllStepsStack(h);var c=(c=this.getLatestResult())?this.matrixMultiplication3x3(h,c):h;this.pushResultStack(c)},n.prototype.calcFlipMatrix=function(t,e){return[1-2*t*t,-2*t*e,0,-2*t*e,1-2*e*e,0,0,0,1]},n.prototype.rotate=function(t,e,i){this.flipNum%2?(this.totalAngle-=t,t=-t):this.totalAngle+=t;var o=this.rotateMatrix(t,e||0,i||0);this.pushRotateAndFlipStack(o),this.pushAllStepsStack(o);var n=(n=this.getLatestResult())?this.matrixMultiplication3x3(o,n):o;this.pushResultStack(n)},n.prototype.translate=function(t,e){var i=this.moveMatrix(t,e);this.pushRotateAndFlipStack(i),this.pushAllStepsStack(i);var o=(o=this.getLatestResult())?this.matrixMultiplication3x3(i,o):i;this.pushResultStack(o)},n.prototype.addAngle=function(t){this.angle+=t},n.prototype.calcTranslateDis=function(t,e){var i=this.totalAngle/180*Math.PI,o=t*Math.cos(i),n=-t*Math.sin(i),r=e*Math.sin(i),s=e*Math.cos(i);return this.flipNumX%2&&(r=-r,s=-s),this.flipNumY%2&&(o=-o,n=-n),{x:o+r,y:n+s}},n.prototype.reset=function(){this.clearAllStepsStack(),this.clearResultStack(),this.clearRotateAndFilpStack(),this.clearCropStack(),this.totalAngle=0,this.flipNumX=0,this.flipNumY=0,this.flipNum=0},n);function n(){this.cropStack=[],this.rotateAndFlipStack=[],this.allStepsStack=[],this.resultStack=[],this.angle=0,this.flipNum=0,this.flipNumX=0,this.flipNumY=0,this.totalAngle=0,this.tx=0,this.ty=0,this.obj={uid:"xxx",type:"crop/rotate/flip",cor:[],angle:0,totalAngle:0,zoom:1}}e.Transform2d=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(8);window.Promise||(window.Promise=o);var n,r,s=i(11);function c(t){return"function"==typeof t||"[object Function]"===n.call(t)}function u(t){var e,i=(e=Number(t),isNaN(e)?0:0!==e&&isFinite(e)?(0<e?1:-1)*Math.floor(Math.abs(e)):e);return Math.min(Math.max(i,0),r)}e.DVS=s.DVS,i(52),i(53),"undefined"!=typeof document&&"undefined"!=typeof window&&(window.DVS=s.DVS),Array.from||(Array.from=(n=Object.prototype.toString,r=Math.pow(2,53)-1,function(t,e,i){var o=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,r=1<arguments.length?e:void 0;if(void 0!==r){if(!c(r))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(n=i)}for(var s,a=u(o.length),l=c(this)?Object(new this(a)):new Array(a),h=0;h<a;)s=o[h],l[h]=r?void 0===n?r(s,h):r.call(n,s,h):s,h+=1;return l.length=a,l})),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),o=1;o<arguments.length;o++){var n=arguments[o];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},writable:!0,configurable:!0}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var o=atob(this.toDataURL(e,i).split(",")[1]),n=o.length,r=new Uint8Array(n),s=0;s<n;s++)r[s]=o.charCodeAt(s);t(new Blob([r],{type:e||"image/png"}))}})},function(e,t,i){(function(rt,z,h){var t;t=function(){var t,e,i;return function r(s,a,l){function h(i,t){if(!a[i]){if(!s[i]){var e="function"==typeof _dereq_&&_dereq_;if(!t&&e)return e(i,!0);if(c)return c(i,!0);var o=new Error("Cannot find module '"+i+"'");throw o.code="MODULE_NOT_FOUND",o}var n=a[i]={exports:{}};s[i][0].call(n.exports,function(t){var e=s[i][1][t];return h(e||t)},n,n.exports,r,s,a,l)}return a[i].exports}for(var c="function"==typeof _dereq_&&_dereq_,t=0;t<l.length;t++)h(l[t]);return h}({1:[function(t,e,i){"use strict";e.exports=function(t){var o=t._SomePromiseArray;function e(t){var e=new o(t),i=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),i}t.any=e,t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e,i){"use strict";var o;try{throw new Error}catch(t){o=t}var n=t("./schedule"),r=t("./queue");function s(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new r(16),this._normalQueue=new r(16),this._haveDrainedQueues=!1;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=n}function a(t){for(;0<t.length();)!function(t){var e=t.shift();{var i,o;"function"!=typeof e?e._settlePromises():(i=t.shift(),o=t.shift(),e.call(i,o))}}(t)}s.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},s.prototype.hasCustomScheduler=function(){return this._customScheduler},s.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},s.prototype.fatalError=function(t,e){e?(rt.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),rt.exit(2)):this.throwLater(t)},s.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},s.prototype.invokeLater=function(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()},s.prototype.invoke=function(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()},s.prototype.settlePromises=function(t){this._normalQueue._pushOne(t),this._queueTick()},s.prototype._drainQueues=function(){a(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,a(this._lateQueue)},s.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},s.prototype._reset=function(){this._isTickUsed=!1},e.exports=s,e.exports.firstLineError=o},{"./queue":26,"./schedule":29}],3:[function(t,e,i){"use strict";e.exports=function(r,s,a,l){function i(t,e){this._reject(e)}function h(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(i,i,null,this,t)}function c(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)}function u(t,e){e.promiseRejectionQueued||this._reject(t)}var d=!1;r.prototype.bind=function(t){d||(d=!0,r.prototype._propagateFrom=l.propagateFromFunction(),r.prototype._boundValue=l.boundValueFunction());var e=a(t),i=new r(s);i._propagateFrom(this,1);var o,n=this._target();return i._setBoundTo(e),e instanceof r?(o={promiseRejectionQueued:!1,promise:i,target:n,bindingPromise:e},n._then(s,h,void 0,i,o),e._then(c,u,void 0,i,o),i._setOnCancel(e)):i._resolveCallback(n),i},r.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},r.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},r.bind=function(t,e){return r.resolve(e).bind(t)}}},{}],4:[function(t,e,i){"use strict";var o;"undefined"!=typeof Promise&&(o=Promise);var n=t("./promise")();n.noConflict=function(){try{Promise===n&&(Promise=o)}catch(t){}return n},e.exports=n},{"./promise":22}],5:[function(t,e,i){"use strict";var o,n,r=Object.create;r&&(o=r(null),n=r(null),o[" size"]=n[" size"]=0),e.exports=function(n){var r=t("./util"),o=r.canEvaluate;r.isIdentifier;function i(t){return function(t,e){var i;if(null!=t&&(i=t[e]),"function"==typeof i)return i;var o="Object "+r.classString(t)+" has no method '"+r.toString(e)+"'";throw new n.TypeError(o)}(t,this.pop()).apply(t,this)}function s(t){return t[this]}function a(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}n.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(i,void 0,void 0,e,void 0)},n.prototype.get=function(t){var e,i;return i="number"==typeof t?a:o&&null!==(e=(void 0)(t))?e:s,this._then(i,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(l,t,e){"use strict";t.exports=function(t,e,i,o){var n=l("./util"),r=n.tryCatch,s=n.errorObj,a=t._async;t.prototype.break=t.prototype.cancel=function(){if(!o.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=i}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),a.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){var i;if(n.isArray(t))for(var o=0;o<t.length;++o)this._doInvokeOnCancel(t[o],e);else void 0!==t&&("function"==typeof t?e||(i=r(t).call(this._boundValue()))===s&&(this._attachExtraTrace(i.e),a.throwLater(i.e)):t._resultCancelled(this))},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),a.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,i){"use strict";e.exports=function(u){var d=t("./util"),p=t("./es5").keys,f=d.tryCatch,g=d.errorObj;return function(l,h,c){return function(t){var e=c._boundValue();t:for(var i=0;i<l.length;++i){var o=l[i];if(o===Error||null!=o&&o.prototype instanceof Error){if(t instanceof o)return f(h).call(e,t)}else if("function"==typeof o){var n=f(o).call(e,t);if(n===g)return n;if(n)return f(h).call(e,t)}else if(d.isObject(t)){for(var r=p(o),s=0;s<r.length;++s){var a=r[s];if(o[a]!=t[a])continue t}return f(h).call(e,t)}}return u}}}},{"./es5":13,"./util":36}],8:[function(t,e,i){"use strict";e.exports=function(r){var s=!1,i=[];function a(){this._trace=new a.CapturedTrace(l())}function l(){var t=i.length-1;if(0<=t)return i[t]}return r.prototype._promiseCreated=function(){},r.prototype._pushContext=function(){},r.prototype._popContext=function(){return null},r._peekContext=r.prototype._peekContext=function(){},a.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},a.prototype._popContext=function(){if(void 0===this._trace)return null;var t=i.pop(),e=t._promiseCreated;return t._promiseCreated=null,e},a.CapturedTrace=null,a.create=function(){if(s)return new a},a.deactivateLongStackTraces=function(){},a.activateLongStackTraces=function(){var t=r.prototype._pushContext,e=r.prototype._popContext,i=r._peekContext,o=r.prototype._peekContext,n=r.prototype._promiseCreated;a.deactivateLongStackTraces=function(){r.prototype._pushContext=t,r.prototype._popContext=e,r._peekContext=i,r.prototype._peekContext=o,r.prototype._promiseCreated=n,s=!1},s=!0,r.prototype._pushContext=a.prototype._pushContext,r.prototype._popContext=a.prototype._popContext,r._peekContext=r.prototype._peekContext=l,r.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},a}},{}],9:[function(nt,t,e){"use strict";t.exports=function(s,o,n,r){var i,a,l,t,e,h=s._async,c=nt("./errors").Warning,u=nt("./util"),d=nt("./es5"),p=u.canAttachTrace,f=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,g=/\((?:timers\.js):\d+:\d+\)/,m=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,_=null,v=null,y=!1,b=!(0==u.env("BLUEBIRD_DEBUG")),C=!(0==u.env("BLUEBIRD_WARNINGS")||!b&&!u.env("BLUEBIRD_WARNINGS")),T=!(0==u.env("BLUEBIRD_LONG_STACK_TRACES")||!b&&!u.env("BLUEBIRD_LONG_STACK_TRACES")),w=0!=u.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(C||!!u.env("BLUEBIRD_W_FORGOTTEN_RETURN"));function x(){for(var t=0;t<e.length;++t)e[t]._notifyUnhandledRejection();S()}function S(){e.length=0}e=[],t=function(t){e.push(t),setTimeout(x,1)},d.defineProperty(s,"_unhandledRejectionCheck",{value:x}),d.defineProperty(s,"_unhandledRejectionClear",{value:S}),s.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},s.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),t(this))},s.prototype._notifyUnhandledRejectionIsHandled=function(){G("rejectionHandled",i,void 0,this)},s.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},s.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},s.prototype._notifyUnhandledRejection=function(){var t;this._isRejectionUnhandled()&&(t=this._settledValue(),this._setUnhandledRejectionIsNotified(),G("unhandledRejection",a,t,this))},s.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},s.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},s.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},s.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},s.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},s.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},s.prototype._warn=function(t,e,i){return X(t,e,i||this)},s.onPossiblyUnhandledRejection=function(t){var e=s._getContext();a=u.contextBind(e,t)},s.onUnhandledRejectionHandled=function(t){var e=s._getContext();i=u.contextBind(e,t)};var E=function(){};s.longStackTraces=function(){if(h.haveItemsQueued()&&!ot.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");var t,e,i;!ot.longStackTraces&&K()&&(t=s.prototype._captureStackTrace,e=s.prototype._attachExtraTrace,i=s.prototype._dereferenceTrace,ot.longStackTraces=!0,E=function(){if(h.haveItemsQueued()&&!ot.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");s.prototype._captureStackTrace=t,s.prototype._attachExtraTrace=e,s.prototype._dereferenceTrace=i,o.deactivateLongStackTraces(),ot.longStackTraces=!1},s.prototype._captureStackTrace=U,s.prototype._attachExtraTrace=z,s.prototype._dereferenceTrace=W,o.activateLongStackTraces())},s.hasLongStackTraces=function(){return ot.longStackTraces&&K()};var I={unhandledrejection:{before:function(){var t=u.global.onunhandledrejection;return u.global.onunhandledrejection=null,t},after:function(t){u.global.onunhandledrejection=t}},rejectionhandled:{before:function(){var t=u.global.onrejectionhandled;return u.global.onrejectionhandled=null,t},after:function(t){u.global.onrejectionhandled=t}}},R=function(){function o(t,e){if(!t)return!u.global.dispatchEvent(e);var i;try{return i=t.before(),!u.global.dispatchEvent(e)}finally{t.after(i)}}try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return u.global.dispatchEvent(t),function(t,e){t=t.toLowerCase();var i=new CustomEvent(t,{detail:e,cancelable:!0});return d.defineProperty(i,"promise",{value:e.promise}),d.defineProperty(i,"reason",{value:e.reason}),o(I[t],i)}}if("function"!=typeof Event)return(t=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),u.global.dispatchEvent(t),function(t,e){t=t.toLowerCase();var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,!1,!0,e),o(I[t],i)};var t=new Event("CustomEvent");return u.global.dispatchEvent(t),function(t,e){t=t.toLowerCase();var i=new Event(t,{cancelable:!0});return i.detail=e,d.defineProperty(i,"promise",{value:e.promise}),d.defineProperty(i,"reason",{value:e.reason}),o(I[t],i)}}catch(t){}return function(){return!1}}(),P=u.isNode?function(){return rt.emit.apply(rt,arguments)}:u.global?function(t){var e="on"+t.toLowerCase(),i=u.global[e];return!!i&&(i.apply(u.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function L(t,e){return{promise:e}}var k={promiseCreated:L,promiseFulfilled:L,promiseRejected:L,promiseResolved:L,promiseCancelled:L,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:L},M=function(t){var e=!1;try{e=P.apply(null,arguments)}catch(t){h.throwLater(t),e=!0}var i=!1;try{i=R(t,k[t].apply(null,arguments))}catch(t){h.throwLater(t),i=!0}return i||e};function A(){return!1}function D(t,e,i){var o=this;try{t(e,i,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+u.toString(t));o._attachCancellationCallback(t)})}catch(t){return t}}function B(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?u.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function O(){return this._onCancelField}function F(t){this._onCancelField=t}function N(){this._cancellationParent=void 0,this._onCancelField=void 0}function V(t,e){var i;0!=(1&e)&&(void 0===(i=(this._cancellationParent=t)._branchesRemainingToCancel)&&(i=0),t._branchesRemainingToCancel=i+1),0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}s.config=function(t){var e,i;if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?s.longStackTraces():!t.longStackTraces&&s.hasLongStackTraces()&&E()),"warnings"in t&&(e=t.warnings,ot.warnings=!!e,w=ot.warnings,u.isObject(e)&&"wForgottenReturn"in e&&(w=!!e.wForgottenReturn)),"cancellation"in t&&t.cancellation&&!ot.cancellation){if(h.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");s.prototype._clearCancellationData=N,s.prototype._propagateFrom=V,s.prototype._onCancel=O,s.prototype._setOnCancel=F,s.prototype._attachCancellationCallback=B,s.prototype._execute=D,j=V,ot.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!ot.monitoring?(ot.monitoring=!0,s.prototype._fireEvent=M):!t.monitoring&&ot.monitoring&&(ot.monitoring=!1,s.prototype._fireEvent=A)),"asyncHooks"in t&&u.nodeSupportsAsyncResource&&(ot.asyncHooks!==(i=!!t.asyncHooks)&&((ot.asyncHooks=i)?n:r)()),s},s.prototype._fireEvent=A,s.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},s.prototype._onCancel=function(){},s.prototype._setOnCancel=function(t){},s.prototype._attachCancellationCallback=function(t){},s.prototype._captureStackTrace=function(){},s.prototype._attachExtraTrace=function(){},s.prototype._dereferenceTrace=function(){},s.prototype._clearCancellationData=function(){},s.prototype._propagateFrom=function(t,e){};var j=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function H(){var t=this._boundTo;return void 0!==t&&t instanceof s?t.isFulfilled()?t.value():void 0:t}function U(){this._trace=new et(this._peekContext())}function z(t,e){var i,o;p(t)&&(void 0!==(i=this._trace)&&e&&(i=i._parent),void 0!==i?i.attachExtraTrace(t):t.__stackCleaned__||(o=Z(t),u.notEnumerableProp(t,"stack",o.message+"\n"+o.stack.join("\n")),u.notEnumerableProp(t,"__stackCleaned__",!0)))}function W(){this._trace=void 0}function X(t,e,i){var o,n,r;ot.warnings&&(o=new c(t),e?i._attachExtraTrace(o):ot.longStackTraces&&(n=s._peekContext())?n.attachExtraTrace(o):(r=Z(o),o.stack=r.message+"\n"+r.stack.join("\n")),M("warning",o)||q(o,"",!0))}function Y(t){for(var e=[],i=0;i<t.length;++i){var o=t[i],n="    (No stack trace)"===o||_.test(o),r=n&&Q(o);n&&!r&&(y&&" "!==o.charAt(0)&&(o="    "+o),e.push(o))}return e}function Z(t){var e=t.stack,i=t.toString(),e="string"==typeof e&&0<e.length?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var o=e[i];if("    (No stack trace)"===o||_.test(o))break}return 0<i&&"SyntaxError"!=t.name&&(e=e.slice(i)),e}(t):["    (No stack trace)"];return{message:i,stack:"SyntaxError"==t.name?e:Y(e)}}function q(t,e,i){var o,n;"undefined"!=typeof console&&(n=u.isObject(t)?(o=t.stack,e+v(o,t)):e+String(t),"function"==typeof l&&l(n,i))}function G(t,e,i,o){var n=!1;try{"function"==typeof e&&(n=!0,"rejectionHandled"===t?e(o):e(i,o))}catch(t){h.throwLater(t)}"unhandledRejection"===t?M(t,i,o)||n||q(i,"Unhandled rejection "):M(t,o)}function $(t){if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():u.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{var e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){if(t.length<41)return t;return t.substr(0,38)+"..."}(e)+">, no stack trace)"}function K(){return"function"==typeof it}var Q=function(){return!1},J=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function tt(t){var e=t.match(J);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function et(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);it(this,et),32<e&&this.uncycle()}u.inherits(et,Error),(o.CapturedTrace=et).prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},o=0,n=this;void 0!==n;++o)e.push(n),n=n._parent;for(o=(t=this._length=o)-1;0<=o;--o){var r=e[o].stack;void 0===i[r]&&(i[r]=o)}for(o=0;o<t;++o){var s=i[e[o].stack];if(void 0!==s&&s!==o){0<s&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[o]._parent=void 0,e[o]._length=1;var a=0<o?e[o-1]:this;s<t-1?(a._parent=e[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var l=a._length+1,h=o-2;0<=h;--h)e[h]._length=l,l++;return}}}},et.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=Z(t),i=e.message,o=[e.stack],n=this;void 0!==n;)o.push(Y(n.stack.split("\n"))),n=n._parent;!function(t){for(var e=t[0],i=1;i<t.length;++i){for(var o=t[i],n=e.length-1,r=e[n],s=-1,a=o.length-1;0<=a;--a)if(o[a]===r){s=a;break}for(a=s;0<=a;--a){var l=o[a];if(e[n]!==l)break;e.pop(),n--}e=o}}(o),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(o),u.notEnumerableProp(t,"stack",function(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}(i,o)),u.notEnumerableProp(t,"__stackCleaned__",!0)}};var it=function(){function t(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():$(e)}var e=/^\s*at\s*/;if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,_=e,v=t;var i=Error.captureStackTrace;return Q=function(t){return f.test(t)},function(t,e){Error.stackTraceLimit+=6,i(t,e),Error.stackTraceLimit-=6}}var o,n=new Error;if("string"==typeof n.stack&&0<=n.stack.split("\n")[0].indexOf("stackDetection@"))return _=/@/,v=t,y=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){o="stack"in t}return"stack"in n||!o||"number"!=typeof Error.stackTraceLimit?(v=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?$(e):e.toString()},null):(_=e,v=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(l=function(t){},u.isNode&&rt.stderr.isTTY?l=function(t,e){}:u.isNode||"string"!=typeof(new Error).stack||(l=function(t,e){}));var ot={warnings:C,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1};return T&&s.longStackTraces(),{asyncHooks:function(){return ot.asyncHooks},longStackTraces:function(){return ot.longStackTraces},warnings:function(){return ot.warnings},cancellation:function(){return ot.cancellation},monitoring:function(){return ot.monitoring},propagateFromFunction:function(){return j},boundValueFunction:function(){return H},checkForgottenReturns:function(t,e,i,o,n){if(void 0===t&&null!==e&&w){if(void 0!==n&&n._returnedNonUndefined())return;if(0==(65535&o._bitField))return;i&&(i+=" ");var r="",s="";if(e._trace){for(var a=e._trace.stack.split("\n"),l=Y(a),h=l.length-1;0<=h;--h){var c=l[h];if(!g.test(c)){var u=c.match(m);u&&(r="at "+u[1]+":"+u[2]+":"+u[3]+" ");break}}if(0<l.length)for(var d=l[0],h=0;h<a.length;++h)if(a[h]===d){0<h&&(s="\n"+a[h-1]);break}}var p="a promise was created in a "+i+"handler "+r+"but was not returned from it, see http://goo.gl/rRqMUw"+s;o._warn(p,!0,e)}},setBounds:function(t,e){if(K()){for(var i,o,n=(t.stack||"").split("\n"),r=(e.stack||"").split("\n"),s=-1,a=-1,l=0;l<n.length;++l){if(h=tt(n[l])){i=h.fileName,s=h.line;break}}for(var h,l=0;l<r.length;++l){if(h=tt(r[l])){o=h.fileName,a=h.line;break}}s<0||a<0||!i||!o||i!==o||a<=s||(Q=function(t){if(f.test(t))return!0;var e=tt(t);return!!(e&&e.fileName===i&&s<=e.line&&e.line<=a)})}},warn:X,deprecated:function(t,e){var i=t+" is deprecated and will be removed in a future version.";return e&&(i+=" Use "+e+" instead."),X(i)},CapturedTrace:et,fireDomEvent:R,fireGlobalEvent:P}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(t,e,i){"use strict";e.exports=function(i){function o(){return this.value}function n(){throw this.reason}i.prototype.return=i.prototype.thenReturn=function(t){return t instanceof i&&t.suppressUnhandledRejections(),this._then(o,void 0,void 0,{value:t},void 0)},i.prototype.throw=i.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},i.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},i.prototype.catchReturn=function(t){if(arguments.length<=1)return t instanceof i&&t.suppressUnhandledRejections(),this._then(void 0,o,void 0,{value:t},void 0);var e=arguments[1];e instanceof i&&e.suppressUnhandledRejections();return this.caught(t,function(){return e})}}},{}],11:[function(t,e,i){"use strict";e.exports=function(t,i){var o=t.reduce,e=t.all;function n(){return e(this)}t.prototype.each=function(t){return o(this,t,i,0)._then(n,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return o(this,t,i,i)},t.each=function(t,e){return o(t,e,i,0)._then(n,void 0,void 0,t,void 0)},t.mapSeries=function(t,e){return o(t,e,i,i)}}},{}],12:[function(t,e,i){"use strict";var o,n,r=t("./es5"),s=r.freeze,a=t("./util"),l=a.inherits,h=a.notEnumerableProp;function c(e,i){function o(t){if(!(this instanceof o))return new o(t);h(this,"message","string"==typeof t?t:i),h(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(o,Error),o}var u=c("Warning","warning"),d=c("CancellationError","cancellation error"),p=c("TimeoutError","timeout error"),f=c("AggregateError","aggregate error");try{o=TypeError,n=RangeError}catch(t){o=c("TypeError","type error"),n=c("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<g.length;++m)"function"==typeof Array.prototype[g[m]]&&(f.prototype[g[m]]=Array.prototype[g[m]]);r.defineProperty(f.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),f.prototype.isOperational=!0;var _=0;function v(t){if(!(this instanceof v))return new v(t);h(this,"name","OperationalError"),h(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(h(this,"message",t.message),h(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}f.prototype.toString=function(){var t=Array(4*_+1).join(" "),e="\n"+t+"AggregateError of:\n";_++,t=Array(4*_+1).join(" ");for(var i=0;i<this.length;++i){for(var o=this[i]===this?"[Circular AggregateError]":this[i]+"",n=o.split("\n"),r=0;r<n.length;++r)n[r]=t+n[r];e+=(o=n.join("\n"))+"\n"}return _--,e},l(v,Error);var y=Error.__BluebirdErrorTypes__;y||(y=s({CancellationError:d,TimeoutError:p,OperationalError:v,RejectionError:v,AggregateError:f}),r.defineProperty(Error,"__BluebirdErrorTypes__",{value:y,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:o,RangeError:n,CancellationError:y.CancellationError,OperationalError:y.OperationalError,TimeoutError:y.TimeoutError,AggregateError:y.AggregateError,Warning:u}},{"./es5":13,"./util":36}],13:[function(t,e,i){var o,n,r,s,a=function(){"use strict";return void 0===this}();a?e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:a,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}}:(o={}.hasOwnProperty,n={}.toString,r={}.constructor.prototype,s=function(t){var e=[];for(var i in t)o.call(t,i)&&e.push(i);return e},e.exports={isArray:function(t){try{return"[object Array]"===n.call(t)}catch(t){return!1}},keys:s,names:s,defineProperty:function(t,e,i){return t[e]=i.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return r}},isES5:a,propertyIsWritable:function(){return!0}})},{}],14:[function(t,e,i){"use strict";e.exports=function(t,o){var n=t.map;t.prototype.filter=function(t,e){return n(this,t,e,o)},t.filter=function(t,e,i){return n(t,e,i,o)}}},{}],15:[function(t,e,i){"use strict";e.exports=function(a,s,l){var h=t("./util"),c=a.CancellationError,u=h.errorObj,d=t("./catch_filter")(l);function n(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function p(t){this.finallyHandler=t}function f(t,e){return null!=t.cancelPromise&&(1<arguments.length?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,1)}function g(){return _.call(this,this.promise._target()._settledValue())}function m(t){if(!f(this,t))return u.e=t,u}function _(t){var e=this.promise,i=this.handler;if(!this.called){this.called=!0;var o=this.isFinallyHandler()?i.call(e._boundValue()):i.call(e._boundValue(),t);if(o===l)return o;if(void 0!==o){e._setReturnedNonUndefined();var n=s(o,e);if(n instanceof a){if(null!=this.cancelPromise){if(n._isCancelled()){var r=new c("late cancellation observer");return e._attachExtraTrace(r),u.e=r,u}n.isPending()&&n._attachCancellationCallback(new p(this))}return n._then(g,m,void 0,this,void 0)}}}return e.isRejected()?(f(this),u.e=t,u):(f(this),t)}return n.prototype.isFinallyHandler=function(){return 0===this.type},p.prototype._resultCancelled=function(){f(this.finallyHandler)},a.prototype._passThrough=function(t,e,i,o){return"function"!=typeof t?this.then():this._then(i,o,void 0,new n(this,e,t),void 0)},a.prototype.lastly=a.prototype.finally=function(t){return this._passThrough(t,0,_,_)},a.prototype.tap=function(t){return this._passThrough(t,1,_)},a.prototype.tapCatch=function(t){var e=arguments.length;if(1===e)return this._passThrough(t,1,void 0,_);for(var i=new Array(e-1),o=0,n=0;n<e-1;++n){var r=arguments[n];if(!h.isObject(r))return a.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+h.classString(r)));i[o++]=r}i.length=o;var s=arguments[n];return this._passThrough(d(i,s,this),1,void 0,_)},n}},{"./catch_filter":7,"./util":36}],16:[function(i,t,e){"use strict";t.exports=function(a,o,s,l,t,h){var c=i("./errors").TypeError,e=i("./util"),u=e.errorObj,d=e.tryCatch,p=[];function f(t,e,i,o){var n,r;h.cancellation()?(n=new a(s),r=this._finallyPromise=new a(s),this._promise=n.lastly(function(){return r}),n._captureStackTrace(),n._setOnCancel(this)):(this._promise=new a(s))._captureStackTrace(),this._stack=o,this._generatorFunction=t,this._receiver=e,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}e.inherits(f,t),f.prototype._isResolved=function(){return null===this._promise},f.prototype._cleanup=function(){this._promise=this._generator=null,h.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},f.prototype._promiseCancelled=function(){var t,e;this._isResolved()||(e=void 0!==this._generator.return?(this._promise._pushContext(),d(this._generator.return).call(this._generator,void 0)):(t=new a.CancellationError("generator .return() sentinel"),a.coroutine.returnSentinel=t,this._promise._attachExtraTrace(t),this._promise._pushContext(),d(this._generator.throw).call(this._generator,t)),this._promise._popContext(),this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e))},f.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=d(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},f.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=d(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},f.prototype._resultCancelled=function(){var t;this._yieldedPromise instanceof a&&(t=this._yieldedPromise,this._yieldedPromise=null,t.cancel())},f.prototype.promise=function(){return this._promise},f.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},f.prototype._continue=function(t){var e=this._promise;if(t===u)return this._cleanup(),this._cancellationPhase?e.cancel():e._rejectCallback(t.e,!1);var i=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?e.cancel():e._resolveCallback(i);var o,n=l(i,this._promise);n instanceof a||null!==(n=function(t,e,i){for(var o=0;o<e.length;++o){i._pushContext();var n=d(e[o])(t);if(i._popContext(),n===u){i._pushContext();var r=a.reject(u.e);return i._popContext(),r}var s=l(n,i);if(s instanceof a)return s}return null}(n,this._yieldHandlers,this._promise))?0==(50397184&(o=(n=n._target())._bitField))?(this._yieldedPromise=n)._proxy(this,null):0!=(33554432&o)?a._async.invoke(this._promiseFulfilled,this,n._value()):0!=(16777216&o)?a._async.invoke(this._promiseRejected,this,n._reason()):this._promiseCancelled():this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(i))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},a.coroutine=function(o,t){if("function"!=typeof o)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=f,s=(new Error).stack;return function(){var t=o.apply(this,arguments),e=new r(void 0,void 0,n,s),i=e.promise();return e._generator=t,e._promiseFulfilled(void 0),i}},a.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new c("expecting a function but got "+e.classString(t));p.push(t)},a.spawn=function(t){if(h.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return o("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var e=new f(t,this),i=e.promise();return e._run(a.spawn),i}}},{"./errors":12,"./util":36}],17:[function(s,t,e){"use strict";t.exports=function(t,n,e,i,o){var r=s("./util");r.canEvaluate,r.tryCatch,r.errorObj;t.join=function(){var t,e=arguments.length-1;0<e&&"function"==typeof arguments[e]&&(t=arguments[e]);var i=[].slice.call(arguments);t&&i.pop();var o=new n(i).promise();return void 0!==t?o.spread(t):o}}},{"./util":36}],18:[function(e,t,i){"use strict";t.exports=function(p,t,r,f,a,g){var l=e("./util"),m=l.tryCatch,_=l.errorObj,h=p._async;function s(t,e,i,o){this.constructor$(t),this._promise._captureStackTrace();var n=p._getContext();if(this._callback=l.contextBind(n,e),this._preservedValues=o===a?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0),l.isArray(t))for(var r=0;r<t.length;++r){var s=t[r];s instanceof p&&s.suppressUnhandledRejections()}}function i(t,e,i,o){if("function"!=typeof e)return r("expecting a function but got "+l.classString(e));var n=0;if(void 0!==i){if("object"!=typeof i||null===i)return p.reject(new TypeError("options argument must be an object but it is "+l.classString(i)));if("number"!=typeof i.concurrency)return p.reject(new TypeError("'concurrency' must be a number but it is "+l.classString(i.concurrency)));n=i.concurrency}return new s(t,e,n="number"==typeof n&&isFinite(n)&&1<=n?n:0,o).promise()}l.inherits(s,t),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,e){var i=this._values,o=this.length(),n=this._preservedValues,r=this._limit;if(e<0){if(i[e=-1*e-1]=t,1<=r&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(1<=r&&this._inFlight>=r)return i[e]=t,this._queue.push(e),!1;null!==n&&(n[e]=t);var s=this._promise,a=this._callback,l=s._boundValue();s._pushContext();var h=m(a).call(l,t,e,o),c=s._popContext();if(g.checkForgottenReturns(h,c,null!==n?"Promise.filter":"Promise.map",s),h===_)return this._reject(h.e),!0;var u=f(h,this._promise);if(u instanceof p){var d=(u=u._target())._bitField;if(0==(50397184&d))return 1<=r&&this._inFlight++,(i[e]=u)._proxy(this,-1*(e+1)),!1;if(0==(33554432&d))return 0!=(16777216&d)?this._reject(u._reason()):this._cancel(),!0;h=u._value()}i[e]=h}return o<=++this._totalResolved&&(null!==n?this._filter(i,n):this._resolve(i),!0)},s.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;0<t.length&&this._inFlight<e;){if(this._isResolved())return;var o=t.pop();this._promiseFulfilled(i[o],o)}},s.prototype._filter=function(t,e){for(var i=e.length,o=new Array(i),n=0,r=0;r<i;++r)t[r]&&(o[n++]=e[r]);o.length=n,this._resolve(o)},s.prototype.preservedValues=function(){return this._preservedValues},p.prototype.map=function(t,e){return i(this,t,e,null)},p.map=i}},{"./util":36}],19:[function(e,t,i){"use strict";t.exports=function(s,a,t,l,h){var c=e("./util"),u=c.tryCatch;s.method=function(o){if("function"!=typeof o)throw new s.TypeError("expecting a function but got "+c.classString(o));return function(){var t=new s(a);t._captureStackTrace(),t._pushContext();var e=u(o).apply(this,arguments),i=t._popContext();return h.checkForgottenReturns(e,i,"Promise.method",t),t._resolveFromSyncValue(e),t}},s.attempt=s.try=function(t){if("function"!=typeof t)return l("expecting a function but got "+c.classString(t));var e,i,o,n=new s(a);n._captureStackTrace(),n._pushContext(),o=1<arguments.length?(h.deprecated("calling Promise.try with more than 1 argument"),e=arguments[1],i=arguments[2],c.isArray(e)?u(t).apply(i,e):u(t).call(i,e)):u(t)();var r=n._popContext();return h.checkForgottenReturns(o,r,"Promise.try",n),n._resolveFromSyncValue(o),n},s.prototype._resolveFromSyncValue=function(t){t===c.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,i){"use strict";var s=t("./util"),a=s.maybeWrapAsError,l=t("./errors").OperationalError,h=t("./es5");var c=/^(?:name|message|stack|cause)$/;function u(t){var e,i;if((i=t)instanceof Error&&h.getPrototypeOf(i)===Error.prototype){(e=new l(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var o=h.keys(t),n=0;n<o.length;++n){var r=o[n];c.test(r)||(e[r]=t[r])}return e}return s.markAsOriginatingFromRejection(t),t}e.exports=function(n,r){return function(t,e){var i,o;null!==n&&(t?(i=u(a(t)),n._attachExtraTrace(i),n._reject(i)):r?(o=[].slice.call(arguments,1),n._fulfill(o)):n._fulfill(e),n=null)}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,i){"use strict";t.exports=function(t){var o=e("./util"),n=t._async,r=o.tryCatch,s=o.errorObj;function a(t,e){if(!o.isArray(t))return l.call(this,t,e);var i=r(e).apply(this._boundValue(),[null].concat(t));i===s&&n.throwLater(i.e)}function l(t,e){var i=this._boundValue(),o=void 0===t?r(e).call(i,null):r(e).call(i,null,t);o===s&&n.throwLater(o.e)}function h(t,e){var i;t||((i=new Error(t+"")).cause=t,t=i);var o=r(e).call(this._boundValue(),t);o===s&&n.throwLater(o.e)}t.prototype.asCallback=t.prototype.nodeify=function(t,e){var i;return"function"==typeof t&&(i=l,void 0!==e&&Object(e).spread&&(i=a),this._then(i,h,void 0,this,t)),this}}},{"./util":36}],22:[function(D,B,t){"use strict";B.exports=function(){function l(){return new d("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")}function a(){return new L.PromiseInspection(this._target())}function s(t){return L.reject(new d(t))}function h(){}var c={},p=D("./util");p.setReflectHandler(a);function t(){var t=rt.domain;return void 0===t?null:t}function e(){return{domain:t(),async:null}}function i(){return{domain:t(),async:new o("Bluebird::Promise")}}var o=p.isNode&&p.nodeSupportsAsyncResource?D("async_hooks").AsyncResource:null,f=p.isNode?e:function(){return null};p.notEnumerableProp(L,"_getContext",f);var n=D("./es5"),r=D("./async"),g=new r;n.defineProperty(L,"_async",{value:g});var u=D("./errors"),d=L.TypeError=u.TypeError;L.RangeError=u.RangeError;var m=L.CancellationError=u.CancellationError;L.TimeoutError=u.TimeoutError,L.OperationalError=u.OperationalError,L.RejectionError=u.OperationalError,L.AggregateError=u.AggregateError;var _=function(){},v={},y={},b=D("./thenables")(L,_),C=D("./promise_array")(L,_,b,s,h),T=D("./context")(L),w=T.create,x=D("./debuggability")(L,T,function(){f=i,p.notEnumerableProp(L,"_getContext",i)},function(){f=e,p.notEnumerableProp(L,"_getContext",e)}),S=(x.CapturedTrace,D("./finally")(L,b,y)),E=D("./catch_filter")(y),I=D("./nodeback"),R=p.errorObj,P=p.tryCatch;function L(t){t!==_&&function(t,e){if(null==t||t.constructor!==L)throw new d("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new d("expecting a function but got "+p.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function k(t){this.promise._resolveCallback(t)}function M(t){this.promise._rejectCallback(t,!1)}function A(t){var e=new L(_);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return L.prototype.toString=function(){return"[object Promise]"},L.prototype.caught=L.prototype.catch=function(t){var e=arguments.length;if(1<e){for(var i=new Array(e-1),o=0,n=0;n<e-1;++n){var r=arguments[n];if(!p.isObject(r))return s("Catch statement predicate: expecting an object but got "+p.classString(r));i[o++]=r}if(i.length=o,"function"!=typeof(t=arguments[n]))throw new d("The last argument to .catch() must be a function, got "+p.toString(t));return this.then(void 0,E(i,t,this))}return this.then(void 0,t)},L.prototype.reflect=function(){return this._then(a,a,void 0,this,void 0)},L.prototype.then=function(t,e){var i;return x.warnings()&&0<arguments.length&&"function"!=typeof t&&"function"!=typeof e&&(i=".then() only accepts functions but was passed: "+p.classString(t),1<arguments.length&&(i+=", "+p.classString(e)),this._warn(i)),this._then(t,e,void 0,void 0,void 0)},L.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},L.prototype.spread=function(t){return"function"!=typeof t?s("expecting a function but got "+p.classString(t)):this.all()._then(t,void 0,void 0,v,void 0)},L.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},L.prototype.all=function(){return 0<arguments.length&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},L.prototype.error=function(t){return this.caught(p.originatesFromRejection,t)},L.getNewLibraryCopy=B.exports,L.is=function(t){return t instanceof L},L.fromNode=L.fromCallback=function(t){var e=new L(_);e._captureStackTrace();var i=1<arguments.length&&!!Object(arguments[1]).multiArgs,o=P(t)(I(e,i));return o===R&&e._rejectCallback(o.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},L.all=function(t){return new C(t).promise()},L.resolve=L.fulfilled=L.cast=function(t){var e=b(t);return e instanceof L||((e=new L(_))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},L.reject=L.rejected=function(t){var e=new L(_);return e._captureStackTrace(),e._rejectCallback(t,!0),e},L.setScheduler=function(t){if("function"!=typeof t)throw new d("expecting a function but got "+p.classString(t));return g.setScheduler(t)},L.prototype._then=function(t,e,i,o,n){var r=void 0!==n,s=r?n:new L(_),a=this._target(),l=a._bitField;r||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===o&&0!=(2097152&this._bitField)&&(o=0!=(50397184&l)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var h,c,u,d=f();return 0!=(50397184&l)?(u=a._settlePromiseCtx,0!=(33554432&l)?(c=a._rejectionHandler0,h=t):0!=(16777216&l)?(c=a._fulfillmentHandler0,h=e,a._unsetRejectionIsUnhandled()):(u=a._settlePromiseLateCancellationObserver,c=new m("late cancellation observer"),a._attachExtraTrace(c),h=e),g.invoke(u,a,{handler:p.contextBind(d,h),promise:s,receiver:o,value:c})):a._addCallbacks(t,e,s,o,d),s},L.prototype._length=function(){return 65535&this._bitField},L.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},L.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},L.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},L.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},L.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},L.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},L.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},L.prototype._isFinal=function(){return 0<(4194304&this._bitField)},L.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},L.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},L.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},L.prototype._setAsyncGuaranteed=function(){var t;g.hasCustomScheduler()||(t=this._bitField,this._bitField=t|(536870912&t)>>2^134217728)},L.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},L.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==c)return void 0===e&&this._isBound()?this._boundValue():e},L.prototype._promiseAt=function(t){return this[4*t-4+2]},L.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4]},L.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},L.prototype._boundValue=function(){},L.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,i=t._rejectionHandler0,o=t._promise0,n=t._receiverAt(0);void 0===n&&(n=c),this._addCallbacks(e,i,o,n,null)},L.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),o=t._rejectionHandlerAt(e),n=t._promiseAt(e),r=t._receiverAt(e);void 0===r&&(r=c),this._addCallbacks(i,o,n,r,null)},L.prototype._addCallbacks=function(t,e,i,o,n){var r,s=this._length();return 65531<=s&&(s=0,this._setLength(0)),0===s?(this._promise0=i,this._receiver0=o,"function"==typeof t&&(this._fulfillmentHandler0=p.contextBind(n,t)),"function"==typeof e&&(this._rejectionHandler0=p.contextBind(n,e))):(this[2+(r=4*s-4)]=i,this[3+r]=o,"function"==typeof t&&(this[r]=p.contextBind(n,t)),"function"==typeof e&&(this[1+r]=p.contextBind(n,e))),this._setLength(s+1),s},L.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},L.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(l(),!1);var i=b(t,this);if(!(i instanceof L))return this._fulfill(t);e&&this._propagateFrom(i,2);var o=i._target();if(o!==this){var n,r=o._bitField;if(0==(50397184&r)){var s=this._length();0<s&&o._migrateCallback0(this);for(var a=1;a<s;++a)o._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else{0!=(33554432&r)?this._fulfill(o._value()):0!=(16777216&r)?this._reject(o._reason()):(n=new m("late cancellation observer"),o._attachExtraTrace(n),this._reject(n))}}else this._reject(l())}},L.prototype._rejectCallback=function(t,e,i){var o,n=p.ensureErrorObject(t),r=n===t;r||i||!x.warnings()||(o="a promise was rejected with a non-error: "+p.classString(t),this._warn(o,!0)),this._attachExtraTrace(n,!!e&&r),this._reject(t)},L.prototype._resolveFromExecutor=function(t){var e,i,o;t!==_&&((e=this)._captureStackTrace(),this._pushContext(),o=!0,i=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,o)}),o=!1,this._popContext(),void 0!==i&&e._rejectCallback(i,!0))},L.prototype._settlePromiseFromHandler=function(t,e,i,o){var n,r;0==(65536&o._bitField)&&(o._pushContext(),e===v?i&&"number"==typeof i.length?n=P(t).apply(this._boundValue(),i):(n=R).e=new d("cannot .spread() a non-array: "+p.classString(i)):n=P(t).call(e,i),r=o._popContext(),0==(65536&o._bitField)&&(n===y?o._reject(i):n===R?o._rejectCallback(n.e,!1):(x.checkForgottenReturns(n,r,"",o,this),o._resolveCallback(n))))},L.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},L.prototype._followee=function(){return this._rejectionHandler0},L.prototype._setFollowee=function(t){this._rejectionHandler0=t},L.prototype._settlePromise=function(t,e,i,o){var n=t instanceof L,r=this._bitField,s=0!=(134217728&r);0!=(65536&r)?(n&&t._invokeInternalOnCancel(),i instanceof S&&i.isFinallyHandler()?(i.cancelPromise=t,P(e).call(i,o)===R&&t._reject(R.e)):e===a?t._fulfill(a.call(i)):i instanceof h?i._promiseCancelled(t):n||t instanceof C?t._cancel():i.cancel()):"function"==typeof e?n?(s&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,o,t)):e.call(i,o,t):i instanceof h?i._isResolved()||(0!=(33554432&r)?i._promiseFulfilled(o,t):i._promiseRejected(o,t)):n&&(s&&t._setAsyncGuaranteed(),0!=(33554432&r)?t._fulfill(o):t._reject(o))},L.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,o=t.receiver,n=t.value;"function"==typeof e?i instanceof L?this._settlePromiseFromHandler(e,o,n,i):e.call(o,n,i):i instanceof L&&i._reject(n)},L.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},L.prototype._settlePromise0=function(t,e,i){var o=this._promise0,n=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(o,t,n,e)},L.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[2+e]=this[3+e]=this[e]=this[1+e]=void 0},L.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=l();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,0<(65535&e)&&(0!=(134217728&e)?this._settlePromises():g.settlePromises(this),this._dereferenceTrace())}},L.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return g.fatalError(t,p.isNode);0<(65535&e)?g.settlePromises(this):this._ensurePossibleRejectionHandled()}},L.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var o=this._fulfillmentHandlerAt(i),n=this._promiseAt(i),r=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(n,o,r,e)}},L.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var o=this._rejectionHandlerAt(i),n=this._promiseAt(i),r=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(n,o,r,e)}},L.prototype._settlePromises=function(){var t,e,i=this._bitField,o=65535&i;0<o&&(0!=(16842752&i)?(t=this._fulfillmentHandler0,this._settlePromise0(this._rejectionHandler0,t,i),this._rejectPromises(o,t)):(e=this._rejectionHandler0,this._settlePromise0(this._fulfillmentHandler0,e,i),this._fulfillPromises(o,e)),this._setLength(0)),this._clearCancellationData()},L.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&n.defineProperty(L.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),L.defer=L.pending=function(){return x.deprecated("Promise.defer","new Promise"),{promise:new L(_),resolve:k,reject:M}},p.notEnumerableProp(L,"_makeSelfResolutionError",l),D("./method")(L,_,b,s,x),D("./bind")(L,_,b,x),D("./cancel")(L,C,s,x),D("./direct_resolve")(L),D("./synchronous_inspection")(L),D("./join")(L,C,b,_,g),(L.Promise=L).version="3.7.2",D("./call_get.js")(L),D("./generators.js")(L,s,_,b,h,x),D("./map.js")(L,C,s,b,_,x),D("./nodeify.js")(L),D("./promisify.js")(L,_),D("./props.js")(L,C,b,s),D("./race.js")(L,_,b,s),D("./reduce.js")(L,C,s,b,_,x),D("./settle.js")(L,C,x),D("./some.js")(L,C,s),D("./timers.js")(L,_,x),D("./using.js")(L,s,b,w,_,x),D("./any.js")(L),D("./each.js")(L,_),D("./filter.js")(L,_),p.toFastProperties(L),p.toFastProperties(L.prototype),A({a:1}),A({b:2}),A({c:3}),A(1),A(function(){}),A(void 0),A(!1),A(new L(_)),x.setBounds(r.firstLineError,p.lastLineError),L}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(o,t,e){"use strict";t.exports=function(a,i,l,s,t){var h=o("./util");h.isArray;function e(t){var e=this._promise=new a(i);t instanceof a&&(e._propagateFrom(t,3),t.suppressUnhandledRejections()),e._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return h.inherits(e,t),e.prototype.length=function(){return this._length},e.prototype.promise=function(){return this._promise},e.prototype._init=function t(e,i){var o,n=l(this._values,this._promise);if(n instanceof a){var r=(n=n._target())._bitField;if(this._values=n,0==(50397184&r))return this._promise._setAsyncGuaranteed(),n._then(t,this._reject,void 0,this,i);if(0==(33554432&r))return 0!=(16777216&r)?this._reject(n._reason()):this._cancel();n=n._value()}null!==(n=h.asArray(n))?0!==n.length?this._iterate(n):-5===i?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(i)):(o=s("expecting an array or an iterable object but got "+h.classString(n)).reason(),this._promise._rejectCallback(o,!1))},e.prototype._iterate=function(t){var e=this.getActualLength(t.length);this._length=e,this._values=this.shouldCopyValues()?new Array(e):this._values;for(var i=this._promise,o=!1,n=null,r=0;r<e;++r){var s=l(t[r],i),n=s instanceof a?(s=s._target())._bitField:null;o?null!==n&&s.suppressUnhandledRejections():null!==n?0==(50397184&n)?(s._proxy(this,r),this._values[r]=s):o=0!=(33554432&n)?this._promiseFulfilled(s._value(),r):0!=(16777216&n)?this._promiseRejected(s._reason(),r):this._promiseCancelled(r):o=this._promiseFulfilled(s,r)}o||i._setAsyncGuaranteed()},e.prototype._isResolved=function(){return null===this._values},e.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},e.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},e.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},e.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},e.prototype._promiseCancelled=function(){return this._cancel(),!0},e.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},e.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof a)t.cancel();else for(var e=0;e<t.length;++e)t[e]instanceof a&&t[e].cancel()}},e.prototype.shouldCopyValues=function(){return!0},e.prototype.getActualLength=function(t){return t},e}},{"./util":36}],24:[function(i,t,e){"use strict";t.exports=function(h,c){var p={},f=i("./util"),u=i("./nodeback"),d=f.withAppended,g=f.maybeWrapAsError,t=f.canEvaluate,m=i("./errors").TypeError,_={__isPromisified__:!0},e=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),v=function(t){return f.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function s(t){return!e.test(t)}function y(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function b(t,e,i,o){for(var n,r,s,a,l=f.inheritedDataKeys(t),h=[],c=0;c<l.length;++c){var u=l[c],d=t[u],p=o===v||v(u,d,t);"function"!=typeof d||y(d)||(n=t,r=u,s=e,a=void 0,(a=f.getDataPropertyOrDefault(n,r+s,_))&&y(a))||!o(u,d,t,p)||h.push(u,d)}return function(t,e,i){for(var o=0;o<t.length;o+=2){var n=t[o];if(i.test(n))for(var r=n.replace(i,""),s=0;s<t.length;s+=2)if(t[s]===r)throw new m("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(h,e,i),h}var C=function(t){return t.replace(/([$])/,"\\$")};var T=t?void 0:function(n,r,t,e,i,s){var a=function(){return this}(),l=n;function o(){var t=r;r===p&&(t=this);var e=new h(c);e._captureStackTrace();var i="string"==typeof l&&this!==a?this[l]:n,o=u(e,s);try{i.apply(t,d(arguments,o))}catch(t){e._rejectCallback(g(t),!0,!0)}return e._isFateSealed()||e._setAsyncGuaranteed(),e}return"string"==typeof l&&(n=e),f.notEnumerableProp(o,"__isPromisified__",!0),o};function w(t,e,i,o,n){for(var r=new RegExp(C(e)+"$"),s=b(t,e,r,i),a=0,l=s.length;a<l;a+=2){var h,c=s[a],u=s[a+1],d=c+e;o===T?t[d]=T(c,p,c,u,e,n):(h=o(u,function(){return T(c,p,c,u,e,n)}),f.notEnumerableProp(h,"__isPromisified__",!0),t[d]=h)}return f.toFastProperties(t),t}h.promisify=function(t,e){if("function"!=typeof t)throw new m("expecting a function but got "+f.classString(t));if(y(t))return t;var i,o=void 0===(e=Object(e)).context?p:e.context,n=!!e.multiArgs,r=T(i=t,o,void 0,i,null,n);return f.copyDescriptors(t,r,s),r},h.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new m("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var i=!!(e=Object(e)).multiArgs,o=e.suffix;"string"!=typeof o&&(o="Async");var n=e.filter;"function"!=typeof n&&(n=v);var r=e.promisifier;if("function"!=typeof r&&(r=T),!f.isIdentifier(o))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=f.inheritedDataKeys(t),a=0;a<s.length;++a){var l=t[s[a]];"constructor"!==s[a]&&f.isClass(l)&&(w(l.prototype,o,n,r,i),w(l,o,n,r,i))}return w(t,o,n,r,i)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(f,t,e){"use strict";t.exports=function(o,t,n,r){var a,e=f("./util"),s=e.isObject,l=f("./es5");"function"==typeof Map&&(a=Map);var i,h,c=(h=0,function(t){i=t.size,h=0;var e=new Array(2*t.size);return t.forEach(u,e),e});function u(t,e){this[h]=t,this[h+i]=e,h++}function d(t){var e=!1;if(void 0!==a&&t instanceof a)n=c(t),e=!0;else for(var i=l.keys(t),o=i.length,n=new Array(2*o),r=0;r<o;++r){var s=i[r];n[r]=t[s],n[r+o]=s}this.constructor$(n),this._isMap=e,this._init$(void 0,e?-6:-3)}function p(t){var e,i=n(t);return s(i)?(e=i instanceof o?i._then(o.props,void 0,void 0,void 0,void 0):new d(i).promise(),i instanceof o&&e._propagateFrom(i,2),e):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}e.inherits(d,t),d.prototype._init=function(){},d.prototype._promiseFulfilled=function(t,e){var i;if(this._values[e]=t,++this._totalResolved>=this._length){if(this._isMap)i=function(t){for(var e=new a,i=t.length/2|0,o=0;o<i;++o){var n=t[i+o],r=t[o];e.set(n,r)}return e}(this._values);else{i={};for(var o=this.length(),n=0,r=this.length();n<r;++n)i[this._values[n+o]]=this._values[n]}return this._resolve(i),!0}return!1},d.prototype.shouldCopyValues=function(){return!1},d.prototype.getActualLength=function(t){return t>>1},o.prototype.props=function(){return p(this)},o.props=p}},{"./es5":13,"./util":36}],26:[function(t,e,i){"use strict";function o(t){this._capacity=t,this._length=0,this._front=0}o.prototype._willBeOverCapacity=function(t){return this._capacity<t},o.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},o.prototype.push=function(t,e,i){var o=this.length()+3;if(this._willBeOverCapacity(o))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var n=this._front+o-3;this._checkCapacity(o);var r=this._capacity-1;this[n&r]=t,this[1+n&r]=e,this[2+n&r]=i,this._length=o},o.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},o.prototype.length=function(){return this._length},o.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},o.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,i,o,n){for(var r=0;r<n;++r)i[r+o]=t[r+e],t[r+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},e.exports=o},{}],27:[function(t,e,i){"use strict";e.exports=function(h,c,u,d){var p=t("./util"),f=function(e){return e.then(function(t){return i(t,e)})};function i(t,e){var i=u(t);if(i instanceof h)return f(i);if(null===(t=p.asArray(t)))return d("expecting an array or an iterable object but got "+p.classString(t));var o=new h(c);void 0!==e&&o._propagateFrom(e,3);for(var n=o._fulfill,r=o._reject,s=0,a=t.length;s<a;++s){var l=t[s];(void 0!==l||s in t)&&h.cast(l)._then(n,r,void 0,o,null)}return o}h.race=function(t){return i(t,void 0)},h.prototype.race=function(){return i(this,void 0)}}},{"./util":36}],28:[function(e,t,i){"use strict";t.exports=function(a,t,n,i,r,s){var l=e("./util"),h=l.tryCatch;function c(t,e,i,o){this.constructor$(t);var n=a._getContext();this._fn=l.contextBind(n,e),void 0!==i&&(i=a.resolve(i))._attachCancellationCallback(this),this._initialValue=i,this._currentCancellable=null,this._eachValues=o===r?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function o(t,e,i,o){return"function"!=typeof e?n("expecting a function but got "+l.classString(e)):new c(t,e,i,o).promise()}function d(t){this.accum=t,this.array._gotAccum(t);var e=i(this.value,this.array._promise);return e instanceof a?(this.array._currentCancellable=e)._then(p,void 0,void 0,this,void 0):p.call(this,e)}function p(t){var e,i=this.array,o=i._promise,n=h(i._fn);o._pushContext(),(e=void 0!==i._eachValues?n.call(o._boundValue(),t,this.index,this.length):n.call(o._boundValue(),this.accum,t,this.index,this.length))instanceof a&&(i._currentCancellable=e);var r=o._popContext();return s.checkForgottenReturns(e,r,void 0!==i._eachValues?"Promise.each":"Promise.reduce",o),e}l.inherits(c,t),c.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==r&&this._eachValues.push(t)},c.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},c.prototype._init=function(){},c.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},c.prototype.shouldCopyValues=function(){return!1},c.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},c.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof a&&this._currentCancellable.cancel(),this._initialValue instanceof a&&this._initialValue.cancel())},c.prototype._iterate=function(t){var e=(this._values=t).length,i=void 0!==this._initialValue?(s=this._initialValue,0):(s=a.resolve(t[0]),1);this._currentCancellable=s;for(var o=i;o<e;++o){var n=t[o];n instanceof a&&n.suppressUnhandledRejections()}if(!s.isRejected())for(;i<e;++i){var r={accum:null,value:t[i],index:i,length:e,array:this},s=s._then(d,void 0,void 0,r,void 0);0==(127&i)&&s._setNoAsyncGuarantee()}void 0!==this._eachValues&&(s=s._then(this._eachComplete,void 0,void 0,this,void 0)),s._then(u,u,void 0,s,this)},a.prototype.reduce=function(t,e){return o(this,t,e,null)},a.reduce=o}},{"./util":36}],29:[function(t,e,i){"use strict";var o,n,r,s,a=t("./util"),l=a.getNativePromise();r=a.isNode&&"undefined"==typeof MutationObserver?(o=z.setImmediate,n=rt.nextTick,a.isRecentNode?function(t){o.call(z,t)}:function(t){n.call(rt,t)}):"function"==typeof l&&"function"==typeof l.resolve?(s=l.resolve(),function(t){s.then(t)}):"undefined"!=typeof MutationObserver&&("undefined"==typeof window||!window.navigator||!window.navigator.standalone&&!window.cordova)&&"classList"in document.documentElement?function(){var i=document.createElement("div"),o={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){i.classList.toggle("foo"),n=!1}).observe(r,o);return function(t){var e=new MutationObserver(function(){e.disconnect(),t()});e.observe(i,o),n||(n=!0,r.classList.toggle("foo"))}}():void 0!==h?function(t){h(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},e.exports=r},{"./util":36}],30:[function(r,t,e){"use strict";t.exports=function(t,e,i){var o=t.PromiseInspection;function n(t){this.constructor$(t)}r("./util").inherits(n,e),n.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},n.prototype._promiseFulfilled=function(t,e){var i=new o;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},n.prototype._promiseRejected=function(t,e){var i=new o;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},t.settle=function(t){return i.deprecated(".settle()",".reflect()"),new n(t).promise()},t.allSettled=function(t){return new n(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(c,t,e){"use strict";t.exports=function(t,e,n){var i=c("./util"),o=c("./errors").RangeError,r=c("./errors").AggregateError,s=i.isArray,a={};function l(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function h(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new l(t),o=i.promise();return i.setHowMany(e),i.init(),o}i.inherits(l,e),l.prototype._init=function(){var t;this._initialized&&(0!==this._howMany?(this._init$(void 0,-5),t=s(this._values),!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))):this._resolve([]))},l.prototype.init=function(){this._initialized=!0,this._init()},l.prototype.setUnwrap=function(){this._unwrap=!0},l.prototype.howMany=function(){return this._howMany},l.prototype.setHowMany=function(t){this._howMany=t},l.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},l.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},l.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(a),this._checkOutcome())},l.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new r,e=this.length();e<this._values.length;++e)this._values[e]!==a&&t.push(this._values[e]);return 0<t.length?this._reject(t):this._cancel(),!0}return!1},l.prototype._fulfilled=function(){return this._totalResolved},l.prototype._rejected=function(){return this._values.length-this.length()},l.prototype._addRejected=function(t){this._values.push(t)},l.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},l.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},l.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new o(e)},l.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=h,t.prototype.some=function(t){return h(this,t)},t._SomePromiseArray=l}},{"./errors":12,"./util":36}],32:[function(t,e,i){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},o=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},r=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return r.call(this._target())},t.prototype.isFulfilled=function(){return n.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),o.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,i){"use strict";e.exports=function(a,l){var h=t("./util"),c=h.errorObj,n=h.isObject;var r={}.hasOwnProperty;return function(t,e){if(n(t)){if(t instanceof a)return t;var i=function(t){try{return t.then}catch(t){return c.e=t,c}}(t);if(i===c){e&&e._pushContext();var o=a.reject(i.e);return e&&e._popContext(),o}if("function"==typeof i){if(function(t){try{return r.call(t,"_promise0")}catch(t){return!1}}(t)){o=new a(l);return t._then(o._fulfill,o._reject,void 0,o,null),o}return function(t,e,i){var o=new a(l),n=o;i&&i._pushContext();o._captureStackTrace(),i&&i._popContext();var r=!0,s=h.tryCatch(e).call(t,function(t){if(!o)return;o._resolveCallback(t),o=null},function(t){if(!o)return;o._rejectCallback(t,r,!0),o=null});r=!1,o&&s===c&&(o._rejectCallback(s.e,!0,!0),o=null);return n}(t,i,e)}}return t}}},{"./util":36}],34:[function(t,e,i){"use strict";e.exports=function(n,r,a){var l=t("./util"),h=n.TimeoutError;function c(t){this.handle=t}c.prototype._resultCancelled=function(){clearTimeout(this.handle)};function s(t){return e(+this).thenReturn(t)}var e=n.delay=function(t,e){var i,o;return void 0!==e?(i=n.resolve(e)._then(s,null,null,t,void 0),a.cancellation()&&e instanceof n&&i._setOnCancel(e)):(i=new n(r),o=setTimeout(function(){i._fulfill()},+t),a.cancellation()&&i._setOnCancel(new c(o)),i._captureStackTrace()),i._setAsyncGuaranteed(),i};n.prototype.delay=function(t){return e(t,this)};function i(t){return clearTimeout(this.handle),t}function o(t){throw clearTimeout(this.handle),t}n.prototype.timeout=function(t,n){var r,s;t=+t;var e=new c(setTimeout(function(){var t,e,i,o;r.isPending()&&(t=r,i=s,o="string"!=typeof(e=n)?e instanceof Error?e:new h("operation timed out"):new h(e),l.markAsOriginatingFromRejection(o),t._attachExtraTrace(o),t._reject(o),null!=i&&i.cancel())},t));return a.cancellation()?(s=this.then(),(r=s._then(i,o,void 0,e,void 0))._setOnCancel(e)):r=this._then(i,o,void 0,e,void 0),r}}},{"./util":36}],35:[function(s,t,e){"use strict";t.exports=function(d,p,f,e,t,g){var m=s("./util"),i=s("./errors").TypeError,o=s("./util").inherits,_=m.errorObj,v=m.tryCatch,n={};function h(t){setTimeout(function(){throw t},0)}function y(n,r){var s=0,a=n.length,l=new d(t);return function t(){if(a<=s)return l._fulfill();var e,i,o=(e=n[s++],(i=f(e))!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&i._setDisposable(e._getDisposer()),i);if(o instanceof d&&o._isDisposable()){try{o=f(o._getDisposer().tryDispose(r),n.promise)}catch(t){return h(t)}if(o instanceof d)return o._then(t,h,null,null,null)}t()}(),l}function b(t,e,i){this._data=t,this._promise=e,this._context=i}function r(t,e,i){this.constructor$(t,e,i)}function C(t){return b.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function T(t){this.length=t,this.promise=null,this[t-1]=null}b.prototype.data=function(){return this._data},b.prototype.promise=function(){return this._promise},b.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():n},b.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var o=e!==n?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,o},b.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},o(r,b),r.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},T.prototype._resultCancelled=function(){for(var t=this.length,e=0;e<t;++e){var i=this[e];i instanceof d&&i.cancel()}},d.using=function(){var t=arguments.length;if(t<2)return p("you must pass at least 2 arguments to Promise.using");var e,r=arguments[t-1];if("function"!=typeof r)return p("expecting a function but got "+m.classString(r));var s=!0;2===t&&Array.isArray(arguments[0])?(t=(e=arguments[0]).length,s=!1):(e=arguments,t--);for(var i=new T(t),o=0;o<t;++o){var n,a,l=e[o];b.isDisposer(l)?(l=(n=l).promise())._setDisposable(n):(a=f(l))instanceof d&&(l=a._then(C,null,null,{resources:i,index:o},void 0)),i[o]=l}for(var h=new Array(i.length),o=0;o<h.length;++o)h[o]=d.resolve(i[o]).reflect();var c=d.all(h).then(function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return _.e=i.error(),_;if(!i.isFulfilled())return void c.cancel();t[e]=i.value()}u._pushContext(),r=v(r);var o=s?r.apply(void 0,t):r(t),n=u._popContext();return g.checkForgottenReturns(o,n,"Promise.using",u),o}),u=c.lastly(function(){var t=new d.PromiseInspection(c);return y(i,t)});return(i.promise=u)._setOnCancel(i),u},d.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},d.prototype._isDisposable=function(){return 0<(131072&this._bitField)},d.prototype._getDisposer=function(){return this._disposer},d.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},d.prototype.disposer=function(t){if("function"==typeof t)return new r(t,this,e());throw new i}}},{"./errors":12,"./util":36}],36:[function(t,e,i){"use strict";var h=t("./es5"),o="undefined"==typeof navigator,n={e:{}},r,s="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==z?z:void 0!==this?this:null;function a(){try{var t=r;return r=null,t.apply(this,arguments)}catch(t){return n.e=t,n}}function l(t){return r=t,a}var c=function(e,i){var o={}.hasOwnProperty;function t(){for(var t in this.constructor=e,(this.constructor$=i).prototype)o.call(i.prototype,t)&&"$"!==t.charAt(t.length-1)&&(this[t+"$"]=i.prototype[t])}return t.prototype=i.prototype,e.prototype=new t,e.prototype};function u(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function d(t){return"function"==typeof t||"object"==typeof t&&null!==t}function p(t){return u(t)?new Error(S(t)):t}function f(t,e){for(var i=t.length,o=new Array(i+1),n=0;n<i;++n)o[n]=t[n];return o[n]=e,o}function g(t,e,i){if(!h.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var o=Object.getOwnPropertyDescriptor(t,e);return null!=o?null==o.get&&null==o.set?o.value:i:void 0}function m(t,e,i){if(u(t))return t;var o={value:i,configurable:!0,enumerable:!1,writable:!0};return h.defineProperty(t,e,o),t}function _(t){throw t}var v=function(){function a(t){for(var e=0;e<n.length;++e)if(n[e]===t)return 1}var n=[Array.prototype,Object.prototype,Function.prototype];if(h.isES5){var l=Object.getOwnPropertyNames;return function(t){for(var e,i=[],o=Object.create(null);null!=t&&!a(t);){try{e=l(t)}catch(t){return i}for(var n=0;n<e.length;++n){var r,s=e[n];o[s]||(o[s]=!0,null!=(r=Object.getOwnPropertyDescriptor(t,s))&&null==r.get&&null==r.set&&i.push(s))}t=h.getPrototypeOf(t)}return i}}var r={}.hasOwnProperty;return function(t){if(a(t))return[];var e=[];t:for(var i in t)if(r.call(t,i))e.push(i);else{for(var o=0;o<n.length;++o)if(r.call(n[o],i))continue t;e.push(i)}return e}}(),y=/this\s*\.\s*\S+\s*=/;function b(t){try{if("function"==typeof t){var e=h.names(t.prototype),i=h.isES5&&1<e.length,o=0<e.length&&!(1===e.length&&"constructor"===e[0]),n=y.test(t+"")&&0<h.names(t).length;if(i||o||n)return!0}return!1}catch(t){return!1}}function C(t){function e(){}e.prototype=t;var i=new e;function o(){return i.foo,1}return o(),o(),t}var T=/^[a-z$_][a-z$_0-9]*$/i;function w(t){return T.test(t)}function x(t,e,i){for(var o=new Array(t),n=0;n<t;++n)o[n]=e+n+i;return o}function S(t){try{return t+""}catch(t){return"[no string representation]"}}function E(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function I(t){try{m(t,"isOperational",!0)}catch(t){}}function R(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function P(t){return E(t)&&h.propertyIsWritable(t,"stack")}var L="stack"in new Error?function(t){return P(t)?t:new Error(S(t))}:function(t){if(P(t))return t;try{throw new Error(S(t))}catch(t){return t}};function k(t){return{}.toString.call(t)}function M(t,e,i){for(var o=h.names(t),n=0;n<o.length;++n){var r=o[n];if(i(r))try{h.defineProperty(e,r,h.getDescriptor(t,r))}catch(t){}}}var A=function(t){return h.isArray(t)?t:null},D,A;"undefined"!=typeof Symbol&&Symbol.iterator&&(D="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],o=t[Symbol.iterator]();!(e=o.next()).done;)i.push(e.value);return i},A=function(t){return h.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?D(t):null});var B=void 0!==rt&&"[object process]"===k(rt).toLowerCase(),O=void 0!==rt&&void 0!==rt.env,F;function N(t){return O?rt.env[t]:void 0}function V(){if("function"==typeof Promise)try{if("[object Promise]"===k(new Promise(function(){})))return Promise}catch(t){}}function j(t,e){if(null===t||"function"!=typeof e||e===F)return e;null!==t.domain&&(e=t.domain.bind(e));var i,o=t.async;return null!==o&&(i=e,e=function(){var t=new Array(2).concat([].slice.call(arguments));return t[0]=i,t[1]=this,o.runInAsyncScope.apply(o,t)}),e}var H={setReflectHandler:function(t){F=t},isClass:b,isIdentifier:w,inheritedDataKeys:v,getDataPropertyOrDefault:g,thrower:_,isArray:h.isArray,asArray:A,notEnumerableProp:m,isPrimitive:u,isObject:d,isError:E,canEvaluate:o,errorObj:n,tryCatch:l,inherits:c,withAppended:f,maybeWrapAsError:p,toFastProperties:C,filledRange:x,toString:S,canAttachTrace:P,ensureErrorObject:L,originatesFromRejection:R,markAsOriginatingFromRejection:I,classString:k,copyDescriptors:M,isNode:B,hasEnvVariables:O,env:N,global:s,getNativePromise:V,contextBind:j},U;H.isRecentNode=H.isNode&&(rt.versions&&rt.versions.node?U=rt.versions.node.split(".").map(Number):rt.version&&(U=rt.version.split(".").map(Number)),0===U[0]&&10<U[1]||0<U[0]),H.nodeSupportsAsyncResource=H.isNode&&function(){var e=!1;try{e="function"==typeof t("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(t){e=!1}return e}(),H.isNode&&H.toFastProperties(rt);try{throw new Error}catch(t){H.lastLineError=t}e.exports=H},{"./es5":13,async_hooks:void 0}]},{},[4])(4)},e.exports=t(),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,i(2),i(3),i(9).setImmediate)},function(t,n,r){(function(t){var e=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}n.setTimeout=function(){return new o(i.call(setTimeout,e,arguments),clearTimeout)},n.setInterval=function(){return new o(i.call(setInterval,e,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(e,this._id)},n.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},r(10),n.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,n.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,r(3))},function(t,e,i){(function(t,f){!function(i,o){"use strict";var n,r,s,a,l,h,e,c,t;function u(t){delete r[t]}function d(t){if(s)setTimeout(d,0,t);else{var e=r[t];if(e){s=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(o,i)}}(e)}finally{u(t),s=!1}}}}function p(t){t.source===i&&"string"==typeof t.data&&0===t.data.indexOf(c)&&d(+t.data.slice(c.length))}i.setImmediate||(n=1,s=!(r={}),a=i.document,t=(t=Object.getPrototypeOf&&Object.getPrototypeOf(i))&&t.setTimeout?t:i,l="[object process]"==={}.toString.call(i.process)?function(t){f.nextTick(function(){d(t)})}:function(){if(i.postMessage&&!i.importScripts){var t=!0,e=i.onmessage;return i.onmessage=function(){t=!1},i.postMessage("","*"),i.onmessage=e,t}}()?(c="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",p,!1):i.attachEvent("onmessage",p),function(t){i.postMessage(c+t,"*")}):i.MessageChannel?((e=new MessageChannel).port1.onmessage=function(t){d(t.data)},function(t){e.port2.postMessage(t)}):a&&"onreadystatechange"in a.createElement("script")?(h=a.documentElement,function(t){var e=a.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,h.removeChild(e),e=null},h.appendChild(e)}):function(t){setTimeout(d,0,t)},t.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var o={callback:t,args:e};return r[n]=o,l(n),n++},t.clearImmediate=u)}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(3),i(2))},function(t,e,i){"use strict";var r=this&&this.__awaiter||function(t,s,a,l){return new(a=a||Promise)(function(i,e){function o(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}r((l=l.apply(t,s||[])).next())})},h=this&&this.__generator||function(i,o){var n,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&e[0]?r.return:e[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,e[1])).done)return s;switch(r=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=o.call(i,a)}catch(t){e=[6,t],r=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s,a,l=i(12),c=i(27),u=i(36),d=o(i(0)),p=i(37),f=o(i(0)),g=i(43),m=o(i(1)),_=o(i(44)),v=m.default.errorMessages;(a=s=s||{})[a.HAND=0]="HAND",a[a.CROP=1]="CROP",a[a.CLICK_TO_ZOOM=2]="CLICK_TO_ZOOM";var y=(b.prototype._bindEvent=function(){var e=this,i={_onTagChange:this._onTagChange,_onCanvasResize:this._onCanvasResize,_onLoadImage:this._onLoadImage,_onAppendImage:this._onAppendImage,_onAddTag:this._onAddTag,_onRenameTag:this._onRenameTag,_onOpenTag:this._onOpenTag,_onAddNode:this._onAddNode,_onAddFile:this._onAddFile,_onAddFolder:this._onAddFolder,_onRenameNode:this._onRenameNode,_onRenameFolder:this._onRenameFolder,_onRenameFile:this._onRenameFile,_onOpenNode:this._onOpenNode,_onOpenFile:this._onOpenFile,_onOpenFolder:this._onOpenFolder,_onBackToPrevious:this._onBackToPrevious,_onPreviousPage:this._onPreviousPage,_onNextPage:this._onNextPage,_onDirectoryChange:this._onDirectoryChange,_onUiRefresh:this._onUiRefresh,_onReOrderThumbnail:this._onReOrderThumbnail,_onSetSelectedIndexes:this._onSetSelectedIndexes,_onFirstPage:this._onFirstPage,_onLastPage:this._onLastPage,_onGotoPage:this._onGotoPage,_onAddImageTag:this._onAddImageTag,_onRemoveImageTag:this._onRemoveImageTag,_onRemoveTag:this._onRemoveTag,_onEmptyTag:this._onEmptyTag,_onRemoveNode:this._onRemoveNode,_onRemoveFile:this._onRemoveFile,_onRemoveFolder:this._onRemoveFolder,_onRemove:this._onRemove,_onRemoveAll:this._onRemoveAll,_onFitType:this._onFitType,_onSendCropLimitArea:this._onSendCropLimitArea,_onCrop:this._onCrop,_onZoomIn:this._onZoomIn,_onZoomOUt:this._onZoomOut,_onSetClickToZoom:this._onSetClickToZoom,_onGetOperationMode:this._onGetOperationMode,_onOpenAll:this._onOpenAll,_onSendMiniImgSize:this._onSendMiniImgSize,_onThumbnailScrollTo:this._onThumbnailScrollTo,_onExistImage:this._onExistImage,_onShowCanvas:this._onShowCanvas,slideSwitch:this._slideSwitch,_onUpdateImage:this._onUpdateImage,_onRotate:this._onRotate,_onFlip:this._onFlip,_onMirror:this._onMirror,_onUpdateMetaData:this._onUpdateMetaData};Object.keys(i).forEach(function(t){e.on(t,i[t].bind(e))})},b.prototype._onTagChange=function(){this.dataHandler.onTagChange()},b.prototype._onCanvasResize=function(){this.graphic.onCanvasResize()},b.prototype._onLoadImage=function(t){this.dataHandler.loadImage(t)},b.prototype._onAppendImage=function(t,e){this.appendImage(t,e).catch(function(t){})},b.prototype._onAddTag=function(t){this.addTag(t)},b.prototype._onRenameTag=function(t,e){this.renameTag(t,e)},b.prototype._onOpenTag=function(t){this.setDefaultTag(t),this.openTag(t)},b.prototype._onAddNode=function(t,e){this.addFolder(t,e)},b.prototype._onAddFile=function(t,e){this.addFile(t,e)},b.prototype._onAddFolder=function(t,e){this.addFolder(t,e)},b.prototype._onRenameNode=function(t,e){this.renameNode(t,e)},b.prototype._onRenameFile=function(t,e){this.renameFile(t,e)},b.prototype._onRenameFolder=function(t,e){this.renameFolder(t,e)},b.prototype._onOpenNode=function(t){this.openNode(t)},b.prototype._onOpenFile=function(t){this.openFile(t)},b.prototype._onOpenFolder=function(t){this.openFolder(t)},b.prototype._onBackToPrevious=function(){this.backToPrevious()},b.prototype._onPreviousPage=function(){this.prevPage()},b.prototype._onNextPage=function(){this.nextPage()},b.prototype._onFirstPage=function(){this.firstPage()},b.prototype._onLastPage=function(){this.lastPage()},b.prototype._onGotoPage=function(t){this.goToPage(t)},b.prototype._onDirectoryChange=function(){this.dataHandler.onDirectoryChange()},b.prototype._onUiRefresh=function(){this.dataHandler.onDirectoryChange(),this.dataHandler.onTagChange(),this.dataHandler.onThumbnailChange()},b.prototype._onReOrderThumbnail=function(t,e){this.dataHandler.reorderThumbnail(t,e)},b.prototype._onSetSelectedIndexes=function(t){this.setSelectedIndexes(t)},b.prototype._onAddImageTag=function(t,e){this.addImageTag(t,e)},b.prototype._onRemoveImageTag=function(t,e){this.removeImageTag(t,e)},b.prototype._onRemoveTag=function(t){this.removeTag(t)},b.prototype._onEmptyTag=function(t){this.emptyTag(t)},b.prototype._onRemoveNode=function(t){this.removeFolder(t)},b.prototype._onRemoveFile=function(t){this.removeFile(t)},b.prototype._onRemoveFolder=function(t){this.removeFolder(t)},b.prototype._onRemove=function(t){this.remove(t)},b.prototype._onRemoveAll=function(){this.removeAll()},b.prototype._onFitType=function(t){this.fitType=t},b.prototype._onSendCropLimitArea=function(){var t=this.graphic._getCropLimitAreaForCrop();this.emit("_onGetCropLimitArea",t)},b.prototype._onCrop=function(t){var e=t.slice(0).pop(),i=this.graphic._getImageRelArea(e.left,e.top,e.width,e.height);this.graphic.crop(i.x,i.y,i.width,i.height)},b.prototype._onZoomIn=function(){this.zoomIn()},b.prototype._onZoomOut=function(){this.zoomOut()},b.prototype._onSetClickToZoom=function(t){2===t&&(this.graphic.isClickToRoom=!0)},b.prototype._onGetOperationMode=function(t){this.operationMode=t},b.prototype._onOpenAll=function(){this.openAll()},b.prototype._onSendMiniImgSize=function(){var t,e,i,o,n=this,r=this.dataHandler.currentContents;0!==r.length?(t=this.getCurrentIndex(),(e=this.getMetaDataByIndex(t)).imageWidth?this.emit("_onGetMiniImgSize",{width:e.imageWidth,height:e.imageHeight}):null!==t&&(t>=r.length||(i=r[t].originalData,(o=new Image).crossOrigin="anonymous",o.src=i,o.onload=function(){var t=o.naturalWidth||0,e=o.naturalHeight||0;n.emit("_onGetMiniImgSize",{width:t,height:e}),o=null},o.onerror=function(){n.emit("_onGetMiniImgSize",{width:0,height:0}),o=null}))):this.graphic.clearCanvas()},b.prototype._onThumbnailScrollTo=function(t){this.thumbnailScrollTo(t)},b.prototype._onAddLog=function(t){this._addLog(t)},b.prototype._onExistImage=function(){this.emit("_getImageCountForCanvas",this.currentImageCount)},b.prototype._onShowCanvas=function(t){this._isCanvasVisiable=t},b.prototype._slideSwitch=function(t){switch(t){case"left":this.prevPage();break;case"right":this.nextPage()}},b.prototype._onUpdateImage=function(t,e,i){t&&this.updateImageSync(t,e,i)},b.prototype._onRotate=function(t){this.rotate(t)},b.prototype._onFlip=function(){this.flip()},b.prototype._onMirror=function(){this.mirror()},b.prototype._onUpdateMetaData=function(t,e){var i,o=this.getCurrentIndex();null===o||(i=this.getMetaDataByIndex(o)).imageWidth&&(i.imageWidth=t,i.imageHeight=e,this.setMetaDataByIndex(o,i),this.emit("_onGetMiniImgSize",{width:t,height:e}))},b.prototype._windowResize=function(){window.addEventListener("resize",function(){})},b.prototype.cancelRender=function(){var i=this;this._cancelArr.forEach(function(t,e){t.cancel(),delete i._cancelArr[e]})},b.prototype.makeCancel=function(t){var o=!1;return{promise:new Promise(function(e,i){t.then(function(t){return o?i({isCanceled:!0}):e(t)}),t.catch(function(t){return i(o?{isCanceled:!0}:t)})}),cancel:function(){o=!0}}},b.prototype.render=function(){if(this._isCanvasVisiable){var t=this.dataHandler.currentContents;if(0===t.length)return this.graphic.clearCanvas(),void(this._renderImage=null);var e=this.getCurrentIndex();null!==e&&(e>=t.length||this.graphic.render(e))}},b.prototype.setSelectedImageArea=function(t,e,i,o,n){if(null===this.getCurrentIndex())return this._throwErr(v.NO_IMAGE_EXIST,"setSelectedImageArea"),!1;if(!(d.default.isNumber(t)&&d.default.isNumber(e)&&d.default.isNumber(i)&&d.default.isNumber(o)))return this._throwErr(v.PARAMETER_TYPE,"setSelectedImageArea"),!1;if(t<0||e<0||i<0||o<0)return this._throwErr(v.PARAMETER_RANGE,"setSelectedImageArea"),!1;if(void 0!==n&&!d.default.isBoolean(n))return this._throwErr(v.PARAMETER_TYPE,"setSelectedImageArea"),!1;var r=this.graphic.getCropAreaRelativeToImage(t,e,i,o);return this.uiEventControl&&this.uiEventControl.setCropArea(r.x,r.y,r.width,r.height,n)},b.prototype.setSelectedThumbnailArea=function(t,e,i,o,n){var r=this.getCurrentIndex();return null===r?(this._throwErr(v.NO_IMAGE_EXIST,"setSelectedThumbnailArea"),!1):d.default.isNumber(t)&&d.default.isNumber(e)&&d.default.isNumber(i)&&d.default.isNumber(o)?t<0||e<0||i<0||o<0?(this._throwErr(v.PARAMETER_RANGE,"setSelectedThumbnailArea"),!1):void 0===n||d.default.isBoolean(n)?!(!this.uiEventControl||!this.uiEventControl.setThumbnailCropArea(r,t,e,i,o,n)):(this._throwErr(v.PARAMETER_TYPE,"setSelectedThumbnailArea"),!1):(this._throwErr(v.PARAMETER_TYPE,"setSelectedThumbnailArea"),!1)},b.prototype.getCustomDataByIndex=function(t){return this.dataHandler.getCustomDataByIndex(t)},Object.defineProperty(b.prototype,"selectionRectAspectRatio",{get:function(){return this.uiEventControl&&this.uiEventControl.getCropRatio()},set:function(t){f.default.isNumber(t)&&0<t&&this.uiEventControl&&this.uiEventControl.setCropRatio(t)},enumerable:!0,configurable:!0}),b.prototype.appendImage=function(e,i){return r(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,this.dataHandler.appendImage(e,i)];case 1:return[2,t.sent()]}})})},b.prototype.appendImageSync=function(t,e){return this.dataHandler.appendImageSync(t,e)},b.prototype.insertImage=function(e,i,o){return r(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,this.dataHandler.insertImage(e,i,o)];case 1:return[2,t.sent()]}})})},b.prototype.insertImageSync=function(t,e,i){return this.dataHandler.insertImageSync(t,e,i)},b.prototype.setLoadCallback=function(t){return this.dataHandler.setLoadCallback(t)},b.prototype.setLoadInfoCallback=function(t){return this.dataHandler.setInfoCallback(t)},b.prototype.save=function(){alert("not achieve ...")},b.prototype.print=function(){alert("not achieve ...")},b.prototype.remove=function(t){return this.dataHandler.remove(t)},b.prototype.removeSync=function(t){return this.dataHandler.removeSync(t)},b.prototype.removeAll=function(){return this.dataHandler.removeAll()},b.prototype.removeAllSync=function(){return this.dataHandler.removeAllSync()},b.prototype.getCurrentIndex=function(){return this.dataHandler.getCurrentIndex()},b.prototype.setCurrentIndex=function(t){return this.dataHandler.setCurrentIndex(t)},b.prototype.mirror=function(){return this.graphic.flip(1)},b.prototype.flip=function(){return this.graphic.flip(0)},b.prototype.rotate=function(t){return this.graphic.rotate(t)},b.prototype.crop=function(t,e,i,o){return this.graphic.crop(t,e,i,o)},b.prototype.erase=function(t,e,i,o,n){return this.graphic.erase(t,e,i,o,n)},b.prototype.saveTransformResult=function(){return this.graphic.saveTransformResult()},b.prototype.setFreeCropBox=function(t,e,i,o){var n=(n=[]).concat(t).concat(e).concat(i).concat(o);return this.graphic.setFreeCropBox(n)},b.prototype.addData=function(t,e){return this.dataHandler.addData(t,e)},b.prototype.getData=function(t){return this.dataHandler.getData(t)},b.prototype.removeData=function(t){return this.dataHandler.removeData(t)},b.prototype.updateData=function(t,e){return this.dataHandler.updateData(t,e)},b.prototype.openAll=function(){return this.dataHandler.openAll()},b.prototype.getAllContents=function(){return this.dataHandler.getAllContents()},b.prototype.getCurrentNode=function(){return this.dataHandler.getCurrentNode()},b.prototype.getFileContents=function(t){return this.dataHandler.getFileContents(t)},b.prototype.addFile=function(t,e){return this.dataHandler.addFile(t,e)},b.prototype.addFolder=function(t,e){return this.dataHandler.addFolder(t,e)},b.prototype.openNode=function(t){return/\//g.test(t)?this.dataHandler.openFileByPath(t):this.dataHandler.openFile(t)},b.prototype.openFile=function(t){return/\//g.test(t)?this.dataHandler.openFileByPath(t):this.dataHandler.openFile(t)},b.prototype.openFolder=function(t){return/\//g.test(t)?this.dataHandler.openFolderByPath(t):this.dataHandler.openFolder(t)},b.prototype.backToPrevious=function(){return this.dataHandler.backToPrevious()},b.prototype.removeFile=function(t){return/\//g.test(t)?this.dataHandler.removeFileByPath(t):this.dataHandler.removeFile(t)},b.prototype.removeFolder=function(t){return/\//g.test(t)?this.dataHandler.removeFolderByPath(t):this.dataHandler.removeFolder(t)},b.prototype.renameNode=function(t,e){return this.dataHandler.renameFile(t,e)},b.prototype.renameFile=function(t,e){return this.dataHandler.renameFile(t,e)},b.prototype.renameFolder=function(t,e){return this.dataHandler.renameFolder(t,e)},b.prototype.nextPage=function(){return this.dataHandler.nextPage()},b.prototype.prevPage=function(){return this.dataHandler.previousPage()},b.prototype.firstPage=function(){return this.dataHandler.firstPage()},b.prototype.lastPage=function(){return this.dataHandler.lastPage()},b.prototype.goToPage=function(t){return this.dataHandler.goToPage(t)},b.prototype.moveImage=function(t,e){return this.dataHandler.moveImage(t,e)},b.prototype.switchImage=function(t,e){return this.dataHandler.switchImage(t,e)},b.prototype.getUidByIndex=function(t){return this.dataHandler.getUidByIndex(t)},b.prototype.getIndexByUid=function(t){return this.dataHandler.getIndexByUid(t)},b.prototype.updateImage=function(t,e,i){return this.dataHandler.updateImage(t,e,i)},b.prototype.updateImageSync=function(t,e,i){return this.dataHandler.updateImageSync(t,e,i)},b.prototype.getMetaDataByIndex=function(t){return this.dataHandler.getMetaDataByIndex(t)},b.prototype.setMetaDataByIndex=function(t,e){return this.dataHandler.setMetaDataByIndex(t,e)},b.prototype.setSelectedIndexes=function(t){return this.dataHandler.setSelectedIndexes(t)},b.prototype.getSelectedIndexes=function(){return this.dataHandler.getSelectedIndexes()},b.prototype.getThumbnailUids=function(){return this.dataHandler.getThumbnailUids()},b.prototype.selectAll=function(){return this.dataHandler.selectAll()},b.prototype.emptyThumbnail=function(){return this.dataHandler.removeAllThumbnailItem()},b.prototype.insertBefore=function(t,e){return this.dataHandler.insertBefore(t,e)},b.prototype.insertAfter=function(t,e){return this.dataHandler.insertAfter(t,e)},b.prototype.overlayRectangle=function(e,n,r,s,a,l,h){var c=this,i=this.getUidByIndex(e),o=this.dataHandler.getThumbnailContents();return!!i&&(this.dataHandler.getData(i).then(function(t){return c.dataHandler.getImageFromCanvas(t,o[e])}).then(function(t){var e=t.ctx,i=t.r;c.graphic.drawRectangle(e,n/i,r/i,s/i,a/i,"#000000",l,0,1,h);var o=e.canvas.toDataURL("image/jpeg",1);return Promise.resolve(o)}).then(function(t){c.updateImage(i,{minData:t},!0)}),!0)},Object.defineProperty(b.prototype,"currentImageCount",{get:function(){return this.dataHandler.getCurrentImageCounts()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"totalImageCount",{get:function(){return this.dataHandler._all.imgLists.length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"imageMargin",{get:function(){return this.viewer.uiConfig.thumbnail.imageSpace},set:function(t){this.uiEventControl&&this.uiEventControl.changeMargin(t)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showPageNumber",{get:function(){return this.viewer.showPageNumber},set:function(t){this.viewer.setShowPageNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showSelectBox",{get:function(){return this.viewer.showSelectBox},set:function(t){this.viewer.setShowSelectBox(t)},enumerable:!0,configurable:!0}),b.prototype.addTag=function(t,e){return this.dataHandler.addTag(t,e)},b.prototype.removeTag=function(t){return this.dataHandler.removeTag(t)},b.prototype.addImageTag=function(t,e){return this.dataHandler.addImageTag(t,e)},b.prototype.emptyTag=function(t){return this.dataHandler.emptyTag(t)},b.prototype.removeImageTag=function(t,e){return this.dataHandler.removeImageTag(t,e)},b.prototype.getTagContents=function(t){return this.dataHandler.getTagContents(t)},b.prototype.renameTag=function(t,e){return this.dataHandler.renameTag(t,e)},b.prototype.openTag=function(t){return this.dataHandler.openTag(t)},b.prototype.getTagList=function(){return this.dataHandler.getTagList()},b.prototype.setDefaultTag=function(t){return this.dataHandler.setDefaultTag(t)},b.prototype.getDefaultTag=function(){return this.dataHandler.getDefaultTag()},b.prototype.getCurrentTag=function(){return this.dataHandler.getCurrentTag()},b.prototype.on=function(t,e){this.publishSubscribe.on(t,e)},b.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this.publishSubscribe).emit.apply(e,n([t],i))},b.prototype.off=function(t,e){this.publishSubscribe.off(t,e)},b.prototype.addTab=function(t){return this.dataHandler.addTab(t)},b.prototype.removeTab=function(t){return this.dataHandler.removeTab(t)},b.prototype.getTab=function(t){return this.dataHandler.getTab(t)},b.prototype.showTab=function(t){this.dataHandler.showTab(t)},b.prototype._throwErr=function(t,e){this.emit("dvs_error",t),void 0!==e&&void 0!==t.message&&this.emit("_onAddLog",d.default.formatLog(e,!1,t.message))},b.prototype._ok=function(){this.emit("dvs_error",v.OK)},b.prototype.zoomIn=function(){return this.graphic.zoomIn()},b.prototype.zoomOut=function(){return this.graphic.zoomOut()},b.prototype.zoomTo=function(t,e,i){return!d.default.isNumber(t)||void 0!==e&&!d.default.isNumber(e)||void 0!==i&&!d.default.isNumber(i)?(this._throwErr(v.PARAMETER_TYPE,"zoomTo"),!1):t<=0?(this._throwErr(v.PARAMETER_RANGE,"zoomTo"),!1):(this.graphic.useRelativeZoom||(t/=this.graphic.originZoomX),this.graphic.zoomTo(t,!1,e,i),this.render(),this._ok(),!0)},b.prototype.fullScreen=function(){var t=this.viewer.fullScreen();return this.uiEventControl&&this.uiEventControl.styleChange(),t},b.prototype.cancelFullScreen=function(){var t=this.viewer.cancelFullScreen();return this.uiEventControl&&this.uiEventControl.styleChange(),t},b.prototype.fullPage=function(){var t=this.viewer.fullPage();return this.uiEventControl&&this.uiEventControl.styleChange(),t},b.prototype.cancelFullPage=function(){var t=this.viewer.cancelFullPage();return this.uiEventControl&&this.uiEventControl.styleChange(),t},b.prototype.setViewMode=function(t,e){return d.default.isNumber(t)&&d.default.isNumber(e)?t<0&&e<0?(this._throwErr(v.PARAMETER_RANGE,"setViewMode"),!1):this.uiEventControl&&this.uiEventControl.setViewMode(t,e):(this._throwErr(v.PARAMETER_TYPE,"setViewMode"),!1)},b.prototype.thumbnailScrollTo=function(t){return d.default.isNumber(t)?this.uiEventControl&&this.uiEventControl.scrollTo(t):(this._throwErr(v.PARAMETER_TYPE,"thumbnailScrollTo"),!1)},b.prototype.bindViewer=function(t,e){if(!d.default.isString(t))return this._throwErr(v.PARAMETER_TYPE,"bindViewer"),!1;if(e&&!d.default.isObject(e))return this._throwErr(v.PARAMETER_TYPE,"bindViewer"),!1;for(var i in e)if(!this.viewer.uiConfig[i])return this._throwErr(v.PARAMETER_INVALID,"bindViewer"),!1;var o=d.default.id(t);if(o){this.containerId=t;var n=d.default.id("WebViewer"+this.postfix);if(!n||e)return this.viewer.unbindAllMainContent(),n&&this.unbindViewer(),d.default.mergeJSON(e,this.viewer.uiConfig),this.viewer.initUI(t),this.viewer.bindAllMainContent(),this.graphic.bindCanvasContainer("viewPort"+this.postfix),this.bindContent(),this.uiEventControl?this.uiEventControl.uiEventInit():this.uiEventControl=new c.UiEventControl(this.viewer,this.publishSubscribe),this._onUiRefresh(),this.emit("_onAddLog",d.default.formatLog("bindViewer",!0)),!0;o.appendChild(n);var r=this.getCurrentIndex();return this._onThumbnailScrollTo(r),!0}return this._throwErr(v.ELEMENT_NOT_EXIST,"bindViewer"),!1},b.prototype.bindContent=function(t,e,i){if(t&&!d.default.isString(t))return this._throwErr(v.PARAMETER_TYPE,"bindContent"),!1;if(e&&i&&(!d.default.isNumber(e)||!d.default.isNumber(e)))return this._throwErr(v.PARAMETER_TYPE,"bindContent"),!1;if(e<0||i<0)return this._throwErr(v.PARAMETER_RANGE,"bindContent"),!1;var o=this.viewer.bindContent(t,e,i);return this.uiEventControl&&this.uiEventControl.styleChange(),o},b.prototype.unbindContent=function(t){var e=this.viewer.unbindContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},b.prototype.updateUISettings=function(t){if(!t||!d.default.isObject(t))return this._throwErr(v.PARAMETER_TYPE,"updateUISettings"),!1;var e=d.default.id("WebViewer"+this.postfix),i=e&&e.parentNode&&e.parentNode.id||this.containerId,o=d.default.deepClone(this.viewer.defaultUiConfig);return d.default.mergeJSON(t,o),i&&d.default.id(i)&&e?(this.viewer.unbindAllMainContent(!0),e&&this.unbindViewer(),this.viewer.initUI(i,o),this.viewer.bindAllMainContent(),this.graphic.bindCanvasContainer("viewPort"+this.postfix),this.bindContent(),this.uiEventControl?this.uiEventControl.uiEventInit():this.uiEventControl=new c.UiEventControl(this.viewer,this.publishSubscribe),this._onUiRefresh(),this._ok(),this.emit("_onAddLog",d.default.formatLog("updateUISettings",!0))):(this.viewer.uiConfig=o,this._ok()),!0},b.prototype.refreshUi=function(){this.dataHandler.showCurrentTab()},b.prototype.unbindViewer=function(){var t=d.default.id("WebViewer"+this.postfix);if(t){var e=t.parentNode;return this.graphic.unbindCanvasContainer(),this.uiEventControl&&this.uiEventControl.unbindEvents(),this.unbindContent(!0),e&&e.removeChild(t),this.webcam&&(this.closeVideo(),this.showVideoContainer=!1),!0}return this._throwErr(v.ELEMENT_NOT_EXIST,"unbindViewer"),!1},b.prototype.setButtonClass=function(t,e){return d.default.isString(t)&&(d.default.isString(e)||d.default.isArray(e))?this.viewer.setButtonClass(t,e):(this._throwErr(v.PARAMETER_TYPE,"setButtonClass"),!1)},b.prototype.setGroupClass=function(t,e){return d.default.isString(t)&&(d.default.isString(e)||d.default.isArray(e))?this.viewer.setGroupClass(t,e):(this._throwErr(v.PARAMETER_TYPE,"setButtonClass"),!1)},b.prototype.showGroup=function(t){return d.default.isString?(this.viewer.showGroup(t),this._ok(),!0):(this._throwErr(v.PARAMETER_TYPE),!1)},b.prototype.hideGroup=function(t){return d.default.isString?(this.viewer.hideGroup(t),this._ok(),!0):(this._throwErr(v.PARAMETER_TYPE),!1)},b.prototype.switchToTreeTab=function(){return this.viewer.switchToTreeTab()?(this._ok(),!0):(this._throwErr(v.ELEMENT_NOT_EXIST,"switchToTreeTab"),!1)},b.prototype.switchToTagTab=function(){return this.viewer.switchToTagTab()?(this._ok(),!0):(this._throwErr(v.ELEMENT_NOT_EXIST,"switchToTagTab"),!1)},b.prototype.switchThumbnailDirection=function(t,e){return d.default.isString(t)&&(void 0===e||d.default.isNumber(e))?"row"!==t&&"column"!==t?(this._throwErr(v.PARAMETER_RANGE,"switchThumbnailDirection"),!1):!(!this.uiEventControl||!this.uiEventControl.switchThumbnailDirection(t,e)||(this._ok(),0)):(this._throwErr(v.PARAMETER_TYPE,"switchThumbnailDirection"),!1)},b.prototype.bindCustomElement=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=!1);var o=this.viewer.bindMainContent(t,e,i);return this.uiEventControl&&this.uiEventControl.styleChange(),o},b.prototype.unbindCustomElement=function(t){var e=this.viewer.unbindMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},b.prototype.toggleCustomElement=function(t){var e=this.viewer.toggleMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},b.prototype.showCustomElement=function(t){var e=this.viewer.toggleMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},b.prototype.hideCustomElement=function(t){var e=this.viewer.hideMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},b.prototype.setOuterScroll=function(t,e){return d.default.isNumber(t)&&d.default.isNumber(e)?!!this.uiEventControl&&this.uiEventControl.setOuterScroll(t,e):(this._throwErr(v.PARAMETER_TYPE),!1)},b.prototype.updateVideoContainer=function(t){return d.default.isString(t)?this.viewer.updateVideoContainer(t):(this._throwErr(v.PARAMETER_TYPE,"updateVideoContainer"),!1)},b.prototype.setLogLevel=function(t){return!(!f.default.isNumber(t)||1!==t&&0!==t||(this._logLevel=t,0))},b.prototype.setLogFunc=function(t){return this._logLevel?(t(this._logs.slice()),!0):(t([]),!1)},b.prototype._addLog=function(t){var e=f.default.formatTime("yyyy-MM-dd hh:mm:ss")+" DVS: "+t;this._logs.push(e)},b.prototype.clearLogs=function(){this._logs=[]},Object.defineProperty(b.prototype,"zoom",{get:function(){var t=this.graphic._zoom;return this.graphic.useRelativeZoom||(t*=this.graphic.originZoomX),t},set:function(t){d.default.isNumber(t)&&0<t?this.graphic.setZoom(t):this._throwErr(v.PARAMETER_TYPE,"zoom")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"minZoom",{get:function(){return this.graphic.getMinZoom()},set:function(t){d.default.isNumber(t)&&0<t?this.graphic.setMinZoom(t):this._throwErr(v.PARAMETER_TYPE,"minZoom")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxZoom",{get:function(){return this.graphic.getMaxZoom()},set:function(t){d.default.isNumber(t)&&0<t?this.graphic.setMaxZoom(t):this._throwErr(v.PARAMETER_TYPE,"maxZoom")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showHeader",{get:function(){return this.viewer.showHeader},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowHeader(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showHeader")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"headerColor",{get:function(){return this.viewer.headerColor},set:function(t){d.default.isColor(t)?this.viewer.setHeaderColor(t):this._throwErr(v.PARAMETER_TYPE,"headerColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showTopMenu",{get:function(){return this.viewer.showTopMenu},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowTopMenu(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showTopMenu")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"topMenuColor",{get:function(){return this.viewer.topMenuColor},set:function(t){d.default.isColor(t)?this.viewer.setTopMenuColor(t):this._throwErr(v.PARAMETER_TYPE,"headerColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showSideBar",{get:function(){return this.viewer.showSideBar},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowSideBar(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showSideBar")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showThumbnail",{get:function(){return this.viewer.showThumbnail},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowThumbnail(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showThumbnail")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showVideoContainer",{get:function(){return this.viewer.showVideoContainer},set:function(t){d.default.isBoolean(t)?(this.viewer.setshowVideoContainer(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showVideoContainer")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showAside",{get:function(){return this.viewer.showAside},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowAside(t),this.uiEventControl&&this.uiEventControl.styleChange(),this._ok()):this._throwErr(v.PARAMETER_TYPE,"showAside")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showMain",{get:function(){return this.viewer.showMain},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowMain(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showMain")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showFooter",{get:function(){return this.viewer.showFooter},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowFooter(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showFooter")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showControlBox",{get:function(){return this.viewer.showControlBox},set:function(t){d.default.isBoolean(t)?(this.viewer.setShowControlBox(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(v.PARAMETER_TYPE,"showControlBox")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"footerColor",{get:function(){return this.viewer.footerColor},set:function(t){d.default.isColor(t)?this.viewer.setFooterColor(t):this._throwErr(v.PARAMETER_TYPE,"headerColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showThumbnailControl",{get:function(){return this.viewer.showThumbnailControl},set:function(t){d.default.isBoolean(t)?this.viewer.setShowThumbnailControl(t):this._throwErr(v.PARAMETER_TYPE,"showThumbnailControl")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"themeColor",{get:function(){return this.viewer.themeColor},set:function(t){d.default.isString(t)?this.viewer.setThemeColor(t):this._throwErr(v.PARAMETER_TYPE,"themeColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cursorOverThumbnailsView",{get:function(){return this.viewer.mouseShape},set:function(t){d.default.isString(t)?this.viewer.changeMouseShape(t):this._throwErr(v.PARAMETER_TYPE,"cursorOverThumbnailsView")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"canvasMouseShape",{get:function(){return this.graphic.mouseShape},set:function(t){d.default.isString(t)?this.graphic.changeMouseShape(t):this._throwErr(v.PARAMETER_TYPE,"mouseShape")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fitType",{get:function(){return this.graphic.fitType},set:function(t){d.default.isString(t)?(this.graphic.setFitType(t),this.graphic.resetScroller4FitType(),this.render()):this._throwErr(v.PARAMETER_TYPE,"fitType")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"canvasBackground",{get:function(){return this.graphic.backgroundColor},set:function(t){d.default.isColor(t)?this.graphic.setCanvasBackgroundColor(t):this._throwErr(v.COLOR_INVALID,"canvasBackground")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bOnlyShowThumbnailsView",{get:function(){return this.viewer.fullThumbnail},set:function(t){d.default.isBoolean(t)?(this.viewer.setFullThumbnail(t),this._onCanvasResize()):this._throwErr(v.PARAMETER_TYPE,"bOnlyShowThumbnailsView ")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"thumbnailBackground",{get:function(){return this.viewer.thumbnailBackground},set:function(t){d.default.isColor(t)?this.viewer.setThumbnailBackground(t):this._throwErr(v.COLOR_INVALID,"thumbnailBackground")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"thumbnailBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.thumbnailBorderColor},set:function(t){d.default.isColor(t)?this.viewer.setThumbnailBorderColor(t):this._throwErr(v.COLOR_INVALID,"thumbnailBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectedImageBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.selectedBorderColor},set:function(t){d.default.isColor(t)?this.viewer.setSelectedImageBorderColor(t):this._throwErr(v.COLOR_INVALID,"selectedImageBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectedImageBackground",{get:function(){return this.viewer.uiConfig.thumbnail.selectedBackgroundColor},set:function(t){d.default.isColor(t)?this.viewer.setSelectedBackgroundColor(t):this._throwErr(v.COLOR_INVALID,"selectedImageBackground")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"imageBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.imageBorderColor},set:function(t){d.default.isColor(t)?this.viewer.setImageBorderColor(t):this._throwErr(v.COLOR_INVALID,"imageBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"imageBackgroundColor",{get:function(){return this.viewer.uiConfig.thumbnail.imageBackgroundColor},set:function(t){d.default.isColor(t)?this.viewer.setImageBackgroundColor(t):this._throwErr(v.COLOR_INVALID,"imageBackgroundColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hoverBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.hoverBorderColor},set:function(t){d.default.isColor(t)?this.viewer.setHoverBorderColor(t):this._throwErr(v.COLOR_INVALID,"hoverBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hoverBackgroundColor",{get:function(){return this.viewer.uiConfig.thumbnail.hoverBackgroundColor},set:function(t){d.default.isColor(t)?this.viewer.setHoverBackgroundColor(t):this._throwErr(v.COLOR_INVALID,"hoverBackgroundColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"placeholderBackgroundColor",{get:function(){return this.viewer.uiConfig.thumbnail.placeholderBackgroundColor},set:function(t){d.default.isColor(t)?(this.viewer.setPlaceholderBackgroundColor(t),this._ok()):this._throwErr(v.COLOR_INVALID,"placeholderBackgroundColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"viewerBorderColor",{get:function(){return this.viewer.viewerBorderColor},set:function(t){d.default.isColor(t)?(this.viewer.setViewerBorderColor(t),this._ok()):this._throwErr(v.COLOR_INVALID,"viewerBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sidebarWidth",{get:function(){return this.viewer.sidebarWidth},set:function(t){d.default.isNumber(t)||d.default.isString(t)?(this.viewer.setSidebarWidth(t),this.uiEventControl&&this.uiEventControl.styleChange(),this._ok()):this._throwErr(v.PARAMETER_TYPE,"sidebarWidth")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"thumbnailWidth",{get:function(){return this.viewer.thumbnailWidth},set:function(t){d.default.isNumber(t)||d.default.isString(t)?(this.viewer.setThumbnailWidth(t),this.uiEventControl&&this.uiEventControl.styleChange(),this._ok()):this._throwErr(v.PARAMETER_TYPE,"thumbnailWidth")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return this.viewer.getViewerWidth()},set:function(t){this.viewer.setViewerWidth(t),this.uiEventControl&&this.uiEventControl.styleChange()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this.viewer.getViewerHeight()},set:function(t){this.viewer.setViewerHeight(t),this.uiEventControl&&this.uiEventControl.styleChange()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"uiConfig",{get:function(){return this.viewer.uiConfig},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showLatestImage",{get:function(){return this.dataHandler.showLatestImage},set:function(t){d.default.isBoolean(t)?(this.dataHandler.showLatestImage=t,this._ok()):this._throwErr(v.PARAMETER_TYPE,"showLatestImage")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"operationMode",{get:function(){return this._operationMode},set:function(t){d.default.isNumber(t)?-1===[0,1,2,3].indexOf(t)?this._throwErr(v.PARAMETER_RANGE,"operationMode"):(this._operationMode=t,this.graphic.onSetOperationMode(t),this.emit("_onSetOperationMode",t),this._ok()):this._throwErr(v.PARAMETER_TYPE,"operationMode")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keepZoom",{get:function(){return this.graphic.keepZoom},set:function(t){d.default.isBoolean(t)?(this.graphic.keepZoom=t,this._ok()):this._throwErr(v.PARAMETER_TYPE,"keepZoom")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ifAllowSlide",{get:function(){return this.graphic.ifAllowSlide},set:function(t){this.graphic.ifAllowSlide=t},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useOuterDrop",{get:function(){return this.uiEventControl&&!this.uiEventControl.useMyEvent},set:function(t){d.default.isBoolean(t)?(this.uiEventControl&&(this.uiEventControl.useMyEvent=!t),this._ok()):this._throwErr(v.PARAMETER_TYPE,"useOuterDrop")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectedImageCount",{get:function(){return this.dataHandler.selectedImagesCount},set:function(t){f.default.isNumber(t)&&(this.dataHandler.selectedImagesCount=t,this._ok())},enumerable:!0,configurable:!0}),b.prototype.setSelectImageIndex=function(t,e){return this.dataHandler.setSelectImageIndex(t,e)},b.prototype.testThumbnail=function(){this.bOnlyShowThumbnailsView=!0,this.showThumbnailControl=!1,this.setViewMode(1,1)},b.prototype.createCamera=function(){var o=this;if(d.default.isFunction(this._licenseCallback)){var t=this._licenseCallback();if(t&&0!==t.errorCode)throw t}var e=d.default.id("videoContainer"+this.postfix);if(this._exitCameraMode(),this.webcam)return!1;this.webcam=new _.default;var n=this.webcam;return n.bindUI(e,!0),this._areaDetectFn&&n.bindAreaDetectFunction(this._areaDetectFn),this._perspectiveCallback&&n.bindPerspectiveFunction(this._perspectiveCallback),this._hideBarsTemp(),this._showHomeUi(),n.on("onCapture",function(){o.cameraCapture()}),n.on("onDetect",function(){o._toggleDetectBtn()}),n.on("onRemake",function(){o.cameraGiveup()}),n.on("onBack",function(){o._showEditUi()}),n.on("onConfirm",function(){var t=d.default.query("#controlBox"+o.postfix+" #confirmBtn");t&&(t.style.pointerEvents="none");var e=o._captureUids.pop(),i=o.getIndexByUid(e);o.removeSync([i]),o._savePhotoCallback&&o._savePhotoCallback(n._resultImg.src),o._showHomeUi(!0)}),n.on("onExitCamera",function(){return o._captureUids.length&&(o._captureUids.forEach(function(t){var e=o.getIndexByUid(t);o.remove([e])}),o._captureUids=[]),o.closeCamera(),!0}),n.on("onPerspective",function(){return r(o,void 0,void 0,function(){var e,i,o;return h(this,function(t){switch(t.label){case 0:return(e=this.graphic.getFreeCropBox())?((i=d.default.query("#controlBox"+this.postfix+" #perspectiveBtn"))&&(i.style.pointerEvents="none"),[4,n.perspective(e)]):[2,!1];case 1:return o=t.sent(),this._showSaveUi(o),[2]}})})}),n.on("video-error",function(t){o.emit("video-error",t)}),this.on("onViewerResize",this._webcamResize.bind(this)),this._imgProcReady&&this._imgProcReady(),!0},b.prototype.showVideo=function(e,i){return r(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return e&&!d.default.isString(e)||i&&!d.default.isObject(i)?(this._throwErr(v.PARAMETER_TYPE),[2,Promise.reject(v.PARAMETER_TYPE)]):(this.createCamera(),e?[4,this.webcam.selectSource(e)]:[3,2]);case 1:t.sent(),t.label=2;case 2:return i&&i.width&&i.height?[2,this.webcam.play(void 0,i.width,i.height)]:[2,this.webcam.play()]}})})},b.prototype.closeVideo=function(){this.closeCamera()},b.prototype.closeCamera=function(){return this.emit("video-closed"),this._exitCameraMode()},b.prototype.cameraPlay=function(){var t=this.webcam;return!!t&&(t.play(),!0)},b.prototype.cameraPause=function(){var t=this.webcam;return!!t&&(t.pause(),!0)},b.prototype.cameraResume=function(){var t=this.webcam;return!!t&&(t.resume(),!0)},b.prototype.cameraCapture=function(){var e=this;if(!this.webcam)return this._throwErr(v.ELEMENT_NOT_EXIST),!1;this.cameraPause(),this.unbindRealTimeRender();var t=d.default.query("#controlBox"+this.postfix+" #captureBtn");t&&(t.style.pointerEvents="none"),this.dealWithBlob().then(function(t){e._showEditUi()})},b.prototype.cameraGiveup=function(){if(this.webcam){if(this._showHomeUi(),this._captureUids.length){var t=this._captureUids.pop(),e=this.getIndexByUid(t);return this.removeSync([e]),!0}return!1}return!1},b.prototype.bindRealTimeRender=function(t){var e=this.webcam;return!!e&&e.bindRealTimeRender(t)},b.prototype.unbindRealTimeRender=function(){var t=this.webcam;return!!t&&(t.unbindRealTimeRender(),!0)},b.prototype.bindCameraSelector=function(t){var e=this.webcam;return e?e.bindCameraSelector(t):(this._throwErr(v.ELEMENT_NOT_EXIST),!1)},b.prototype.unbindCameraSelector=function(){var t=this.webcam;return t?t.unbindCameraSelector():(this._throwErr(v.ELEMENT_NOT_EXIST),!1)},b.prototype.bindResolutionsSelector=function(t){var e=this.webcam;return e?e.bindResolutionsSelector(t):(this._throwErr(v.ELEMENT_NOT_EXIST),!1)},b.prototype.unbindResolutionsSelector=function(){var t=this.webcam;return t?t.unbindResolutionsSelector():(this._throwErr(v.ELEMENT_NOT_EXIST),!1)},b.prototype.bindImgProcReady=function(t){return!!d.default.isFunction(t)&&(this._imgProcReady=t,!0)},b.prototype.bindAreaDetectFunction=function(t){if(this._areaDetectFn=t,this.webcam)return this.webcam.bindAreaDetectFunction(t)},b.prototype.bindPerspectiveFunction=function(t){if(this._perspectiveCallback=t,this.webcam)return this.webcam.bindPerspectiveFunction(t)},b.prototype.bindLicenseCallback=function(t){return!!d.default.isFunction(t)&&(this._licenseCallback=t,!0)},b.prototype.bindSavePhotoCallback=function(t){return!!d.default.isFunction(t)&&(this._savePhotoCallback=t,!0)},b.prototype.setControlBoxHeight=function(t){var e=d.default.id("controlBox"+this.postfix);e&&(e.style.flex="0 0 "+t+"%")},b.prototype.dealWithBlob=function(l){return r(this,void 0,void 0,function(){var e,i,o,n,r,s,a=this;return h(this,function(t){switch(t.label){case 0:return e=null,[4,(i=this.webcam).detectArea()];case 1:return o=t.sent(),Array.isArray(o)?l?(e=l,[3,4]):[3,2]:[2,!1];case 2:return[4,i.getBlobData()];case 3:e=t.sent(),t.label=4;case 4:return e?(n=[o.slice(0,2),o.slice(2,4),o.slice(4,6),o.slice(6,8)],r=this.appendImageSync("captureFile",[{originalData:e}]),this._captureUids.push(r[0]),(s=function(){setTimeout(function(){a.isImageRendered?(a.operationMode=3,a.setFreeCropBox(n[0],n[1],n[2],n[3])):s()},0)})(),[2]):[2,!1]}})})},b.prototype._webcamResize=function(){return this.webcam&&this.webcam.drawRegionsults()},b.prototype._toggleDetectBtn=function(){var t=d.default.id("detectBtn");if(!t)return!1;var e=t.classList.toggle("selectedBtn");e?this.bindRealTimeRender(5):this.unbindRealTimeRender(),this._isDetecting=e},b.prototype._hideBarsTemp=function(){var t={showSideBar:this.showSideBar,showMain:this.showMain,showFooter:this.showFooter,showHeader:this.showHeader,showTopMenu:this.showTopMenu,showThumbnail:this.showThumbnail,operationMode:this.operationMode};for(var e in this._tempStatusObj=t)this[e]=!1},b.prototype._showBarsTemp=function(){var t=this._tempStatusObj;for(var e in t)e&&(this[e]=t[e]);this._tempStatusObj=null},b.prototype._showHomeUi=function(t){void 0===t&&(t=!1);var e=this.webcam;if(!e)return!1;e.resume(),e.bindControlBox("controlBox"+this.postfix),e.hideResultImage(t),e.emptyTempCanvas(),this.setControlBoxHeight(20),this._enterSuspend(),this.showVideoContainer=!0,this.showControlBox=!0,this.operationMode=0,this._isDetecting&&this._toggleDetectBtn()},b.prototype._showEditUi=function(t){void 0===t&&(t=!1);var e=this.webcam;if(!e)return!1;this.cameraPause(),this.unbindRealTimeRender(),e.bindConfirmBox("controlBox"+this.postfix),e.hideResultImage(t),this.setControlBoxHeight(10),this._exitSuspend(),this.showVideoContainer=!1,this.showMain=!0,this.operationMode=3},b.prototype._showSaveUi=function(t){var e=this.webcam;if(!e)return!1;this.cameraPause(),this.unbindRealTimeRender(),e.bindSaveBox("controlBox"+this.postfix),e.showResultImage(t),this.setControlBoxHeight(10),this._exitSuspend(),this.showVideoContainer=!0},b.prototype._enterSuspend=function(){var t=d.default.id("controlBox"+this.postfix);t&&(t.style.position="absolute",t.style.bottom=0,t.style.backgroundColor="rgba(0,0,0,0.2)")},b.prototype._exitSuspend=function(){var t=d.default.id("controlBox"+this.postfix);t&&(t.style.position=null,t.style.bottom=null,t.style.backgroundColor=null)},b.prototype._exitCameraMode=function(t){void 0===t&&(t=!1);var e,i,o=this.webcam;return!!o&&(this.showControlBox=!1,this.showVideoContainer=!1,this._isDetecting=!1,this._captureUids.length&&(e=this._captureUids.pop(),i=this.getIndexByUid(e),this.remove([i])),o.hideResultImage(t),o.emptyTempCanvas(),o.unbindRealTimeRender(),o.destroy(),this.webcam=null,this._showBarsTemp(),this.off("onViewerResize",this._webcamResize.bind(this)),this.uiEventControl&&this.uiEventControl.styleChange(),!0)},b);function b(t){this._operationMode=s.HAND,this.errorMessage="ok",this.errorCode=0,this.postfix="_"+d.default.uid(9),this._logLevel=1,this._logs=[],this._cancelArr=[],this._isCanvasVisiable=!1,this._renderTimer=null,this._captureUids=[],this._licenseCallback=null,this._areaDetectFn=null,this._perspectiveCallback=null,this._savePhotoCallback=null,this._imgProcReady=null,this._tempStatusObj=null,this.isImageRendered=!1,this._addLog("Init DVS."),this.publishSubscribe=new g.PublishSubscribe,this.on("_onAddLog",this._onAddLog.bind(this)),this.viewer=new u.Viewer(this.postfix,t.uiConfig,this.publishSubscribe),this.graphic=new p.Graphic({pubsub:this.publishSubscribe,backgroundColor:this.viewer._canvasBackgroundColor,scrollerConfig:t.scrollerConfig});var e=this.viewer.uiConfig,i=e.tag.visibility,o=e.tree.visibility;this.dataHandler=new l.DataHandler(t,this.publishSubscribe,i,o),this._bindEvent(),this.on("render",function(){this.render()}.bind(this)),this.on("dvs_error",function(t){this.errorCode=t.code,this.errorMessage=t.message}.bind(this)),this.on("isImageRendered",function(t){this.isImageRendered=Boolean(t)}.bind(this)),this.containerId=t.containerId,this.bindViewer(t.containerId,t.uiConfig),this._addLog("Init DVS completed")}e.DVS=y},function(t,e,i){"use strict";var r=this&&this.__awaiter||function(t,s,a,l){return new(a=a||Promise)(function(i,e){function o(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}r((l=l.apply(t,s||[])).next())})},C=this&&this.__generator||function(i,o){var n,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&e[0]?r.return:e[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,e[1])).done)return s;switch(r=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=o.call(i,a)}catch(t){e=[6,t],r=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=o(i(0)),s=i(13),a=i(15),l=i(20),h=i(22),c=i(23),d=i(24),p=o(i(1)),f=i(26),g=p.default.errorMessages,m=u.default.uid,_=(v.prototype._initAll=function(){this._all={id:u.default.uid(11),name:"All",imgLists:[]}},v.prototype.getAllContents=function(){return this._all.imgLists},v.prototype.openAll=function(){return r(this,void 0,void 0,function(){var e,i;return C(this,function(t){switch(t.label){case 0:return e=this._tab.checkTab(this._all.id),i=this._all.imgLists,-1===e&&this._tab.addTab({tabId:this._all.id,tabName:this._all.name,type:"file",imgLists:i.slice(0),selectedImageUids:i.slice(0,1)}),[4,this.showTab(this._all.id)];case 1:return t.sent(),this._ok(),[2,this._all.name]}})})},v.prototype._clearSelectedImage=function(){this._selectedImageArr=[],this.selectedImagesCount=1},v.prototype.setSelectImageIndex=function(t,e){if(!u.default.isNumber(t)||!u.default.isNumber(e))return this._throwError(g.PARAMETER_TYPE),!1;if(t>=this.selectedImagesCount||t<0||e<0||e+1>this._thumbnail.counts)return this._throwError(g.PARAMETER_RANGE),!1;if(0<this._selectedImageArr.filter(function(t){return t===e}).length)return this._throwError(g.IMG_HAVE_EXIST),!1;for(var i=0;i<t;i++)if(void 0===this._selectedImageArr[i])return this._throwError(g.EMPTY_IN_ARRAY),!1;this._selectedImageArr[t]=e;var o=this.getCurrentTab();if(!o)return!1;var n=this._getUidsByIndexes(this._selectedImageArr);o.setSelectedImageUids(n),this._selectedIndexes=n,this._pager.setPageData({currentPage:e});var r=this._pager.getPageData();return this.emit("pagerRefresh",r),this.emit("_onPagerRefresh",r),this.emit("imageSelected",this._selectedImageArr),this.emit("render"),this._ok(),!0},v.prototype.getCustomDataByIndex=function(t){if(!u.default.isNumber(t))return this._throwError(g.PARAMETER_TYPE),{};if(t<0||t>=this.getCurrentImageCounts())return this._throwError(g.PARAMETER_RANGE),{};var e=this.getUidByIndex(t);if(e){var i=this._getInterlayerData(e);return!!i&&(this._ok(),i.customData)}},v.prototype.setLoadCallback=function(t){this.loadCallback=t},v.prototype.getMetaDataByIndex=function(t){var e=this.getUidByIndex(t);if(e){var i=this._dataStorage.getDataSync(e);if(i&&i.metaData)return i.metaData}return{}},v.prototype.setMetaDataByIndex=function(t,e){var i=this,o=this.getUidByIndex(t);if(o){var n=this._dataStorage.getDataSync(o);return n&&n.metaData&&(n.metaData=e,this._dataStorage.updateDataSync(o,n)),this._dataStorage.getData(o).then(function(t){t&&t.metaData&&(t.metaData=e,i._dataStorage.updateData(o,t))}).catch(function(t){}),!0}return!1},v.prototype.appendImageSync=function(t,e){var i=this;if(!this._checkString(t)||!this._checkArray(e))return[];var o=this.findChild(this.getCurrentNode(),t),n=null;o?n=o.treeId:(n=this._directoryTree.addNewNode(t,"file",[]),o=this.findChild(this.getCurrentNode(),t));var r=this._loadImageSync(t,e,n);r.forEach(function(t){o.children.push(t)});var s=!1;return e.forEach(function(t){t.tags&&0<t.tags.length&&(s=!0)}),s&&this.onTagChange(),this.onDirectoryChange(),this.emit("isImageRendered",!1),this.showTab(this._tab.selectedTabId).then(function(t){var e;i.showLatestImage&&(e=i.getIndexByUid(r.slice(0).pop()),i.emit("_onThumbnailScroll",e))}),this.emit("_onAddLog",u.default.formatLog("appendImage",!0)),this._ok(),r},v.prototype.appendImage=function(s,a){return r(this,void 0,void 0,function(){var e,i,o,n,r=this;return C(this,function(t){switch(t.label){case 0:return this._checkString(s)&&this._checkArray(a)?(e=this.findChild(this.getCurrentNode(),s),i=null,e?i=e.treeId:(i=this._directoryTree.addNewNode(s,"file",[]),e=this.findChild(this.getCurrentNode(),s)),[4,this._loadImage(s,a,i)]):(this.emit("_onAddLog",u.default.formatLog("appendImage",!1,"Parameter error.")),[2,Promise.reject(new Error("parameter error."))]);case 1:return(o=t.sent()).forEach(function(t){e.children.push(t)}),n=!1,a.forEach(function(t){t.tags&&0<t.tags.length&&(n=!0)}),n&&this.onTagChange(),this.onDirectoryChange(),this.showTab(this._tab.selectedTabId).then(function(t){var e;r.showLatestImage&&(e=r.getIndexByUid(o.slice(0).pop()),r.emit("_onThumbnailScroll",e))}),this.emit("_onAddLog",u.default.formatLog("appendImage",!0)),this._ok(),[2,o]}})})},v.prototype.insertImageSync=function(t,e,i){var o=this;if(!this._checkString(t)||!this._checkArray(e))return this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("insertImage",!1,"Parameter error.")),Promise.reject(new Error(g.PARAMETER_TYPE.message));var n=this.findChild(this.getCurrentNode(),t);if(!n)return this._throwError(g.FILE_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("insertImage",!1,"File dose not exist.")),Promise.reject(new Error(g.FILE_NOT_EXIST.message));var r=n.children.length;if(void 0!==i&&!u.default.isNumber(i)||i<0||r-1<i)return this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("insertImage",!1,"Parameter error.")),Promise.reject(new Error(g.PARAMETER_TYPE.message));if(void 0===i)return this.appendImageSync(t,e);var s=n.treeId,a=this._loadImageSync(t,e,s,i);return n.children,a.forEach(function(t){n.children.splice(i++,0,t)}),this.onTagChange(),this.onDirectoryChange(),clearTimeout(this._timer),this._timer=setTimeout(function(){o.showTab(o._tab.selectedTabId).then(function(t){var e;o.showLatestImage&&(e=o.getIndexByUid(a.slice(0).pop()),o.emit("_onThumbnailScroll",e))})},0),this.emit("_onAddLog",u.default.formatLog("insertImage",!0)),this._ok(),a},v.prototype.insertImage=function(s,a,l){return r(this,void 0,void 0,function(){var e,i,o,n,r=this;return C(this,function(t){switch(t.label){case 0:return this._checkString(s)&&this._checkArray(a)?(e=this.findChild(this.getCurrentNode(),s))?(i=e.children.length,void 0!==l&&!u.default.isNumber(l)||l<0||i-1<l?(this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("insertImage",!1,"Parameter error.")),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))]):void 0!==l?[3,2]:[4,this.appendImage(s,a)]):(this._throwError(g.FILE_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("insertImage",!1,"File dose not exist.")),[2,Promise.reject(new Error(g.FILE_NOT_EXIST.message))]):(this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("insertImage",!1,"Parameter error.")),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))]);case 1:return[2,t.sent()];case 2:return o=e.treeId,[4,this._loadImage(s,a,o,l)];case 3:return n=t.sent(),e.children,n.forEach(function(t){e.children.splice(l++,0,t)}),this.onTagChange(),this.onDirectoryChange(),this.showTab(this._tab.selectedTabId).then(function(t){var e;r.showLatestImage&&(e=r.getIndexByUid(n.slice(0).pop()),r.emit("_onThumbnailScroll",e))}),this.emit("_onAddLog",u.default.formatLog("insertImage",!0)),this._ok(),[2,n]}})})},v.prototype._loadImage=function(t,v,y,b){return r(this,void 0,void 0,function(){var e,i,o,n,r,s,a,l,h,c,u,d,p,f,g,m,_;return C(this,function(t){switch(t.label){case 0:this.emit("beforeLoad",v),e=[],v.length,i=this.getCurrentTab(),o=0,n=v.entries(),t.label=1;case 1:return o<n.length?(r=n[o],s=r[0],a=r[1],(l=a).tags||(l.tags=[]),this._tag.defaultTagName&&-1===l.tags.indexOf(this._tag.defaultTagName)&&l.tags.push(this._tag.defaultTagName),h=this._formatData(l),(c=Object.assign({},h.image)).minData=null,c.originalData=null,this._dataStorage.addDataSync(h.uid,c),[4,this.addData(h.uid,h.image).then(function(t){}).catch(function(t){})]):[3,4];case 2:for(t.sent(),e.push(h.uid),u={uid:h.uid,minData:null,originalData:null,customData:null,tags:l.tags.slice(0),dataType:1,active:!1},this._addInterlayerData(h.uid,u),this._tab.selectedTabId&&(d=this._tab.selectedTabId,p=(p=this._tag.getTag(this.getDefaultTag()))||{tagId:null},d!==this._all.id&&d!==y&&d!==p.tagId||null!==i&&(void 0!==b?i.insertImage(b+s,h.uid):i.addImg(h.uid))),void 0!==b?this._all.imgLists.splice(b,0,h.uid):this._all.imgLists.push(h.uid),f=l.tags,g=0;g<f.length;g++)this._tag.addTag(f[g]),(m=this._getTag(f[g]))&&m.imgLists.push(h.uid);t.label=3;case 3:return o++,[3,1];case 4:return this.showLatestImage?(i.setSelectedImageUids([e.slice(0).pop()]),this._selectedIndexes=[e.slice(0).pop()],_=this.getIndexByUid(e.slice(0).pop()),this.emit("_onThumbnailScroll",_)):i.setSelectedImageUids(i.selectedImageUids.length?i.selectedImageUids:[this.getUidByIndex(0)]),this.emit("afterLoad",e),[2,e]}})})},v.prototype._checkOriginalType=function(t){var e=Object.prototype.toString.call(t);return"[object Blob]"===e?1:"[object Object]"===e?2:"[object String]"===e?3:/data:image\/\w+;base64/.test(t)?4:/\[object ArrayBuffer\]|\[object \w+Array\]/.test(e)?5:0},v.prototype._loadImageSync2=function(t,e,i,o){this.emit("beforeLoad",e);for(var n,r=[],s=e.length,a=this.getCurrentTab(),l=0;l<s;l++){var h=e[l];h.tags||(h.tags=[]),this._tag.defaultTagName&&-1===h.tags.indexOf(this._tag.defaultTagName)&&h.tags.push(this._tag.defaultTagName);var c=this._formatData(h),u=Object.assign({},c.image);u.minData=null,u.originalData=null,this._dataStorage.addDataSync(c.uid,u),this._dataStorage.addData(c.uid,c.image),r.push(c.uid);var d,p,f={uid:c.uid,minData:null,originalData:null,customData:h.customData||{},tags:h.tags.slice(0),dataType:1,active:!1};this._addInterlayerData(c.uid,f),this._tab.selectedTabId&&(d=this._tab.selectedTabId,p=(p=this._tag.getTag(this.getDefaultTag()))||{tagId:null},d!==this._all.id&&d!==i&&d!==p.tagId||null!==a&&(void 0!==o?a.insertImage(o+l,c.uid):a.addImg(c.uid))),void 0!==o?this._all.imgLists.splice(o,0,c.uid):this._all.imgLists.push(c.uid);for(var g=h.tags,m=0;m<g.length;m++){this._tag.addTag(g[m]);var _=this._getTag(g[m]);_&&_.imgLists.push(c.uid)}}return this.showLatestImage?(a.setSelectedImageUids([r.slice(0).pop()]),this._selectedIndexes=[r.slice(0).pop()],n=this.getIndexByUid(r.slice(0).pop()),this.emit("_onThumbnailScroll",n)):a.setSelectedImageUids(a.selectedImageUids.length?a.selectedImageUids:[this.getUidByIndex(0)]),this.emit("afterLoad",r),r},v.prototype._loadImageSync=function(t,e,i,o){this.emit("beforeLoad",e);for(var n,r=[],s=e.length,a=this.getCurrentTab(),l=0;l<s;l++){var h=e[l];h.tags||(h.tags=[]);var c,u=1;h.originalData||h.customData.src&&(u=2,c=h.customData.src,h.customData.src=null,this._dataStorage.addData(h.customData.srcId.toString(),c)),this._tag.defaultTagName&&-1===h.tags.indexOf(this._tag.defaultTagName)&&h.tags.push(this._tag.defaultTagName);var d=this._formatData(h),p=Object.assign({},d.image);p.minData=null,p.originalData=null,this._dataStorage.addDataSync(d.uid,p),this._dataStorage.addData(d.uid,d.image),r.push(d.uid);var f,g,m={uid:d.uid,minData:null,originalData:null,customData:h.customData||{},tags:h.tags.slice(0),dataType:u,active:!1};this._addInterlayerData(d.uid,m),this._tab.selectedTabId&&(f=this._tab.selectedTabId,g=(g=this._tag.getTag(this.getDefaultTag()))||{tagId:null},f!==this._all.id&&f!==i&&f!==g.tagId||null!==a&&(void 0!==o?a.insertImage(o+l,d.uid):a.addImg(d.uid))),void 0!==o?this._all.imgLists.splice(o,0,d.uid):this._all.imgLists.push(d.uid);for(var _=h.tags,v=0;v<_.length;v++){this._tag.addTag(_[v]);var y=this._getTag(_[v]);y&&y.imgLists.push(d.uid)}}return this.showLatestImage?(a.setSelectedImageUids([r.slice(0).pop()]),this._selectedIndexes=[r.slice(0).pop()],n=this.getIndexByUid(r.slice(0).pop()),this.emit("_onThumbnailScroll",n)):a.setSelectedImageUids(a.selectedImageUids.length?a.selectedImageUids:[this.getUidByIndex(0)]),this.emit("afterLoad",r),r},v.prototype._convertImageData=function(t,e){t.customData&&(e.customData=t.customData),t.metaData&&(e.metaData=t.metaData),t.tags&&(e.tags=u.default.unique(e.tags.concat(t.tags)));var i=this._createUrl(t.originalData);return e.originalData=i,t.minData?e.minData=this._createUrl(t.minData):e.minData=i,e},v.prototype._convertImageDataSync=function(t,e){var i=this.loadCallback(t);i.customData&&(e.customData=i.customData),i.tags&&(e.tags=u.default.unique(e.tags.concat(i.tags)));var o=this._createUrl(i.originalData);return e.originalData=o,i.minData?e.minData=this._createUrl(i.minData):e.minData=o,e},v.prototype.loadImage=function(e){return r(this,void 0,void 0,function(){return C(this,function(t){return this._typeIdentify(e.fileType),[2,this.appendImage(e.name,e.contents)]})})},v.prototype._setCurrentcontents=function(t,e){this.scrollLeft=t.scrollLeft,this.scrollTop=t.scrollTop,this.zoom=t.zoom,this.currentContents=e,this.emit("getDrawImageData",this.currentContents.slice())},v.prototype.getCurrentIndex=function(){var t=this.getCurrentTab();return t?t.getCurrentIndex():null},v.prototype.setCurrentIndex=function(t){return!!this._checkIndex(t)&&(this._clearSelectedImage(),this.setSelectedIndexes([t]),this._ok(),!0)},v.prototype.save=function(){},v.prototype.removeSync=function(e){var i=this;if(!this._checkArray(e))return this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),!1;for(var t=this.getCurrentTab(),o=e.length,n=[],r=0;r<o;r++){if(!u.default.isNumber(e[r]))return this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),!1;if(e[r]<0||e[r]>=this.getCurrentImageCounts())return this._throwError(g.PARAMETER_RANGE),this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),!1;var s=this.getUidByIndex(e[r]);if(!s)return this._throwError(g.FILE_NOT_EXIST),!1;n.push(s)}if(t){for(var a,l,h=0;h<o;h++)t.getCurrentUid()===n[h]&&((a=t.imgLists.indexOf(n[h]))===(l=t.imgLists.length)-1?l-2<0?t.setSelectedImageUids([]):t.setSelectedImageUids([t.imgLists[l-2]]):t.setSelectedImageUids([t.imgLists[a+1]]),this.emit("isImageRendered",!1)),t.removeImg(n[h]),this._removeSync(n[h],t);this.showTab(this._tab.selectedTabId).then(function(t){0===i.getCurrentImageCounts()&&i.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),i.emit("getRemoveIndexes",e)})}return this.emit("_onAddLog",u.default.formatLog("remove",!0)),this._ok(),n},v.prototype._removeSync=function(t,e){var i=this;this.removeImageTag(t);var o=this._getInterlayerData(t);o&&(this._revokeUrl(o.originalData),this._revokeUrl(o.minData),this._removeInterlayerData(t));var n=this._all.imgLists.indexOf(t);-1!==n&&this._all.imgLists.splice(n,1);var r=null;return(r=this._findImageByUid(t,this._directoryTree.rootNode))?(r.removeImg(t),this.removeData(t).catch(function(t){i._throwError(g.IMG_NOT_EXIST)}),this._dataStorage.removeDataSync(t),t):[]},v.prototype.remove=function(h){return r(this,void 0,void 0,function(){var e,i,o,n,r,s,a,l;return C(this,function(t){switch(t.label){case 0:if(!this._checkArray(h))return this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))];for(e=this.getCurrentTab(),i=h.length,o=[],n=0;n<i;n++){if(!u.default.isNumber(h[n]))return this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))];if(h[n]<0||h[n]>=this.getCurrentImageCounts())return this._throwError(g.PARAMETER_RANGE),this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),[2,Promise.reject(new Error(g.PARAMETER_RANGE.message))];if(!(r=this.getUidByIndex(h[n])))return this._throwError(g.FILE_NOT_EXIST),[2,Promise.reject(new Error(g.FILE_NOT_EXIST.message))];o.push(r)}if(!e)return[3,2];for(s=0;s<i;s++)e.getCurrentUid()===o[s]&&(a=e.imgLists.indexOf(o[s]),l=e.imgLists.length,a===l-1?l-2<0?e.setSelectedImageUids([]):e.setSelectedImageUids([e.imgLists[l-2]]):e.setSelectedImageUids([e.imgLists[a+1]])),e.removeImg(o[s]),this._remove(o[s],e);return[4,this.showTab(e.tabId)];case 1:t.sent(),t.label=2;case 2:return this.emit("_onAddLog",u.default.formatLog("remove",!0)),0===this.getCurrentImageCounts()&&this.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),this.emit("getRemoveIndexes",h),this._ok(),[2,o]}})})},v.prototype._remove=function(n,t){return r(this,void 0,void 0,function(){var e,i,o;return C(this,function(t){switch(t.label){case 0:return this.removeImageTag(n),(e=this._getInterlayerData(n))&&(this._revokeUrl(e.originalData),this._revokeUrl(e.minData),this._removeInterlayerData(n)),-1!==(i=this._all.imgLists.indexOf(n))&&this._all.imgLists.splice(i,1),o=null,(o=this._findImageByUid(n,this._directoryTree.rootNode))?(o.removeImg(n),[4,this.removeData(n)]):[2,Promise.reject(new Error(g.FILE_NOT_EXIST.message))];case 1:return t.sent(),this._dataStorage.removeDataSync(n),[2,n]}})})},v.prototype._removeImageFromCurrentByUid=function(t){var e,i=this.getIndexByUid(t);null!==i&&(0===(e=this.currentContents.length)||e-1<i||this.currentContents.splice(i,1))},v.prototype._findImageByUid=function(t,e){for(var i=e.children,o=i.length,n=0;n<o;n++)if(i[n].children){var r=this._findImageByUid(t,i[n]);if(r)return r}else if(i[n]===t)return e},v.prototype.removeAll=function(){return r(this,void 0,void 0,function(){var e,i,o,n,r,s=this;return C(this,function(t){switch(t.label){case 0:if(this.currentContents=[],!(e=this.getTab(this._tab.selectedTabId)))return this._throwError(g.FILE_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("removeAll",!1,"File dose not exist.")),[2,Promise.reject(new Error(g.FILE_NOT_EXIST.message))];(i=e.imgLists.slice()).length,o=0,n=i,t.label=1;case 1:return o<n.length?(r=n[o],[4,this._remove(r,e)]):[3,4];case 2:t.sent(),t.label=3;case 3:return o++,[3,1];case 4:return e.emptyTab(),clearTimeout(this._timer),this._timer=setTimeout(function(){s.showTab(s._tab.selectedTabId),s.emit("getRemoveIndexes",[])},0),this.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),this._ok(),[2,i]}})})},v.prototype.removeAllSync=function(){var e=this;this.currentContents=[];var t=this.getTab(this._tab.selectedTabId);if(!t)return this._throwError(g.FILE_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("removeAll",!1,"File dose not exist.")),!1;var i=t.imgLists.slice();t.emptyTab();for(var o=i.length,n=0;n<o;n++)this._removeSync(i[n],t);return this.showTab(this._tab.selectedTabId).then(function(t){e.emit("getRemoveIndexes",[])}),this.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),this.emit("_onAddLog",u.default.formatLog("remove",!1,"Parameter error.")),this._ok(),i},v.prototype.print=function(){},v.prototype._formatData=function(t){return{uid:m(11),image:t}},v.prototype._typeIdentify=function(t){return/(jpg|png|webp|jpeg)$/.test(t)?"single":/(pdf|tiff)$/.test(t)?"multiple":void 0},v.prototype.addData=function(i,o){return r(this,void 0,void 0,function(){var e=this;return C(this,function(t){switch(t.label){case 0:return this._checkString(i)&&u.default.isObject(o)?[4,this._dataStorage.addData(i,o).then(function(t){return e._ok(),t}).catch(function(t){return e._throwError(g.IMG_STORAGE_FAILED),Promise.reject(new Error(g.IMG_STORAGE_FAILED.message))})]:(this._throwError(g.PARAMETER_TYPE),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))]);case 1:return[2,t.sent()]}})})},v.prototype.getData=function(i){return r(this,void 0,void 0,function(){var e=this;return C(this,function(t){switch(t.label){case 0:return this._checkString(i)?[4,this._dataStorage.getData(i).then(function(t){return e._ok(),Promise.resolve(t)}).catch(function(t){return e._throwError(g.IMG_NOT_EXIST),Promise.reject(new Error(g.IMG_NOT_EXIST.message))})]:(this._throwError(g.PARAMETER_TYPE),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))]);case 1:return[2,t.sent()]}})})},v.prototype.removeData=function(i){return r(this,void 0,void 0,function(){var e=this;return C(this,function(t){switch(t.label){case 0:return this._checkString(i)?[4,this._dataStorage.removeData(i).then(function(t){return e._ok(),t}).catch(function(t){return e._throwError(g.IMG_REMOVE_FAILED),Promise.reject(new Error(g.IMG_REMOVE_FAILED.message))})]:(this._throwError(g.PARAMETER_TYPE),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))]);case 1:return[2,t.sent()]}})})},v.prototype.updateData=function(i,o){return r(this,void 0,void 0,function(){var e=this;return C(this,function(t){switch(t.label){case 0:return this._checkString(i)?[4,this._dataStorage.updateData(i,o).then(function(t){return e._ok(),t}).catch(function(t){return e._throwError(g.IMG_NOT_EXIST),Promise.reject(new Error(g.IMG_NOT_EXIST.message))})]:(this._throwError(g.PARAMETER_TYPE),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))]);case 1:return[2,t.sent()]}})})},v.prototype.getCurrentNode=function(){return this._ok(),this._directoryTree.currentNode},v.prototype.onDirectoryChange=function(){var t=this.getCurrentNode();this.emit("directoryRefresh",t),this.emit("_onDirectoryRefresh",t),this._directoryTree.getSelectedNode()},v.prototype.addFile=function(t,e){return!this._checkNameString(t)||e&&!this._checkArray(e)?(this.emit("_onAddLog",u.default.formatLog("addFile",!1,g.PARAMETER_TYPE.message)),!1):(this._directoryTree.addNewNode(t,"file",e),this.onDirectoryChange(),this.emit("_onAddLog",u.default.formatLog("addFile",!0)),this._ok(),!0)},v.prototype.addFolder=function(t,e){return!this._checkNameString(t)||e&&!this._checkArray(e)?(this.emit("_onAddLog",u.default.formatLog("addFolder",!1,g.PARAMETER_TYPE.message)),!1):(this._directoryTree.addNewNode(t,"folder",e),this.onDirectoryChange(),this.emit("_onAddLog",u.default.formatLog("addFolder",!0)),this._ok(),!0)},v.prototype.getFileContents=function(t){if(!this._checkString(t))return[];var e=this._directoryTree.enterFile(t);return e?e.children.slice():[]},v.prototype.creatNewNode=function(t,e,i){var o=this._directoryTree.addNewNode(t,e,i);return this.onDirectoryChange(),o},v.prototype.openFile=function(i){return r(this,void 0,void 0,function(){var e;return C(this,function(t){switch(t.label){case 0:return this._checkString(i)?(e=this._directoryTree.enterFile(i))?(this.addTab({tabId:e.treeId,tabName:e.name,type:"file",imgLists:e.children.slice(0),selectedImageUids:e.children.slice(0,1)}),[4,this.showTab(e.treeId)]):[3,2]:(this.emit("_onAddLog",u.default.formatLog("openFile",!1,g.PARAMETER_TYPE.message)),[2,!1]);case 1:return t.sent(),this.emit("_onThumbnailScrollTo",0),this.emit("fileSelected",e.name),this.emit("_onAddLog",u.default.formatLog("openTag",!0)),this._ok(),[2,e.name];case 2:return this._throwError(g.FILE_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("openFile",!1,g.FILE_NOT_EXIST.message)),[2,!1]}})})},v.prototype.openFolder=function(t){return this._checkString(t)?this._directoryTree.enterFolder(t)?(this.onDirectoryChange(),this._ok(),this.emit("_onAddLog",u.default.formatLog("openFolder",!0)),!0):(this._throwError(g.FOLDER_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("openFolder",!1,g.FOLDER_NOT_EXIST.message)),!1):(this.emit("_onAddLog",u.default.formatLog("openFolder",!1,g.PARAMETER_TYPE.message)),!1)},v.prototype.openFolderByPath=function(t){return!!this._checkString(t)&&(this._directoryTree.enterFolderByPath(t)?(this.onDirectoryChange(),this._ok(),!0):(this._throwError(g.PATH_ERROR),!1))},v.prototype.openFileByPath=function(i){return r(this,void 0,void 0,function(){var e;return C(this,function(t){switch(t.label){case 0:return this._checkString(i)?(e=this._directoryTree.enterFileByPath(i))?(this.addTab({tabId:e.treeId,tabName:e.name,type:"file",imgLists:e.children.slice(0),selectedImageUids:e.children.slice(0,1)}),[4,this.showTab(e.treeId)]):[3,2]:[2,!1];case 1:return t.sent(),this.emit("fileSelected",e.name),this._ok(),[2,!0];case 2:return this._throwError(g.FILE_NOT_EXIST),[2,!1]}})})},v.prototype._enterFolder=function(e){return r(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return"folder"!==e?[3,1]:(this.onDirectoryChange(),[3,3]);case 1:return this.addTab({tabId:e.treeId,tabName:e.name,type:"file",imgLists:e.children.slice(0),selectedImageUids:e.children.slice(0,1)}),[4,this.showTab(e.treeId)];case 2:t.sent(),this.emit("fileSelected",e.name),t.label=3;case 3:return[2,!0]}})})},v.prototype.backToPrevious=function(){return this._directoryTree.backToPreviousNode()?(this.onDirectoryChange(),this._ok(),!0):(this._throwError(g.BACK_TO_TOP),!1)},v.prototype.removeFile=function(t){if(!this._checkString(t))return this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("removeFile",!1,g.PARAMETER_TYPE.message)),!1;var e=this._directoryTree.removeFile(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this.emit("_onAddLog",u.default.formatLog("removeFile",!0)),this._ok(),!0):(this._throwError(g.FILE_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("removeFile",!1,g.FILE_NOT_EXIST.message)),!1)},v.prototype.removeFileByPath=function(t){if(!this._checkString(name))return!1;var e=this._directoryTree.removeFileByPath(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this._ok(),!0):(this._throwError(g.FILE_NOT_EXIST),!1)},v.prototype.removeFolder=function(t){if(!this._checkString(t))return this._throwError(g.PARAMETER_TYPE),this.emit("_onAddLog",u.default.formatLog("removeFolder",!1,g.PARAMETER_TYPE.message)),!1;var e=this._directoryTree.removeFolder(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this.emit("_onAddLog",u.default.formatLog("removeFolder",!0)),this._ok(),!0):(this._throwError(g.FOLDER_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("removeFolder",!1,g.FOLDER_NOT_EXIST.message)),!1)},v.prototype.removeFolderByPath=function(t){if(!this._checkString(name))return!1;var e=this._directoryTree.removeFolderByPath(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this._ok(),!0):(this._throwError(g.FILE_NOT_EXIST),!1)},v.prototype._removeNodeContents=function(e){var i=this,t=e.children;if(t){var o=t.length;if(0===o)return;for(var n=0;n<o;n++)this._removeNodeContents(t[n])}else{var r=this._getInterlayerData(e);if(!r)return!1;r.tags.forEach(function(t){i.removeImageTag(e,t)})}},v.prototype.renameFile=function(t,e){return!(!this._checkString(t)||!this._checkString(e)||(this._directoryTree.renameNode(t,e,"file")?(this.onDirectoryChange(),this._ok(),0):(this._throwError(g.FILE_NOT_EXIST),1)))},v.prototype.renameFolder=function(t,e){return!(!this._checkString(t)||!this._checkString(e)||(this._directoryTree.renameNode(t,e,"folder")?(this.onDirectoryChange(),this._ok(),0):(this._throwError(g.FILE_NOT_EXIST),1)))},v.prototype.findChild=function(t,e){return this._directoryTree._findNode(t,e,"file")},v.prototype.nextPage=function(){return this._pager.nextPage()?(this._onpagechange(),this._ok(),!0):(this._throwError(g.PAGE_NOT_EXIST),!1)},v.prototype.previousPage=function(){return this._pager.prevPage()?(this._onpagechange(),this._ok(),!0):(this._throwError(g.PAGE_NOT_EXIST),!1)},v.prototype.firstPage=function(){return this._pager.homePage()?(this._onpagechange(),this._ok(),!0):(this._throwError(g.PAGE_NOT_EXIST),!1)},v.prototype.lastPage=function(){return this._pager.endPage()?(this._onpagechange(),this._ok(),!0):(this._throwError(g.PAGE_NOT_EXIST),!1)},v.prototype.goToPage=function(t){if(void 0!==t){if(!this._checkIndex(t))return!1;this._pager.goToPage(t)}return this._onpagechange(),this._ok(),!0},v.prototype._onpagechange=function(){var t=this._pager.getPageData(),e=this.getUidByIndex(t.currentPage),i=this.getCurrentTab();i&&(e?(i.setSelectedImageUids([e]),this.emit("_onSetRenderImageUid",e)):i.setSelectedImageUids([]),this.emit("pagerRefresh",t),this.emit("_onPagerRefresh",t),this.emit("imageSelected",[t.currentPage]),this.emit("render"))},v.prototype.getThumbnailUids=function(){var t=this.getCurrentTab();return t?(this._ok(),t.imgLists.slice(0)):[]},v.prototype.selectAll=function(){for(var t=this.getThumbnailUids().length,e=[],i=0;i<t;i++)e.push(i);return this.setSelectedIndexes(e)},v.prototype.getUidByIndex=function(t){if(!this._checkIndex(t))return null;var e=this.getCurrentTab();return e?(this._ok(),e.imgLists[t]):null},v.prototype._getUidsByIndexes=function(t){for(var e=t.length,i=[],o=0;o<e;o++)i.push(this.getUidByIndex(t[o]));return i},v.prototype._getIndexesByUids=function(t){for(var e=t.length,i=[],o=0;o<e;o++)i.push(this.getIndexByUid(t[o]));return i},v.prototype.getIndexByUid=function(t){if(!this._checkString(t))return null;var e=[],i=this.getCurrentTab();if(!i)return this._throwError(g.IMG_NOT_EXIST),null;var o=(e=i.imgLists.slice(0)).length;if(0===o)return this._throwError(g.IMG_NOT_EXIST),null;for(var n=0;n<o;n++)if(e[n]===t)return this._ok(),n;return this._throwError(g.IMG_NOT_EXIST),null},v.prototype.updateImage=function(e,s,a){return r(this,void 0,void 0,function(){var i,o,n,r=this;return C(this,function(t){switch(t.label){case 0:return this._checkString(e)?[4,this.getData(e)]:[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))];case 1:return i=t.sent(),o=this._getInterlayerData(e),a&&(this._revokeUrl(o.originalData),this._revokeUrl(o.minData)),n={},Object.keys(i).forEach(function(t){var e;void 0!==s[t]?("customData"!==t&&(e=r._createUrl(s[t]),o[t]=e),n[t]=s[t]):n[t]=i[t]}),[4,this.updateData(e,n)];case 2:return t.sent(),[4,this.showTab(this._tab.selectedTabId)];case 3:return t.sent(),this._ok(),[2,e]}})})},v.prototype._combineData=function(t,e){for(var i=Object.keys(e),o=0;o<i.length;o++){var n=e[i[o]];if("originalData"!==i[o]&&"minData"!==i[o]||!n){if("metaData"===i[o])for(var r=Object.keys(n),s=0;s<r.length;s++)t.metaData[r[o]]=n[r[o]];else if("customData"===i[o])for(var a=Object.keys(n),l=0;l<a.length;l++)t.customData[a[o]]=n[a[o]]}else t[i[o]]=n}return t},v.prototype.updateImageSync=function(t,e,i){var o=this;if(void 0===i&&(i=!0),!this._checkString(t))return!1;var n,r=1;e.originalData?this.updateData(t,e).catch(function(t){o._throwError(g.IMG_NOT_EXIST)}):(r=2,n=e.customData.src,this._dataStorage.addData(e.customData.srcId.toString(),n),e.customData.src=null,this._dataStorage.updateData(t,e).catch(function(t){o._throwError(g.IMG_NOT_EXIST)})),this._dataStorage.updateDataSync(t,e),this.emit("_onSendMiniImgSize");var s=this._getInterlayerData(t);return!!s&&(i&&(this._revokeUrl(s.originalData),this._revokeUrl(s.minData)),s.active=!1,s.dataType=r,this._updateInterlayerData(t,s),this.emit("resetTrnasform"),this.showTab(this._tab.selectedTabId),this._ok(),!0)},v.prototype.setSelectedIndexes=function(t){if(!u.default.isArray(t))return this._throwError(g.PARAMETER_TYPE),!1;for(var e=t.length,i=0;i<e;i++)if(!this._checkIndex(t[i]))return!1;var o=this.getCurrentTab();if(!o)return!1;this.getCurrentIndex();var n=o.getSelectedImageUids(),r=this._getUidsByIndexes(t);if(n.toString()===r.toString()){var s=o.selectedImageUids.length,a=o.selectedImageUids[s-1];return this.emit("_onSetRenderImageUid",a),this._ok(),!0}o.setSelectedImageUids(r);var l=o.selectedImageUids.length,h=o.selectedImageUids[l-1];this.emit("_onSetRenderImageUid",h),this._clearSelectedImage(),this._selectedIndexes=r,this._pager.setPageData({currentPage:t[t.length-1],totalPages:this.getCurrentImageCounts()});var c=this._pager.getPageData();return this.emit("pagerRefresh",c),this.emit("_onPagerRefresh",c),this.emit("imageSelected",t),this.emit("render"),this._ok(),!0},v.prototype.getSelectedIndexes=function(){var t=this.getCurrentTab();return t?(this._ok(),this._getIndexesByUids(t.selectedImageUids)):null},v.prototype.getThumbnailContents=function(){return this._thumbnail.getThumbnailContents()},v.prototype.setThumbnailContents=function(t){this.clearThumbnail();for(var e=t.length,i=0;i<e;i++){var o=t[i],n={uid:o.uid,data:o.minData,tags:o.tags};this.addThumbnailItem(n)}var r=this.getThumbnailContents(),s={currentPage:this.getCurrentIndex()||0,totalPages:e};return this._pager.setPageData(s),this.emit("thumbnailRefresh",r),this.emit("_onThumbnailRefresh",r),this.emit("pagerRefresh",s),this.emit("_onPagerRefresh",s),this.emit("render"),!0},v.prototype.onThumbnailChange=function(){var t=this.getThumbnailContents();this.emit("thumbnailRefresh",t),this.emit("_onThumbnailRefresh",t),this._onpagechange()},v.prototype.addThumbnailItem=function(t){return this._thumbnail.addThumbnailItem(t)},v.prototype.clearThumbnail=function(){this._thumbnail.clearThumbnail()},v.prototype.removeThumbnailItem=function(t){this._thumbnail.removeThumbnailItem(t);var e=this.getThumbnailContents();return this.emit("thumbnailRefresh",e),this.emit("_onThumbnailRefresh",e),!0},v.prototype.removeThumbnailItemByUid=function(t){for(var e=this.getThumbnailContents(),i=0;i<e.length;i++)if(e[i].uid===t)return e.splice(i,1),this._thumbnail.counts--,this.emit("thumbnailRefresh",e),this.emit("_onThumbnailRefresh",e),!0;return!1},v.prototype.removeAllThumbnailItem=function(){this._thumbnail.contents=[],this._thumbnail.counts=0;var t=this.getThumbnailContents();return this.emit("thumbnailRefresh",t),this.emit("_onThumbnailRefresh",t),!0},v.prototype.thumbnailCopy=function(t){},v.prototype._initClipboard=function(){},v.prototype.insertBefore=function(t,e){},v.prototype.insertAfter=function(t,e){},v.prototype.reorderThumbnail=function(t,e){if(!this._checkArray(t))return!1;for(var i=t.length,o=0,n=0;n<i;n++){if(!this._checkIndex(t[n]))return!1;t[n]===n&&o++}if(o!==i){var r,s=this.getCurrentTab(),a=null;a="file"===s.type?s.tabId===this._all.id?this._all.imgLists:(r=this._directoryTree.enterFile(s.tabName))?r.children:[]:this._tag.getCurrentTag().imgLists;for(var l=0;l<i;l++)if(t[l],t[l]!==l){this._thumbnail.contents=this._reorder(this._thumbnail.contents,t),this.currentContents=this._reorder(this.currentContents,t),s.imgLists=this._reorder(s.imgLists,t),a=this._reorder(a,t);var h=this._getUidsByIndexes(e);s.setSelectedImageUids(h);var c=s.selectedImageUids.length,u=s.selectedImageUids[c-1];return this.emit("_onSetRenderImageUid",u),void this.showCurrentTab()}}},v.prototype._reorder=function(t,e){for(var i=t.length,o=[],n=0;n<i;n++)o[n]=t[e[n]];for(var r=0;r<i;r++)t[r]=o[r];return o},v.prototype.moveImage=function(t,e){if(!this._checkIndex(t)||!this._checkIndex(e))return!1;var i=this.getCurrentTab();if(i){var o=null,n=(o="file"===i.type?i.tabId===this._all.id?this._all.imgLists:this.findChild(this.getCurrentNode(),i.tabName).children:this._tag.getCurrentTag().imgLists).splice(t,1);o.splice(e,0,n[0]);var r=i.imgLists,s=r.splice(t,1);r.splice(e,0,s[0]);var a=this.getUidByIndex(e);return i.setSelectedImageUids([a]),this.emit("_onSetRenderImageUid",a),this.emit("_onSetRenderImageUid",a),this.showCurrentTab(),this._ok(),!0}return!1},v.prototype.switchImage=function(t,e){if(!this._checkIndex(t)||!this._checkIndex(e))return!1;var i=this.getCurrentTab();if(i){var o=null,o="file"===i.type?i.tabId===this._all.id?this._all.imgLists:this.findChild(this.getCurrentNode(),i.tabName).children:this._tag.getCurrentTag().imgLists;this._switch(t,e,o);var n=this.getCurrentIndex();n===t?this.setCurrentIndex(e):n===e&&this.setCurrentIndex(t),this._switch(t,e,i.imgLists);var r=i.selectedImageUids.length,s=i.selectedImageUids[r-1];return this.emit("_onSetRenderImageUid",s),this.showCurrentTab(),this._ok(),!0}return!1},v.prototype._switch=function(t,e,i){var o;i.length<2||(o=i[t],i[t]=i[e],i[e]=o)},v.prototype.addTag=function(t,e,i){if(!this._checkNameString(t)||e&&!u.default.isColor(e))return this.emit("_onAddLog",u.default.formatLog("addTag",!1,"Parameter error.")),!1;var o=this._tag.addTag(t,e,i);if(-1===o)return this._throwError(g.TAG_HAVE_EXIST),!1;var n=this.getTagList();return this.emit("tagRefresh",n),this.emit("_onTagRefresh",n),this.emit("_onAddLog",u.default.formatLog("addTag",!0)),this._ok(),o},v.prototype._getTag=function(t){var e=this._tag.getTag(t);return e||(this._throwError(g.TAG_NOT_EXIST),!1)},v.prototype.removeTag=function(t){if(!this._checkString(t))return this.emit("_onAddLog",u.default.formatLog("removeTag",!1,"Parameter error.")),!1;var e=this._getTag(t);if(!e)return this._throwError(g.TAG_NOT_EXIST),!1;for(var i=e.imgLists.slice(0),o=i.length,n=0;n<o;n++)this.removeImageTag(i[n],t);if(e.tagId===this._tab.selectedTabId&&this.showCurrentTab(),!this._tag.removeTag(t))return this._throwError(g.TAG_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("removeTag",!1,"Tag dose not exist.")),!1;var r=this.getTagList();return this.emit("tagRefresh",r),this.emit("_onTagRefresh",r),this.emit("_onAddLog",u.default.formatLog("remove",!0)),this._ok(),!0},v.prototype.emptyTag=function(t){if(!this._checkString(t))return!1;var e=this._getTag(t);if(!e)return this._throwError(g.TAG_NOT_EXIST),!1;for(var i=e.imgLists.slice(0),o=i.length,n=0;n<o;n++)this.removeImageTag(i[n],t);var r=this.getTagList();return this.emit("tagRefresh",r),this.emit("_onTagRefresh",r),this._tab.selectedTabId===e.tagId&&this.showTab(e.tagId),this._ok(),!0},v.prototype.onTagChange=function(){var t=this.getTagList();this.emit("tagRefresh",t),this.emit("_onTagRefresh",t)},v.prototype.addImageTag=function(t,e){if(!this._checkString(t)||!this._checkString(e))return!1;var i=this._getTag(e);if(!i)return this._throwError(g.TAG_NOT_EXIST),!1;i.imgLists.push(t);var o=this._getInterlayerData(t);if(void 0===o)return this._throwError(g.IMG_NOT_EXIST),!1;var n=o.tags;return-1!==n.indexOf(e)?(this._throwError(g.TAG_HAVE_EXIST),!1):(n.push(e),this._ok(),!0)},v.prototype.removeImageTag=function(e,t){var i=this;if(!e||e&&!this._checkString(e)||t&&!this._checkString(t))return!1;var o=this._getInterlayerData(e);if(void 0===o)return this._throwError(g.IMG_NOT_EXIST),!1;var n=o.tags;if(t){var r=n.indexOf(t);if(-1===r)return this._throwError(g.TAG_NOT_EXIST),!1;if(n.splice(r,1),!this._removeImageTag(e,t))return!1}else n.forEach(function(t){if(!i._removeImageTag(e,t))return!1}),n.splice(0);return this._ok(),!0},v.prototype._removeImageTag=function(t,e){var i=this._getTag(e);if(!i)return this._throwError(g.TAG_NOT_EXIST),!1;if(!i.removeImg(t))return this._throwError(g.IMG_NOT_EXIST),!1;if(this._tab.selectedTabId===i.tagId){var o=this._tab.getTab(this._tab.selectedTabId);if(!o)return!1;var n=o.imgLists.indexOf(t);-1!==n&&o.imgLists.splice(n,1),this.removeThumbnailItemByUid(t),this._removeImageFromCurrentByUid(t)}return this._ok(),!0},v.prototype.getTagContents=function(t){if(t){if(!this._checkString(t))return!1}else t=this.getDefaultTag();var e=this._tag.filterByTag(t);return-1===e?(this._throwError(g.TAG_NOT_EXIST),!1):(this._ok(),e)},v.prototype.renameTag=function(t,e){if(!this._checkString(t)||!this._checkString(e))return this.emit("_onAddLog",u.default.formatLog("renameTag",!1,"Parameter error.")),!1;if(t===e)return!0;if(-1!==this.checkTag(e))return this.emit("_onAddLog",u.default.formatLog("renameTag",!1,g.TAG_HAVE_EXIST.message)),this._throwError(g.TAG_HAVE_EXIST),!1;var i=this._getTag(t);if(!i)return this.emit("_onAddLog",u.default.formatLog("renameTag",!1,g.TAG_NOT_EXIST.message)),this._throwError(g.TAG_NOT_EXIST),!1;for(var o=i.imgLists.slice(),n=o.length,r=0;r<n;r++){var s=this._getInterlayerData(o[r]);if(!s)return!1;var a=s.tags;if(void 0===a)return this._throwError(g.IMG_NOT_EXIST),!1;var l=a.indexOf(t);if(-1===l)return this._throwError(g.TAG_NOT_EXIST),!1;a.splice(l,1,e)}i.name=e;var h=this.getTagList();return this.emit("tagRefresh",h),this.emit("_onTagRefresh",h),this.emit("_onAddLog",u.default.formatLog("renameTag",!0)),this._ok(),!0},v.prototype.getCurrentTag=function(){var t=this._tag.getCurrentTag();return t?(this._ok(),t.name):(this._throwError(g.TAG_NOT_EXIST),!1)},v.prototype.setDefaultTag=function(t){return!(!this._checkString(t)||(""===t?(this._tag.defaultTagName=null,this._ok(),0):-1===this.checkTag(t)?(this._throwError(g.TAG_NOT_EXIST),1):(this._tag.defaultTagName=t,this._ok(),0)))},v.prototype.getDefaultTag=function(){return this._ok(),this._tag.defaultTagName},v.prototype.openTag=function(n){return r(this,void 0,void 0,function(){var e,i,o;return C(this,function(t){switch(t.label){case 0:return this._checkString(n)?(this.emit("tagSelected",n),(e=this._tag.getTag(n))?e.tagId!==this._tab.selectedTabId?[3,2]:[4,this.showTab(e.tagId)]:(this._throwError(g.TAG_NOT_EXIST),this.emit("_onAddLog",u.default.formatLog("openTag",!1,g.TAG_NOT_EXIST.message)),[2,Promise.reject(new Error(g.TAG_NOT_EXIST.message))])):(this.emit("_onAddLog",u.default.formatLog("openTag",!1,g.PARAMETER_TYPE.message)),[2,Promise.reject(new Error(g.PARAMETER_TYPE.message))]);case 1:return t.sent(),this._ok(),[2,e.imgLists];case 2:return this._tag.selectedTagId=e.tagId,i=this._tab.checkTab(e.tagId),o=e.imgLists,-1===i&&this._tab.addTab({tabId:e.tagId,tabName:n,type:"tag",imgLists:o.slice(0),selectedImageUids:o.slice(0,1)}),[4,this.showTab(e.tagId)];case 3:return t.sent(),this.emit("_onAddLog",u.default.formatLog("openTag",!0)),this._ok(),[2,e.imgLists]}})})},v.prototype.getTagList=function(){return this._tag.getTagList()},v.prototype.checkTag=function(t){return this._tag.checkTag(t)},v.prototype.on=function(t,e){this._pubSub.on(t,e)},v.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},v.prototype.off=function(t,e){this._pubSub.off(t,e)},v.prototype.onTabChange=function(){this.showTab(this._tab.selectedTabId)},v.prototype.addTab=function(t){return-1===this._tab.checkTab(t.tabId)&&this._tab.addTab(t)},v.prototype.removeTab=function(t){return this._tab.removeTab(t)},v.prototype.getTab=function(t){return this._tab.getTab(t)},v.prototype.showCurrentTab=function(){var t=this._tab.getTab(this._tab.selectedTabId);if(t){var e=this._getImageUrlByUid(t.imgLists);return this._setCurrentcontents(t,e),this.setThumbnailContents(e),this.emit("imageSelected",this.getSelectedIndexes()),!0}},v.prototype.showTab=function(p){return r(this,void 0,void 0,function(){var e,i,o,n,r,s,a,l,h,c,u,d;return C(this,function(t){switch(t.label){case 0:if(!(e=this._tab.getTab(p)))return[2,Promise.reject(new Error("The tab '"+p+"' dose not exist."))];this._tab.selectedTabId!==p&&(this._tab.selectedTabId=p,this.emit("_onCurTabChange",{name:e.tabName,tabId:p}),this.showLatestImage&&(i=e.imgLists.length-1,o=i<0?0:i,this.emit("_onThumbnailScroll",o))),n=e.selectedImageUids.length,r=e.selectedImageUids[n-1],this.emit("_onSetRenderImageUid",r),this.setCurrentIndex(this.getIndexByUid(n&&r)),s=e.imgLists.slice(0),a=[],l=0,h=s,t.label=1;case 1:return l<h.length?(c=h[l],u=null,(d=this._getInterlayerData(c))?d.active?[3,3]:(d.active=!0,[4,this._dataStorage.getData(c)]):[2,!1]):[3,5];case 2:u=t.sent(),this._convertImageData(u,d),t.label=3;case 3:a.push(d),t.label=4;case 4:return l++,[3,1];case 5:return this._setCurrentcontents(e,a),this.setThumbnailContents(a),this.emit("imageSelected",this.getSelectedIndexes()),[2,!0]}})})},v.prototype.getCurrentTab=function(){var t=this._tab.getCurrentTab();return t?(this._ok(),t):(this._throwError(g.NO_IMAGE_EXIST),null)},v.prototype.emptyTab=function(){this.removeAllThumbnailItem(),this.currentContents=[];var t=this.getTab(this._tab.selectedTabId);return t?(t.emptyTab(),this.showCurrentTab(),this._ok(),!0):(this._throwError(g.FILE_NOT_EXIST),!1)},v.prototype.getCurrentImageCounts=function(){var t=this.getCurrentTab();return this._ok(),t?t.getImageCounts():0},v.prototype.getTotalImageCounts=function(){},v.prototype._getImageUrlByUid=function(t){var e=t.length,i=[];if(0===e)return[];for(var o=0;o<e;o++){var n=this._getInterlayerData(t[o]);i.push(n)}return i},v.prototype._createUrl=function(t){var e=Object.prototype.toString.call(t);return"[object Blob]"===e?this._blobToImg(t):/\[object ArrayBuffer\]|\[object \w+Array\]/.test(e)?this._ArrayBufferToImg(t):(/data:image\/\w+;base64/.test(t),t)},v.prototype._revokeUrl=function(t){var e=window.URL||window.webkitURL;if(/^blob:/.test(t))return e.revokeObjectURL(t)},v.prototype._blobToImg=function(t){return(window.URL||window.webkitURL).createObjectURL(t)},v.prototype._urlToImg=function(o){return new Promise(function(t,e){var i=new Image;i.src=o,i.onload=function(){t(i)},i.onerror=function(t){e("img load failed.")}})},v.prototype._ArrayBufferToImg=function(t){var e=new Blob([t]);return this._blobToImg(e)},v.prototype._base64ToImg=function(t){return this._urlToImg(t)},v.prototype._getInterlayerData=function(t){return this._interlayer.getData(t)},v.prototype._addInterlayerData=function(t,e){return this._interlayer.addData(t,e)},v.prototype._removeInterlayerData=function(t){return this._interlayer.removeData(t)},v.prototype._updateInterlayerData=function(t,e){return this._interlayer.updateData(t,e)},v.prototype._checkArray=function(t){return!!u.default.isArray(t)||(this._throwError(g.PARAMETER_TYPE),!1)},v.prototype._checkString=function(t){return!!u.default.isString(t)||(this._throwError(g.PARAMETER_TYPE),!1)},v.prototype._checkIndex=function(t){return u.default.isNumber(t)?!(t<0||t>=this.getCurrentImageCounts())||(this._throwError(g.PARAMETER_RANGE),!1):(this._throwError(g.PARAMETER_TYPE),!1)},v.prototype._checkNameString=function(t){return u.default.isString(t)&&0!==t.length||(this._throwError(g.PARAMETER_TYPE),!1)},v.prototype._checkColor=function(t){return u.default.isString(t)&&(!!/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/.test(t)||!!/^[rR][gG][Bb][Aa]?[\(]([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}[\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?[\s]*(0\.\d{1,2}|1|0)?[\)]{1}$/g.test(t))||(this._throwError(g.PARAMETER_TYPE),!1)},v.prototype._ok=function(){this.emit("dvs_error",g.OK)},v.prototype._throwError=function(t){this.emit("dvs_error",t)},v.prototype.getImageFromCanvas=function(l){return r(this,void 0,void 0,function(){var e,i,o,n,r,s,a;return C(this,function(t){switch(t.label){case 0:return e=null,e=l.minData?l.minData:l.originalData,i=l.originalData,o=this._createUrl(e),n=this._createUrl(i),r=new Image,s=new Image,r.setAttribute("crossOrigin","Anonymous"),s.setAttribute("crossOrigin","Anonymous"),r.src=o,s.src=n,a=document.createElement("canvas"),[4,new Promise(function(i,e){r.onload=function(){var t=r.naturalWidth;a.style.width=t+"px";var e=(a.width=t)/(r.naturalWidth/r.naturalHeight);a.style.height=e+"px",a.height=e,s.onload=function(){var t=s.naturalWidth/r.naturalWidth,e=a.getContext("2d");e.drawImage(r,0,0,r.naturalWidth,r.naturalHeight,0,0,a.width,a.height),i({ctx:e,r:t})}},r.onerror=function(t){e(t)}})];case 1:return[2,t.sent()]}})})},v);function v(t,e,i,o){var n=this;this.showLatestImage=!0,this.useIndexedDB=!0,this.pageSpace=0,this._timer=null,this.selectedImagesCount=0,this._selectedImageArr=[],this.requestArr=[],this.loadCallback=null,this._pubSub=e,this.emit("_onAddLog","Initialization dataHandler."),this.useTag=i,this.useTree=o,this._selectedIndexes=[],this.currentContents=[],this.scrollLeft=0,this.scrollTop=0,this.zoom=1,this._tag=new s.Tags(t.tagConfig),this._interlayer=new f.Interlayer,this._directoryTree=new a.DirectoryTree,this._thumbnail=new l.Thumbnail,this._dataStorage=new h.DataStorage,this._pager=new c.Pager({currentPage:0,totalPages:0}),this._initAll(),this._tab=new d.Tab,this._tab.selectedTabId=this._all.id,this.addTab({tabId:this._tab.selectedTabId,tabName:this._all.name,type:"file",imgLists:[]}),this.showTab(this._tab.selectedTabId),this.emit("_onAddLog","Initialization dataHandler completed."),this.on("sendDrawImageData",function(t){n.emit("getDrawImageData",n.currentContents.slice())})}e.DataHandler=_},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var n=i(14),r=o(i(0)),s=(a.prototype.initDefaultTag=function(){var t=new n.TagItem({tagId:r.default.uid(11),name:this.defaultTagName,color:this.defaultTagColor,imgLists:[]});this._tagList.push(t),this.selectedTagId=t.tagId},a.prototype.getCurrentTag=function(){return this.getTagById(this.selectedTagId)},a.prototype.addTag=function(t,e,i){if(-1!==this.checkTag(t))return-1;var o=new n.TagItem({name:t,color:e||this.defaultTagColor,imgLists:i||[]});return this._tagList.push(o),!0},a.prototype.removeTag=function(t){var e=this.checkTag(t);return-1!==e&&(t===this.defaultTagName&&(this.defaultTagName=null),this._tagList.splice(e,1)[0])},a.prototype.renameTag=function(t,e){this.getTag(t).name=e},a.prototype.checkTag=function(t){var e=this._tagList.length;if(!e)return-1;for(var i=0;i<e;i++)if(this._tagList[i].name===t)return i;return-1},a.prototype.getTagList=function(){return this._tagList},a.prototype.getTag=function(t){var e=this.checkTag(t);return-1===e?null:this._tagList[e]},a.prototype.getTagById=function(t){for(var e=this._tagList.length,i=0;i<e;i++)if(this._tagList[i].tagId===t)return this._tagList[i];return null},a.prototype.filterByTag=function(t){var e=this.checkTag(t);return-1===e?-1:this._tagList[e].imgLists},a);function a(t){this._tagList=[],this.defaultTagColor="#4c4d4a",this.defaultTagName=null,this.defaultTagId=null,this.selectedTagId=null}e.Tags=s},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var n=o(i(0)).default.uid,r=(s.prototype.addImg=function(t){this.imgLists.push(t)},s.prototype.removeImg=function(t){if(0===this.imgLists.length)return!0;var e=this.imgLists.indexOf(t);return-1===e||0<this.imgLists.splice(e,1).length},s.prototype.emptyTag=function(){this.imgLists=[]},s);function s(t){this.name=t.name,this.color=t.color,this.imgLists=t.imgLists||[],this.tagId=t.tagId||n(11)}e.TagItem=r},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var n,r,s=i(16),l=i(19),h=o(i(0));(r=n=n||{}).ROOT="root",r.FOLDER="folder",r.SINGLE="single",r.MULTIPLE="multiple";var a=(c.prototype.generateDirectory=function(){},c.prototype.backToPreviousNode=function(){var t=this.currentNode.parentNode;return!!t&&(this.currentNode=t,!0)},c.prototype.enterNodeFromCurrent=function(t){var e=this.findChild(this.currentNode,t);return this._checkNode(e)},c.prototype.enterFile=function(t){var e=this._findNode(this.currentNode,t,"file");return!!e&&(this.selectedNodeId=e.treeId,e)},c.prototype.enterFileByPath=function(t){var e=this._pathResolve(t);this.currentPath=t;for(var i=this.rootNode,o=e.length,n=0;n<o-1;n++)if(!(i=this._findNode(i,e[n],"folder")))return!1;return!!(i=this._findNode(i,e[o],"file"))&&(this.selectedNodeId=i.treeId,i)},c.prototype.enterFolder=function(t){var e=this._findNode(this.currentNode,t,"folder");return!!e&&(this.currentNode=e,!0)},c.prototype.enterFolderByPath=function(t){var e=this._pathResolve(t);this.currentPath=t;for(var i=this.rootNode,o=0,n=e.length;o<n;o++)if(!(i=this._findNode(i,e[o],"folder")))return!1;this.currentNode=i},c.prototype._findNode=function(t,e,i){if(!e)return!1;if(0<=t.children.length){var o=t.children.filter(function(t){return t.name===e&&t.type===i});return!!o.length&&o[0]}return!1},c.prototype.enterNode=function(t){var e=this._pathResolve(t);this.currentPath=t;for(var i=this.rootNode,o=0,n=e.length;o<n;o++)i=this.findChild(i,e[o]);return this._checkNode(i)},c.prototype._checkNode=function(t){return!t||"folder"!==t.type&&"root"!==t.type?(this.selectedNodeId=t.treeId,t):(this.currentNode=t,"folder")},c.prototype.addNewNode=function(t,e,i){for(var o=t,n=1;this._checkChildren(this.currentNode,o,e);)o=t+"("+n+")",n++;var r,s=h.default.uid(11),a=new l.TreeNode({treeId:s,name:o,type:e,parentNode:this.currentNode,children:i||[]});return"folder"===e?this.currentNode.children.unshift(a):(r=this._getSpiltIndex(this.currentNode.children),this.currentNode.children.splice(r,0,a)),s},c.prototype._getSpiltIndex=function(t){for(var e=t.length,i=0;i<e;i++)if("folder"!==t[i].type)return i;return e},c.prototype.removeFromCurrentNode=function(t){return this.currentNode.removeChildren(t,"file")},c.prototype.removeFile=function(t){return this.currentNode.removeChildren(t,"file")},c.prototype.removeFileByPath=function(t){for(var e=this._pathResolve(t),i=this.rootNode,o=e.length,n=0;n<o-1;n++)i=this._findNode(i,e[n],"folder");return this.currentNode.name===e[o-1]&&(this.currentNode=i),!!i&&i.removeChildren(e[o-1],"file")},c.prototype.removeFolder=function(t){return this.currentNode.removeChildren(t,"folder")},c.prototype.removeFolderByPath=function(t){for(var e=this._pathResolve(t),i=this.rootNode,o=e.length,n=0;n<o-1;n++)i=this._findNode(i,e[n],"folder");return this.currentNode.name===e[o-1]&&(this.currentNode=i),!!i&&i.removeChildren(e[o-1],"folder")},c.prototype.removeNode=function(t){for(var e=this._pathResolve(t),i=this.rootNode,o=e.length,n=0;n<o-1;n++)i=this.findChild(i,e[n]);return i.parentNode&&this.currentNode.parentNode&&i.parentNode.name===this.currentNode.parentNode.name&&i.name===this.currentNode.name&&(this.currentNode=this.currentNode.parentNode),!!i&&i.removeChildren(e[o-1],"file")},c.prototype.renameNode=function(t,e,i){var o=this._findNode(this.currentNode,t,i);return!!o&&(o.setName(e),!0)},c.prototype.addToNode=function(t,e){for(var i=this._pathResolve(t),o=this.rootNode,n=i.length,r=0;r<n;r++)o=this.findChild(o,i[r]);var s=new l.TreeNode({name:e.name,type:e.type,parentNode:o,children:e.children});o.children.push(s)},c.prototype._pathResolve=function(t){s.isString(t);var i=[];return t.replace(/([\w+\.|\w+]+)/g,function(t,e){return i.push(e),t}),i},c.prototype._checkChildren=function(t,e,i){for(var o=t.children,n=o.length,r=0;r<n;r++)if(o[r].name===e&&o[r].type===i)return!0;return!1},c.prototype.findChild=function(t,e){if(!e)return!1;if(0<=t.children.length){var i=t.children.filter(function(t){return t.name===e});return!!i.length&&i[0]}return!1},c.prototype.getSelectedNode=function(){for(var t=this.currentNode.children,e=0,i=t.length;e<i;e++)if(t[e].treeId===this.selectedNodeId&&("single"===t[e].type||"multiple"===t[e].type))return t[e];return null},c);function c(){this.root="root",this.rootNode=new l.TreeNode({treeId:h.default.uid(11),name:"root",type:n.ROOT,parentNode:null,children:[]}),this.currentNode=this.rootNode,this.selectedNodeId=null}e.DirectoryTree=a},function(t,I,R){(function(s){var e=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},o=0;o<e.length;o++)i[e[o]]=Object.getOwnPropertyDescriptor(t,e[o]);return i},a=/%[sdj%]/g;I.format=function(t){if(!b(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(l(arguments[i]));return e.join(" ")}for(var i=1,o=arguments,n=o.length,r=String(t).replace(a,function(t){if("%%"===t)return"%";if(n<=i)return t;switch(t){case"%s":return String(o[i++]);case"%d":return Number(o[i++]);case"%j":try{return JSON.stringify(o[i++])}catch(t){return"[Circular]"}default:return t}}),s=o[i];i<n;s=o[++i])v(s)||!h(s)?r+=" "+s:r+=" "+l(s);return r},I.deprecate=function(t,e){if(void 0!==s&&!0===s.noDeprecation)return t;if(void 0===s)return function(){return I.deprecate(t,e).apply(this,arguments)};var i=!1;return function(){if(!i){if(s.throwDeprecation)throw new Error(e);s.traceDeprecation,i=!0}return t.apply(this,arguments)}};var i,o={};function l(t,e){var i={seen:[],stylize:r};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),_(e)?i.showHidden=e:e&&I._extend(i,e),C(i.showHidden)&&(i.showHidden=!1),C(i.depth)&&(i.depth=2),C(i.colors)&&(i.colors=!1),C(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=n),p(i,t,i.depth)}function n(t,e){var i=l.styles[e];return i?"["+l.colors[i][0]+"m"+t+"["+l.colors[i][1]+"m":t}function r(t,e){return t}function p(e,i,o){if(e.customInspect&&i&&S(i.inspect)&&i.inspect!==I.inspect&&(!i.constructor||i.constructor.prototype!==i)){var t=i.inspect(o,e);return b(t)||(t=p(e,t,o)),t}var n=function(t,e){if(C(e))return t.stylize("undefined","undefined");if(b(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(y(e))return t.stylize(""+e,"number");if(_(e))return t.stylize(""+e,"boolean");if(v(e))return t.stylize("null","null")}(e,i);if(n)return n;var r,s=Object.keys(i),a=(r={},s.forEach(function(t,e){r[t]=!0}),r);if(e.showHidden&&(s=Object.getOwnPropertyNames(i)),x(i)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return f(i);if(0===s.length){if(S(i)){var l=i.name?": "+i.name:"";return e.stylize("[Function"+l+"]","special")}if(T(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(w(i))return e.stylize(Date.prototype.toString.call(i),"date");if(x(i))return f(i)}var h,c="",u=!1,d=["{","}"];return m(i)&&(u=!0,d=["[","]"]),S(i)&&(c=" [Function"+(i.name?": "+i.name:"")+"]"),T(i)&&(c=" "+RegExp.prototype.toString.call(i)),w(i)&&(c=" "+Date.prototype.toUTCString.call(i)),x(i)&&(c=" "+f(i)),0!==s.length||u&&0!=i.length?o<0?T(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),h=u?function(e,i,o,n,t){for(var r=[],s=0,a=i.length;s<a;++s)E(i,String(s))?r.push(g(e,i,o,n,String(s),!0)):r.push("");return t.forEach(function(t){t.match(/^\d+$/)||r.push(g(e,i,o,n,t,!0))}),r}(e,i,o,a,s):s.map(function(t){return g(e,i,o,a,t,u)}),e.seen.pop(),function(t,e,i){if(60<t.reduce(function(t,e){return 0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(h,c,d)):d[0]+c+d[1]}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function g(t,e,i,o,n,r){var s,a,l=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]};if(l.get?a=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(a=t.stylize("[Setter]","special")),E(o,n)||(s="["+n+"]"),a||(t.seen.indexOf(l.value)<0?-1<(a=v(i)?p(t,l.value,null):p(t,l.value,i-1)).indexOf("\n")&&(a=r?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),C(s)){if(r&&n.match(/^\d+$/))return a;s=(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+a}function m(t){return Array.isArray(t)}function _(t){return"boolean"==typeof t}function v(t){return null===t}function y(t){return"number"==typeof t}function b(t){return"string"==typeof t}function C(t){return void 0===t}function T(t){return h(t)&&"[object RegExp]"===c(t)}function h(t){return"object"==typeof t&&null!==t}function w(t){return h(t)&&"[object Date]"===c(t)}function x(t){return h(t)&&("[object Error]"===c(t)||t instanceof Error)}function S(t){return"function"==typeof t}function c(t){return Object.prototype.toString.call(t)}I.debuglog=function(t){return C(i)&&(i=s.env.NODE_DEBUG||""),t=t.toUpperCase(),o[t]||(new RegExp("\\b"+t+"\\b","i").test(i)?(s.pid,o[t]=function(){I.format.apply(I,arguments)}):o[t]=function(){}),o[t]},(I.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},I.isArray=m,I.isBoolean=_,I.isNull=v,I.isNullOrUndefined=function(t){return null==t},I.isNumber=y,I.isString=b,I.isSymbol=function(t){return"symbol"==typeof t},I.isUndefined=C,I.isRegExp=T,I.isObject=h,I.isDate=w,I.isError=x,I.isFunction=S,I.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},I.isBuffer=R(17);function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}I.log=function(){},I.inherits=R(18),I._extend=function(t,e){if(!e||!h(e))return t;for(var i=Object.keys(e),o=i.length;o--;)t[i[o]]=e[i[o]];return t};var u="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function d(t,e){var i;return t||((i=new Error("Promise was rejected with a falsy value")).reason=t,t=i),e(t)}I.promisify=function(r){if("function"!=typeof r)throw new TypeError('The "original" argument must be of type Function');if(u&&r[u]){var t;if("function"!=typeof(t=r[u]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,u,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var i,o,t=new Promise(function(t,e){i=t,o=e}),e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);e.push(function(t,e){t?o(t):i(e)});try{r.apply(this,e)}catch(t){o(t)}return t}return Object.setPrototypeOf(t,Object.getPrototypeOf(r)),u&&Object.defineProperty(t,u,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,e(r))},I.promisify.custom=u,I.callbackify=function(r){if("function"!=typeof r)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var i=t.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");function o(){return i.apply(n,arguments)}var n=this;r.apply(this,t).then(function(t){s.nextTick(o,null,t)},function(t){s.nextTick(d,t,o)})}return Object.setPrototypeOf(t,Object.getPrototypeOf(r)),Object.defineProperties(t,e(r)),t}}).call(this,R(2))},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.removeImg=function(t){if(0===this.children.length)return!1;var e=this.children.indexOf(t);return-1!==e&&(this.children.splice(e,1),!0)},n.prototype.emptyChildren=function(){this.children=[]},n.prototype.removeChildren=function(t,e){var i=this.children.length;if(i){for(var o=0;o<i;o++)if(this.children[o].name===t&&this.children[o].type===e)return this.children.splice(o,1)[0];return!1}return!1},n.prototype.setName=function(t){this.name=t},n);function n(t){this.treeId=t.treeId,this.name=t.name,this.type=t.type,this.parentNode=t.parentNode,this.children=t.children}e.TreeNode=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(21),n=(r.prototype.getThumbnailContents=function(){return this.contents},r.prototype.addThumbnailItem=function(t){var e=new o.ThumbnailItem(t);return this.contents.push(e),this.counts++,e},r.prototype.clearThumbnail=function(){this.counts=0,this.contents.forEach(function(t){}),this.contents=[]},r.prototype.removeThumbnailItem=function(t){return 0<=t&&t<=this.counts&&(window.URL.revokeObjectURL(this.contents[t]),this.contents.splice(t,1),this.counts--,!0)},r);function r(){this.counts=0,this.contents=[]}e.Thumbnail=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function o(t){this.uid=t.uid,this.data=t.data,this.tags=t.tags}e.ThumbnailItem=o},function(t,e,i){"use strict";var o;Object.defineProperty(e,"__esModule",{value:!0}),(o={})[o.SUCCESS=0]="SUCCESS",o[o.FAILURE=1]="FAILURE",o[o.OVERFLOW=2]="OVERFLOW",o[o.TIMEOUT=3]="TIMEOUT";var n=(r.prototype.addData=function(i,o){var n=this;return new Promise(function(t,e){n.datas[i]=o,t(!0)})},r.prototype.getData=function(i){var o=this;return new Promise(function(t,e){o._checkData(i)?t(o.datas[i]):e("not exist.")})},r.prototype.removeData=function(i){var o=this;return new Promise(function(t,e){o._checkData(i)?(delete o.datas[i],t(!0)):e(!1)})},r.prototype.updateData=function(i,o){var n=this;return new Promise(function(t,e){n._checkData(i)?(n.datas[i]=o,t(!0)):e(!1)})},r.prototype._checkData=function(t){return!!this.datas[t]},r.prototype.addDataSync=function(t,e){return this.syncdata[t]=e,!0},r.prototype.getDataSync=function(t){return!!this._checkDataSync(t)&&this.syncdata[t]},r.prototype.removeDataSync=function(t){return!!this._checkDataSync(t)&&(delete this.syncdata[t],!0)},r.prototype.updateDataSync=function(t,e){return!!this._checkDataSync(t)&&(this.syncdata[t]=e,!0)},r.prototype._checkDataSync=function(t){return!!this.syncdata[t]},r);function r(){this.datas={},this.syncdata={}}e.DataStorage=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.setPageData=function(t){this.currentPage=void 0!==t.currentPage?t.currentPage:this.currentPage,this.totalPages=void 0!==t.totalPages?t.totalPages:this.totalPages},n.prototype.getPageData=function(){return{currentPage:this.currentPage,totalPages:this.totalPages}},n.prototype.prevPage=function(){return 0!==this.currentPage&&(0<this.currentPage&&this.currentPage--,!0)},n.prototype.nextPage=function(){return 1<this.totalPages-this.currentPage&&this.currentPage<this.totalPages&&(this.currentPage++,!0)},n.prototype.homePage=function(){return 0!==this.currentPage&&!(this.currentPage=0)},n.prototype.endPage=function(){return this.currentPage!==this.totalPages-1&&(this.currentPage=this.totalPages-1,!0)},n.prototype.goToPage=function(t){return"number"==typeof t&&(t=this._checkPage(t),this.currentPage=t,!0)},n.prototype._checkPage=function(t){return t<this.totalPages?0<=t?t:0:this.totalPages-1},n);function n(t){this.currentPage=t.currentPage,this.totalPages=t.totalPages}e.Pager=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(25),n=(r.prototype.addTab=function(t){if(-1!==this.checkTab(t.tabId))return!1;var e=new o.TabItem(t);return"single"===this.tabMode?this.tabLists=[e]:"multiple"===this.tabMode&&this.tabLists.push(e),e},r.prototype.getTab=function(t){var e=this.checkTab(t);return-1===e?null:this.tabLists[e]},r.prototype.removeTab=function(t){var e=this.checkTab(t);return-1!==e&&(t===this.selectedTabId&&(this.selectedTabId=null),this.tabLists.splice(e,1),!0)},r.prototype.checkTab=function(t){var e=this.tabLists.length;if(!e)return-1;for(var i=0;i<e;i++)if(this.tabLists[i].tabId===t)return i;return-1},r.prototype.getCurrentTab=function(){return this.getTab(this.selectedTabId)},r.prototype.setCurrentTab=function(t){return-1!==this.checkTab(t)&&(this.selectedTabId=t,!0)},r.prototype.closeTab=function(t){var e=this.checkTab(t);return-1!==e&&(this.tabLists.splice(e,1),!0)},r.prototype.setTabMode=function(t){return("single"===t||"multiple"===t)&&(this.tabMode=t,!0)},r);function r(){this.tabMode="single",this.tabLists=[],this.selectedTabId="single"}e.Tab=n},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var n=o(i(0)).default.uid,r=(s.prototype.addImg=function(t){this.imgLists.push(t)},s.prototype.getImageCounts=function(){return this.imgLists.length},s.prototype.getCurrentUid=function(){var t=this.selectedImageUids.length;return t?this.selectedImageUids[t-1]:null},s.prototype.getCurrentIndex=function(){var t=this.imgLists.indexOf(this.getCurrentUid());return-1===t?null:t},s.prototype.removeImg=function(t){if(0===this.imgLists.length)return!0;var e=this.imgLists.indexOf(t);return-1===e||0<this.imgLists.splice(e,1).length},s.prototype.insertImage=function(t,e){this.imgLists.splice(t,0,e)},s.prototype.emptyTab=function(){this.imgLists=[],this.selectedImageUids=[]},s.prototype.setSelectedImageUids=function(t){this.selectedImageUids=t},s.prototype.getSelectedImageUids=function(){return this.selectedImageUids.slice()},Object.defineProperty(s.prototype,"totalImageCount",{get:function(){return this.imgLists.length},enumerable:!0,configurable:!0}),s);function s(t){this.imgLists=[],this.selectedImageUids=[],this.imgObjLists=[],this.totalPage=0,this.currentPage=0,this.displayMode=0,this.tabId=t.tabId||n(11),this.tabName=t.tabName,this.type=t.type,this.scrollTop=t.scrollTop||0,this.scrollLeft=t.scrollLeft||0,this.zoom=t.zoom||1,this.imgLists=t.imgLists||[],this.selectedImageUids=t.selectedImageUids||[]}e.TabItem=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.addData=function(t,e){this.data[t]=e},n.prototype.removeData=function(t){delete this.data[t]},n.prototype.updateData=function(t,e){this.data[t]=e},n.prototype.getData=function(t){return this.data[t]},n);function n(){this.data={}}e.Interlayer=o},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var f=o(i(0)),r=i(28),s=i(30),a=i(32),l=i(33),h=i(34),c=i(35),u=o(i(1)).default.errorMessages,d=(p.prototype.uiEventInit=function(){var s=this;this.sendThumbnailConfig(),this.viewer,this._directoryRender.treeInit(),this._thumbnailRender.thumbnailInit(),this._tagRender.tagInit(),this._cropRender.cropInit(),this._scrollRender._addButtonScroll(),this.buttons=this.viewer.uiConfig.buttons;var t=this.viewer.ID.bind(this);Object.keys(this.buttons).forEach(function(t){var e=s.buttons[t],i=f.default.id(t+"Btn"+s.postfix);if(!i)return!1;"loadImage"!==t&&i.classList.add("DVS_iconColor"),e.onButtonClick&&f.default.addEvent(i,"click",function(t){s._scrollRender.buttonMove?s._scrollRender.buttonMove=!1:t.changedTouches?s.emit(e.onButtonClick,t.changedTouches[0]):s.emit(e.onButtonClick,t)});var o,n=i.children,r=n[n.length-1];f.default.addEvent(i,"mouseover",function(){r&&r.classList.contains("dropdownUl")&&(clearTimeout(s._btnTimer),r.classList.remove("DVS_nodisplay"))}),f.default.addEvent(i,"mouseout",function(){r&&r.classList.contains("dropdownUl")&&(s._btnTimer=setTimeout(function(){r.classList.add("DVS_nodisplay")},500))}),f.default.isArray(e.dropDown)&&(o=r.children,e.dropDown.forEach(function(e,t){e.onButtonClick&&(o[t].onclick=function(t){s.emit(e.onButtonClick,t),e.ifStopBubble&&f.default.stopBubble(t)})}))}),f.default.addEvent(f.default.id("WebViewer"+this.postfix),"contextmenu",function(t){s.emit("onMouseRightClick",t),f.default.preventDefault(t)});var e="click",i="mousedown",o="mousemove",n="mouseup";"ontouchend"in document.documentElement&&(i="touchstart",o="touchmove",n=e="touchend"),this._hasDocumentEvent||(document.body.addEventListener("touchstart",function(){}),document.addEventListener(n,function(t){s._documentMouseUp(t)}),window.addEventListener("resize",function(){s._windowResize()}),window.addEventListener("resize",f.default.throttleStable.call(this,this.styleChange,40)),window.ondragstart=function(){return!1},f.default.addEvent(document,"keyup",function(t){s.selectImageByKey(t)}),this._hasDocumentEvent=!0),f.default.addEvent(t("WebViewer"),e,function(){s.hidePaneBox(),s.hideContextMenu()}),f.default.addEvent(t("besides"),e,function(t){s.hidePaneBox(),s.hideContextMenu(),f.default.stopBubble(t)}),f.default.addEvent(t("WebViewer"),"dragover",this.dragFileOver),f.default.addEvent(t("WebViewer"),"drop",function(t){s.emit("onDrop",t)}),f.default.addEvent(t("navChange"),e,function(t){s.tabChange(t)}),f.default.addEvent(t("cancelRemove"),e,function(){s.toggleConfirmBox()}),f.default.addEvent(t("confirmRemove"),e,function(){s.removeSelectedImage()}),t("panelChangeBtn")&&f.default.addEvent(t("panelChangeBtn"),e,function(t){f.default.stopBubble(t)}),f.default.addEvent(t("isShowPane"),e,function(t){s.togglePanesSelector(t)}),f.default.addEvent(t("paneSelector"),e,function(t){s.changePaneShow(t)}),f.default.addEvent(t("thumbnailPane"),e,function(t){s._changeThumbnailShow(t)}),f.default.addEvent(t("tagLists"),e,function(t){s.cancelTag(t),s.confrimTag(t)}),f.default.addEvent(f.default.id("addTag"+this.postfix),"click",function(t){s._tagRender.addNewTag(t)}),f.default.addEvent(f.default.id("tagLists"+this.postfix),"click",function(t){s._tagRender.quickRenameTag(t),s._tagRender.quickDelTag(t)}),f.default.addEvent(t("tagLists"),"keyup",function(t){var e,i;13===t.keyCode?(e=t.target.nextSibling.children[0])&&e.click():27!==t.keyCode||(i=t.target.nextSibling.children[1])&&i.click()}),f.default.addEvent(t("treeLists"),e,function(t){s.confirmFolder(t),s.cancelFolder(t)}),f.default.addEvent(f.default.id("addFolder"+this.postfix),"click",function(t){s._directoryRender.addNewFolder(t)}),f.default.addEvent(t("treeLists"),"keyup",function(t){var e,i;13===t.keyCode?(e=t.target.nextSibling.children[0])&&e.click():27!==t.keyCode||(i=t.target.nextSibling.children[1])&&i.click()}),"ontouchstart"in document.documentElement?(f.default.addEvent(f.default.id("thumbLists"+this.postfix),"touchstart",function(t){s._thumbnailRender.dragStartMobile(t)}),f.default.addEvent(f.default.id("thumbLists"+this.postfix),"touchmove",function(t){s._thumbnailRender.dragMoveMobile(t)})):(f.default.addEvent(f.default.id("thumbLists"+this.postfix),"mousedown",function(t){s._thumbnailRender.dragThumbnail(t)}),f.default.addEvent(f.default.id("thumbLists"+this.postfix),"mousemove",function(t){s._thumbnailRender.dragMove(t)}),f.default.addEvent(f.default.id("thumbLists"+this.postfix),"mouseover",function(t){s._thumbnailRender.setHoverColor(t)}),f.default.addEvent(f.default.id("thumbLists"+this.postfix),"mouseout",function(t){s._thumbnailRender.setImageColor(t)}),f.default.addEvent(f.default.id("stretchBar"+this.postfix),"mousedown",function(t){s._thumbnailRender.stretchMouseDown(t)}),f.default.addEvent(f.default.id("thumbnailStretchBarRight"+this.postfix),"mousedown",function(t){s._thumbnailRender.thumbnailStretchRightStart(t)}),f.default.addEvent(f.default.id("WebViewer"+this.postfix),"mousemove",function(t){s._thumbnailRender.stretchMouseMove(t),s._thumbnailRender.thumbnailStretchRightMove(t)})),f.default.addEvent(t("mutiSelect"),e,function(){s.enterMutipleMode(),s.viewer.setShowSelectBox(!0)}),f.default.addEvent(f.default.id("selectAll"+this.postfix),e,function(){s._thumbnailRender.selectAllImage(),s.selectImageByIndexes()}),f.default.addEvent(t("exitMutiple"),e,function(){s.exitMutipleMode(),s.viewer.setShowSelectBox(!1)}),f.default.addEvent(t("thumbLists"),"scroll",f.default.stable.call(this,this.thumbnailScroll,50)),f.default.addEvent(t("thumbLists"),"click",function(t){var e,i=s._thumbnailRender.getImageItem(t);i&&(e=f.default.getIndex(i),clearTimeout(s._clickTimer),s._clickItem&&i==s._clickItem?(s.emit("imageDoubleClick",e,t),s._clickItem=null,f.default.preventDefault(t)):(s._clickItem=i,s._clickTimer=setTimeout(function(){s._clickItem=null},500),s.emit("imageClick",e,t)))}),t("defaultTag")&&f.default.addEvent(t("defaultTag"),e,function(){s._onOpenAll(),t("defaultTag").classList.add("DVS_activeAllImage"),s._tagSelected(""),s._fileSelected("")}),f.default.addEvent(t("magnifyImage"),e,function(){s.thumbnailZoomIn()}),f.default.addEvent(t("shrinkImage"),e,function(){s.thumbnailZoomOut()}),f.default.addEvent(t("contextMenu"),"mouseenter",function(t){s.showEditTag(t)},!0),f.default.addEvent(t("contextMenu"),"mouseleave",function(t){s.hideEditTag(t)},!0),f.default.addEvent(t("contextMenu"),e,function(t){s.toggleSelectedTag(t),s.removeTag(t),s.removeFile(t),s.removeImage(t),s.removeAllImage(t),s.copyImage(t),s.insertImgaeBefore(t),s.insertImageAfter(t),s._tagRender.renameTag(t),s._directoryRender.renameFile(t),s.emptyTag(t)}),f.default.addEvent(t("pageInput"),"blur",function(t){s.changePageEvent(t)}),f.default.addEvent(t("pageInput"),"keyup",function(t){13===t.keyCode&&t.target.blur()}),f.default.addEvent(t("cancleSaveBtn"),e,function(){s.hideSaveSetting()}),f.default.addEvent(t("confirmSaveBtn"),e,function(){s.hideSaveSetting()}),f.default.addEvent(t("cancleCropBtn"),e,function(){s.exitCropMode()}),f.default.addEvent(f.default.id("confirmCropBtn"+this.postfix),e,function(){s._confirmCrop()}),f.default.addEvent(t("cropEditArea"),i,function(t){s._imageAreaUnselected(t)}),f.default.addEvent(t("cropEditArea"),"click",function(t){clearTimeout(s._clickEventTimer),s._clickEventTimer?(s.emit("doubleClick",t),s._clickEventTimer=null):(s._clickEventTimer=setTimeout(function(){s._clickEventTimer=null},500),s.emit("click",t)),f.default.stopBubble(t)}),f.default.addEvent(t("cropEditArea"),o,function(t){s.emit("move",t)}),f.default.addEvent(t("cropEditArea"),"wheel",function(t){s.emit("_onScrollWheel",t)}),"ontouchstart"in document.documentElement?f.default.addEvent(t("cropEditArea"),"touchmove",function(t){s._cropRender._cropMoveMobile(t),s._cropRender._editBoxMoveMobile(t),s._cropRender._dragBoxMoveMobile(t)}):(f.default.addEvent(t("cropEditArea"),"mousemove",function(t){s._cropRender.cropMove(t),s._cropRender._editBoxMove(t),s._cropRender._dragBoxMove(t)}),f.default.addEvent(f.default.id("cropBar"+this.postfix),"click",function(t){s._cropRender.setCropRatio(t)}),f.default.addEvent(f.default.id("outer"+this.postfix),"scroll",function(){s._scrollRender.isMyScroll?s._scrollRender.isMyScroll=!1:(s._scrollRender._xOver||s._scrollRender._yOver)&&s._canvasScroll()})),f.default.addEvent(t("cropEditArea"),"mousedown",function(t){2===t.button&&(s._rightClickFlag=!0),f.default.stopBubble(t)}),f.default.addEvent(t("cropEditArea"),"mouseup",function(t){return 2===t.button&&(s._rightClickFlag&&s.emit("rightClick"),void(s._rightClickFlag=!1))}),f.default.addEvent(t("cropEditArea"),"touchstart",function(t){s._longpressTimer=setTimeout(function(){s.emit("rightClick",t)},500)}),f.default.addEvent(t("cropEditArea"),"touchmove",function(t){clearTimeout(s._longpressTimer),f.default.preventDefault(t)}),f.default.addEvent(t("cropEditArea"),"touchend",function(t){clearTimeout(s._longpressTimer)}),f.default.addEvent(t("treeLists"),e,function(t){s.emit("fileClick",t)}),f.default.addEvent(t("tagLists"),e,function(t){s.emit("tagClick",t)}),f.default.addEvent(t("thumbLists"),o,function(t){var e,i=s._thumbnailRender.getImageItem(t);i&&(e=f.default.getIndex(i),s._thumbnailRender.isdrag||s.emit("imageMove",e,t))}),f.default.addEvent(t("thumbLists"),"mousedown",function(t){if(2!==t.button)return!1;if(s._thumbnailRender._isDragMove)return!1;var e=s._thumbnailRender.getImageItem(t);e&&(s._imageRightClickItem=e)}),f.default.addEvent(t("thumbLists"),"mouseup",function(t){if(2!==t.button)return!1;var e=s._thumbnailRender.getImageItem(t);if(e){if(e!==s._imageRightClickItem)return!1;var i=f.default.getIndex(e);if(void 0===i||s._thumbnailRender._isDragMove)return!1;s.emit("imageRightClick",i,t),-1===s._thumbnailRender.selectedIndexes.indexOf(i)&&s.selectImageByIndexes([i])}s._imageRightClickItem=null}),f.default.addEvent(t("thumbLists"),"touchstart",function(t){var e,i=s._thumbnailRender.getImageItem(t);i&&(e=f.default.getIndex(i),s._imageLongpressTimer=setTimeout(function(){s.emit("imageRightClick",e,t),-1===s._thumbnailRender.selectedIndexes.indexOf(e)&&s.selectImageByIndexes([e])},500))}),f.default.addEvent(t("thumbLists"),"touchmove",function(t){clearTimeout(s._imageLongpressTimer)}),f.default.addEvent(t("thumbLists"),"touchend",function(t){clearTimeout(s._imageLongpressTimer)}),f.default.addEvent(t("treeLists"),"contextmenu",function(t){s.emit("fileRightClick",t)}),f.default.addEvent(t("tagLists"),"contextmenu",function(t){s.emit("tagRightClick",t)})},p.prototype.bindEvents=function(){var e=this;this._refreshEvents.forEach(function(t){e.on(t[0],t[1])}),this._outerEvents.forEach(function(t){e.on(t[0],t[1])}),this._buttonEvents.forEach(function(t){e.on(t[0],t[1])}),this._privateEvents.forEach(function(t){e.on(t[0],t[1])})},p.prototype.unbindEvents=function(){var t=this;window.removeEventListener("resize",function(){t._windowResize()}),document.removeEventListener("mouseup",this._documentMouseUp),document.removeEventListener("touchend",this._documentMouseUp),this._thumbnailRender.content=[],this._tagRender.content=[],this._directoryRender.treeList=[],this._cropRender.unbindCropMask()},p.prototype.bindMyAlert=function(){var e=this,i=window.alert;window.alert=function(t){i(t),e._cropRender.preventCrop(),e._thumbnailRender.preventAllCrop()}},p.prototype.on=function(t,e){this._pubSub.on(t,e.bind(this))},p.prototype.off=function(t,e){this._pubSub.off(t,e)},p.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},p.prototype.loadImage=function(){var e=this;(new c.LoadImage).loadImage({type:"input"}).then(function(t){e.emit("_onLoadImage",t)})},p.prototype.toggleConfirmBox=function(){var t=this._thumbnailRender.selectedIndexes,e=f.default.id("thumbLists"+this.postfix)&&f.default.id("thumbLists"+this.postfix).children;t.length&&e&&e.length?f.default.toggleDisplayByQuery("#confirmBox"+this.postfix):alert("Please selected one image at least!")},p.prototype.removeSelectedImage=function(){var t=this._thumbnailRender.selectedIndexes;this.emit("_onRemove",t),f.default.toggleDisplayByQuery("#confirmBox"+this.postfix)},p.prototype.toggleFullScreen=function(){f.default.isFullscreen()?this.viewer.cancelFullScreen():this.viewer.fullScreen()},p.prototype.fitPage=function(){f.default.id("WebViewer"+this.postfix).classList.contains("fitPage")?this.viewer.cancelFullPage():this.viewer.fullPage(),this.styleChange()},p.prototype.fitWindow=function(){this.emit("_onFitType","window")},p.prototype.fitWidth=function(){this.emit("_onFitType","width")},p.prototype.fitHeight=function(){this.emit("_onFitType","height")},p.prototype.flip=function(){this.emit("_onFlip")},p.prototype.mirror=function(){this.emit("_onMirror")},p.prototype.rotate=function(){this.emit("_onRotate",-90)},p.prototype.wipe=function(){},p.prototype.hideSaveSetting=function(){f.default.hiddenByQuery("#saveSettingBox"+this.postfix)},p.prototype.dragFileOver=function(t){f.default.preventDefault(t)},p.prototype.dropFileOnly=function(t){if(f.default.preventDefault(t),!this.useMyEvent)return!1;for(var e=t.dataTransfer.files,i=0;i<e.length;i++){var o,n,r=e[i];/^image\/(?!tiff)/.test(r.type)&&(o={name:r.name,fileType:r.type,contents:[]},n=URL.createObjectURL(r),o.contents.push({originalData:n,minData:null,tags:[]}),this.emit("_onLoadImage",o))}},p.prototype.togglePanesSelector=function(t){var e=t.target;if(e&&("SPAN"===e.tagName||e.classList.contains("ds-dvs-ui-iconfont"))&&(e=e.parentNode),!e||!e.classList.contains("isShowPane"))return!1;var i=e.children[0],o=e.parentNode.children[1];i.classList.toggle("ds-dvs-ui-selected"),i.classList.toggle("ds-dvs-ui-mutiple"),f.default.toggleDisplayByDom(o,!0),this.toggleBeside(),i.classList.contains("ds-dvs-ui-mutiple")&&(f.default.id("besides"+this.postfix).classList.add("DVS_nodisplay"),this.emit("_onCanvasResize")),f.default.stopBubble(t)},p.prototype.hidePaneBox=function(){f.default.hiddenByQuery("#navigationPane"+this.postfix)},p.prototype.changePaneShow=function(t){var e,i=t.target.tagName;if("LI"==i)e=f.default.getIndex(t.target);else{if("DIV"!==i&&"SPAN"!==i)return this._throwErr(u.ELEMENT_NOT_EXIST),!1;e=f.default.getIndex(t.target.parentNode)}var o=f.default.id("paneSelector"+this.postfix).children[e].children[0],n=f.default.id("navChange"+this.postfix).children,r=f.default.id("paneShow"+this.postfix).children;o.classList.toggle("ds-dvs-ui-selected"),o.classList.toggle("ds-dvs-ui-mutiple");var s=f.default.toggleDisplayByDom(n[e],!0),a=this.isPaneEmpty();if(-1!=a)(!s&&n[e].classList.contains("activeTab")||1===this.availablePaneLength())&&n[a].children[0].click();else for(var l=0;l<r.length;l++)r[l].classList.add("DVS_nodisplay");this.toggleBeside()},p.prototype._changeThumbnailShow=function(t){var e=t.target;if(e&&("SPAN"===e.tagName||e.classList.contains("ds-dvs-ui-iconfont"))&&(e=e.parentNode),!e||!e.classList.contains("thumbnailPane"))return!1;var i=e.children[0];i.classList.toggle("ds-dvs-ui-selected"),i.classList.toggle("ds-dvs-ui-mutiple");var o=i.classList.contains("ds-dvs-ui-mutiple");return this.viewer.setShowThumbnail(!o),this.styleChange(),f.default.stopBubble(t),!0},p.prototype.isPaneEmpty=function(){for(var t=f.default.id("navChange"+this.postfix).children,e=0;e<t.length;e++)if(!t[e].classList.contains("DVS_nodisplay")&&!t[e].classList.contains("DVS_disabled"))return e;return-1},p.prototype.availablePaneLength=function(){for(var t=0,e=f.default.id("navChange"+this.postfix).children,i=0;i<e.length;i++)e[i].classList.contains("DVS_nodisplay")||e[i].classList.contains("DVS_disabled")||t++;return t},p.prototype.toggleBeside=function(){var t=this.availablePaneLength(),i=this.isPaneEmpty(),e=f.default.id("besides"+this.postfix);0<t?(e.classList.remove("DVS_nodisplay"),1<t?f.default.id("navChange"+this.postfix).classList.remove("DVS_nodisplay"):f.default.id("navChange"+this.postfix).classList.add("DVS_nodisplay")):(e.classList.add("DVS_nodisplay"),this.emit("_onCanvasResize")),f.default.queryAll("#navChange"+this.postfix+">li").forEach(function(t,e){t.setAttribute("style",""),t.classList.contains("activeTab")&&e===i&&(t.style.borderLeft="none")}),this.emit("_onCanvasResize")},p.prototype.enterCropMode=function(){var t=f.default.id("thumbLists"+this.postfix);return!(!t||!t.children.length||(this.emit("_onGetOperationMode",1),0))},p.prototype.exitCropMode=function(){var t=this._thumbnailRender.selectedIndexes.slice(0).pop(),e=this._cropRender.cropBoxes;e&&0<e.length&&this.emit("imageAreaUnselected",t),this._cropRender.isCrop=!1,this.emit("_onCanvasResize")},p.prototype._confirmCrop=function(){var t=this._cropRender.cropBoxes;return t.length&&this.emit("_onCrop",t),!0},p.prototype.setCropRatio=function(t){var e=this._cropRender.setCropRatioFun(t);return this._thumbnailRender.cropRatio.ratio=t,e},p.prototype.getCropRatio=function(){return this._cropRender.currentRatio},p.prototype.bindCropMask=function(t){this._cropRender.bindCropMask(t)},p.prototype.unbindCropMask=function(){this._cropRender.unbindCropMask()},p.prototype.setCropArea=function(t,e,i,o,n){return this._cropRender.setCropArea(t,e,i,o,n)},p.prototype.setThumbnailCropArea=function(t,e,i,o,n,r){var s=this._thumbnailRender.cropItem;if(!s)return!1;var a=this.imageLayout,l=a.rowsCount,h=a.columnsCount;if(1!==l||1!==h)return!1;var c=s.setCropArea(e,i,o,n),u=s.cropBoxes.length-1;return this.emit("imageAreaSelected",{index:t,x:e,y:i,width:o,height:n,areaIndex:u}),c},p.prototype._imageAreaUnselected=function(t){var e=this._thumbnailRender.selectedIndexes.slice(0).pop(),i=this._cropRender.cropBoxes,o=i&&0<i.length;void 0!==t.button?(this._cropRender.cropStart(t),t.ctrlKey||o&&this.emit("imageAreaUnselected",e)):(this._cropRender.cropStartMobile(t),o&&this.emit("imageAreaUnselected",e))},p.prototype._imageAreaSelected=function(t){if(!this._cropRender.isCrop)return!1;var i,e,o,n=this._cropRender.isCropMove;void 0!==t.button?(this._cropRender.cropEnd(),this._cropRender.editBoxEnd(),this._cropRender.dragBoxEnd()):(this._cropRender.cropEndMobile(),this._cropRender.editBoxEndMobile(),this._cropRender.dragBoxEndMobile()),n&&(this._cropRender.isCropMove=!1,(i=this._cropRender.currentCropBox)&&(e=this._thumbnailRender.selectedIndexes.slice(0).pop(),o=-1,this._cropRender.cropBoxes.forEach(function(t,e){t===i&&(o=e)}),-1!==o&&this.emit("_onImageAreaSelected",{index:e,x:0<i.left?i.left:0,y:0<i.top?i.top:0,width:i.width,height:i.height,areaIndex:o})))},p.prototype.confrimTag=function(t){var e,i,o;t.target.classList.contains("confirmTag")?(e=this._tagRender.confirmTag(t))&&this.emit("_onAddTag",e.tagName):t.target.classList.contains("renameConfireTag")&&((i=t.target.parentNode.parentNode.dvs_oldName)===(o=f.default.id("createBox"+this.postfix).children[0].value)?this.emit("_onTagChange"):this.emit("_onRenameTag",i,o))},p.prototype.cancelTag=function(t){t.target.classList.contains("cancelTag")&&(this.emit("_onTagChange"),f.default.id("addTag"+this.postfix).style.pointerEvents="auto")},p.prototype.showTagContent=function(t){var e,i=this._tagRender.getTargetDom(t);i&&((e=i.dvs_name)&&(this.emit("_onOpenTag",e),this._tagSelected(e)),this.hideContextMenu(),f.default.stopBubble(t))},p.prototype._tagSelected=function(t){try{return this._tagRender.selectTagByName(t),!0}catch(t){return this._throwErr(u.ELEMENT_NOT_EXIST),!1}},p.prototype._onRefreshTag=function(t){f.default.id("tagLists"+this.postfix)&&this._tagRender.updateTagList(t)},p.prototype.confirmFolder=function(t){var e=this._directoryRender.confirmFolder(t);if(e)this.emit("_onAddFolder",e,[]);else if(t.target.classList.contains("renameConfirmFile")){var i=t.target.parentNode.parentNode,o=i.dvs_fileName,n=i.children[1].value,r=i.dvs_type;if("folder"===r)this.emit("_onRenameFolder",o,n);else{if("file"!==r)return;this.emit("_onRenameFile",o,n)}}},p.prototype.enterFolder=function(t){var e,i,o=this._directoryRender.getTargetDom(t);o&&(e=o.dvs_type,i=o.dvs_fileName,"folder"===e?this.emit("_onOpenFolder",i):"back"===e?this.emit("_onBackToPrevious"):this.emit("_onOpenFile",i),this.hideContextMenu())},p.prototype.cancelFolder=function(t){t.target.classList.contains("cancelFolder")&&this.emit("_onDirectoryChange")},p.prototype._fileSelected=function(t){this._directoryRender.selectFileByName(t)},p.prototype._onRefreshDirctory=function(t){if(!f.default.id("treeLists"+this.postfix))return!1;this._directoryRender.updataDirectory(t);var e=f.default.id("addFolder"+this.postfix);e&&e.style&&(e.style.pointerEvents="auto")},p.prototype.enterMutipleMode=function(){this._thumbnailRender.enterMutipleMode()},p.prototype.exitMutipleMode=function(){this._thumbnailRender.exitMutipleMode();var t=this._thumbnailRender.selectedIndexes.slice(0).pop()||0;this.selectImageByIndexes([t])},p.prototype.dragThumbUp=function(t){var e=this._thumbnailRender.dragUp();this._dragFunction(e,t)},p.prototype.dragThumbUpMobile=function(t){var e=this._thumbnailRender.dragUpMobile();this._dragFunction(e,t)},p.prototype._sendThumbnailRect=function(){if(f.default.isMobile())return!1;var t=f.default.id("Thumbnail"+this.postfix);if(t){var e=t.getBoundingClientRect();if(0==e.width&&0==e.height)return!1;var i=this._tempThumbnailSize;i.width===e.width&&i.height===e.height||(i.width=e.width,i.height=e.height,this.emit("thumbnailStretch",e.width,e.height))}},p.prototype._dragFunction=function(t,e){var i,o,n,r;t&&(i=f.default.id("thumbLists"+this.postfix),o=this._thumbnailRender.selectedIndexes.map(function(t){return i.children[t].DVS_defaultIndex}),n=this._thumbnailRender.getDefaultIndexes(),r=[],o.forEach(function(t){var e=n.indexOf(t);-1!==e&&e!==t&&r.push([t,e])}),this.emit("_onReOrderThumbnail",n,this._thumbnailRender.selectedIndexes),this.selectImageByIndexes(),r.length&&this.emit("dragDone",r))},p.prototype.selectThumbImg=function(t,e){var i,o=this._thumbnailRender,n=o.selectedIndexes;if(!e.ctrlKey&&!e.metaKey||e.shiftKey)if(!e.shiftKey||e.ctrlKey||e.metaKey)if((e.ctrlKey||e.metaKey)&&e.shiftKey){var r=n.slice(0),s=r[r.length-1];r.push(t);var a=t,l=t;r.forEach(function(t){t<a?a=t:l<t&&(l=t)});for(var h=[],c=a;c<=l;c++)c!==s&&h.push(c);0<=s&&h.push(s),o.selectedIndexes=h}else o.needClick?(i=o.getTargetDom(e),o.selectThumb(i)):o.needClick=!0;else if(void 0===(s=n.slice(0).pop()))o.selectedIndexes.push(t);else{var u=[];if(s<t)for(var c=t;s<=c;c--)u.push(c);else for(var d=t;d<=s;d++)u.push(d);o.selectedIndexes=u}else{var p=n.indexOf(t);if(-1===p)o.selectedIndexes.push(t);else{if(!(1<o.selectedIndexes.length))return!1;o.selectedIndexes.splice(p,1)}}return this.selectImageByIndexes(),f.default.id("contextMenu"+this.postfix).classList.add("DVS_nodisplay"),!0},p.prototype.selectImageByIndexes=function(t){var e=this._thumbnailRender,i=t||e.selectedIndexes;this.emit("_onSetSelectedIndexes",i)},p.prototype.thumbnailScroll=function(){var t=f.default.id("contextMenu"+this.postfix);t&&t.classList.add("DVS_nodisplay"),this._fileTopImageChange(!0)},p.prototype.thumbnailWheelScroll=function(t){var e=f.default.id("thumbLists"+this.postfix);if(!e)return!1;if("row"===e.style.flexDirection){if(e.scrollHeight<=e.clientHeight)return!1;f.default.animation(e,"scrollTop",e.scrollTop+t.deltaY,100)}else{if(e.scrollWidth<=e.clientWidth)return!1;e.scrollLeft+=t.deltaX}},p.prototype._getTopImageIndex=function(){var t=f.default.id("thumbLists"+this.postfix);if(!t)return-1;var e=t.children;if(e.length<=0)return-1;if(t.scrollWidth<=t.clientWidth&&t.scrollHeight<=t.clientHeight)return 0;var i,o,n=e[0].getBoundingClientRect(),r=this.imageLayout,s=r.rowsCount,a=r.columnsCount,l=r.isrow,h=parseInt(this.viewer.uiConfig.thumbnail.imageSpace);return 1===s&&1===a&&(h=0),l?(i=t.scrollTop,Math.floor((i+1)/(n.height+h))*a):(o=t.scrollLeft,Math.floor((o+1)/(n.width+h))*s)},p.prototype.scrollTo=function(t){if(this.viewer._tempScrollIndex=null,!f.default.isNumber(t)||t<0)return!1;var e=f.default.id("thumbLists"+this.postfix);if(!e||!e.children||!e.children.length)return!1;if(t>e.children.length-1)return!1;if(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth){var i=e.getBoundingClientRect(),o=e.children[t].getBoundingClientRect(),n=this.imageLayout,r=n.rowsCount,s=n.columnsCount,a=n.isrow,l=this.viewer.uiConfig.thumbnail.imageSpace;1===Math.abs(r)&&1===Math.abs(s)&&(l=0);var h=o.height+l,c=o.width+l,u=void 0,d=void 0;return a?i.top>=o.top?u=h*Math.floor(t/s):i.bottom<=o.bottom&&(u=h*Math.floor(t/s-r+1)):i.left>=o.left?d=c*Math.floor(t/r):i.right<=o.right&&(d=c*Math.floor(t/r-s+1)),null!=u&&(e.scrollTop=u),null!=d&&(e.scrollLeft=d),this._fileTopImageChange(!1),!0}if(this.viewer.showThumbnail)return!1;this.viewer._tempScrollIndex=t},p.prototype.selectImageByKey=function(t){if(!f.default.id("thumbLists"+this.postfix))return!1;if(!this._totalImageIndex)return!1;var e,i=this.imageLayout,o=i.isrow,n=i.columnsCount,r=i.rowsCount;38===t.keyCode?o?0<=(e=this._currentImageIndex-n)&&this.goToPage(e):this.prevPage():40===t.keyCode?o?(e=this._currentImageIndex+n)<this._totalImageIndex&&this.goToPage(e):this.nextPage():37===t.keyCode?o?this.prevPage():0<=(e=this._currentImageIndex-r)&&this.goToPage(e):39===t.keyCode&&(o?this.nextPage():(e=this._currentImageIndex+r)<this._totalImageIndex&&this.goToPage(e)),f.default.preventDefault(t)},p.prototype.changeMargin=function(t){return this.viewer.uiConfig.thumbnail.imageSpace=t,this._updateImageMargin(t)},p.prototype.setViewMode=function(t,e){try{var i=f.default.id("thumbLists"+this.postfix),o=this._thumbnailRender.thumbnailConfig.imageSpace;this._updateRowsColumns(e,t),e=this.imageLayout.rowsCount,t=this.imageLayout.columnsCount,this._updateImageMargin(o,e,t);var n=this._thumbnailRender.selectedIndexes.slice(0).pop();return this.scrollTo(n),this._thumbnailRender.selectThumbByIndex(),i.classList.toggle("fixIE"),!0}catch(t){return!1}},p.prototype.thumbnailZoomIn=function(){var t=this.imageLayout,e=t.rowsCount,i=t.columnsCount;1<e&&e--,1<i&&i--,this.imageLayout.rowsCount=e,this.imageLayout.columnsCount=i,this.setViewMode()},p.prototype.thumbnailZoomOut=function(){var t=this.imageLayout,e=t.rowsCount,i=t.columnsCount;e<10&&e++,i<10&&i++,this.imageLayout.rowsCount=e,this.imageLayout.columnsCount=i,this.setViewMode()},p.prototype._imageSelected=function(t){var e;f.default.isArray(t)&&((e=this._thumbnailRender).selectedIndexes=t,e.selectThumbByIndex(t))},p.prototype._onRefreshThumb=function(t){f.default.id("thumbLists"+this.postfix)&&(this._thumbnailRender.updataContent(t),this.setViewMode())},p.prototype._fileTopImageChange=function(t){void 0===t&&(t=!0);var e=this._getTopImageIndex(),i=f.default.id("Thumbnail"+this.postfix);if(!this.viewer.showThumbnail||!i)return!1;if(!this._thumbnailRender.thumbnailContent[e])return null!==this._topImageUid&&(this._topImageUid=null,this._onTopImageChange(-1,t)),!1;var o=this._thumbnailRender.thumbnailContent[e].uid;if(o!==this._topImageUid){if(this._topImageUid=o||"",this._thumbnailRender.isdrag)return!1;this._onTopImageChange(e,t)}},p.prototype._onTopImageChange=function(t,e){void 0===e&&(e=!0),this.emit("topImageChange",t,e)},p.prototype._updateRowsColumns=function(t,e){var i=f.default.id("thumbLists"+this.postfix);e<0&&0<t?(e=-e,i.style.flexDirection="row",i.style.overflowX="hidden",i.style.overflowY="auto",this.imageLayout.isrow=!0,this.viewer.uiConfig.thumbnail.imageDirection="row"):0<e&&t<0&&(t=-t,i.style.flexDirection="column",i.style.overflowX="auto",i.style.overflowY="hidden",this.imageLayout.isrow=!1,this.viewer.uiConfig.thumbnail.imageDirection="column"),0<e&&0<t&&(this.imageLayout.rowsCount=t,this.imageLayout.columnsCount=e)},p.prototype._updateImageMargin=function(e,t,i){var o=this,n=f.default.id("thumbLists"+this.postfix);0<=e?this.viewer.uiConfig.thumbnail.imageSpace=e:e=this.viewer.uiConfig.thumbnail.imageSpace,t&&i||(t=this.imageLayout.rowsCount,i=this.imageLayout.columnsCount),n.clientWidth&&e*(i+1)>n.clientWidth&&(e=n.clientWidth/(i+1)-5),n.clientHeight&&e*(t+1)>n.clientHeight&&(e=n.clientHeight/(t+1)-5),e=0<e?e:0,1===Math.abs(i)&&1===Math.abs(t)&&(e=0);var r,s="calc("+100/i+"% - "+e+"px)",a="calc("+100/t+"% - "+e+"px)";return this._thumbnailRender.imageInfo={width:"calc("+100/i+"% - "+(i+1)/i*e+"px)",height:"calc("+100/t+"% - "+(t+1)/t*e+"px)",oldWidth:s,oldHeight:a},n&&n.children.length&&(r=f.default.arrayFrom(n.children),this.imageLayout.isrow,r.forEach(function(t){t.style.width=s,t.style.height=a,t.style.margin="0 "+e+"px "+e+"px 0",t.style.cursor=o.viewer.uiConfig.thumbnail.mouseShape,n.style.padding=e+"px 0 0 "+e+"px"}),this._thumbnailRender.getPagerSize()),!0},p.prototype.nextPage=function(){this.emit("_onNextPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},p.prototype.prevPage=function(){this.emit("_onPreviousPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},p.prototype.homePage=function(){this.emit("_onFirstPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},p.prototype.endPage=function(){this.emit("_onLastPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},p.prototype.goToPage=function(t){this.emit("_onGotoPage",t),this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},p.prototype.changePageEvent=function(t){var e=0<(e=parseInt(t.target.value))?e:0;this.emit("pageChange",e)},p.prototype.pageChange=function(t){var e=t-1;this.goToPage(e),this.scrollTo(e)},p.prototype._onRefreshPage=function(t){var e=f.default.id("pageInput"+this.postfix),i=f.default.id("pageLabel"+this.postfix),o=t.currentPage,n=t.totalPages;this._currentImageIndex=o;var r,s=(this._totalImageIndex=n)?o+1:0;e&&i&&(e.value=s,i.innerText=n,e.style.fontSize="16px",r=16*String(n).length+"px",e.style.width=r),this._clearCropBoxes(),this._fileTopImageChange(!0)},p.prototype._canvasScroll=function(){var t=f.default.id("outer"+this.postfix),e=t.scrollLeft,i=t.scrollTop;this.emit("_onCanvasScroll",{left:e,top:i})},p.prototype._canvasZoomIn=function(){this.emit("_onZoomIn")},p.prototype._canvasZoomOut=function(){this.emit("_onZoomOUt")},p.prototype.setOuterScroll=function(t,e){return this._scrollRender.setScroller(t,e)},p.prototype.showContextMenu=function(t,e){if(t){var i=f.default.id("contextMenu"+this.postfix),o=f.default.id("WebViewer"+this.postfix).getBoundingClientRect();i.classList.remove("DVS_nodisplay");var n=i.getBoundingClientRect();return i.DVS_activeIndex=f.default.getIndex(t),i.style.left=e.clientX-o.left+"px",n.height+e.clientY<o.bottom?(i.style.top=e.clientY-o.top+"px",i.style.bottom=null):(i.style.bottom=o.bottom-e.clientY+"px",i.style.top=null,e.clientY-n.height<o.top&&(i.style.top="0px",i.style.bottom=null)),i}return!1},p.prototype.contextTree=function(t){var e=this._directoryRender.getTargetDom(t);e&&!e.classList.contains("backTree")&&(this.generateContextTree(),this.showContextMenu(e,t))},p.prototype.contextTag=function(t){var e=this._tagRender.getTargetDom(t);e&&!e.classList.contains("defaultTag")&&(this.generateContextTag(),this.showContextMenu(e,t))},p.prototype.contextThumb=function(t,e){if(this._thumbnailRender.isdrag)return!1;var i,o,n,r=this._thumbnailRender.getTargetDom(e);r&&(i=f.default.id("contextMenu"+this.postfix),o=this._tagRender.tagList,this.generateContextThumbnail(),this.showContextMenu(r,e),(n=f.default.id("nextMenu"+this.postfix))&&(1<o.length?n.classList.remove("DVS_nodisplay"):n.classList.add("DVS_nodisplay"),i.DVS_tags=r.DVS_tags,i.DVS_uid=r.DVS_uid,this.generateEditTags()))},p.prototype.showEditTag=function(t){if(t.target.classList.contains("changeTagLi")){var e=f.default.id("nextMenu"+this.postfix);if(e){var i=f.default.id("editTags"+this.postfix);if(!i||e.classList.contains("DVS_nodisplay"))return!1;i.style.top="-1px",i.classList.remove("DVS_nodisplay");var o=i.getBoundingClientRect(),n=f.default.id("WebViewer"+this.postfix).getBoundingClientRect();o.height>n.height&&(i.style.height=n.height+"px",o=i.getBoundingClientRect()),o.bottom>n.bottom&&(i.style.top=n.bottom-o.bottom+"px")}f.default.stopBubble(t)}},p.prototype.hideEditTag=function(t){t.target.classList.contains("changeTagLi")&&f.default.id("editTags"+this.postfix).classList.add("DVS_nodisplay")},p.prototype.toggleSelectedTag=function(t){var e,i,o,n=null;t.target.parentNode.classList.contains("editTags")?n=t.target:t.target.parentNode.parentNode.classList.contains("editTags")?n=t.target.parentNode:t.target.classList.contains("changeTagLi")&&f.default.stopBubble(t),n&&(e=!n.children[0].classList.toggle("DVS_hidden"),i=f.default.id("contextMenu"+this.postfix).DVS_uid,o=n.children[1].innerText,e?this.emit("_onAddImageTag",i,o):this.emit("_onRemoveImageTag",i,o),f.default.stopBubble(t))},p.prototype.generateEditTags=function(){for(var t="",e=this._tagRender.tagList.map(function(t){return t.name}),i=f.default.id("contextMenu"+this.postfix).DVS_tags,o=0,n=e.length;o<n;o++)t+='<li>\n                <div class="ds-dvs-ui-iconfont ds-dvs-ui-confire '+(-1===i.indexOf(e[o])?"DVS_hidden":"")+'" > </div>\n                <span> '+e[o]+" </span>\n                </li>";f.default.id("editTags"+this.postfix).innerHTML=t},p.prototype.hideContextMenu=function(){f.default.hiddenByQuery("#contextMenu"+this.postfix)},p.prototype.removeTag=function(t){var e,i;t.target.classList.contains("removeTagBtn")&&(e=f.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=f.default.id("tagLists"+this.postfix).children[e].dvs_name,this.emit("_onRemoveTag",i))},p.prototype.emptyTag=function(t){var e,i;t.target.classList.contains("emptyTagBtn")&&(e=f.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=f.default.id("tagLists"+this.postfix).children[e].dvs_name,this.emit("_onEmptyTag",i))},p.prototype.removeFile=function(t){var e=t.target;if(!e)return!1;if(e.classList.contains("removeFileBtn")){var i=f.default.id("contextMenu"+this.postfix).DVS_activeIndex,o=f.default.id("treeLists"+this.postfix).children[i];if(!o)return!1;var n=o.children[1].innerText,r=o.dvs_type;if("folder"===r)this.emit("_onRemoveFolder",n);else{if("file"!==r)return!1;this.emit("_onRemoveFile",n)}}},p.prototype.removeImage=function(t){try{var e,i,o;t.target.classList.contains("removeImageBtn")&&(e=f.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=this._thumbnailRender.selectedIndexes,o=void 0,o=-1!==i.indexOf(e)?i:[e],this.emit("_onRemove",o))}catch(t){this._throwErr(u.ELEMENT_NOT_EXIST)}},p.prototype.removeAllImage=function(t){try{t.target.classList.contains("removeAllImageBtn")&&this.emit("_onRemoveAll")}catch(t){this._throwErr(u.ELEMENT_NOT_EXIST)}},p.prototype.copyImage=function(t){try{var e,i,o;t.target.classList.contains("copyImageBtn")&&(e=f.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=this._thumbnailRender.selectedIndexes,o=void 0,o=-1!==i.indexOf(e)?i:[e],this.emit("_thumbnailCopy",o))}catch(t){this._throwErr(u.ELEMENT_NOT_EXIST)}},p.prototype.insertImgaeBefore=function(t){try{var e;t.target.classList.contains("insertBeforeBtn")&&(e=f.default.id("contextMenu"+this.postfix).DVS_activeIndex,this.emit("_insertBefore",e))}catch(t){this._throwErr(u.ELEMENT_NOT_EXIST)}},p.prototype.insertImageAfter=function(t){try{var e;t.target.classList.contains("insertAfterBtn")&&(e=f.default.id("contextMenu"+this.postfix).DVS_activeIndex,this.emit("_insertAfter",e))}catch(t){this._throwErr(u.ELEMENT_NOT_EXIST)}},p.prototype.generateContextTree=function(){var t=f.default.id("contextMenu"+this.postfix);"tree"!==this._contextType&&(this._contextType="tree",t.innerHTML="\n        <li>Copy</li>\n        <li>Cut</li>\n        <li>Paste</li>\n        <li class='removeFileBtn'>Remove</li>\n        <li class='renameFileBtn'>Rename</li>")},p.prototype.generateContextTag=function(){var t=f.default.id("contextMenu"+this.postfix);"tag"!==this._contextType&&(this._contextType="tag",t.innerHTML="\n        <li class='emptyTagBtn'>Empty</li>\n        <li class='renameTagBtn'>Rename</li>\n        <li class='removeTagBtn'>Remove</li>")},p.prototype.generateContextThumbnail=function(){var t=f.default.id("contextMenu"+this.postfix);"thumbnail"!==this._contextType&&(this._contextType="thumbnail",t.innerHTML="  \n        <li class='copyImageBtn'>Copy</li>\n        <li>Cut</li>\n        <li class='changeTagLi "+(this.viewer.uiConfig.tag.visibility?"":"DVS_disabled")+"'>\n            Tag\n            <div id='nextMenu"+this.postfix+"' class=\"ds-dvs-ui-iconfont ds-dvs-ui-pageNext nextMenu\"></div>\n            <ul id='editTags"+this.postfix+"' class='editTags DVS_nodisplay'></ul>\n\n        </li>\n        <li class='insertBeforeBtn'>Insert Before</li>\n        <li class='insertAfterBtn'>Insert After</li>\n        <li class='removeImageBtn'>Remove</li>\n        <li class='removeAllImageBtn'>RemoveAll</li>")},p.prototype.tabChange=function(t){if("DIV"===t.target.tagName){var e=f.default.getIndex(t.target.parentNode);this._selectTab(e),t.target.parentNode.classList.add("activeTab");for(var i=f.default.id("paneShow"+this.postfix).children,o=0;o<i.length;o++)f.default.hiddenByDom(i[o]),o===e&&f.default.toggleDisplayByDom(i[o])}this.hideContextMenu(),f.default.stopBubble(t)},p.prototype._selectTab=function(t){for(var e=f.default.id("navChange"+this.postfix).children,i=f.default.id("besides"+this.postfix),o=!1,n=0,r=e.length;n<r;n++)n===t?(e[n].classList.add("activeTab"),o=!0):e[n].classList.remove("activeTab");return o?i.classList.remove("DVS_hiddenBesides"):i.classList.add("DVS_hiddenBesides"),!0},p.prototype.styleChange=function(){Window;var t=f.default.id("WebViewer"+this.postfix);if(!t)return!1;this.viewer.uiConfig.buttonResize.ifResize&&(f.default.isMobile()||this.viewer.changeButtonSize(),t.classList.add("DWT_imageEditor"));var e=f.default.id("topMenu"+this.postfix),i=f.default.id("topMenuRight"+this.postfix);i&&(e.style.paddingRight=i.getBoundingClientRect().width+"px"),this._clearCropBoxes(),this._thumbnailRender.getPagerSize(),this.viewer.updateVideoSize(),this._scrollRender.updateAllGroupShowMore(),this._sendThumbnailRect(),f.default.id("thumbLists"+this.postfix).classList.toggle("fixIE"),this.emit("_onCanvasResize"),this.emit("_onSendCropLimitArea"),this.emit("onViewerResize")},p.prototype._throwErr=function(t,e){this.emit("dvs_error",t)},p.prototype._ok=function(){this.emit("dvs_error",u.OK)},p.prototype._windowResize=function(){this._clearCropBoxes()},p.prototype._documentMouseUp=function(t){return!!f.default.id("WebViewer"+this.postfix)&&(!t.button||0===t.button)&&(this._imageAreaSelected(t),this._thumbnailRender.cropItem&&this._thumbnailRender.cropItem._imageAreaSelected(t),void(t.changedTouches?(e=t.changedTouches[0],this.dragThumbUpMobile(e)):(i=f.default.id("stretchBar"+this.postfix),o=f.default.id("thumbnailStretchBarRight"+this.postfix),i&&i.classList.contains("DVS_streching")&&(this._thumbnailRender.stretchMouseUp(),this.styleChange()),o&&o.classList.contains("DVS_streching")&&(this._thumbnailRender.thumbnailStretchRightEnd(),(n=f.default.id("Thumbnail"+this.postfix))&&(this.viewer.thumbnailWidth=n.clientWidth),this.styleChange()),this.dragThumbUp(t))));var e,i,o,n},p.prototype.switchThumbnailDirection=function(t,e){var i=f.default.id("showImageArea"+this.postfix),o=f.default.id("Thumbnail"+this.postfix);if(!i||!o)return this._throwErr(u.ELEMENT_NOT_EXIST),!1;if(this.viewer.uiConfig.thumbnail.direction!==t){var n=this.imageLayout,r=n.rowsCount,s=n.columnsCount;if("row"===t)i.style.flexDirection="row",this.setViewMode(-s,r);else{if("column"!==t)return this._throwErr(u.PARAMETER_RANGE),!1;i.style.flexDirection="column",o.style.width=null,this.setViewMode(s,-r)}this.viewer.uiConfig.thumbnail.direction=t}return void 0!==e&&(o.style.order=e,this.viewer.uiConfig.thumbnail.sequence=e),!0},p.prototype._onOpenAll=function(){this.emit("_onOpenAll")},p.prototype.getTabItem=function(t){this._tabItem=t,this._thumbnailRender.tabItem=t},p.prototype._onSave=function(){f.default.id("saveSettingBox"+this.postfix).classList.toggle("DVS_nodisplay")},p.prototype.togglePaneBox=function(){f.default.toggleDisplayByQuery("#navigationPane"+this.postfix,!0)},p.prototype.toggleThumbnail=function(){this.viewer.toggleMainContent("Thumbnail"+this.postfix),this.styleChange()},p.prototype._onSetOperationMode=function(t){var e,i;1===t?(this._cropRender.isCrop=!0,this.emit("_onCanvasResize"),this.emit("_onSendCropLimitArea"),this._thumbnailRender.isCropMode=!0):(e=this._thumbnailRender.selectedIndexes.slice(0).pop(),(i=this._cropRender.cropBoxes)&&0<i.length&&this.emit("imageAreaUnselected",e),this._cropRender.isCrop=!1,this._thumbnailRender.isCropMode=!1),this._thumbnailRender.selectThumbByIndex()},p.prototype._onGetCropLimitArea=function(t){this._cropRender.limitArea=t},p.prototype._changeCanvasSize=function(t){this._scrollRender.getImageSize(t)},p.prototype.getRemoveIndexes=function(t){},p.prototype.sendThumbnailConfig=function(){this._thumbnailRender.thumbnailConfig=this.viewer.uiConfig.thumbnail},p.prototype._clearCropBoxes=function(){this._cropRender.clearEditBoxes();var t=this._thumbnailRender.cropItem;t&&t.clearEditBoxes()},p);function p(t,e){this.useMyEvent=!0,this._hasDocumentEvent=!1,this._isMobile=!1,this._clickItem=null,this._clickTimer=null,this._clickEventTimer=null,this._longpressTimer=null,this._imageLongpressTimer=null,this._rightClickFlag=!1,this._imageRightClickItem=null,this._tempThumbnailSize={width:1,height:1},this._topImageUid="",this.thumbnailDirection="row",this._topImageChange=!0,this._pubSub=e,this.goToThumbnail=!0,this.viewer=t,this.postfix=t.postfix,this.imageLayout={columnsCount:1,rowsCount:4,isrow:!0},this._refreshEvents=[["_onThumbnailRefresh",this._onRefreshThumb],["_onTagRefresh",this._onRefreshTag],["_onDirectoryRefresh",this._onRefreshDirctory],["_onPagerRefresh",this._onRefreshPage]],this._outerEvents=[["imageSelected",this._imageSelected],["imageClick",this.selectThumbImg],["imageRightClick",this.contextThumb],["fileSelected",this._fileSelected],["fileClick",this.enterFolder],["fileRightClick",this.contextTree],["tagSelected",this._tagSelected],["tagClick",this.showTagContent],["tagRightClick",this.contextTag],["onDrop",this.dropFileOnly],["pageChange",this.pageChange]],this._buttonEvents=[["onLoadImage",this.loadImage],["onPanelChange",this.togglePaneBox],["onSave",this._onSave],["onFullScreen",this.toggleFullScreen],["onFullPage",this.fitPage],["onAutoFit",this.fitWindow],["onFitHeight",this.fitHeight],["onFitWidth",this.fitWidth],["onFlip",this.flip],["onMirror",this.mirror],["onRotate",this.rotate],["onWipe",this.wipe],["onCrop",this.enterCropMode],["onRemove",this.toggleConfirmBox],["onFirstPage",this.homePage],["onPreviousPage",this.prevPage],["onNextPage",this.nextPage],["onLastPage",this.endPage],["onZoomIn",this._canvasZoomIn],["onZoomOut",this._canvasZoomOut],["onToggleThumbnail",this.toggleThumbnail]],this._privateEvents=[["_onGetCropLimitArea",this._onGetCropLimitArea],["_onCanvasZoom",this._changeCanvasSize],["_onSetOperationMode",this._onSetOperationMode],["_onThumbnailScroll",this.scrollTo],["_onCurTabChange",this.getTabItem],["getRemoveIndexes",this.getRemoveIndexes],["_onClearCropBoxes",this._clearCropBoxes],["_onTopImageChange",this._onTopImageChange]],this._thumbnailRender=new s.ThumbnailRender(t.uiConfig.thumbnail,t.postfix,this._pubSub,this.imageLayout),this._directoryRender=new a.DirectoryRender(t.postfix),this._tagRender=new r.TagRender(t.postfix,this._pubSub),this._cropRender=new l.CropRender(t.postfix,t.uiConfig.cropStyle),this._scrollRender=new h.ScrollRender(t.postfix,this._pubSub),this.uiEventInit(),this.bindEvents(),this.styleChange(),this.emit("_onAddLog",f.default.formatLog("uiEventControl init",!0))}e.UiEventControl=d},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var l=o(i(0)),h=o(i(4)),r=(s.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},s.prototype.getTargetDom=function(t){var e=t.target;return!!e&&("SPAN"===e.tagName&&(e=e.parentNode),e&&e.classList&&!e.classList.contains("createBox")?e:void 0)},s.prototype.updateTagList=function(t){l.default.isArray(t)||(t=[]);for(var e=[],i=0,o=(this.tagList=t).length;i<o;i++){var n=t[i].name,r=h.default.createVnode("LI",{dvs_name:n,key:t[i].tagId},[h.default.createVnode("SPAN",{},[],null,n),h.default.createVnode("DIV",{className:"editDelBox  DVS_nodisplay"},[h.default.createVnode("DIV",{className:"DVS_quickEdit ds-dvs-ui-pencil ds-dvs-ui-iconfont"}),h.default.createVnode("DIV",{className:"DVS_quickDel ds-dvs-ui-delete ds-dvs-ui-iconfont"})])]);e.push(r)}var s=l.default.id("tagLists"+this.postfix),a=h.default.createVnode("UL",{},e,s);this.content=h.default.patch(this.content,a),this.bindHoverEvent()},s.prototype.addNewTag=function(t){var e=h.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix},[h.default.createVnode("INPUT",{id:"tagInput"+this.postfix}),h.default.createVnode("DIV",{className:"judgeBox"},[h.default.createVnode("DIV",{className:"confirmTag ds-dvs-ui-iconfont ds-dvs-ui-confire"}),h.default.createVnode("DIV",{className:"cancelTag ds-dvs-ui-iconfont ds-dvs-ui-cancle"})])]);h.default.addOneVnode(this.content,0,e),l.default.id("tagInput"+this.postfix).focus(),t.target.style.pointerEvents="none",l.default.stopBubble(t)},s.prototype.renameTag=function(t){var e,i,o,n,r;t.target.classList.contains("renameTagBtn")&&(e=l.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=l.default.id("tagLists"+this.postfix).children[e].children[0].innerText,o=l.default.deepClone(this.content),n=h.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix,dvs_oldName:i},[h.default.createVnode("INPUT",{id:"tagInput"+this.postfix,value:i}),h.default.createVnode("DIV",{className:"judgeBox"},[h.default.createVnode("DIV",{className:"renameConfireTag ds-dvs-ui-iconfont ds-dvs-ui-confire"}),h.default.createVnode("DIV",{className:"cancelTag ds-dvs-ui-iconfont ds-dvs-ui-cancle"})])]),o.children.splice(e,1,n),this.content=h.default.patch(this.content,o),(r=l.default.id("tagInput"+this.postfix)).focus(),r.select())},s.prototype.quickRenameTag=function(t){var e=t.target;if(e&&e.classList.contains("DVS_quickEdit")){var i=e.parentNode.parentNode;if(!i)return!1;var o=i.dvs_name,n=l.default.getIndex(i),r=l.default.deepClone(this.content),s=h.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix,dvs_oldName:o},[h.default.createVnode("INPUT",{id:"tagInput"+this.postfix,value:o}),h.default.createVnode("DIV",{className:"judgeBox"},[h.default.createVnode("DIV",{className:"renameConfireTag ds-dvs-ui-iconfont ds-dvs-ui-confire"}),h.default.createVnode("DIV",{className:"cancelTag ds-dvs-ui-iconfont ds-dvs-ui-cancle"})])]);r.children.splice(n,1,s),this.content=h.default.patch(this.content,r);var a=l.default.id("tagInput"+this.postfix);a.focus(),a.select()}},s.prototype.quickDelTag=function(t){var e=t.target;if(e&&e.classList.contains("DVS_quickDel")){var i=e.parentNode.parentNode;if(!i)return!1;var o=i.dvs_name;this.emit("_onRemoveTag",o)}},s.prototype.selectTagByName=function(e){var i=this;Array.from(l.default.id("tagLists"+this.postfix).children).forEach(function(t){t.children[0].innerText===e?(t.classList.add("DVS_activeTag"),t.children[1].classList.remove("DVS_nodisplay"),l.default.id("defaultTag"+i.postfix).classList.remove("DVS_activeAllImage")):(t.classList.remove("DVS_activeTag"),t.children[1].classList.add("DVS_nodisplay"))})},s.prototype.confirmTag=function(t){var e=t.target.parentNode.parentNode.children[0].value;if(""!==e)return l.default.id("addTag"+this.postfix).style.pointerEvents="auto",{tagName:e};alert("The tag name can not be empty!")},s.prototype.bindHoverEvent=function(){var t=l.default.id("tagLists"+this.postfix);if(!t)return!1;var o=t.children;if(o&&o.length)for(var e=0;e<o.length;e++)!function(t){var e=o[t],i=e.children[1];e.onmouseenter=function(t){i.classList.remove("DVS_nodisplay")},e.onmouseleave=function(t){e.classList.contains("DVS_activeTag")||i.classList.add("DVS_nodisplay")}}(e)},s.prototype.addEventTag=function(){},s.prototype.tagInit=function(){var t=l.default.id("tagLists"+this.postfix);this.content=h.default.createVnode("UL",{className:"tagLists",id:"tagLists"+this.postfix},[],t)},s);function s(t,e){this._pubSub=e,this.postfix=t,this.tagInit()}e.TagRender=r},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=o(i(0)),n=(r.prototype.createVNode=function(t,e,i,o,n){void 0===e&&(e={}),void 0===i&&(i=[]),void 0===o&&(o=null),void 0===n&&(n="");var r={el:o,tagName:t,sel:"",data:e,children:i,text:n};return this._updateVNode(r)},r.prototype._updateVNode=function(t){var e=this;if(u.default.isObject(t.data)||(t.data={}),u.default.isArray(t.children)||(t.children=[]),t.el){for(var i=[],o=t.el.childNodes,n=0,r=o.length;n<r;n++)3===o[n].nodeType&&i.push(o[n].nodeValue);t.text=i.join("")}else{var s=document.createElement(t.tagName);(t.el=s).textContent=t.text}if(t.el){var a=(s=t.el).classList,l=s.id,h=s.tagName;if(l)h+="#"+l,t.sel=h;else if(a.length){for(var c=0;c<a.length;c++)h+="."+a[c];t.sel=h}}return t.children.forEach(function(t){return e._updateVNode(t)}),t},r);function r(t,e,i,o,n){return this.createVNode(t,e,i,o,n)}e.VNode=n},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var v=o(i(0)),s=o(i(4)),d=i(31),r=(a.prototype.on=function(t,e){this._pubSub.on(t,e.bind(this))},a.prototype.off=function(t,e){this._pubSub.off(t,e)},a.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},a.prototype.preventAllCrop=function(){this.cropItem&&this.cropItem.preventCrop()},a.prototype.getTargetDom=function(t){var e=t.target;if(!e||!e.classList)return!1;if(e.classList.contains("DVS_thumbnailCropArea"))return!1;var i=e.parentNode;if(i&&i.classList&&i.classList.contains("thumbLists"))e=t.target;else{if(!(i.parentNode&&i.parentNode.classList&&i.parentNode.classList.contains("thumbLists")))return!1;e=i}return!e.classList.contains("DVS_replaceBlock")&&(!e.parentNode||-1!==e.parentNode.id.indexOf(this.postfix))&&e},a.prototype.getImageItem=function(t){var e=t.target;if(!e||!e.classList)return!1;var i=e.parentNode;if(!i||!i.classList)return!1;if(i&&i.classList&&i.classList.contains("thumbLists"))e=t.target;else{if(!(i.parentNode&&i.parentNode.classList&&i.parentNode.classList.contains("thumbLists")))return!1;e=i}return!e.classList.contains("DVS_replaceBlock")&&e},a.prototype._getImageSize=function(t){var e,i,o;this.cropItem&&(e=this.selectedIndexes.slice(0).pop(),v.default.isNumber(e)&&0<=e&&(i=t.width,o=t.height,0!==i&&0!==o&&(this.cropItem.naturalImageSize=t)))},a.prototype.getPagerSize=function(){var t=v.default.id("thumbLists"+this.postfix);if(t&&t.children.length){var e=t.children,i=t.children[0].getBoundingClientRect(),o=i.width<i.height?i.width:i.height;this.pageSize=o/5;for(var n=0;n<e.length;n++){var r=e[n],s=r.children[0],a=r.children[1],l=o/5;l=(l=40<l?40:l)<20?20:l,s.style.fontSize=l/2+"px",s.style.width=l+"px",s.style.height=l+"px",a.style.fontSize=2*l/3+"px",a.style.width=2*l/3+"px",a.style.height=2*l/3+"px"}}},Object.defineProperty(a.prototype,"tabItem",{get:function(){return this._tabItem},set:function(t){this._tabItem=t,this._tabItemChange=!0},enumerable:!0,configurable:!0}),a.prototype.enterMutipleMode=function(){v.default.id("thumbControl"+this.postfix).classList.add("DVS_nodisplay"),v.default.id("mutiControl"+this.postfix).classList.remove("DVS_nodisplay"),this.viewMode="mutiple"},a.prototype.exitMutipleMode=function(){v.default.id("thumbControl"+this.postfix).classList.remove("DVS_nodisplay"),v.default.id("mutiControl"+this.postfix).classList.add("DVS_nodisplay"),this.viewMode="single"},a.prototype.selectAllImage=function(){for(var t=v.default.id("thumbLists"+this.postfix).children,e=!0,i=0,o=t.length;i<o;i++)if(!t[i].classList.contains("DVS_activeThumb")){e=!1;break}for(this.selectedIndexes=[],i=0,o=t.length;i<o;i++)e?t[i].classList.remove("DVS_activeThumb"):(t[i].classList.add("DVS_activeThumb"),this.selectedIndexes.push(i))},a.prototype.tagImage=function(t){var e=v.default.id("existTag"+this.postfix);e.insertBefore(t,e.children[0])},a.prototype.removeImageTag=function(t){var e=v.default.id("availTag"+this.postfix);e.insertBefore(t,e.children[0])},a.prototype.updataContent=function(t){void 0===t&&(t=[]);var e=v.default.id("thumbLists"+this.postfix);if(!e)return!1;!this._tabItemChange&&0!==this.thumbnailContent.length||(this._tabItemChange=!1);var r=[];t.forEach(function(t,e){var i=s.default.createVnode("LI",{DVS_tags:t.tags,DVS_uid:t.uid,DVS_defaultIndex:e,key:t.uid},[s.default.createVnode("DIV",{className:"thumbPage"},[],null,e+1),s.default.createVnode("DIV",{className:"ds-dvs-ui-iconfont ds-dvs-ui-unselected"},[])]),o=s.default.createVnode("IMG",{src:t.data},[]),n=o.el;n&&(n.removeAttribute("width"),n.removeAttribute("height")),i.children.push(o),r.push(i)});var i=s.default.createVnode("UL",{},r,e);this.content=s.default.patch(this.content,i),this.thumbnailContent=t},a.prototype.isTopImageChange=function(t){var e=this.imageLayout;e.rowsCount,e.columnsCount,0<t.length&&this.emit("topImageChange",0)},a.prototype.selectThumb=function(t){if(t){var e,i=v.default.getIndex(t);return"single"===this.viewMode?this.selectedIndexes=[i]:"mutiple"===this.viewMode&&(t.classList.contains("DVS_activeThumb")?-1!==(e=this.selectedIndexes.indexOf(i))&&this.selectedIndexes.splice(e,1):this.selectedIndexes.push(i)),this.selectedIndexes.slice(0)}},a.prototype.selectThumbByIndex=function(t){t=t||this.selectedIndexes;var e=v.default.id("thumbLists"+this.postfix);if(!e)return!1;var i=e.children;this.clearAbsolute();var o=i.length;if(i&&o){for(var n=!1,r=0;r<o;r++){var s,a,l,h,c=i[r],u=c.children[3];-1!==t.indexOf(r)?(c.classList.add("DVS_activeThumb"),c.children&&c.children[1]&&((h=c.children[1]).classList.remove("ds-dvs-ui-unselected"),h.classList.add("ds-dvs-ui-selected1")),c.style.borderColor=this.thumbnailConfig.selectedBorderColor,c.style.backgroundColor=this.thumbnailConfig.selectedBackgroundColor,a=(s=this.imageLayout).rowsCount,l=s.columnsCount,1===a&&1===l&&this.isCropMode?(u||(this.cropItem&&this.cropItem.cropBoxes.length&&this.emit("imageAreaUnselected",this.cropIndex),u=document.createElement("div"),this._bindCropEvent(u),c.appendChild(u),this.cropItem=new d.thumbnailCropRender(u,this.postfix,this._pubSub,this.cropRatio),this.cropIndex=r),n=!0):u&&c.removeChild(u)):(u&&c.removeChild(u),c.classList.remove("DVS_activeThumb"),c.children&&c.children[1]&&((h=c.children[1]).classList.add("ds-dvs-ui-unselected"),h.classList.remove("ds-dvs-ui-selected1")),c.style.borderColor=this.thumbnailConfig.imageBorderColor,c.style.backgroundColor=this.thumbnailConfig.imageBackgroundColor)}n||(this.cropItem=null,this.cropIndex=-1)}},a.prototype._bindCropEvent=function(o){var n=this;o.className="DVS_thumbnailCropArea",o.onclick=function(t){var e=o.parentNode,i=v.default.getIndex(e);clearTimeout(n._clickEventTimer),n._clickEventTimer?(n.emit("imageDoubleClick",i,t),n._clickEventTimer=null,v.default.preventDefault(t)):(n._clickEventTimer=setTimeout(function(){n._clickEventTimer=null},500),n.emit("imageClick",i,t)),v.default.stopBubble(t)},o.onmousedown=function(t){2===t.button&&(n._rightClickFlag=!0),v.default.stopBubble(t)},o.onmouseup=function(t){if(2!==t.button)return!1;var e,i;n._rightClickFlag&&(e=o.parentNode,i=v.default.getIndex(e),n.emit("imageRightClick",i,t)),n._rightClickFlag=!1},o.ontouchstart=function(i){n._longpressTimer=setTimeout(function(){var t=o.parentNode,e=v.default.getIndex(t);n.emit("imageRightClick",e,i)},500),v.default.stopBubble(i)},o.ontouchmove=function(t){clearTimeout(n._longpressTimer);var e=o.parentNode,i=v.default.getIndex(e);n.emit("imageMove",i,t),v.default.preventDefault(t)},o.ontouchend=function(){clearTimeout(n._longpressTimer)}},a.prototype.dragThumbnail=function(t){return!(t.ctrlKey||t.shiftKey||t.metaKey)&&0===t.button&&this._dragStartFunction(t)},a.prototype.dragStartMobile=function(t){var e=this;return t=t.changedTouches[0],this.timer=setTimeout(function(){return document.addEventListener("touchmove",v.default.preventDefault,{passive:!1}),e._dragStartFunction(t)},300),!0},a.prototype._dragStartFunction=function(t){v.default.id("contextMenu"+this.postfix).classList.add("DVS_nodisplay");var e=this.imageLayout,i=e.rowsCount,o=e.columnsCount;if(1===i&&1===o)return!1;var n=this.getTargetDom(t);if(!n)return!1;n.classList.contains("DVS_activeThumb")||(this.selectThumb(n),this.selectThumbByIndex(),this.needClick=!1);for(var r=v.default.id("thumbLists"+this.postfix),s=n.getBoundingClientRect(),a=t.clientX-s.left,l=t.clientY-s.top,h=v.default.arrayFrom(r.children),c=0;c<h.length;c++){var u,d=h[c];d.classList.contains("DVS_activeThumb")&&((u=document.createElement("li")).className="DVS_replaceBlock",u.style.backgroundColor=this.thumbnailConfig.placeholderBackgroundColor,u.style.margin=d.style.margin,u.style.flexBasis=d.style.flexBasis,u.style.msFlexPreferredSize=d.style.msFlexPreferredSize,u.style.width=d.style.width,u.style.height=d.style.height,r.insertBefore(u,d))}return r.classList.add("hideReplaceBlock"),this.thumbMoveOption={napX:a,napY:l,target:n},this._clickPosition={clickX:t.pageX,clickY:t.pageY},this.isdrag=!0},a.prototype.dragMove=function(t){return this._dragMoveFunction(t)},a.prototype.dragMoveMobile=function(t){return t=t.changedTouches[0],clearTimeout(this.timer),this._dragMoveFunction(t)},a.prototype._dragMoveFunction=function(t){var s=this;if(this.isdrag){var e=this._clickPosition,i=e.clickX,o=e.clickY,n=t.pageX,r=t.pageY;if(Math.abs(n-i)<15&&Math.abs(r-o)<15&&!this._isDragMove)return;this._isDragMove=!0;var a=v.default.id("thumbLists"+this.postfix),l=a.scrollTop,h=a.scrollLeft,c=this.thumbMoveOption,u=c.napX,d=c.napY,p=c.target.getBoundingClientRect();v.default.queryAll("#thumbLists"+this.postfix+">li:not(.DVS_activeThumb):not(.DVS_replaceBlock)").forEach(function(e){var t=e.getBoundingClientRect(),i=t.left-p.left,o=t.top-p.top;if(Math.abs(i)<=p.width/2&&Math.abs(o)<=p.height/2){var n=v.default.getIndex(e),r=v.default.getIndex(v.default.query("#thumbLists"+s.postfix+">li.DVS_replaceBlock"));return v.default.queryAll("#thumbLists"+s.postfix+">li.DVS_replaceBlock").forEach(function(t){n<r?a.insertBefore(t,e):v.default.insertAfter(t,e)}),a.scrollTop=l,a.scrollLeft=h,!0}});var f=a.getBoundingClientRect(),g=t.clientY-f.top-d,m=t.clientX-f.left-u+h,_=g+l;a.classList.remove("hideReplaceBlock"),v.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb").forEach(function(t,e){t&&(t.classList.add("DVS_absolute"),t.style.width=s.imageInfo.width,t.style.height=s.imageInfo.height,t.style.left=m+5*e+"px",t.style.top=_+5*e+"px",t.style.margin=0,t.style.zIndex=2)}),v.default.preventDefault(t)}},a.prototype.dragUp=function(){return this._dragUpFunction()},a.prototype.dragUpMobile=function(){return document.removeEventListener("touchmove",v.default.preventDefault),clearTimeout(this.timer),this._dragUpFunction()},a.prototype._dragUpFunction=function(){if(!this.thumbMoveOption||!this.thumbMoveOption.target)return!1;var t=this._isDragMove;this.clearAbsolute(),this.thumbMoveOption=null;for(var e=v.default.id("thumbLists"+this.postfix),i=this.selectedIndexes.slice(0),o=e.children.length,n=0;n<o;n++){var r,s,a=e.children[n];a.classList.contains("DVS_replaceBlock")||(a.classList.contains("DVS_activeThumb")&&(r=a.DVS_defaultIndex,-1!==(s=i.indexOf(r))&&(i[s]=n)),a.children[0].innerText=n+1)}return this.selectedIndexes=i,this.isdrag=!1,t},a.prototype.clearAbsolute=function(){var i=this,o=v.default.id("thumbLists"+this.postfix);if(!o)return!1;var n,r=v.default.queryAll("#thumbLists"+this.postfix+">li.DVS_replaceBlock");this.isdrag&&this._isDragMove&&0<r.length&&(n=r[0].style.margin,v.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb").forEach(function(t,e){t&&(o.insertBefore(t,r[e]),t.style.width=i.imageInfo.oldWidth,t.style.height=i.imageInfo.oldHeight,t.style.margin=n,t.style.zIndex=0)})),r.forEach(function(t){o.removeChild(t)}),this._isDragMove=!1;var t=v.default.queryAll("#thumbLists"+this.postfix+">li.DVS_absolute");0<t.length&&t.forEach(function(t){t&&(t.classList.remove("DVS_absolute"),t.style.left=null,t.style.top=null)})},a.prototype.getDefaultIndexes=function(){var i=[];return v.default.queryAll("#thumbLists"+this.postfix+">li").forEach(function(t,e){i.push(t.DVS_defaultIndex),t.DVS_defaultIndex=e}),i},a.prototype.stretchMouseDown=function(t){if(v.default.isNumber(t.button)&&0!==t.button)return!1;v.default.id("stretchBar"+this.postfix).classList.add("DVS_streching"),this.ismoving=!0,v.default.preventDefault(t)},a.prototype.stretchMouseMove=function(t){var e;this.ismoving&&(e=v.default.id("besides"+this.postfix).getBoundingClientRect().left,this.width=0<t.clientX-e?t.clientX-e:0,v.default.id("stretchBar"+this.postfix).style.left=this.width-5+"px",v.default.preventDefault(t))},a.prototype.stretchMouseUp=function(){var t,e;this.ismoving&&(t=v.default.id("stretchBar"+this.postfix),this.ismoving=!1,e=100<(e=this.width/v.default.id("body"+this.postfix).clientWidth*100)?100:e,this.setSideBarPercent(e),t.style.left=null,t.classList.remove("DVS_streching"))},a.prototype.thumbnailStretchRightStart=function(t){if(v.default.isNumber(t.button)&&0!==t.button)return!1;this.fullThumbnail||(v.default.id("thumbnailStretchBarRight"+this.postfix).classList.add("DVS_streching"),this._isThumbnailMove=!0,v.default.preventDefault(t))},a.prototype.thumbnailStretchRightMove=function(t){var e,i;this._isThumbnailMove&&(e=v.default.id("Thumbnail"+this.postfix).getBoundingClientRect().left,i=0<t.clientX-e?t.clientX-e:0,v.default.id("thumbnailStretchBarRight"+this.postfix).style.left=i+"px",v.default.preventDefault(t))},a.prototype.thumbnailStretchRightEnd=function(){var t,e;this._isThumbnailMove&&(t=v.default.id("thumbnailStretchBarRight"+this.postfix),this._isThumbnailMove=!1,e=100<(e=parseInt(t.style.left)/v.default.id("showImageArea"+this.postfix).clientWidth*100)?100:e,this.setThumbnailPercent(e),t.style.left=null,t.classList.remove("DVS_streching"))},a.prototype.setSideBarPercent=function(t){var e=v.default.id("besides"+this.postfix);e.style.flex="0 0 "+t+"%",e.style.msFlex="0 0 "+t+"%",e.style.width=t+"%"},a.prototype.setThumbnailPercent=function(t){var e=v.default.id("Thumbnail"+this.postfix);e.style.flex="0 0 "+t+"%",e.style.msFlex="0 0 "+t+"%",this.cropItem&&this.cropItem.clearEditBoxes()},a.prototype.setHoverColor=function(t){var e=this.getTargetDom(t);e&&(e.classList.contains("DVS_activeThumb")||(e.style.backgroundColor=this.thumbnailConfig.hoverBackgroundColor,e.style.borderColor=this.thumbnailConfig.hoverBorderColor))},a.prototype.setImageColor=function(t){var e=this.getTargetDom(t);e&&(e.classList.contains("DVS_activeThumb")?(e.style.backgroundColor=this.thumbnailConfig.selectedBackgroundColor,e.style.borderColor=this.thumbnailConfig.selectedBorderColor):(e.style.backgroundColor=this.thumbnailConfig.imageBackgroundColor,e.style.borderColor=this.thumbnailConfig.imageBorderColor))},a.prototype.thumbnailInit=function(){var t=v.default.id("thumbLists"+this.postfix);this.content=s.default.createVnode("UL",{style:"backgroundColor='"+this.thumbnailConfig.backgroundColor+"'"},[],t)},a);function a(t,e,i,o){this._isThumbnailMove=!1,this.cropIndex=-1,this._isDragMove=!1,this.isCropMode=!1,this.fullThumbnail=!1,this.thumbMoveOption={napX:0,napY:0,target:null},this._tabItemChange=!1,this._longpressTimer=null,this.selectedIndexes=[],this.thumbnailContent=[],this.postfix=e,this._pubSub=i,this.imageLayout=o,this.cropItem=null,this.cropRatio={ratio:0},this.thumbnailConfig=t,this.thumbnailInit(),this.ismoving=!1,this.isdrag=!1,this.needClick=!0,this.isClick=!0,this.viewMode="single",this.selectedIndexes=[],this.updataContent(),this.on("_onGetMiniImgSize",this._getImageSize)}e.ThumbnailRender=r},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var R=o(i(0)),r=(s.prototype.initCropEditBox=function(){var e=this,t=document.createElement("div");t.className="DVS_cropEditBox",t.innerHTML="\n            <div class='tlr rowBorder' style='top:-2px;left:-2px;'></div>\n            <div class='tlc columnBorder' style='top:-2px;left:-2px;'></div>\n            <div class='tlDragArea corner' style='top:-5%;left:-5%;'></div>\n\n            <div class='t rowBorder' style='top:-2px;left:35%;'></div>\n            <div class='tDragArea' style='top:-5%;left:35%;'></div>\n\n            <div class='trr rowBorder' style='top:-2px;right:-2px;'></div>\n            <div class='trc columnBorder' style='top:-2px;right:-2px;'></div>\n            <div class='trDragArea corner' style='top:-5%;right:-5%;'></div>\n\n            <div class='l columnBorder' style='left:-2px;top:35%;'></div>\n            <div class='lDragArea' style='left:-5%;top:35%;'></div>\n\n            <div class='r columnBorder' style='right:-2px;top:35%;'></div>\n            <div class='rDragArea' style='right:-5%;top:35%;'></div>\n\n            <div class='blr rowBorder' style='left:-2px;bottom:-2px;'></div>\n            <div class='blc columnBorder' style='left:-2px;bottom:-2px;'></div>\n            <div class='blDragArea corner' style='bottom:-5%;left:-5%;'></div>\n\n            <div class='b rowBorder' style='bottom:-2px;left:35%;'></div>\n            <div class='bDragArea' style='bottom:-5%;left:35%;'></div>\n\n            <div class='brr rowBorder' style='bottom:-2px;right:-2px;'></div>\n            <div class='brc columnBorder' style='bottom:-2px;right:-2px;'></div>\n            <div class='brDragArea corner' style='bottom:-5%;right:-5%;'></div>\n\n        ",this.cropEl.appendChild(t);for(var i=t.children,o=0;o<i.length;o++)"ontouchstart"in document.documentElement?R.default.addEvent(i[o],"touchstart",function(t){e._editBoxStartMobile(t)}):R.default.addEvent(i[o],"mousedown",function(t){e._editBoxStart(t)});return"ontouchstart"in document.documentElement?R.default.addEvent(t,"touchstart",function(t){e._dragBoxStartMobile(t)}):R.default.addEvent(t,"mousedown",function(t){e._dragBoxStart(t)}),t},s.prototype.setCropArea=function(t,e,i,o,n){void 0===n&&(n=!1);try{var r=this.cropEl.parentNode;if(!r||!r.children[2])return!1;var s=r.children[2],a=s.getBoundingClientRect();if(this.emit("_onSendMiniImgSize",s),!this.naturalImageSize)return!1;var l=this.naturalImageSize.width,h=a.width/l;t*=h,e*=h,i*=h,o*=h;var c=this.cropEl.getBoundingClientRect(),u={x:a.left-c.left,y:a.top-c.top,width:a.width,height:a.height},d=c.width,p=c.height;if(t<0||e<0||d<t+i||p<e+o)return!1;if(u.width<t+i||u.height<e+o)return!1;t=d<u.width?t:u.x+t,e=p<u.height?e:u.y+e,n||this.clearEditBoxes();var f={left:t,top:e,width:i,height:o},g=this.initCropEditBox();return g.classList.add("DVS_selectedBox"),g.style.left=t+"px",g.style.top=e+"px",g.style.width=i+"px",g.style.height=o+"px",g.style.cursor="move",this.cropBoxes.push(f),this.limitArea=u,!0}catch(t){return!1}},s.prototype.setCropRatio=function(t){return!!R.default.isNumber(t)&&(this.thumbnailCropRatio.ratio=t,!0)},s.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},s.prototype.clearEditBoxes=function(){for(var t=this.cropEl.children,e=0;e<t.length;e++){var i=t[e];i.parentNode.removeChild(i),e--}this.cropBoxes=[]},s.prototype.preventCrop=function(){this._isCroping=!1},s.prototype._editBoxStart=function(t){return this._editBoxStartFun(t)},s.prototype._editBoxStartMobile=function(t){if(1!==t.touches.length)return!1;var e=t.changedTouches[0];return this._editBoxStartFun(e)},s.prototype._editBoxStartFun=function(t){var e=t.target;if(e){var i=e.parentNode.getBoundingClientRect();return this._currentEditOption={currentBorder:e,editRect:i},R.default.stopBubble(t),!0}return!1},s.prototype._editBoxMove=function(t){return this._editBoxMoveFun(t)},s.prototype._editBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;var e=t.changedTouches[0];return this._editBoxMoveFun(e)},s.prototype._editBoxMoveFun=function(t){var e=this._currentEditOption;if(e){this.isCropMove=!0;var i=e.currentBorder,o=e.editRect,n=o.width,r=o.height,s=o.left,a=o.right,l=o.top,h=o.bottom,c=i.parentNode,u=(c.getBoundingClientRect(),this.cropEl),d=u.getBoundingClientRect(),p=t.clientX,f=t.clientY,g=n,m=r,_=s,v=l;if(i.classList.contains("trDragArea")?(_=p<s?p:s,v=f<h?f:h,g=Math.abs(p-s),m=Math.abs(f-h),u.style.cursor="ne-resize"):i.classList.contains("tlDragArea")?(_=p<a?p:a,v=f<h?f:h,g=Math.abs(p-a),m=Math.abs(f-h),u.style.cursor="se-resize"):i.classList.contains("blDragArea")?(_=p<a?p:a,v=f<l?f:l,g=Math.abs(p-a),m=Math.abs(f-l),u.style.cursor="ne-resize"):i.classList.contains("brDragArea")?(_=p<s?p:s,v=f<l?f:l,g=Math.abs(p-s),m=Math.abs(f-l),u.style.cursor="se-resize"):i.classList.contains("tDragArea")?(v=f<h?f:h,m=Math.abs(f-h),u.style.cursor="s-resize"):i.classList.contains("bDragArea")?(v=f<l?f:l,m=Math.abs(f-l),u.style.cursor="s-resize"):i.classList.contains("lDragArea")?(_=p<a?p:a,g=Math.abs(p-a),u.style.cursor="w-resize"):i.classList.contains("rDragArea")&&(_=p<s?p:s,g=Math.abs(p-s),u.style.cursor="w-resize"),p<d.left||p>d.right||f<d.top||f>d.bottom)return!1;var y=this.limitArea,b=y.x+y.width-2,C=y.y+y.height,T=_+g,w=v+m,x=_-d.left,S=v-d.top;x<y.x&&(x=y.x,g=p<s?T-y.x-d.left:p-y.x-d.left),b<x+g&&(g=b-x),S<y.y&&(S=y.y,m=f<l?w-y.y-d.top:f-y.y-d.top),C<S+m&&(m=C-S),b<x||C<S||x<y.x||S<y.y?c.classList.add("DVS_nodisplay"):c.classList.remove("DVS_nodisplay"),c.style.width=g-2+"px",c.style.height=m-2+"px",c.style.left=x+"px",c.style.top=S+"px";var E={left:parseInt(c.style.left)-y.x,top:parseInt(c.style.top)-y.y,width:g,height:m},I=R.default.getIndex(c);return this.cropBoxes.splice(I,1,E),this.currentCropBox=E,R.default.preventDefault(t),!0}return!1},s.prototype.editBoxEnd=function(){return this._editBoxEndFun()},s.prototype.editBoxEndMobile=function(){return this._editBoxEndFun()},s.prototype._editBoxEndFun=function(){return!!this._currentEditOption&&(this._currentEditOption=null,this.cropEl.style.cursor="crosshair",!0)},s.prototype._dragBoxStart=function(t){return this._dragBoxStartFun(t)},s.prototype._dragBoxStartMobile=function(t){if(1!==t.touches.length)return!1;R.default.stopBubble(t);var e=t.changedTouches[0];return this._dragBoxStartFun(e)},s.prototype._dragBoxStartFun=function(t){var e=t.target;if(e&&e.classList.contains("DVS_cropEditBox")){var i=e.getBoundingClientRect();this._isDraging=!0;var o=t.clientX-i.left,n=t.clientY-i.top;this._dragMoveOption={napLeft:o,napTop:n,target:e};var r=R.default.getIndex(e);return this.cropBoxes.splice(r,1),R.default.stopBubble(t),!0}return!1},s.prototype._dragBoxMove=function(t){return this._dragBoxMoveFun(t)},s.prototype._dragBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;var e=t.changedTouches[0];return this._dragBoxMoveFun(e)},s.prototype._dragBoxMoveFun=function(t){if(this._isDraging){this.isCropMove=!0;var e,i,o,n=this._dragMoveOption,r=n.napLeft,s=n.napTop,a=n.target,l=a.getBoundingClientRect(),h=this.cropEl.getBoundingClientRect(),c=(R.default.id("cropMask"+this.postfix).getBoundingClientRect(),t.clientX-r-h.left),u=t.clientY-s-h.top;return c=c<0?0:c+l.width>h.width?h.width-l.width:c,u=u<0?0:u+l.height>h.height?h.height-l.height:u,a&&(i=(e=this.limitArea).x+e.width-2,o=e.y+e.height,c=(c=c<e.x?e.x:c)+l.width>i?i-l.width:c,u=(u=u<e.y?e.y:u)+l.height>o?o-l.height:u,a.style.left=c+"px",a.style.top=u+"px"),R.default.preventDefault(t),!0}return!1},s.prototype.dragBoxEnd=function(){return this._dragBoxEndFun()},s.prototype.dragBoxEndMobile=function(){return this._dragBoxEndFun()},s.prototype._dragBoxEndFun=function(){var t=this._dragMoveOption.target;if(this._isDraging&&t){this._isDraging=!1;var e=t.getBoundingClientRect(),i=this.limitArea,o=R.default.getIndex(t),n={left:parseInt(t.style.left)-i.x,top:parseInt(t.style.top)-i.y,width:e.width,height:e.height};return this.cropBoxes.splice(o,0,n),this.currentCropBox=n,!0}return!1},s.prototype.cropStart=function(t){return!(t.button&&0!==t.button||(this._cropStartFun(t),0))},s.prototype.cropStartMobile=function(t){if(1!==t.touches.length)return!1;var e=t.changedTouches[0];return!!e&&(this._cropStartFun(e),!0)},s.prototype._cropStartFun=function(t){var e=this.cropEl.getBoundingClientRect(),i=this.cropEl.parentNode;if(!i||!i.children[2])return!1;this.naturalImageSize||this.emit("_onSendMiniImgSize");var o=i.children[2].getBoundingClientRect(),n=i.getBoundingClientRect();this.limitArea={x:o.left-n.left,y:o.top-n.top,width:o.width,height:o.height},t.ctrlKey||this.clearEditBoxes();var r=this.initCropEditBox(),s=t.clientX-e.left,a=t.clientY-e.top;return r.style.left=s+"px",r.style.top=a+"px",r.classList.add("DVS_nodisplay"),this._cropMoveOption={left:s,top:a,target:r},this._isCroping=!0,!(this.currentCropBox=null)},s.prototype.cropMove=function(t){return R.default.preventDefault(t),this._cropMoveFun(t)},s.prototype._cropMoveMobile=function(t){if(1!==t.touches.length)return!1;var e=t.changedTouches[0];return this._cropMoveFun(e),R.default.preventDefault(t),!0},s.prototype._cropMoveFun=function(t){if(this._isCroping){this.isCropMove=!0;var e=this._cropMoveOption,i=e.left,o=e.top,n=e.target,r=this.cropEl.getBoundingClientRect();n.classList.remove("DVS_nodisplay");var s,a,l=(l=t.clientX-r.left)<0?0:l,h=(h=t.clientY-r.top)<0?0:h,c=Math.abs(l-i),u=Math.abs(h-o),d=l<i?l:i,p=h<o?h:o,c=l>r.width?r.width-d:c,u=h>r.height?r.height-p:u,f=this.limitArea,g=f.x+f.width-2,m=f.y+f.height-1;return d<f.x&&(d=f.x,c=l<i?i-f.x:l-f.x),g<d+c&&(c=g-d),p<f.y&&(p=f.y,u=h<o?o-f.y:h-f.y),m<p+u&&(u=m-p),this.thumbnailCropRatio.ratio&&(a=c/(s=this.thumbnailCropRatio.ratio),i<l?m<=(p=o<f.y?f.y:o)+a?c=c*(u=m-p)/a:u=a:(u=a,m<o?f.height<=a&&(c=(u=f.height)*s,d=i<g?i-c:g-c):o-f.y<=a&&(c=(u=o-f.y)*s,d=i<g?i-c:g-c),p=o<m?o-u:m-u)),c<=3||u<=3?n.classList.add("DVS_nodisplay"):n.classList.remove("DVS_nodisplay"),n.style.width=c+"px",n.style.height=u+"px",n.style.left=d-1+"px",n.style.top=p+"px",!0}return!1},s.prototype.cropEnd=function(){return this._cropEndFun()},s.prototype.cropEndMobile=function(){return this._cropEndFun()},s.prototype._cropEndFun=function(){var t,e,i,o,n=this._cropMoveOption.target;return!(!this._isCroping||!n||(this._isCroping=!1,this.isCropMove&&(t=n.getBoundingClientRect(),e=this.limitArea,i=this.cropEl.getBoundingClientRect(),o={left:t.left-e.x-i.left,top:t.top-e.y-i.top,width:t.width,height:t.height},n.classList.add("DVS_selectedBox"),n.style.cursor="move",this.cropBoxes.push(o),this.currentCropBox=o),0))},s.prototype._imageAreaUnselected=function(t){var e=this.cropEl.parentNode,i=R.default.getIndex(e),o=this.cropBoxes,n=o&&0<o.length;void 0!==t.button?(this.cropStart(t),t.ctrlKey||n&&this.emit("imageAreaUnselected",i)):(this.cropStartMobile(t),n&&this.emit("imageAreaUnselected",i))},s.prototype._imageAreaSelected=function(t){var e=this.isCropMove;if(void 0!==t.button?(this.cropEnd(),this.editBoxEnd(),this.dragBoxEnd()):(this.cropEndMobile(),this.editBoxEndMobile(),this.dragBoxEndMobile()),e){this.isCropMove=!1;var i=this.currentCropBox;if(i){var o=this.cropEl.parentNode;if(!o||!o.children||!o.children[2])return!1;var n=this.limitArea.width,r=this.naturalImageSize;if(!r)return!1;var s=r.width/n,a=R.default.getIndex(o),l=-1;this.cropBoxes.forEach(function(t,e){t===i&&(l=e)}),-1!==l&&this.emit("imageAreaSelected",{index:a,x:0<i.left?i.left*s:0,y:0<i.top?i.top*s:0,width:i.width*s,height:i.height*s,areaIndex:l})}}},s.prototype._addEvent=function(){var e=this;"ontouchstart"in document.documentElement?(R.default.addEvent(this.cropEl,"touchmove",function(t){e._cropMoveMobile(t),e._editBoxMoveMobile(t),e._dragBoxMoveMobile(t)}),R.default.addEvent(this.cropEl,"touchstart",function(t){e._imageAreaUnselected(t)}),R.default.addEvent(this.cropEl,"touchend",function(t){e._imageAreaSelected(t)})):(R.default.addEvent(this.cropEl,"mousemove",function(t){e.cropMove(t),e._editBoxMove(t),e._dragBoxMove(t)}),R.default.addEvent(this.cropEl,"mousedown",function(t){e._imageAreaUnselected(t)}),R.default.addEvent(this.cropEl,"mouseup",function(t){e._imageAreaSelected(t)})),this.naturalImageSize||this.emit("_onSendMiniImgSize")},s);function s(t,e,i,o){this.cropBoxes=[],this.thumbnailCropRatio={ratio:0},this._dragMoveOption={},this._cropMoveOption={},this.isCropMove=!1,this._isDraging=!1,this._isCroping=!1,this.cropEl=t,this.postfix=e,this._pubSub=i,this.thumbnailCropRatio=o,this._addEvent()}e.thumbnailCropRender=r},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(i(0)),l=o(i(4)),n=(r.prototype.updataDirectory=function(t){var e=a.default.id("treeLists"+this.postfix);if(!e)return!1;var i=l.default.createVnode("UL",{},[],e);"root"!==t.name&&i.children.push(l.default.createVnode("LI",{className:"backTree",dvs_type:"back"},[l.default.createVnode("DIV",{className:"ds-dvs-ui-iconfont ds-dvs-ui-folderopen"}),l.default.createVnode("SPAN",{},[],null,".....")]));for(var o=t.children,n=0,r=o.length;n<r;n++){var s=o[n];i.children.push(l.default.createVnode("LI",{title:s.name,dvs_type:s.type,dvs_fileName:s.name},[l.default.createVnode("DIV",{className:"ds-dvs-ui-iconfont "+("folder"===s.type?"ds-dvs-ui-tree":"ds-dvs-ui-file")}),l.default.createVnode("SPAN",{},[],null,s.name)]))}this.treeList=l.default.patch(this.treeList,i)},r.prototype.getChildIndex=function(t){var e=a.default.getIndex(t),i=t.parentNode.children[0];return"back"===i.type&&e--,i.classList.contains("createBox")&&e--,e},r.prototype.getTargetDom=function(t){var e,i=t.target;return!!i&&("LI"===i.tagName&&i.dvs_fileName?e=i:i.parentNode.dvs_type&&(e=i.parentNode),e)},r.prototype.addNewFolder=function(t){var e=a.default.id("treeLists"+this.postfix),i=l.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix},[l.default.createVnode("DIV",{className:"ds-dvs-ui-iconfont ds-dvs-ui-tree"}),l.default.createVnode("INPUT",{id:"folderInput"+this.postfix}),l.default.createVnode("DIV",{className:"judgeBox"},[l.default.createVnode("DIV",{className:"confirmFolder ds-dvs-ui-iconfont ds-dvs-ui-confire"}),l.default.createVnode("DIV",{className:"cancelFolder ds-dvs-ui-iconfont ds-dvs-ui-cancle"})])]);e.children.length&&"back"===e.children[0].dvs_type?l.default.addOneVnode(this.treeList,1,i):l.default.addOneVnode(this.treeList,0,i),a.default.id("folderInput"+this.postfix).focus(),a.default.id("addFolder"+this.postfix).style.pointerEvents="none"},r.prototype.renameFile=function(t){var e,i,o,n,r,s;t.target.classList.contains("renameFileBtn")&&(e=a.default.id("contextMenu"+this.postfix).DVS_activeIndex,o=(i=a.default.id("treeLists"+this.postfix).children[e]).children[1].innerText,n=a.default.deepClone(this.treeList),r=l.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix,dvs_fileName:o,dvs_type:i.dvs_type},[l.default.createVnode("DIV",{className:"ds-dvs-ui-iconfont ds-dvs-ui-tree"}),l.default.createVnode("INPUT",{id:"folderInput"+this.postfix,value:o}),l.default.createVnode("DIV",{className:"judgeBox"},[l.default.createVnode("DIV",{className:"renameConfirmFile ds-dvs-ui-iconfont ds-dvs-ui-confire"}),l.default.createVnode("DIV",{className:"cancelFolder ds-dvs-ui-iconfont ds-dvs-ui-cancle"})])]),n.children.splice(e,1,r),this.treeList=l.default.patch(this.treeList,n),(s=a.default.id("folderInput"+this.postfix)).focus(),s.select())},r.prototype.selectFileByName=function(e){var i=this;Array.from(a.default.id("treeLists"+this.postfix).children).forEach(function(t){t.children[1].innerText===e?(t.classList.add("DVS_activeFile"),a.default.id("defaultTag"+i.postfix).classList.remove("DVS_activeAllImage")):t.classList.remove("DVS_activeFile")})},r.prototype.confirmFolder=function(t){if(t.target.classList.contains("confirmFolder")){var e=t.target.parentNode.parentNode.children[1].value;if(""!==e)return a.default.id("addFolder"+this.postfix).style.pointerEvents="auto",e;alert("The folder name can not be empty!")}},r.prototype.addTreeEvent=function(){},r.prototype.treeInit=function(){var t=a.default.id("treeLists"+this.postfix);this.treeList=l.default.createVnode("UL",{},[],t)},r);function r(t){this.postfix=t,this.treeInit()}e.DirectoryRender=n},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var L=o(i(0)),n=(Object.defineProperty(r.prototype,"isCrop",{get:function(){return this._isCrop},set:function(t){var e=L.default.id("cropBar"+this.postfix),i=L.default.id("cropMask"+this.postfix),o=L.default.id("cropEditArea"+this.postfix);e&&(t?(this.cropOption.cropBar&&e.classList.remove("DVS_nodisplay"),this.cropOption.cropMask&&i.classList.remove("DVS_nodisplay"),o.classList.remove("DVS_nodisplay"),this.drawCropMask()):(e.classList.add("DVS_nodisplay"),i.classList.add("DVS_nodisplay"),o.classList.add("DVS_nodisplay"),this.clearEditBoxes(),this._clearCurrentCropRatio()),this._isCrop=t)},enumerable:!0,configurable:!0}),r.prototype.initCropMask=function(){var t=document.createElement("canvas");t.className="DVS_cropMask DVS_nodisplay",t.id="cropMask"+this.postfix,this.cropMask=t},r.prototype.initCropEditBox=function(){var e=this,t=document.createElement("div");t.className="DVS_cropEditBox",t.innerHTML="\n            <div class='tlr rowBorder' style='top:0px;left:0px;'></div>\n            <div class='tlc columnBorder' style='top:0px;left:0px;'></div>\n            <div class='tlDragArea corner' style='top:-5%;left:-5%;'></div>\n\n            <div class='t rowBorder' style='top:0px;left:35%;'></div>\n            <div class='tDragArea' style='top:-5%;left:35%;'></div>\n\n            <div class='trr rowBorder' style='top:0px;right:0px;'></div>\n            <div class='trc columnBorder' style='top:0px;right:0px;'></div>\n            <div class='trDragArea corner' style='top:-5%;right:-5%;'></div>\n\n            <div class='l columnBorder' style='left:0px;top:35%;'></div>\n            <div class='lDragArea' style='left:-5%;top:35%;'></div>\n\n            <div class='r columnBorder' style='right:0px;top:35%;'></div>\n            <div class='rDragArea' style='right:-5%;top:35%;'></div>\n\n            <div class='blr rowBorder' style='left:0px;bottom:0px;'></div>\n            <div class='blc columnBorder' style='left:0px;bottom:0px;'></div>\n            <div class='blDragArea corner' style='bottom:-5%;left:-5%;'></div>\n\n            <div class='b rowBorder' style='bottom:0px;left:35%;'></div>\n            <div class='bDragArea' style='bottom:-5%;left:35%;'></div>\n\n            <div class='brr rowBorder' style='bottom:0px;right:0px;'></div>\n            <div class='brc columnBorder' style='bottom:0px;right:0px;'></div>\n            <div class='brDragArea corner' style='bottom:-5%;right:-5%;'></div>\n\n        ",L.default.id("cropEditArea"+this.postfix).appendChild(t);for(var i=t.children,o=0;o<i.length;o++)"ontouchstart"in document.documentElement?L.default.addEvent(i[o],"touchstart",function(t){e._editBoxStartMobile(t)}):L.default.addEvent(i[o],"mousedown",function(t){e._editBoxStart(t)});return"ontouchstart"in document.documentElement?L.default.addEvent(t,"touchstart",function(t){e._dragBoxStartMobile(t)}):L.default.addEvent(t,"mousedown",function(t){e._dragBoxStart(t)}),t},r.prototype.setCropArea=function(t,e,i,o,n){void 0===n&&(n=!1);try{var r=L.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),s=r.width,a=r.height;if(t<0||e<0||s<t+i||a<e+o)return!1;var l=this.limitArea;if(t+i>l.width||e+o>l.height)return!1;t=l.width>s?t:l.x+t,e=l.height>a?e:l.y+e,n||this.clearEditBoxes();var h={left:t,top:e,width:i,height:o},c=this.initCropEditBox();return c.classList.add("DVS_selectedBox"),c.style.left=t+"px",c.style.top=e+"px",c.style.width=i+"px",c.style.height=o+"px",c.style.cursor="move",this.cropBoxes.push(h),this._drawFinalMask(),!0}catch(t){return!1}},r.prototype.bindCropMask=function(t){var e=L.default.id(t);e&&(this.containerId=t,e.appendChild(this.cropMask))},r.prototype.unbindCropMask=function(){var t=L.default.id(this.containerId);t&&(t.removeChild(this.cropMask),this.containerId="")},r.prototype.clearEditBoxes=function(){var t=L.default.id("cropEditArea"+this.postfix);if(!t)return!1;for(var e=t.children,i=0;i<e.length;i++){var o=e[i];L.default.id("cropEditArea"+this.postfix).removeChild(o),i--}this.cropBoxes=[],this._drawFinalMask()},r.prototype.drawCropMask=function(){var t=L.default.id("WebViewer"+this.postfix).getBoundingClientRect(),e=this.cropMask;e.width=t.width,e.height=t.height;var i=e.getContext("2d");i.fillStyle="rgba(166, 166, 166, 0.4)",i.fillRect(0,0,e.width,e.height)},r.prototype.preventCrop=function(){this._isCroping=!1},r.prototype._clearCropMask=function(){for(var t=L.default.id("cropMask"+this.postfix).getContext("2d"),e=L.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),i=L.default.id("cropMask"+this.postfix).getBoundingClientRect(),o=e.top-i.top,n=e.left-i.left,r=this.cropBoxes,s=0;s<r.length;s++){var a=r[s],l=a.left,h=a.top,c=a.width,u=a.height;t.clearRect(l+n,h+o,c,u)}},r.prototype._drawFinalMask=function(){try{return this.drawCropMask(),this._clearCropMask(),!0}catch(t){return!1}},r.prototype.setCropRatio=function(t){var o,n=this,e=t.target;e&&e.classList.contains("DVS_cropRatio")&&(o=L.default.getIndex(e),L.default.queryAll("#ratioList"+this.postfix+">div.DVS_cropRatio").forEach(function(t,e){var i;e===o?(i=t.classList.toggle("DVS_activeRate"),n.currentRatio=i?n._cropRatios[o][0]/n._cropRatios[o][1]:0):t.classList.remove("DVS_activeRate")}))},r.prototype.setCropRatioFun=function(t){return!!L.default.isNumber(t)&&(this.currentRatio=t,!0)},r.prototype._clearCurrentCropRatio=function(){this.currentRatio=0,L.default.queryAll("#ratioList"+this.postfix+">div.DVS_cropRatio").forEach(function(t){t.classList.remove("DVS_activeRate")})},r.prototype._editBoxStart=function(t){return this._editBoxStartFun(t)},r.prototype._editBoxStartMobile=function(t){if(1!==t.touches.length)return!1;L.default.stopBubble(t);var e=t.changedTouches[0];return this._editBoxStartFun(e)},r.prototype._editBoxStartFun=function(t){var e=t.target;if(e){var i=e.parentNode.getBoundingClientRect();return this._currentEditOption={currentBorder:e,editRect:i},L.default.stopBubble(t),!0}return!1},r.prototype._editBoxMove=function(t){return this._editBoxMoveFun(t)},r.prototype._editBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;L.default.preventDefault(t);var e=t.touches[0];return this._editBoxMoveFun(e)},r.prototype._editBoxMoveFun=function(t){var e=this._currentEditOption;if(e){this.isCropMove=!0;var i,o=e.currentBorder,n=e.editRect,r=n.width,s=n.height,a=n.left,l=n.right,h=n.top,c=n.bottom,u=o.parentNode,d=L.default.id("cropEditArea"+this.postfix),p=d.getBoundingClientRect(),f=t.clientX,g=t.clientY,m=r,_=s,v=a,y=h,b=m/_;if(o.classList.contains("trDragArea")?(v=f<a?f:a,y=g<c?g:c,m=Math.abs(f-a),_=Math.abs(g-c),t.shiftKey&&(i=m/b,f<a&&c+i>p.bottom&&(v=a-(m=(i=p.bottom-c)*b)),a<f&&c-i<p.top&&(m=(i=c-p.top)*b),_=i,y=a<f?c-i:c),d.style.cursor="ne-resize"):o.classList.contains("tlDragArea")?(v=f<l?f:l,y=g<c?g:c,m=Math.abs(f-l),_=Math.abs(g-c),t.shiftKey&&(i=m/b,l<f&&c+i>p.bottom&&(m=(i=p.bottom-c)*b),f<l&&c-i<p.top&&(v=l-(m=(i=c-p.top)*b)),_=i,y=f<l?c-i:c),d.style.cursor="se-resize"):o.classList.contains("blDragArea")?(v=f<l?f:l,y=g<h?g:h,m=Math.abs(f-l),_=Math.abs(g-h),t.shiftKey&&(i=m/b,f<l&&h+i>p.bottom&&(v=l-(m=(i=p.bottom-h)*b)),l<f&&h-i<p.top&&(m=(i=h-p.top)*b),_=i,y=l<f?h-i:h),d.style.cursor="ne-resize"):o.classList.contains("brDragArea")?(v=f<a?f:a,y=g<h?g:h,m=Math.abs(f-a),_=Math.abs(g-h),t.shiftKey&&(i=m/b,a<f&&h+i>p.bottom&&(m=(i=p.bottom-h)*b),f<a&&h-i<p.top&&(v=a-(m=(i=h-p.top)*b)),_=i,y=f<a?h-i:h),d.style.cursor="se-resize"):o.classList.contains("tDragArea")?(y=g<c?g:c,_=Math.abs(g-c),d.style.cursor="s-resize"):o.classList.contains("bDragArea")?(y=g<h?g:h,_=Math.abs(g-h),d.style.cursor="s-resize"):o.classList.contains("lDragArea")?(v=f<l?f:l,m=Math.abs(f-l),d.style.cursor="w-resize"):o.classList.contains("rDragArea")&&(v=f<a?f:a,m=Math.abs(f-a),d.style.cursor="w-resize"),f<p.left||f>p.right||g<p.top||g>p.bottom)return!1;var C=this.limitArea,T=C.x+C.width,w=C.y+C.height,x=v+m,S=y+_,E=v-p.left,I=y-p.top;E<C.x&&(E=0<C.x?C.x:0,m=x-C.x-p.left),T<E+m&&(m=T-E),I<C.y&&(I=C.y,_=S-C.y-p.top),w<I+_&&(_=w-I),T<E||w<I?u.classList.add("DVS_nodisplay"):u.classList.remove("DVS_nodisplay"),u.style.width=m+"px",u.style.height=_+"px",u.style.left=E<C.x?C.x<1?0:C.x-1:E+"px",u.style.top=I+"px";var R={left:parseInt(u.style.left),top:parseInt(u.style.top),width:m,height:_};this.currentCropBox=R;var P=L.default.getIndex(u);return this.cropBoxes.splice(P,1,R),this._drawFinalMask(),!0}return!1},r.prototype.editBoxEnd=function(){return this._editBoxEndFun()},r.prototype.editBoxEndMobile=function(){return this._editBoxEndFun()},r.prototype._editBoxEndFun=function(){return!!this._currentEditOption&&(this._currentEditOption=null,L.default.id("cropEditArea"+this.postfix).style.cursor="crosshair",!0)},r.prototype._dragBoxStart=function(t){return this._dragBoxStartFun(t)},r.prototype._dragBoxStartMobile=function(t){if(L.default.stopBubble(t),1!==t.touches.length)return!1;var e=t.changedTouches[0];return this._dragBoxStartFun(e)},r.prototype._dragBoxStartFun=function(t){var e=t.target;if(e&&e.classList.contains("DVS_cropEditBox")){var i=e.getBoundingClientRect();this._isMoving=!0;var o=t.clientX-i.left,n=t.clientY-i.top;this._dragMoveOption={napLeft:o,napTop:n,target:e},L.default.stopBubble(t);var r=L.default.getIndex(e);return this.cropBoxes.splice(r,1),!0}return!1},r.prototype._dragBoxMove=function(t){return this._dragBoxMoveFun(t)},r.prototype._dragBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;L.default.preventDefault(t);var e=t.changedTouches[0];return this._dragBoxMoveFun(e)},r.prototype._dragBoxMoveFun=function(t){if(this._isMoving){this.isCropMove=!0;var e,i,o,n=this._dragMoveOption,r=n.napLeft,s=n.napTop,a=n.target,l=a.getBoundingClientRect(),h=L.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),c=L.default.id("cropMask"+this.postfix).getBoundingClientRect(),u=t.clientX-r-h.left,d=t.clientY-s-h.top;return u=u<0?0:u+l.width>h.width?h.width-l.width:u,d=d<0?0:d+l.height>h.height?h.height-l.height:d,a&&(i=(e=this.limitArea).x+e.width,o=e.y+e.height,u=(u=u<e.x?e.x<0?0:e.x:u)+l.width>i?i-l.width:u,d=(d=d<e.y?e.y:d)+l.height>o?o-l.height:d,a.style.left=u+"px",a.style.top=d+"px",l=a.getBoundingClientRect(),L.default.id("cropMask"+this.postfix).getContext("2d").clearRect(l.left-c.left,l.top-c.top,l.width,l.height)),this._clearCropMask(),!0}return!1},r.prototype.dragBoxEnd=function(){return this._dragBoxEndFun()},r.prototype.dragBoxEndMobile=function(){return this._dragBoxEndFun()},r.prototype._dragBoxEndFun=function(){var t=this._dragMoveOption.target;if(this._isMoving&&t){this._isMoving=!1;var e=t.getBoundingClientRect(),i=L.default.getIndex(t),o={left:parseInt(t.style.left),top:parseInt(t.style.top),width:e.width,height:e.height};return this.cropBoxes.splice(i,0,o),this.currentCropBox=o,this._drawFinalMask(),this._dragMoveOption={},!0}return!(this._dragMoveOption={})},r.prototype.cropStart=function(t){return!(t.button&&0!==t.button||(this._cropStartFun(t),0))},r.prototype.cropStartMobile=function(t){if(1!==t.touches.length)return!1;var e=t.changedTouches[0];return!!e&&(this._cropStartFun(e),!0)},r.prototype._cropStartFun=function(t){var e=L.default.id("thumbLists"+this.postfix);if(!e||!e.children||e.children.length<=0)return!1;var i=L.default.id("cropEditArea"+this.postfix).getBoundingClientRect();t.ctrlKey||this.clearEditBoxes(),this._drawFinalMask();var o=this.initCropEditBox(),n=t.clientX-i.left,r=t.clientY-i.top;return o.style.left=n+"px",o.style.top=r+"px",o.classList.add("DVS_nodisplay"),this._cropMoveOption={left:n,top:r,target:o},this._isCroping=!0,!(this.currentCropBox=null)},r.prototype.cropMove=function(t){return this._cropMoveFun(t)},r.prototype._cropMoveMobile=function(t){if(1!==t.touches.length)return!1;L.default.preventDefault(t),L.default.stopBubble(t);var e=t.changedTouches[0];return this._cropMoveFun(e),!0},r.prototype._cropMoveFun=function(t){if(this._isCroping){this.isCropMove=!0;var e=this._cropMoveOption,i=e.left,o=e.top,n=e.target,r=L.default.id("cropEditArea"+this.postfix),s=r.getBoundingClientRect(),a=L.default.id("cropMask"+this.postfix).getBoundingClientRect(),l=n.getBoundingClientRect();n.classList.remove("DVS_nodisplay");var h,c,u=(u=t.clientX-s.left)<0?0:u,d=(d=t.clientY-s.top)<0?0:d,p=Math.abs(u-i),f=Math.abs(d-o),g=u<i?u:i,m=d<o?d:o,p=u>r.clientWidth?r.clientWidth-g:p,f=d>r.clientHeight?r.clientHeight-m:f,_=this.limitArea,v=_.x+_.width,y=_.y+_.height;return g<_.x&&(g=_.x,p=u<i?i-_.x:u-_.x),v<g+p&&(p=v-g),m<_.y&&(m=_.y,f=d<o?o-_.y:d-_.y),y<m+f&&(f=y-m),this.currentRatio&&(c=p/(h=this.currentRatio),i<u?y<=(m=o<_.y?_.y:o)+c?p=p*(f=y-m)/c:f=c:(f=c,y<o?_.height<=c&&(p=(f=_.height)*h,g=i<v?i-p:v-p):o-_.y<=c&&(p=(f=o-_.y)*h,g=i<v?i-p:v-p),m=o<y?o-f:y-f)),p<=3||f<=3?n.classList.add("DVS_nodisplay"):n.classList.remove("DVS_nodisplay"),n.style.width=p+"px",n.style.height=f+"px",n.style.left=g+"px",n.style.top=m+"px",l=n.getBoundingClientRect(),L.default.id("cropMask"+this.postfix).getContext("2d").clearRect(l.left-a.left,l.top-a.top,l.width,l.height),this._clearCropMask(),!0}return!1},r.prototype.cropEnd=function(){return this._cropEndFun()},r.prototype.cropEndMobile=function(){return this._cropEndFun()},r.prototype._cropEndFun=function(){var t,e,i,o=this._cropMoveOption.target;return this._isCroping&&o?(this._isCroping=!1,o&&this.isCropMove&&(t=o.getBoundingClientRect(),e=L.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),i={left:t.left-e.left,top:t.top-e.top,width:t.width,height:t.height},o.classList.add("DVS_selectedBox"),o.style.cursor="move",this.cropBoxes.push(i),this.currentCropBox=i),this._drawFinalMask(),this._cropMoveOption={},!0):!(this._cropMoveOption={})},r.prototype._addEvent=function(){},r.prototype.cropInit=function(){this.bindCropMask("WebViewer"+this.postfix);var t=this.isCrop;this.isCrop=t},r);function r(t,e){this.cropBoxes=[],this.containerId="",this.isCropMove=!1,this._isCrop=!1,this._isCroping=!1,this._isMoving=!1,this._cropMoveOption={},this._dragMoveOption={},this.currentRatio=0,this.postfix=t,this.cropOption=e,this._cropRatios=e.ratios,this.initCropMask(),this.cropInit()}e.CropRender=n},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var h=o(i(0)),n=(r.prototype.getImageSize=function(t){var e=this,i=this.setOuterSize(t.width,t.height);return this.setScroller(t.x,t.y),i&&setTimeout(function(){e.setViewPort(),e._pub.emit("_onCanvasResize")}),i},r.prototype.setScroller=function(t,e){var i=h.default.id("outer"+this._postfix);if(!i)return!1;var o=i.scrollLeft,n=i.scrollTop;return o===t&&n===e||(this.isMyScroll=!0),i.scrollLeft=t,i.scrollTop=e,!0},r.prototype.setOuterSize=function(t,e){var i=h.default.id("outer"+this._postfix),o=h.default.id("inner"+this._postfix),n=!1,r=!1;if(!i||!o)return!1;t>i.offsetWidth?(i.style.overflowX="auto",n=!0):i.style.overflowX="hidden",e>i.offsetHeight?(i.style.overflowY="auto",r=!0):i.style.overflowY="hidden",o.style.width=t+"px",o.style.height=e+"px";var s=this._xOver!==n,a=this._yOver!==r;return this._xOver=n,this._yOver=r,s||a},r.prototype.setViewPort=function(){var t=h.default.id("outer"+this._postfix),e=h.default.id("viewPort"+this._postfix);if(!t||!e)return!1;if(0===t.clientWidth||0===t.clientHeight)return!1;var i=t.offsetWidth-t.clientWidth,o=t.offsetHeight-t.clientHeight;e.style.width="calc(100% - "+i+"px)",e.style.height="calc(100% - "+o+"px)"},r.prototype._addButtonScroll=function(){var n=this;h.default.queryAll(".DVS_groupType").forEach(function(t){"ontouchstart"in document.documentElement?(h.default.addEvent(t,"touchstart",function(t){n.buttonScrollStartMobile(t)}),document.addEventListener("touchmove",function(t){n.buttonScrollMoveMobile(t)}),document.addEventListener("touchend",function(){n.buttonScrollEndFun()})):(h.default.addEvent(t,"mousedown",function(t){n.buttonScrollStart(t)}),document.addEventListener("mousemove",function(t){n.buttonScrollMove(t)}),document.addEventListener("mouseup",function(){n.buttonScrollEndFun()}));var e=t.children[0];e&&(e.onclick=function(){t.scrollLeft=0,n._updateShowMore(t)});var i=t.children.length,o=t.children[i-1];o&&(o.onclick=function(){t.scrollLeft=t.scrollWidth-t.clientWidth,n._updateShowMore(t)})})},r.prototype.buttonScrollStart=function(t){return!(t.button&&0!==t.button||(this._buttonScrollStartFun(t),0))},r.prototype.buttonScrollStartMobile=function(t){var e=t.changedTouches[0];return!!e&&(this._buttonScrollStartFun(e),!0)},r.prototype._buttonScrollStartFun=function(t){var e;if(t.target&&t.target.classList.contains("DVS_groupType"))e=t.target;else{if(!(t.target&&t.target.parentNode&&t.target.parentNode.classList.contains("DVS_groupType")))return!1;e=t.target.parentNode}document.addEventListener("touchmove",h.default.preventDefault,{passive:!1}),this._isButtonScroll=!0,this._scrollStartInfo={x:t.clientX,y:t.clientY,left:e.scrollLeft,top:e.scrollTop,item:e}},r.prototype.buttonScrollMove=function(t){return this._buttonScrollMoveFun(t),!0},r.prototype.buttonScrollMoveMobile=function(t){var e=t.changedTouches[0];return!!e&&(this._buttonScrollMoveFun(e),!0)},r.prototype._buttonScrollMoveFun=function(t){if(!this._isButtonScroll)return!1;var e,i,o=this._scrollStartInfo,n=o.x,r=o.y,s=o.left,a=o.top,l=o.item;l.scrollWidth>l.clientWidth&&(e=t.clientX-n,i=t.clientY-r,(5<Math.abs(e)||5<Math.abs(i))&&(this.buttonMove=!0,l.scrollLeft=s-e,l.scrollTop=a-i,this._updateShowMore(l),h.default.preventDefault(t),h.default.stopBubble(t)))},r.prototype.buttonScrollEndFun=function(){this._isButtonScroll=!1,this._scrollStartInfo={},document.removeEventListener("touchmove",h.default.preventDefault)},r.prototype._updateShowMore=function(t){if(!t)return!1;if(0==t.children.length)return!1;5<=t.scrollWidth-t.clientWidth?t.style.justifyContent="flex-start":t.style.justifyContent="";var e=t.scrollLeft,i=5<=e,o=e+t.clientWidth<t.scrollWidth-5,n=t.children[0];if(!n||"SPAN"!==n.tagName)return!1;i&&60<=t.clientWidth?n.classList.remove("DVS_nodisplay"):n.classList.add("DVS_nodisplay");var r=t.children.length,s=t.children[r-1];o&&60<=t.clientWidth?s.classList.remove("DVS_nodisplay"):s.classList.add("DVS_nodisplay"),e=t.scrollLeft,n.style.left=e+"px",s.style.right=-e+"px"},r.prototype.updateAllGroupShowMore=function(){var e=this;h.default.queryAll(".DVS_groupType").forEach(function(t){e._updateShowMore(t)})},r);function r(t,e){this._pub=null,this._xOver=!1,this._yOver=!1,this.isMyScroll=!1,this.buttonMove=!1,this._isButtonScroll=!1,this._postfix=t,this._pub=e,this._addButtonScroll()}e.ScrollRender=n},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var n=o(i(0)).default.uid,r=(s.prototype.loadImage=function(t){var e=t.type,i=t.param,o={fromurl:function(t){return new Promise(function(t,e){})},frominput:function(){var s=document.createElement("input");return s.type="file",s.accept="image/png,image/jpeg,image/jpg,image/gif,image/webp,image/bmp",s.style.position="fixed",s.style.background="transparent",new Promise(function(n,r){s.addEventListener("change",function(t){var e,i,o=s.files[0];o?(e=new Blob([o],{type:o.type}),i={name:o.name,fileType:o.type,contents:[{minData:null,originalData:e,tags:[]}]},n(i)):r()},!0),s.click()})}};return o["from"+e]&&o["from"+e](i)},s.prototype._formatData=function(t){return{uid:n(11),content:t}},s);function s(){}e.LoadImage=r},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var d=o(i(0)),l=o(i(1)).default.errorMessages,r=(s.prototype.initUI=function(t,e){if(!t||!d.default.id(t))return this._throwErr(l.ELEMENT_NOT_EXIST),!1;if(e&&!d.default.isObject(e))return this._throwErr(l.PARAMETER_TYPE),!1;void 0!==e&&(this.uiConfig=e),this._btnListInit(),this._groupListInit(),this._templateObjInit();var i='<div id="WebViewer'+this.postfix+"\" class='DVS_WebViewer'>\n      "+this.templateObj.header+"\n      <div id='body"+this.postfix+'\' class="DVS_body">\n    ';i+=this._besidesMenuInit(),i+=this._contentInit(),i+="</div>",i+=this._hiddenBoxInit(),i+="</div>";var o=this.uiConfig;d.default.id(t).innerHTML=i,this._emptyString(),this.setViewerWidth(this.width),this.setViewerHeight(this.height),this.setViewerBorderColor(this.viewerBorderColor),this.setThumbnailBackground(this.thumbnailBackground),this.setThumbnailWidth(this.thumbnailWidth),this.setSelectedImageBorderColor(o.thumbnail.selectedBorderColor),this.setSelectedBackgroundColor(o.thumbnail.selectedBackgroundColor),this.setImageBackgroundColor(o.thumbnail.imageBackgroundColor),this.setImageBorderColor(o.thumbnail.imageBorderColor),this.setHoverBorderColor(o.thumbnail.hoverBorderColor),this.setHoverBackgroundColor(o.thumbnail.hoverBackgroundColor),this.setPlaceholderBackgroundColor(o.thumbnail.placeholderBackgroundColor),this.setShowAside(o.component.asideMenu),this.setShowThumbnail(o.thumbnail.visibility),this.setShowFooter(o.component.bottomMenu),this.setFooterColor(this.footerColor),this.setShowHeader(o.component.header),this.setHeaderColor(this.headerColor),this.setShowTopMenu(o.component.topMenu),this.setTopMenuColor(this.topMenuColor),this.setShowMain(o.content.visibility),this.setShowSideBar(o.content.besides.visibility),this.setshowVideoContainer(this.showVideoContainer),this.setSidebarWidth(this.sidebarWidth),this.emit("_onAddLog",d.default.formatLog("uiInit",!0))},s.prototype._btnListInit=function(){try{var t=this.uiConfig,e=t.buttons,i=t.group;for(var o in i)this.buttonList[o]=[];for(var o in e){var n,r=e[o].location;r&&i[r]&&((n=e[o]).name=o,this._insertMenuArr(r,n,this.buttonList))}return!0}catch(t){return!1}},s.prototype._groupListInit=function(){try{var t=this.uiConfig,e=t.component,i=t.group;for(var o in e)d.default.isString(o)&&(this.groupList[o]=[]);for(var o in i){var n=i[o];if(d.default.isObject(n)){var r=n.location;if(!r)continue;n.name=o,r&&this._insertMenuArr(r,n,this.groupList)}}return!0}catch(t){return!1}},s.prototype._templateObjInit=function(){for(var t=this.uiConfig.component,e=Object.keys(t),i=0;i<e.length;i++){var o=t[e[i]]&&t[e[i]].visibility||!0===t[e[i]],n=t[e[i]].cssStyle?t[e[i]].cssStyle:"",r='<div id="'+(e[i]+this.postfix)+"\" class='"+(o?"":"DVS_disabled")+" DVS_"+e[i]+" "+n+"'>";r+=this._getcomponentInnerTemp(e[i]),r+="</div>",this.templateObj[e[i]]=r}},s.prototype._emptyString=function(){this.buttonList=[],this.groupList=[],this.templateObj={}},s.prototype._insertMenuArr=function(t,e,i){var o=i[t];if(o.length)for(var n=0;n<o.length;n++)if(o[n].sequence>e.sequence)return o.splice(n,0,e),n;return o.push(e),o.length-1},s.prototype._getGroupInnerTemp=function(t){for(var l=this.buttonList[t],h="",c=this.uiConfig,u=this,e=0;e<l.length;e++)!function(t){var e,o,i=l[t].name,n=l[t].iconClass,r=l[t]&&l[t].visibility,s=c.tipsConfig[i],a=l[t].text;"pagination"===l[t].name?h+="\n          <label id='pagination"+u.postfix+"' class='DVS_pagination "+(r?"":"DVS_disabled")+"'>\n            <input id =\"pageInput"+u.postfix+'" type ="text" value ="0"/>\n            <span>| </span>\n            <label id ="pageLabel'+u.postfix+'" for= "pageInput'+u.postfix+'"> 0 </label>\n          </label>\n        ':(h+='<div class="'+(r?"":"DVS_disabled")+"\n        "+(n?"ds-dvs-ui-iconfont "+n:"DVS_emptyBtn")+'"\n        id="'+i+"Btn"+u.postfix+"\" \n        title='"+(s||"")+"'>\n        "+(a?"<span>"+a+"</span>":""),(e=l[t].dropDown)&&e.length&&(h+="<div class='rbIcon ds-dvs-ui-iconfont ds-dvs-ui-rightbottom'></div>",o="<ul class='dropdownUl DVS_nodisplay'>",e.forEach(function(t){var e=t.iconClass?t.iconClass:"",i=t.text?t.text:"";o+="<li class='dropdownLi "+e+"'><span>"+i+"</span></li>"}),h+=o+="</ul>"),h+="</div>")}(e);return h},s.prototype._getcomponentInnerTemp=function(t){for(var e="",i=this.groupList[t],o=0,n=i.length;o<n;o++){var r=i[o].name,s=i[o].cssStyle?i[o].cssStyle:"",a=i[o]&&i[o].visibility;"pager"===r?e+=this._pagerInit():(e+='<div id="'+(r+this.postfix)+'" class="DVS_groupType DVS_'+r+" "+(a?"":"DVS_disabled")+" "+s+'">',e+='<span id="showBefore-'+r+'" class="showMore ds-dvs-ui-iconfont ds-dvs-ui-move_right showBefore DVS_nodisplay"></span>',e+=this._getGroupInnerTemp(r),e+='<span id="showAfter-'+r+'" class="showMore ds-dvs-ui-iconfont ds-dvs-ui-move_left showAfter DVS_nodisplay"></span>',e+="</div>")}return e},s.prototype._besidesMenuInit=function(){var t=this.uiConfig,e=0,i=t.tree&&t.tree.visibility,o=t.tag&&t.tag.visibility,n='<div id="besides'+this.postfix+'" style="order:'+t.content.besides.sequence+'"\n    class="DVS_besides '+(t.content.besides.visibility&&(i||o)?"":"DVS_disabled")+'">',r='<ul id="navChange'+this.postfix+'" class="DVS_navChange">',s="<div id='defaultTag"+this.postfix+"' class='DVS_defaultTag DVS_activeAllImage "+(t.content.allImage&&t.content.allImage.visibility?"":"DVS_disabled")+"'>\n    "+t.content.allImage.displayName+"</div>",a='<ul id="paneShow'+this.postfix+'"  class="DVS_paneShow">';return r+='<li id="DirctoryTreeNav'+this.postfix+'" class="DVS_DirctoryTreeNav'+(0===e?" activeTab":"")+" "+(i?"":"DVS_disabled")+'">\n    <div class="ds-dvs-ui-iconfont '+t.tree.iconClass+'"></div>\n    </li>',a+='<li id="DirctoryTree'+this.postfix+'" class="DVS_DirctoryTree'+(e?" DVS_nodisplay":"")+" "+(i?"":"DVS_disabled")+'">\n        <ul class="treeLists" id="treeLists'+this.postfix+"\"></ul>\n        <div id='addFolderBox"+this.postfix+"' class='DVS_addFolderBox'>\n          <div id='addFolder"+this.postfix+"' class='DVS_addFolder'>Add folder</div>\n        </div>\n        </li>\n        ",i&&e++,r+='<li id="TagsNav'+this.postfix+'" class="DVS_TagsNav'+(0===e?" activeTab":"")+" "+(o?"":"DVS_disabled")+' ">\n    <div class="ds-dvs-ui-iconfont '+t.tag.iconClass+'"></div>\n    </li>',a+='<li id="Tags'+this.postfix+'" class="DVS_Tags'+(e?" DVS_nodisplay":"")+" "+(o?"":"DVS_disabled")+'">\n       \n        <ul id="tagLists'+this.postfix+'" class="tagLists"></ul>\n        <div id=\'addTagBox'+this.postfix+"' class='DVS_addTagBox'>\n          <div id='addTag"+this.postfix+"' class='DVS_addTag'>Add tag</div>\n        </div>\n        </li>",o&&e++,n+=(r+="</ul>")+s+(a+="</ul>"),n+='<div id="stretchBar'+this.postfix+'" class="DVS_stretchBar"></div>\n      </div>'},s.prototype._thumbnailInit=function(){var t=this.uiConfig,e=t.thumbnail&&t.thumbnail.visibility;return'\n    <div id="Thumbnail'+this.postfix+'" class="DVS_Thumbnail '+(e?"":"DVS_disabled")+" \" style='border:1px solid "+this.viewerBorderColor+";\n    order:"+this.uiConfig.thumbnail.sequence+"'>\n        <div id='thumbnailStretchBarLeft"+this.postfix+"' class='DVS_stretchBar DVS_stretchLeft'></div>\n        <div id='thumbnailStretchBarRight"+this.postfix+"' class='DVS_stretchBar DVS_stretchRight'></div>\n        <div id=\"thumbControl"+this.postfix+'" class="DVS_thumbControl '+(t.thumbnail.showThumbnailControl?"":"DVS_disabled")+'">\n          <div id="mutiSelect'+this.postfix+"\" class='DVS_mutipleSelect'>\n            <span>Select Mode</span>\n          </div>\n        </div>\n        <div id=\"mutiControl"+this.postfix+'" class="DVS_mutiControl DVS_nodisplay '+(t.thumbnail.showThumbnailControl?"":"DVS_disabled")+'">\n            <div id="selectAll'+this.postfix+'" class="ds-dvs-ui-iconfont ds-dvs-ui-selected"></div>\n            <div id="exitMutiple'+this.postfix+'" class="ds-dvs-ui-iconfont ds-dvs-ui-exitMutiple"></div>\n        </div>\n        <ul id="thumbLists'+this.postfix+"\" style='flex-direction:"+t.thumbnail.imageDirection+";\n        "+("row"===t.thumbnail.imageDirection?"overflow-x: hidden;overflow-y: auto;":"overflow-x: auto;overflow-y: hidden;")+"' class=\"thumbLists "+(t.thumbnail.showPage?"showPage":"")+"\"></ul>\n        <div id='zoomThumbnail"+this.postfix+"' class='DVS_zoomThumbnail "+(t.thumbnail.showThumbnailControl?"":"DVS_disabled")+"'>\n          <div id=\"magnifyImage"+this.postfix+'" class="ds-dvs-ui-iconfont ds-dvs-ui-magnifyImage"></div>\n          <div id="shrinkImage'+this.postfix+'" class="ds-dvs-ui-iconfont ds-dvs-ui-shrinkImage"></div>\n        </div>              \n    </div>'},s.prototype._contentInit=function(){var t="<div id='showImageArea"+this.postfix+"' class='DVS_showImageArea' \n    style=\"order:"+this.uiConfig.content.viewPort.sequence+";flex-direction:"+this.uiConfig.thumbnail.direction+'">';t+=this._thumbnailInit(),t+='<div id="content'+this.postfix+"\" class='"+(this.uiConfig.content&&this.uiConfig.content.visibility?"":"DVS_disabled")+" DVS_content'>",t+=this.templateObj.topMenu,t+='<div id="middle'+this.postfix+"\"  class='DVS_middle'>",t+=this.templateObj.asideMenu,t+="\n      <div id='container"+this.postfix+"' class='DVS_container'>\n          <div id='outer"+this.postfix+"' class='DVS_outer'>\n            <div id='inner"+this.postfix+"' class='DVS_inner'></div> \n          </div>\n          <div id=\"viewPort"+this.postfix+'" \n            class="'+(this.uiConfig.content.viewPort&&this.uiConfig.content.viewPort.visibility?"":"DVS_disabled")+"  DVS_viewPort\">\n              <div id='cropEditArea"+this.postfix+"' class='DVS_cropEditArea DVS_nodisplay'></div>\n          </div>\n          <div id='videoContainer"+this.postfix+"' class='DVS_videoContainer DVS_nodisplay' style=''>\n            <img id='videoImage"+this.postfix+"' src=''></img>\n          </div>\n      </div>",t+="</div>",t+="<div id='controlBox"+this.postfix+"' class='camera-controlBox DVS_disabled' style=''></div>",t+="<div id='cropBar"+this.postfix+"' class='DVS_cropBar DVS_nodisplay'>\n      <ul id='ratioList"+this.postfix+"' class='DVS_ratioList'>\n  ";for(var e=0;e<this.uiConfig.cropStyle.ratios.length;e++){var i=this.uiConfig.cropStyle.ratios[e];t+="<div class='DVS_cropRatio'>"+i[0]+":"+i[1]+"</div>"}return t+="</ul>\n    <div id='cropConfirmBox"+this.postfix+"' class='DVS_cropConfirmBox'>\n        <div id='confirmCropBtn"+this.postfix+"' class='ds-dvs-ui-iconfont ds-dvs-ui-confire DVS_confirmCropBtn'></div>\n        <div id='cancleCropBtn"+this.postfix+"' class='ds-dvs-ui-iconfont ds-dvs-ui-cancle DVS_cancleCropBtn'></div>\n      </div>\n    </div>\n    ",t+=this.templateObj.bottomMenu,t+="</div>\n    </div>"},s.prototype._pagerInit=function(){for(var t=this.uiConfig,e="",i=this.buttonList.pager,e=' <div id="pager'+this.postfix+'" class="DVS_pager '+(t.group.pager&&t.group.pager.visibility?"":"DVS_disabled")+' DVS_groupType">',o=0;o<i.length;o++){var n=i[o]&&i[o].visibility;"pagination"===i[o].name?(e+='<input id ="pageInput'+this.postfix+'" autocomplete=\'off\' type ="text" value ="0" class=\''+(n?"":"DVS_disabled")+"'/>",e+="<span class='"+(n?"":"DVS_disabled")+"'>| </span>",e+='<label id ="pageLabel'+this.postfix+'" for= "pageInput'+this.postfix+"\" class='"+(n?"":"DVS_disabled")+"'> 0 </label>"):e+='<div id ="'+i[o].name+"Btn"+this.postfix+"\" title='"+t.tipsConfig[i[o].name]+"' \n        class=\""+(n?"":"DVS_disabled")+" ds-dvs-ui-iconfont "+i[o].iconClass+'" > </div>'}return e+="</div>"},s.prototype._hiddenBoxInit=function(){var t=this.uiConfig,e="";return e+='<div  id="hiddenBoxs'+this.postfix+'" class="DVS_hiddenBoxs">\n    <div  id="saveSettingBox'+this.postfix+'" class="saveSettingBox DVS_nodisplay">\n        <div class="settingBox">\n          <div class=\'DVS_saveFomat\'>\n            <div class="fileNameSetting">\n                <label for="fileNameInput'+this.postfix+'">FileName:</label>\n                <input type="text" id="fileNameInput'+this.postfix+'">\n            </div>\n            <div class="formatSetting">\n                <label for="formatselect'+this.postfix+'">Format:</label>\n                <select name="formatselect" id="formatselect'+this.postfix+'">\n                  <option value="1">PDF</option>\n                  <option value="2">JPEG</option>\n                </select>\n            </div>\n          </div>\n          <div class=\'DVS_pageFormat\'>\n            <div class="pagesSetting">\n                <div class="pageSelect">\n                    <label>Pages:</label>\n                    <input type="radio" name="pages" id="allPage'+this.postfix+'">\n                    <label for="allPage'+this.postfix+'">All</label>\n                    <input type="radio" name="pages" id="currentPage'+this.postfix+'">\n                    <label for="currentPage'+this.postfix+'">Current</label>\n                </div>\n                <input type="text" value="1-10">\n            </div>\n          </div>\n          <div class=\'DVS_qualityFormat\'>\n            <div class="qualitySetting">\n                <label for="qualityInput'+this.postfix+'">Quality:</label>\n                <div class=\'qualityControl\'>\n                  <div>+</div>\n                  <input type="text" id="qualityInput'+this.postfix+'" value="80%">\n                  <div>-</div>\n                </div>\n            </div>\n          </div>\n        </div>\n        <div id="confirmSaveBox'+this.postfix+'" class="confirmSaveBox">\n            <div id="cancleSaveBtn'+this.postfix+'" class="cancleSaveBtn">Cancle</div>\n            <div id="confirmSaveBtn'+this.postfix+'" class="confirmSaveBtn">Save</div>\n        </div>\n    </div>\n    <div id="navigationPane'+this.postfix+'" class="navigationPane DVS_nodisplay">\n        <div id="isShowPane'+this.postfix+'" class="isShowPane">\n            <div class="ds-dvs-ui-iconfont ds-dvs-ui-selected"></div>\n            <span>Navigation pane</span>\n    </div>\n    <ul id="paneSelector'+this.postfix+'" class="paneSelector">\n            <li id="dirctoryTreePane'+this.postfix+'" class="dirctoryTreePane '+(t.tree&&t.tree.visibility?"":"DVS_disabled")+'">\n                <div class="ds-dvs-ui-iconfont ds-dvs-ui-selected"></div>\n                <span>DirctoryTree</span>\n            </li>\n            <li  id="tagPane'+this.postfix+'" class="tagPane '+(t.tag&&t.tag.visibility?"":"DVS_disabled")+'">\n                <div class="ds-dvs-ui-iconfont ds-dvs-ui-selected"></div>\n                <span>Tag</span>\n            </li>\n    </ul>\n    <div  id="thumbnailPane'+this.postfix+'" class="thumbnailPane '+(t.thumbnail&&t.thumbnail.visibility?"":"DVS_disabled")+'">\n            <div class="ds-dvs-ui-iconfont ds-dvs-ui-selected"></div>\n            <span>Thumbnail</span>\n        </div>\n    </div>\n    <ul id="contextMenu'+this.postfix+"\" class=\"DVS_nodisplay DVS_contextMenu\">\n      <li>Copy</li>\n      <li>Cut</li>\n      <li>Paste</li>\n      <li class='removeFileBtn'>Remove</li>\n      <li class='renameFileBtn'>Rename</li>\n    </ul>\n    \n</div>\n    <div  id=\"confirmBox"+this.postfix+"\" class='DVS_confirmBox DVS_nodisplay'>\n      <div  id=\"shade"+this.postfix+'" class="DVS_shade"></div>\n      <div  id="removeFrame'+this.postfix+'" class="DVS_removeFrame">\n        <div class="frameTitle"><h2>Delete</h3></div>\n        <div class="frameContent">Delete the selected Image?</div>\n        <div class="optionBtns">\n          <div  id="cancelRemove'+this.postfix+'" class="cancelRemove">Cancel</div>\n          <div  id="confirmRemove'+this.postfix+'" class="confirmRemove">Done</div>\n        </div>\n    </div>\n</div>\n'},s.prototype.ID=function(t){return document.getElementById(t+this.postfix)},s.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},s.prototype._throwErr=function(t){this.emit("dvs_error",t)},s.prototype._ok=function(){this.emit("dvs_error",l.OK)},s.prototype.setThemeColor=function(e){this.themeColor=e,d.default.query(".DVS_topMenu").style.background=e,d.default.query(".DVS_bottomMenu").style.background=e,d.default.query(".saveSettingBox").style.background=e,d.default.queryAll(".loadFileType>li").forEach(function(t){t.style.background=e}),d.default.queryAll(".DVS_navChange>li>div").forEach(function(t){t.style.color=e}),d.default.queryAll(".DVS_paneShow>li>div>div").forEach(function(t){t.style.color=e}),d.default.query(".DVS_WebViewer").style.borderColor=e,d.default.query(".DVS_navChange").style.borderColor=e,d.default.queryAll(".DVS_navChange>li").forEach(function(t){t.style.borderColor=e,t.style.borderBottomColor="#FFF"}),d.default.queryAll(".DVS_paneShow>li>div").forEach(function(t){t.style.borderBottomColor=e}),d.default.query(".DVS_besides").style.borderRightColor=e},s.prototype.changeMouseShape=function(t){this.mouseShape=t;var e=d.default.id("WebViewer"+this.postfix);return!!e&&(e.style.cursor=t||"default",e.style.cursor?(this._ok(),!0):(this._throwErr(l.PARAMETER_INVALID),!1))},s.prototype.setButtonClass=function(t,e){var i=this.uiConfig.buttons,o=d.default.id(t+"Btn"+this.postfix);if(o){var n=i[t].iconClass?i[t].iconClass:"",r=o.classList.contains("DVS_disabled")?"DVS_disabled":"";o.className="ds-dvs-ui-iconfont DVS_iconColor "+r+" "+n,d.default.isArray(e)||(e=[e]);for(var s=0;s<e.length;s++){var a=e[s];o.classList.contains(a)||o.classList.add(a)}return this._ok(),!0}return this._throwErr(l.ELEMENT_NOT_EXIST),!1},s.prototype.setGroupClass=function(t,e){var i=this.uiConfig.group,o=d.default.id(t+this.postfix);if(o){var n=i[t].cssStyle?i[t].cssStyle:"",r=o.classList.contains("DVS_disabled")?"DVS_disabled":"";o.className="DVS_"+t+" DVS_groupType "+r+" "+n,d.default.isArray(e)||(e=[e]);for(var s=0;s<e.length;s++){var a=e[s];o.classList.contains(a)||o.classList.add(a)}return this._ok(),!0}return this._throwErr(l.ELEMENT_NOT_EXIST),!1},s.prototype.changeButtonSize=function(){var t=d.default.id("WebViewer"+this.postfix);if(!t)return!1;t.classList.add("DVS_buttonResize");for(var e=t.clientWidth,i=t.clientHeight,o=36*(e/1920<i/1080?e/1920:i/1080)*window.devicePixelRatio,n=d.default.queryAll("#topMenu"+this.postfix+">div:not(.DVS_pager)>div"),r=d.default.queryAll("#bottomMenu"+this.postfix+">div>div"),s=this.uiConfig.buttonResize.maxSize,a=this.uiConfig.buttonResize.minSize,o=Math.floor(s<o?s:o<a?a:o),l=Math.floor(o/2*3),h=Math.floor(l/4*5),c=[n,r],u=0;u<c.length;u++)c[u].forEach(function(t){t.classList.contains("DVS_emptyBtn")?(t.style.width=o+"px",t.style.height=o+"px",t.style.flexBasis=o+"px"):(t.style.fontSize=o+"px",t.style.width=l+"px",t.style.height=l+"px",t.style.flexBasis=l+"px")});d.default.id("topMenu"+this.postfix).style.flexBasis=h+"px",d.default.id("topMenu"+this.postfix).style.height=h+"px",d.default.id("bottomMenu"+this.postfix).style.flexBasis=h+"px",d.default.id("bottomMenu"+this.postfix).style.height=h+"px",d.default.id("bottomMenu"+this.postfix).style.justifyContent="flex-start"},s.prototype.setShowPageNumber=function(t){var e=d.default.id("thumbLists"+this.postfix);return this.showPageNumber=t,!!e&&(t?e.classList.add("showPage"):e.classList.remove("showPage"),this._ok(),!0)},s.prototype.setShowSelectBox=function(t){var e=d.default.id("thumbLists"+this.postfix);return this.showSelectBox=t,!!e&&(t?e.classList.add("DVS_mutipleMode"):e.classList.remove("DVS_mutipleMode"),this._ok(),!0)},s.prototype.setShowTopMenu=function(t){var e=d.default.id("topMenu"+this.postfix);return this.uiConfig.component.topMenu=t,this.showTopMenu=t,e?(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.setTopMenuColor=function(t){var e=d.default.id("topMenu"+this.postfix);return this.topMenuColor=t,e&&(e.style.background=t),!0},s.prototype.setShowHeader=function(t){var e=d.default.id("header"+this.postfix);return this.uiConfig.component.header=t,this.showHeader=t,e?(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.setHeaderColor=function(t){var e=d.default.id("header"+this.postfix);return this.headerColor=t,e&&(e.style.background=t),!0},s.prototype.setShowSideBar=function(t){var e=d.default.id("besides"+this.postfix);return this.uiConfig.content.besides.visibility=t,this.showSideBar=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},s.prototype.setShowThumbnail=function(t){var e=this,i=d.default.id("Thumbnail"+this.postfix);return this.uiConfig.thumbnail.visibility=t,this.showThumbnail=t,!!i&&(t?(i.classList.remove("DVS_disabled"),this._tempScrollIndex&&setTimeout(function(){e.emit("_onThumbnailScrollTo",e._tempScrollIndex)},0)):i.classList.add("DVS_disabled"),this._ok(),!0)},s.prototype.setShowAside=function(t){var e=d.default.id("asideMenu"+this.postfix);return this.uiConfig.component.asideMenu=t,this.showAside=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},s.prototype.setShowMain=function(t){var e=d.default.id("viewPort"+this.postfix);return this.uiConfig.content.viewPort.visibility=t,this.showMain=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this.emit("_onShowCanvas",t),this._ok(),!0)},s.prototype.setShowFooter=function(t){var e=d.default.id("bottomMenu"+this.postfix);return this.uiConfig.component.bottomMenu=t,this.showFooter=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},s.prototype.setFooterColor=function(t){var e=d.default.id("bottomMenu"+this.postfix);return this.footerColor=t,e&&(e.style.background=t),!0},s.prototype.setShowThumbnailControl=function(t){var e=d.default.id("thumbControl"+this.postfix),i=d.default.id("mutiControl"+this.postfix),o=d.default.id("zoomThumbnail"+this.postfix);return this.uiConfig.thumbnail.showThumbnailControl=t,this.showThumbnailControl=t,!!(e&&i&&o)&&(t?(e.classList.remove("DVS_disabled"),i.classList.remove("DVS_disabled"),o.classList.remove("DVS_disabled")):(e.classList.add("DVS_disabled"),i.classList.add("DVS_disabled"),o.classList.add("DVS_disabled")),this._ok(),!0)},s.prototype.setShowControlBox=function(t){var e=d.default.id("controlBox"+this.postfix);return this.showControlBox=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},s.prototype.setViewerWidth=function(t){var e=d.default.id("WebViewer"+this.postfix);if(this.width=t,!e)return!1;if(d.default.isNumber(t)){if(t<0)return this._throwErr(l.PARAMETER_RANGE),!1;e.style.width=t+"px"}else{if(!d.default.isString(t))return this._throwErr(l.PARAMETER_TYPE),!1;if(!/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t))return this._throwErr(l.PARAMETER_TYPE),!1;e.style.width=t}return this._ok(),!0},s.prototype.getViewerWidth=function(){var t=d.default.id("WebViewer"+this.postfix);return t?t.getBoundingClientRect().width:this.width},s.prototype.setViewerHeight=function(t){var e=d.default.id("WebViewer"+this.postfix);if(this.height=t,!e)return!1;if(d.default.isNumber(t)){if(t<0)return!1;e.style.height=t+"px"}else{if(!d.default.isString(t))return this._throwErr(l.PARAMETER_TYPE),!1;if(!/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t))return this._throwErr(l.PARAMETER_TYPE),!1;e.style.height=t}return this._ok(),!0},s.prototype.getViewerHeight=function(){var t=d.default.id("WebViewer"+this.postfix);return t?t.getBoundingClientRect().height:this.height},s.prototype.setViewerBorderColor=function(t){var e=d.default.id("WebViewer"+this.postfix),i=d.default.id("Thumbnail"+this.postfix),o=d.default.id("content"+this.postfix),n=d.default.id("middle"+this.postfix);e&&(e.style.borderColor=t),i&&(i.style.borderColor=t),o&&(o.style.borderColor=t),n&&(n.style.borderColor=t),this.viewerBorderColor=t},s.prototype.setSelectedImageBorderColor=function(e){this.uiConfig.thumbnail.selectedBorderColor=e;var t=d.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb");return t&&t.length&&t.forEach(function(t){t.style.borderColor=e}),this._ok(),!0},s.prototype.setSelectedBackgroundColor=function(e){this.uiConfig.thumbnail.selectedBackgroundColor=e;var t=d.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb");return t&&t.length&&t.forEach(function(t){t.style.backgroundColor=e}),this._ok(),!0},s.prototype.setImageBackgroundColor=function(t){this.uiConfig.thumbnail.imageBackgroundColor=t;var e=d.default.id("thumbLists"+this.postfix);if(e&&e.children)for(var i=e.children,o=0;o<i.length;o++){var n=i[o];n.classList.contains("DVS_activeThumb")||(n.style.backgroundColor=t)}return this._ok(),!0},s.prototype.setImageBorderColor=function(t){this.uiConfig.thumbnail.imageBorderColor=t;var e=d.default.id("thumbLists"+this.postfix);if(e&&e.children)for(var i=e.children,o=0;o<i.length;o++){var n=i[o];n.classList.contains("DVS_activeThumb")||(n.style.borderColor=t)}return this._ok(),!0},s.prototype.setHoverBorderColor=function(t){return this.uiConfig.thumbnail.hoverBorderColor=t,this._ok(),!0},s.prototype.setHoverBackgroundColor=function(t){return this.uiConfig.thumbnail.hoverBackgroundColor=t,this._ok(),!0},s.prototype.setPlaceholderBackgroundColor=function(t){return this.uiConfig.thumbnail.placeholderBackgroundColor=t,this._ok(),!0},s.prototype.setThumbnailBackground=function(t){this.thumbnailBackground=t,this.uiConfig.thumbnail.backgroundColor=t;var e=this.ID("thumbLists");return e&&(e.style.background=t),this._ok(),!0},s.prototype.setThumbnailBorderColor=function(t){this.uiConfig.thumbnail.thumbnailBorderColor=t;var e=this.ID("Thumbnail");return e&&(e.style.borderColor=t),this._ok(),!0},s.prototype.setSidebarWidth=function(t){var e=d.default.id("besides"+this.postfix);return!!e&&(d.default.isNumber(t)?!(t<0||(e.style.flex="0 0 "+t+"px",e.style.width=t+"px",this.sidebarWidth=t,0)):d.default.isString(t)&&/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t)?(e.style.flex="0 0 "+t,this.sidebarWidth=t,this._ok(),!0):(this._throwErr(l.PARAMETER_TYPE),!1))},s.prototype.setThumbnailWidth=function(t){var e=d.default.id("Thumbnail"+this.postfix);return!!e&&(this.fullThumbnail&&(t="100%"),d.default.isNumber(t)?!(t<0||(e.style.flex="0 0 "+t+"px","row"===this.uiConfig.thumbnail.direction?(e.style.width=t+"px",e.style.height=null):(e.style.height=t+"px",e.style.width=null),this.fullThumbnail||(this.thumbnailWidth=t),0)):d.default.isString(t)&&(/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t)||this.fullThumbnail)?(e.style.flexShrink=0,e.style.flexGrow=0,e.style.flexBasis=t,"row"===this.uiConfig.thumbnail.direction?(e.style.width=""+t,e.style.height=null):(e.style.height=""+t,e.style.width=null),this.fullThumbnail||(this.thumbnailWidth=t),this._ok(),!0):(this._throwErr(l.PARAMETER_TYPE),!1))},s.prototype.setFullThumbnail=function(t){this.fullThumbnail=t,this.setThumbnailWidth(this.thumbnailWidth);var e=d.default.id("thumbnailStretchBarRight"+this.postfix);return e&&(t?e.classList.add("DVS_nodisplay"):e.classList.remove("DVS_nodisplay")),this.emit("_onShowCanvas",!t),this._ok(),!0},s.prototype.setshowVideoContainer=function(t){var e=d.default.id("container"+this.postfix);if(!e)return!1;for(var i=e.children,o=0,n=i.length;o<n;o++)i[o].classList.contains("DVS_videoContainer")?t?i[o].classList.remove("DVS_nodisplay"):i[o].classList.add("DVS_nodisplay"):t?i[o].classList.add("DVS_nodisplay"):i[o].classList.remove("DVS_nodisplay");return this.showVideoContainer=t,this._ok(),!0},s.prototype.fullScreen=function(){var t,e=d.default.id("WebViewer"+this.postfix),i=d.default.launchFullscreen(e);return i?((t=d.default.id("fullScreenBtn"+this.postfix)).classList.add("ds-dvs-ui-exitFull"),t.classList.remove("ds-dvs-ui-fullDevice"),this._ok()):this._throwErr(l.ELEMENT_NOT_EXIST),i},s.prototype.cancelFullScreen=function(){var t,e=d.default.isFullscreen()&&d.default.exitFullscreen();return e?((t=d.default.id("fullScreenBtn"+this.postfix)).classList.add("ds-dvs-ui-fullDevice"),t.classList.remove("ds-dvs-ui-exitFull"),this._ok()):this._throwErr(l.ELEMENT_NOT_EXIST),e},s.prototype.fullPage=function(){var t=d.default.id("WebViewer"+this.postfix),e=d.default.id("fullPageBtn"+this.postfix);return t?(t.classList.add("fitPage"),e.classList.add("ds-dvs-ui-exitFullWeb"),e.classList.remove("ds-dvs-ui-fullWeb"),this.cancelFullScreen(),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.cancelFullPage=function(){var t=d.default.id("WebViewer"+this.postfix),e=d.default.id("fullPageBtn"+this.postfix);return t?(t.classList.remove("fitPage"),e.classList.add("ds-dvs-ui-fullWeb"),e.classList.remove("ds-dvs-ui-exitFullWeb"),this.cancelFullScreen(),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.bindContent=function(t,e,i){this._contentContainer||(this._contentContainer={}),t=t||this._contentContainer.containerId;var o=d.default.id("content"+this.postfix),n=d.default.id("header"+this.postfix),r=d.default.id(t);if(e&&i||(e=this._contentContainer.width,i=this._contentContainer.height),!r||!n||!o)return this._throwErr(l.ELEMENT_NOT_EXIST),!1;var s=document.createElement("div");return s.setAttribute("style","display:flex;flex-direction:column;width:100%;height:100%;border:1px solid "+this.viewerBorderColor),s.id="contentContainer"+this.postfix,s.appendChild(n),s.appendChild(o),0<=e&&0<=i&&(s.style.width=e+"px",s.style.height=i+"px"),r.appendChild(s),this._contentContainer={containerId:t,width:e,height:i},this._ok(),!0},s.prototype.unbindContent=function(t){void 0===t&&(t=!1);try{var e=d.default.id("WebViewer"+this.postfix);if(!e)return!1;var i=d.default.id("content"+this.postfix),o=d.default.id("header"+this.postfix),n=d.default.id("showImageArea"+this.postfix),r=d.default.id("contentContainer"+this.postfix);return o&&e.insertBefore(o,e.children[0]),n&&i&&n.appendChild(i),r&&r.parentNode&&r.parentNode.removeChild(r),t||(this._contentContainer=null,i.style.width=null,i.style.height=null),this._ok(),!0}catch(t){return!1}},s.prototype.switchToTagTab=function(){var t=d.default.id("TagsNav"+this.postfix),e=t&&t.children[0];return!!e&&(e.click(),!0)},s.prototype.switchToTreeTab=function(){var t=d.default.id("DirctoryTreeNav"+this.postfix),e=t&&t.children[0];return!!e&&(e.click(),!0)},s.prototype.bindMainContent=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=!1),!d.default.isString(t)||!d.default.isNumber(e)||!d.default.isBoolean(i))return this._throwErr(l.PARAMETER_TYPE),!1;var o=d.default.id(t);if(!o)return this._throwErr(l.ELEMENT_NOT_EXIST),!1;var n=d.default.id("middle"+this.postfix);if(!n)return this._throwErr(l.ELEMENT_NOT_EXIST),!1;var r={nodeId:t,styleAttr:o.getAttribute("style"),sequence:e,isFull:i},s=o.parentNode;return s&&s!==n&&(s.id&&(r.parentId=s.id),r.nodeIndex=d.default.getIndex(o)),n.appendChild(o),o.style.order=e,i?o.classList.add("DVS_full"):o.classList.remove("DVS_full"),this.mainContentList[t]=r,this._ok(),!0},s.prototype.unbindMainContent=function(t,e){if(void 0===e&&(e=!1),!d.default.isString(t))return this._throwErr(l.PARAMETER_TYPE),!1;var i=d.default.id(t);if(!i)return this._throwErr(l.ELEMENT_NOT_EXIST),!1;if(!d.default.id("middle"+this.postfix))return this._throwErr(l.ELEMENT_NOT_EXIST),!1;var o=this.mainContentList[t];if(!o)return this._ok(),e||(this.mainContentList[t]=null),!0;var n=d.default.id(o.parentId);return n?(n.insertBefore(i,n.children[o.nodeIndex]),i.classList.remove("DVS_full"),i.setAttribute("style",o.styleAttr)):i.parentNode.removeChild(i),this._ok(),e||(this.mainContentList[t]=null),!0},s.prototype.toggleMainContent=function(t){if(!d.default.isString(t))return this._throwErr(l.PARAMETER_TYPE),!1;var e=d.default.id(t);return e?(e.classList.toggle("DVS_nodisplay"),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.showMainContent=function(t){if(!d.default.isString(t))return this._throwErr(l.PARAMETER_TYPE),!1;var e=d.default.id(t);return e?(e.classList.remove("DVS_nodisplay"),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.hideMainContent=function(t){if(!d.default.isString(t))return this._throwErr(l.PARAMETER_TYPE),!1;var e=d.default.id(t);return e?(e.classList.add("DVS_nodisplay"),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.unbindAllMainContent=function(t){void 0===t&&(t=!1);var e=this.mainContentList;for(var i in e)e[i]&&this.unbindMainContent(i,t)},s.prototype.bindAllMainContent=function(){var t=this.mainContentList;for(var e in t){var i=t[e];i&&this.bindMainContent(e,i.sequence,i.isFull)}},s.prototype.showGroup=function(t){var e=d.default.id(t+this.postfix);return e?(e.classList.remove("DVS_disabled"),e.classList.remove("DVS_noDisplay"),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.hideGroup=function(t){var e=d.default.id(t+this.postfix);return e?(e.classList.add("DVS_disabled"),e.classList.add("DVS_noDisplay"),this._ok(),!0):(this._throwErr(l.ELEMENT_NOT_EXIST),!1)},s.prototype.updateVideoContainer=function(t){var e=this,i=d.default.id("videoImage"+this.postfix);return!!i&&(i.src=t,i.onload=function(){e._videoSize&&e._videoSize.imageWidth===i.naturalWidth&&e._videoSize.imageHeight===i.naturalHeight&&e._videoSize.imageBoxWidth===i.clientWidth&&e._videoSize.imageBoxHeight===i.clientHeight||(e._videoSize={imageWidth:i.naturalWidth,imageHeight:i.naturalHeight,imageBoxWidth:i.clientWidth,imageBoxHeight:i.clientHeight},e.updateVideoSize())},!0)},s.prototype.updateVideoSize=function(){if(this._videoSize&&this.showVideoContainer){var t=d.default.id("videoContainer"+this.postfix),e=d.default.id("videoImage"+this.postfix);if(!t||!e)return!1;var i,o=t.clientWidth,n=t.clientHeight,r=this._videoSize,s=r.imageWidth,a=r.imageHeight;o/s-1<n/a-1?(i=o/s,e.style.width=o+"px",e.style.height=a*i+"px"):(i=n/a,e.style.width=s*i+"px",e.style.height=n+"px"),this._videoSize.imageBoxWidth=e.clientWidth,this._videoSize.imageBoxHeight=e.clientHeight}},s);function s(t,e,i){this.showPageNumber=!1,this.showSelectBox=!1,this.showTopMenu=!0,this.topMenuColor="#3a393b",this.showHeader=!0,this.headerColor="#2a292b",this.showSideBar=!1,this.showAside=!0,this.showThumbnail=!0,this.showMain=!0,this.showFooter=!0,this.showControlBox=!1,this.footerColor="#434246",this.showThumbnailControl=!0,this.showVideoContainer=!1,this.fullThumbnail=!1,this.viewerBorderColor="#1b1b1d",this.sidebarWidth=199,this.thumbnailWidth=180,this.width="100%",this.height="100%",this.canvasBackgroundColor="pink",this._tempScrollIndex=null,this.mainContentList={},this.mouseShape="default",this.defaultUiConfig={component:{header:!0,topMenu:!0,asideMenu:!1,bottomMenu:!0},group:{global:{visibility:!0,location:"header",sequence:1,cssStyle:"test"},viewerCorner:{visibility:!0,location:"header",sequence:2},viewMenu:{visibility:!0,location:"topMenu",sequence:1},topMenuRight:{visibility:!0,location:"topMenu",sequence:2},pager:{visibility:!0,location:"bottomMenu",sequence:1},viewChange:{visibility:!0,location:"header",sequence:4}},buttons:{loadImage:{visibility:!0,location:"viewerCorner",iconClass:"DVS_uploadFile",sequence:2,onButtonClick:"onLoadImage",text:"Upload File"},panelChange:{visibility:!0,location:"global",iconClass:"ds-dvs-ui-list",sequence:1,onButtonClick:"onPanelChange"},readDirection:{visibility:!1,location:"global",iconClass:"ds-dvs-ui-readType",sequence:3,onButtonClick:"onReadDirection"},blank1:{visibility:!1,location:"global",sequence:4},flip:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-mirror",sequence:1,onButtonClick:"onFlip"},mirror:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-flip",sequence:2,onButtonClick:"onMirror"},rotate:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-rotateLeft",sequence:3,onButtonClick:"onRotate"},rotateAll:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-rotateAll",sequence:4,onButtonClick:"onRotateAll"},crop:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-crop",sequence:5,onButtonClick:"onCrop"},wipe:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-wipe",sequence:6,onButtonClick:"onWipe"},undo:{visibility:!1,location:"viewMenu",iconClass:"ds-dvs-ui-undo",sequence:7,onButtonClick:"onUndo"},redo:{visibility:!1,location:"viewMenu",iconClass:"ds-dvs-ui-redo",sequence:8,onButtonClick:"onRedo"},zoomIn:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-magnifyImage",sequence:9,onButtonClick:"onZoomIn"},zoomOut:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-shrinkImage",sequence:10,onButtonClick:"onZoomOut"},reset:{visibility:!0,location:"viewMenu",iconClass:"ds-dvs-ui-reset",sequence:11,onButtonClick:"onReset"},remove:{visibility:!0,location:"topMenuRight",iconClass:"ds-dvs-ui-delete menuRight",sequence:1,onButtonClick:"onRemove"},print:{visibility:!1,location:"topMenuRight",iconClass:"ds-dvs-ui-print menuRight",sequence:2,onButtonClick:"onPrint"},save:{visibility:!0,location:"topMenuRight",iconClass:"ds-dvs-ui-save menuRight",sequence:3,onButtonClick:"onSave"},firstPage:{visibility:!0,location:"pager",iconClass:"ds-dvs-ui-pageStart",sequence:1,onButtonClick:"onFirstPage"},previousPage:{visibility:!0,location:"pager",iconClass:"ds-dvs-ui-pagePre",sequence:2,onButtonClick:"onPreviousPage"},pagination:{visibility:!0,location:"pager"},nextPage:{visibility:!0,location:"pager",iconClass:"ds-dvs-ui-pageNext",sequence:4,onButtonClick:"onNextPage"},lastPage:{visibility:!0,location:"pager",iconClass:"ds-dvs-ui-pageEnd",sequence:5,onButtonClick:"onLastPage"},autoFit:{visibility:!0,location:"viewChange",iconClass:"ds-dvs-ui-autoFit",sequence:.5,onButtonClick:"onAutoFit"},fitHeight:{visibility:!0,location:"viewChange",iconClass:"ds-dvs-ui-fitHeight",sequence:1,onButtonClick:"onFitHeight"},fitWidth:{visibility:!0,location:"viewChange",iconClass:"ds-dvs-ui-fitWidth",sequence:2,onButtonClick:"onFitWidth"},fullPage:{visibility:!0,location:"viewChange",iconClass:"ds-dvs-ui-fullWeb",sequence:3,onButtonClick:"onFullPage"},fullScreen:{visibility:!0,location:"viewChange",iconClass:"ds-dvs-ui-fullDevice",sequence:4,onButtonClick:"onFullScreen"}},tipsConfig:{loadImage:"loadImage",panelChange:"panelChange",readDirection:"readDirection",flip:"flip",mirror:"mirror",rotate:"rotate",rotateAll:"rotateAll",crop:"crop",wipe:"wipe",undo:"undo",redo:"redo",zoomIn:"zoomIn",zoomOut:"zoomOut",reset:"reset",remove:"remove",print:"print",save:"save",firstPage:"firstPage",previousPage:"previousPage",pagination:"pagination",nextPage:"nextPage",lastPage:"lastPage",autoFit:"fitWindow",fitHeight:"fitHeight",fitWidth:"fitWidth",fullPage:"fullPage",fullScreen:"fullScreen"},content:{visibility:!0,besides:{visibility:!0,sequence:1},viewPort:{visibility:!0,sequence:2},allImage:{visibility:!0,displayName:"All Images"}},thumbnail:{visibility:!0,iconClass:"ds-dvs-ui-thumbnail",selectedBorderColor:"rgba(255, 0, 0, 1)",selectedBackgroundColor:"rgba(127, 133, 251, 1)",imageBackgroundColor:"rgba(0,0,0,0)",imageBorderColor:"rgba(128, 128, 128, 1)",hoverBackgroundColor:"rgba(196, 250, 248, 1)",hoverBorderColor:"rgba(255, 255, 0, 1)",placeholderBackgroundColor:"rgba(255, 192, 203, 1)",backgroundColor:"rgba(67, 66, 70, 1)",thumbnailBorderColor:"rgba(27, 27, 29, 1)",imageSpace:10,showPageNumber:!1,showThumbnailControl:!0,mouseShape:"pointer",direction:"row",imageDirection:"row",sequence:0},tree:{visibility:!0,iconClass:"ds-dvs-ui-tree",selectedColor:"#0000ff",goToThumbnail:!0},tag:{visibility:!0,iconClass:"ds-dvs-ui-tags",selectedColor:"#0000ff",goToThumbnail:!0,displayMode:""},cropStyle:{ratios:[[1,1],[3,2],[4,3],[5,4],[7,5],[16,9]],cropMask:!1,cropBar:!0},buttonResize:{ifResize:!1,maxSize:26,minSize:14},skinColor:{headerBgColor:"#2a292b",topMenuBackground:"#3a393b",asideBackground:"#ffffff",canvasBackground:"rgba(67,66,70,1)",bottomMenuBackground:"#434246"},presetMode:"basic",theme:"basic"};Window;this.postfix=t,this._pubSub=i,this.buttonList=[],this.groupList=[],this.templateObj={},this.uiConfig=d.default.deepClone(this.defaultUiConfig),e&&d.default.mergeJSON(e,this.uiConfig)}e.Viewer=r},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=i(38),s=i(6),a=i(40),c=i(41),v=o(i(0)),l=o(i(1)),h=i(42),u=l.default.errorMessages,d=(p.prototype._cropCallback=function(t){this.cropPoint=t,this._freeCropRender(this.cropPoint)},p.prototype._freeCropRender=function(t){if(!this._crop.isCrop)return!1;for(var e=t.slice(0,8),i=this._crop.dashLine,o=this._crop._firstPointColor,n=this._crop._lineColor,r=this._crop.lineWidth,s=this.convertPointFromImageToDraw(e.slice(0,8)),a=0;a<4;a++)s[2*a]-=this.moveLeft/this.originZoomX/this._zoom,s[2*a+1]-=this.moveTop/this.originZoomY/this._zoom;var l=this.calcMidpoint(s),h=this._canvas.upperContext;this.clearUpperCanvas();var c=1/this.originZoomX/this._zoom;for(h.save(),this._editorStack.setTransform(this._canvas.upperContext),h.scale(this._zoom*this.originZoomX,this._zoom*this.originZoomY),h.save(),h.setLineDash([i[0]*c,i[1]*c]),h.strokeStyle=n,h.lineWidth=r*c,h.beginPath(),h.moveTo(s[0],s[1]),h.lineTo(s[2],s[3]),h.lineTo(s[4],s[5]),h.lineTo(s[6],s[7]),h.closePath(),h.stroke(),h.restore(),h.save(),h.lineWidth=r*c,h.fillStyle=this.pointFillColor,a=0;a<4;a++)h.strokeStyle=0===a?o:n,h.beginPath(),h.rect(s[2*a]-this.probePiontRadius*c,s[2*a+1]-this.probePiontRadius*c,2*this.probePiontRadius*c,2*this.probePiontRadius*c),h.closePath(),h.stroke(),h.fill();for(a=0;a<4;a++)h.strokeStyle=n,h.beginPath(),h.rect(l[2*a]-this.probePiontRadius*c,l[2*a+1]-this.probePiontRadius*c,2*this.probePiontRadius*c,2*this.probePiontRadius*c),h.closePath(),h.stroke(),h.fill();h.restore(),h.restore()},p.prototype._initCrop=function(t){this._crop=new h.Crop({transformStack:t}),this._crop.bindCallback(this._cropCallback.bind(this)),this._crop.setValidAreaSize(this.canvasCssWidth,this.canvasCssHeight),this._tempImage?this._crop.setImageSize(this._tempImage.naturalWidth,this._tempImage.naturalHeight):this._crop.setImageSize(0,0)},p.prototype._checkColor=function(t){return v.default.isString(t)&&!!(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/.test(t)||/^[rR][gG][Bb][Aa]?[\(]([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}[\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?[\s]*(0\.\d{1,2}|1|0)?[\)]{1}$/g.test(t)||/^url\(.*\)$/g.test(t))||(this._throwError(u.PARAMETER_TYPE),!1)},p.prototype.onSetOperationMode=function(t){this.isClickToZoom=2===t,this.isFreeCrop=3===t},p.prototype._initTransformStack=function(){this._editorStack=new s.Transform2d},p.prototype._initCanvas=function(){var e=this;this.tempCanvas=new a.CanvasCache,this.tempCanvas1=new a.CanvasCache,this._canvas=new r.Canvas({canvasCssWidth:this.canvasCssWidth,canvasCssHeight:this.canvasCssHeight,devicePixelRatio:this.devicePixelRatio,backgroundColor:this.backgroundColor,scaleCoefficient:this.scaleCoefficient}),this._canvas.lowerContext.scale(this.devicePixelRatio,this.devicePixelRatio),this._canvas.upperContext.scale(this.devicePixelRatio,this.devicePixelRatio),this._getCanvasInnerSize();var t=this._canvas.upperCanvas;t.addEventListener("click",function(t){clearTimeout(e._clickEventTimer),e._clickEventTimer?(e.emit("doubleClick",t),e._clickEventTimer=null,v.default.preventDefault(t)):(e._clickEventTimer=setTimeout(function(){e._clickEventTimer=null},500),e.emit("click",t))},!1),t.addEventListener("mousedown",function(t){2===t.button&&(e._rightClickFlag=!0)},!1),t.addEventListener("mousemove",function(t){e.emit("move",t)},!1),t.addEventListener("mouseup",function(t){return 2===t.button&&(e._rightClickFlag&&e.emit("rightClick",t),void(e._rightClickFlag=!1))},!1),t.addEventListener("touchstart",function(t){e._longpressTimer=setTimeout(function(){e.emit("rightClick",t)},500)},!1),t.addEventListener("touchmove",function(t){e.emit("move",t),clearTimeout(e._longpressTimer),t.preventDefault()},{passive:!1}),t.addEventListener("touchend",function(t){clearTimeout(e._longpressTimer)},!1),this.emit("initCanvas")},p.prototype.resetScroller=function(){this._renderImage&&this.calcNewScrollArea(this._renderImage),this.keepZoom||this.zoomTo(1,!1),this.scrollTo(this._maxScrollLeft/2,this._maxScrollTop/2,!1)},p.prototype.resetScroller4FitType=function(){this._tempImage&&(this._calScrollerArea(0,0),this.calcNewScrollArea(this._tempImage),this.zoomTo(1,!1),this.isZoom=!1,this.scrollTo(this._maxScrollLeft/2,this._maxScrollTop/2,!1))},p.prototype._initScroller=function(t){if(t)for(var e=Object.keys(t),i=0,o=e.length;i<o;i++)this[e[i]]=t[e[i]];this.setValidArea(this.canvasCssWidth,this.canvasCssHeight,this.canvasCssWidth,this.canvasCssHeight),this._initScrollerPosition(),this._bindScrollerEvent(),this._bindFreeCropEvent()},p.prototype._initScrollerPosition=function(){var t=this.getUpperCanvasElement();if(!t)return!1;var e={left:0,top:0,right:0,bottom:0,width:0,height:0};try{e=t.getBoundingClientRect()}catch(t){}this.setPosition(e.left+window.pageXOffset+t.clientLeft,e.top+window.pageYOffset+t.clientTop)},p.prototype._initAnimation=function(){this._time=Date.now||function(){return+new Date},this._fps=60,this._running={},this._counter=1},p.prototype.render=function(t){var o,n,r,e=this,i=this._imgArr;if(0===i.length)return this.clearCanvas(),void(this._renderImage=null);null==t||t>=i.length||(o=i[t].url,(n=i[t].uid)===this.toBeRenderUid&&(this.curImageUid=n,r=new Image,this._renderUid===n&&this._renderUrl===o&&null!==this._renderUrl&&null!==this._renderImage?(r=this._renderImage,this._render(r,!1),this.emit("_onSendCropLimitArea")):(this._renderImage=null,(this._renderImage=r).src=o,r.onload=function(){var i=this;this.toBeRenderUid===n&&(this.resetScroller(),clearTimeout(this._renderTimer),this._renderTimer=setTimeout(function(){var t,e;i._renderUid!==n&&i._renderUrl!==o&&(i.cropAndEraseNum=0),i._renderUid===n&&i._renderUrl===o||(i._renderUrl=o,i._renderUid=n,t=i.isZoom,e=i._zoom,i.emit("resetTransform"),i.keepZoom&&t&&(i.isZoom=!0,i._zoom=e)),i._render(r,!0),i.emit("_onSendCropLimitArea")},0))}.bind(this),r.onerror=function(){e._renderUrl=null,e.clearCanvas(),e.emit("dvs_error",l.default.errorMessages.IMG_LOAD_FAILED)})))},p.prototype.calcNewScrollArea=function(t){var e,i,o,n,r;null!==t&&(this._tempImage={naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight},this._crop.setImageSize(t.naturalWidth,t.naturalHeight),this.calcWidth=t.naturalWidth,this.calcHeight=t.naturalHeight,this._canvas.clearCanvas(-this.canvasInnerWidth*this.devicePixelRatio,-this.canvasInnerHeight*this.devicePixelRatio,this.canvasInnerWidth*this.devicePixelRatio*2,this.canvasInnerHeight*this.devicePixelRatio*2),e=this._editorStack.rectangleRotate(0,0,t.naturalWidth,t.naturalHeight,this._editorStack.totalAngle),i=this._calPosition(e.width,e.height,this.lastFitType),this.fitZoom=i,this.newRect=e,this.isZoom||(this.originZoomX=i.zoomX||1,this.originZoomY=i.zoomY||1),this.isZoom&&null===this._firstZoomAngle&&(this._firstZoomAngle=this._editorStack.totalAngle),o=this.newRect.width*this.originZoomX*this._zoom,n=this.newRect.height*this.originZoomY*this._zoom,o>this.canvasCssWidth&&n>this.canvasCssHeight?this.isScrollerBar=!0:this.isScrollerBar=!1,this.isScrollerBar&&(r=this._editorStack.rectangleRotate(0,0,t.naturalWidth,t.naturalHeight,this._firstZoomAngle),this._calPosition(r.width,r.height,this.lastFitType),this.originZoomX=i.zoomX||1,this.originZoomY=i.zoomY||1),this._calScrollerArea(e.width*this.originZoomX,e.height*this.originZoomY))},p.prototype._render=function(t,e){this.calcNewScrollArea(t),this.emit("isImageRendered",!0);var i=this._editorStack.calcTranslateDis(this.scrollLeft-this._maxScrollLeft/2,this.scrollTop-this._maxScrollTop/2),o=this._canvas.lowerContext,n=this._zoom*this.originZoomX,r=this._zoom*this.originZoomY;return this.moveLeft=i.x,this.moveTop=i.y,o.save(),this._editorStack.setTransform(this._canvas.lowerContext),o.scale(n,r),o.imageSmoothingEnabled=!1,this._canvas.render(t,0,0,t.naturalWidth,t.naturalHeight,-i.x/this.originZoomX/this._zoom-t.naturalWidth/2,-i.y/this.originZoomY/this._zoom-t.naturalHeight/2,t.naturalWidth,t.naturalHeight),o.restore(),this._crop.setZoom(this._zoom*this.originZoomX,this._zoom*this.originZoomY),this.isFreeCrop&&this.freeCropRender(this.probePoints),this._crop.isCrop&&this._freeCropRender(this.cropPoint),!0},p.prototype.transformToCenterCoordinate=function(t,e){return{x:t-=this.newRect.width/2,y:e-=this.newRect.height/2}},p.prototype.transformToLeftTopCoordinate=function(t,e){return{x:t+=this._tempImage.naturalWidth/2,y:e+=this._tempImage.naturalHeight/2}},p.prototype.setCropRect=function(t,e,i,o){if(!this.isNormalCrop)return!1;for(var n=[t,e,t+i,e,t+i,e+o,t,e+o],r=0;r<4;r++){var s=this.transformToCenterCoordinate(n[2*r],n[2*r+1]);n[2*r]=s.x,n[2*r+1]=s.y}},p.prototype.setFreeCropBox=function(t){if(!this.isFreeCrop)return!1;if(!this._tempImage)return!1;if(!v.default.isArray(t)||8!==t.length)return!1;if(!this.checkRectConvexity(t))return!1;for(var e=0;e<4;e++){var i=this.transformToCenterCoordinate(t[2*e],t[2*e+1]);t[2*e]=i.x,t[2*e+1]=i.y}return this.cropVertexes=t.slice(),this.cropMidpoints=this.calcMidpoint(t).slice(),this.probePoints=this.cropVertexes.slice().concat(this.cropMidpoints.slice()),this.slopRatio=this.getSlopRatio(this.probePoints).slice(0,4),this.freeCropRender(this.probePoints),!0},p.prototype.getFreeCropBox=function(){for(var t=this.probePoints.slice(0,8),e=0;e<4;e++){var i=this.transformToLeftTopCoordinate(t[2*e],t[2*e+1]);t[2*e]=i.x,t[2*e+1]=i.y}return t},p.prototype.calcMidpoint=function(t){for(var e=t.slice(0,8).concat(t[0],t[1]),i=[],o=0;o<4;o++){var n=(e[2*o]+e[2*o+2])/2,r=(e[2*o+1]+e[2*o+3])/2;i.push(n,r)}return i},p.prototype.checkRectConvexity=function(t){var e=(t[6]-t[0])*(t[3]-t[1])-(t[7]-t[1])*(t[2]-t[0]),i=(t[0]-t[2])*(t[5]-t[3])-(t[1]-t[3])*(t[4]-t[2]),o=(t[2]-t[4])*(t[7]-t[5])-(t[3]-t[5])*(t[6]-t[4]),n=(t[4]-t[6])*(t[1]-t[7])-(t[5]-t[7])*(t[0]-t[6]);if(e*i*o*n<0)return!1;var r=t.slice().concat(t.slice(0,2));if(this.slopRatio.length)for(var s=0;s<2;s++)if(this.slopRatio[s]!==this.slopRatio[s+2]&&this.getIntersection(r.slice(2*s,2*s+2),r.slice(2*s+2,2*s+4),r.slice(2*s+4,2*s+6),r.slice(2*s+6,2*s+8)))return!1;return 0<e*i*o*n},p.prototype.checkProbePoint=function(t,e){for(var i=this.sensorRadius*this.devicePixelRatio/this.originZoomX/this._zoom,o=0;o<8;o++){var n=this.probePoints[2*o],r=this.probePoints[2*o+1],s=this._editorStack.totalAngle,a=this._editorStack.pointRotate(t,e,0,0,-s);if(a.x<=n+i&&a.x>=n-i&&a.y<=r+i&&a.y>=r-i)return o}return null},p.prototype.checkImageRange=function(t,e){var i=this._tempImage.naturalWidth,o=this._tempImage.naturalHeight;return-i/2<=t&&t<=i/2&&-o/2<=e&&e<=o/2},p.prototype.convertPointFromImageToDraw=function(t){for(var e=[],i=this._tempImage.naturalWidth,o=this._tempImage.naturalHeight,n=0;n<4;n++){var r=t[2*n]-i/2,s=t[2*n+1]-o/2;e.push(r,s)}return e},p.prototype.freeCropRender=function(t){if(!this.isFreeCrop)return!1;for(var e=t.slice(0,8),i=0;i<4;i++){var o=this.transformToLeftTopCoordinate(e[2*i],e[2*i+1]);e[2*i]=o.x,e[2*i+1]=o.y}for(var n=this.convertPointFromImageToDraw(e.slice(0,8)),i=0;i<4;i++)n[2*i]-=this.moveLeft/this.originZoomX/this._zoom,n[2*i+1]-=this.moveTop/this.originZoomY/this._zoom;var r=this.calcMidpoint(n),s=this._canvas.upperContext;this.clearUpperCanvas();var a=1/this.originZoomX/this._zoom;for(s.save(),this._editorStack.setTransform(this._canvas.upperContext),s.scale(this._zoom*this.originZoomX,this._zoom*this.originZoomY),s.save(),s.setLineDash([this.cropDashLine[0]*a,this.cropDashLine[1]*a]),s.strokeStyle=this._cropLineColor,s.lineWidth=this.cropLineWidth*a,s.beginPath(),s.moveTo(n[0],n[1]),s.lineTo(n[2],n[3]),s.lineTo(n[4],n[5]),s.lineTo(n[6],n[7]),s.closePath(),s.stroke(),s.restore(),s.save(),s.lineWidth=this.cropLineWidth*a,s.fillStyle=this.pointFillColor,i=0;i<4;i++)s.strokeStyle=0===i?this._firstPointColor:this._cropLineColor,s.beginPath(),s.rect(n[2*i]-this.probePiontRadius*a,n[2*i+1]-this.probePiontRadius*a,2*this.probePiontRadius*a,2*this.probePiontRadius*a),s.closePath(),s.stroke(),s.fill();for(i=0;i<4;i++)s.strokeStyle=this._cropLineColor,s.beginPath(),s.rect(r[2*i]-this.probePiontRadius*a,r[2*i+1]-this.probePiontRadius*a,2*this.probePiontRadius*a,2*this.probePiontRadius*a),s.closePath(),s.stroke(),s.fill();s.restore(),s.restore()},p.prototype.getPointToImage=function(t,e){return{x:t=(t-(this.canvasCssWidth/2-this.newRect.width*this.originZoomX*this._zoom/2-(this.scrollLeft-this._maxScrollLeft/2)))/this._zoom/this.originZoomX,y:e=(e-(this.canvasCssHeight/2-this.newRect.height*this.originZoomY*this._zoom/2-(this.scrollTop-this._maxScrollTop/2)))/this._zoom/this.originZoomY}},p.prototype.getPointToCanvas=function(t,e){return{x:t=t*this.originZoomX*this._zoom-this.scrollLeft,y:e=e*this.originZoomY*this._zoom-this.scrollTop}},p.prototype.getSlopRatio=function(t){for(var e=[],i=null,o=t.slice(0,8).concat(t[0],t[1]),n=0;n<4;n++)i=o[2*n+3]-o[2*n+1]==0&&o[2*n+2]-o[2*n]==0?0:(o[2*n+3]-o[2*n+1])/(o[2*n+2]-o[2*n]),e.push(i);return e},p.prototype._bindFreeCropEvent=function(){var i=this,t=this.getUpperCanvasElement();"ontouchstart"in window?(t.addEventListener("touchstart",function(t){var e=i._canvas.upperCanvas.getBoundingClientRect();i._crop.canvasLeft=e.left,i._crop.canvasTop=e.top,i._onMousedownHandler(t)},!1),document.addEventListener("touchmove",function(t){i._onMousemoveHandler(t)},!1),document.addEventListener("touchend",function(t){i._onMouseupHandler(t)},!1)):(t.addEventListener("mousedown",function(t){var e=i._canvas.upperCanvas.getBoundingClientRect();i._crop.canvasLeft=e.left,i._crop.canvasTop=e.top,i._onMousedownHandler(t)},!1),document.addEventListener("mousemove",function(t){i._onMousemoveHandler(t)},!1),document.addEventListener("mouseup",function(t){i._onMouseupHandler(t)},!1))},p.prototype._onMousedownHandler=function(t){if(this.isFreeCrop){var e=this._canvas.upperCanvas.getBoundingClientRect();this.canvasLeft=e.left,this.canvasTop=e.top;var i=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,o=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY;this._freeCropStartX=i-e.left,this._freeCropStartY=o-e.top;var n=this.getPointToImage(this._freeCropStartX,this._freeCropStartY),n=this.transformToCenterCoordinate(n.x,n.y),r=this.checkProbePoint(n.x,n.y);if(null===r)return this.isPointSelected=!1,void(this.activeProbePoint=null);this.isPointSelected=!0,this.activeProbePoint=r}},p.prototype._onMousemoveHandler=function(t){if(this.isPointSelected&&null!==this.activeProbePoint){var e,i,o,n,r,s,a,l,h,c,u,d=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,p=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,f=d-this.canvasLeft,g=p-this.canvasTop,m=this.activeProbePoint,_=this.getPointToImage(f,g),_=this.transformToCenterCoordinate(_.x,_.y),v=this._editorStack.totalAngle,y=(_=this._editorStack.pointRotate(_.x,_.y,0,0,-v)).x,b=_.y,C=this.probePoints.slice();m<4?(C[2*m]=y,C[2*m+1]=b,e=this._tempImage.naturalWidth,i=this._tempImage.naturalHeight,C[2*m]<-e/2?C[2*m]=-e/2:C[2*m]>e/2?C[2*m]=e/2:C[2*m+1]<-i/2?C[2*m+1]=-i/2:C[2*m+1]>i/2&&(C[2*m+1]=i/2),this.slopRatio=this.getSlopRatio(this.probePoints).slice(0,4)):(w=m-4,r=-(n=b-(o=this.slopRatio[w%4])*y)/o,a=-(s=C[(2*w+9)%8]-o*C[(2*w+8)%8])/o,l=this.slopRatio[(w+1)%4],h=C[(2*w+3)%8]-l*C[(2*w+2)%8],c=this.slopRatio[(w+3)%4],u=C[(2*w+1)%8]-c*C[(2*w+0)%8],0===o?(C[(2*w+3)%8]=b,l!==1/0&&l!==-1/0&&(C[(2*w+2)%8]=(b-h)/l),C[(2*w+1)%8]=b,c!==1/0&&c!==-1/0&&(C[(2*w+0)%8]=(b-u)/c)):o===1/0||o===-1/0?(C[(2*w+2)%8]=y,C[(2*w+3)%8]=l*y+h,C[(2*w+0)%8]=y,C[(2*w+1)%8]=c*y+u):(0===l?C[(2*w+2)%8]+=r-a:l===1/0||l===-1/0?C[(2*w+3)%8]+=n-s:(C[(2*w+2)%8]=(h-n)/(o-l),C[(2*w+3)%8]=(l*n-o*h)/(l-o)),0===c?C[(2*w+0)%8]+=r-a:c===1/0||c===-1/0?C[(2*w+1)%8]+=n-s:(C[(2*w+0)%8]=(u-n)/(o-c),C[(2*w+1)%8]=(c*n-o*u)/(c-o))));for(var T=!1,w=0;w<4;w++)if(!this.checkImageRange(C[2*w],C[2*w+1])){T=!0;break}T||(this.probePoints=C.slice()),this.checkRectConvexity(this.probePoints)?(this._cropLineColor=this.defaultCropLineColor,this._firstPointColor=this.defaultFirstPointColor):(this._cropLineColor=this.invalidCropLineColor,this._firstPointColor=this.invalidFirstPointColor);var x=this.calcMidpoint(this.probePoints);this.probePoints=this.probePoints.slice(0,8).concat(x),this.freeCropRender(this.probePoints)}},p.prototype._onMouseupHandler=function(t){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,o=e-this.canvasLeft,n=i-this.canvasTop,r=this._freeCropStartX,s=this._freeCropStartY;if(this._freeCropStartX=0,this._freeCropStartY=0,this._cropLineColor=this.defaultCropLineColor,this._firstPointColor=this.defaultFirstPointColor,this.isPointSelected&&null!==this.activeProbePoint){this.activeProbePoint=null,this.isPointSelected=!1;var a=this.checkRectConvexity(this.probePoints);if(r===o&&s===n||!a)return this.freeCropRender(this.cropVertexes),this.probePoints=this.cropVertexes.slice().concat(this.cropMidpoints),void(this.slopRatio=this.getSlopRatio(this.probePoints).slice(0,4));this.cropVertexes=this.probePoints.slice(0,8),this.cropMidpoints=this.probePoints.slice(8,16),this.freeCropRender(this.cropVertexes)}},p.prototype.tempCanvasRender=function(t){var e=this._editorStack.rectangleRotate(0,0,t.naturalWidth,t.naturalHeight,this._editorStack.totalAngle);this.tempCanvas.setCanvasSize(e.width,e.height);var i=this.tempCanvas.context;i.clearRect(0,0,e.width,e.height),i.save(),i.transform(1,0,0,1,e.width/2,e.height/2),this._editorStack.setTransform(i),i.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,-t.naturalWidth/2,-t.naturalHeight/2,t.naturalWidth,t.naturalHeight),i.restore()},p.prototype.tempCanvasCrop=function(t,e,i,o){var n=this,r=this.tempCanvas.context,s=this.tempCanvas1.context;this.tempCanvas1.setCanvasSize(i,o),s.drawImage(r.canvas,t,e,i,o,0,0,i,o);var a=this.curImageUid;(s.canvas.toBlob||s.canvas.msToBlob).call(s.canvas,function(t){var e=!1;1<n.cropAndEraseNum&&(e=!0),n.emit("_onUpdateImage",a,{originalData:t,minData:t},e),n.emit("_onUpdateMetaData",i,o)},"image/jpeg",1),this.tempCanvas.setCanvasSize(),this.tempCanvas1.setCanvasSize()},p.prototype.changeMouseShape=function(t){this.mouseShape=t,this._canvas.setMouseShape(t),this.mouseShape=t},p.prototype.setCanvasBackgroundColor=function(t){if(v.default.isColor(t))return this.backgroundColor=t,this._canvas.setBackgroundColor(t)},p.prototype.clearCanvas=function(){this._canvas.clearCanvas(-this.canvasInnerWidth,-this.canvasInnerHeight,2*this.canvasInnerWidth,2*this.canvasInnerHeight)},p.prototype.clearUpperCanvas=function(){this._canvas.clearUpperCanvas(-this.canvasInnerWidth,-this.canvasInnerHeight,2*this.canvasInnerWidth,2*this.canvasInnerHeight)},p.prototype.getCanvas=function(){return this._canvas},p.prototype.getLowerCanvasElement=function(){return this._canvas.lowerCanvas},p.prototype.getUpperCanvasElement=function(){return this._canvas.upperCanvas},p.prototype._initDevicePixelRatio=function(){this.devicePixelRatio=v.default.devicePixelRatio()||1},p.prototype.zoomIn=function(){if("stretch"===this.fitType)return!1;this.isZoom=!0;var t=this.zoom;return(t*=this.zoomInDelta)>this.minZoom&&t<this.maxZoom&&(this.zoomTo(t,!1),this.emit("render")),this.emit("_onClearCropBoxes"),!0},p.prototype.zoomOut=function(t,e){if("stretch"===this.fitType)return!1;this.isZoom=!0;var i=this.zoom;return(i/=this.zoomOutDelta)>this.minZoom&&i<this.maxZoom&&(this.zoomTo(i,!1),this.emit("render",!0)),this.emit("_onClearCropBoxes"),!0},p.prototype.flip=function(t){t=void 0===t?0:t;var e=this._canvas.lowerContext;return this._editorStack.flip(t),this.clearCanvas(),e.save(),this.emit("render"),e.restore(),!0},p.prototype.rotate=function(t,e){var i=this._canvas.lowerContext;return this._editorStack.rotate(t),this._editorStack.getLatestResult(),this.clearCanvas(),i.save(),this.emit("_onCanvasZoom",this._getCropLimitAreaForScroll()),this.emit("render"),i.restore(),!0},p.prototype.crop=function(t,e,i,o){return this.cropAndEraseNum+=1,this.tempCanvasRender(this._renderImage),this.tempCanvasCrop(t,e,i,o),this.emit("resetTransform"),!0},p.prototype.erase=function(t,e,i,o,n){var r=this;this.cropAndEraseNum+=1,this.tempCanvasRender(this._renderImage);var s=this.tempCanvas.context;s.save(),s.fillStyle=n,s.clearRect(t,e,i,o),s.fillRect(t,e,i,o),s.restore();var a=this.curImageUid;return s.canvas.toBlob(function(t){var e={originalData:t,minData:t},i=!1;1<r.cropAndEraseNum&&(i=!0),r.emit("_onUpdateImage",a,e,i)},"image/jpeg",1),this.tempCanvas.setCanvasSize(),this.emit("resetTransform"),!0},p.prototype.saveTransformResult=function(){var e=this;if(!this._renderImage)return!0;this.tempCanvasRender(this._renderImage);var i=this._editorStack.rectangleRotate(0,0,this._renderImage.naturalWidth,this._renderImage.naturalHeight,this._editorStack.totalAngle);this._renderImage=null,this.cropAndEraseNum=0;var o=this.curImageUid;return this.tempCanvas.canvas.toBlob(function(t){e.emit("_onUpdateImage",o,{originalData:t,minData:t},!0),e.emit("_onUpdateMetaData",i.width,i.height)},"image/jpeg",1),this.tempCanvas.setCanvasSize(),this.emit("resetTransform"),!0},p.prototype._getImageRelArea=function(t,e,i,o){return{x:t=(t-(this.canvasCssWidth/2-this.newRect.width*this.originZoomX*this._zoom/2-(this.scrollLeft-this._maxScrollLeft/2)))/this._zoom/this.originZoomX,y:e=(e-(this.canvasCssHeight/2-this.newRect.height*this.originZoomY*this._zoom/2-(this.scrollTop-this._maxScrollTop/2)))/this._zoom/this.originZoomY,width:i=i/this._zoom/this.originZoomX,height:o=o/this._zoom/this.originZoomY}},p.prototype.getCropAreaRelativeToImage=function(t,e,i,o){return!!this._tempImage&&{x:t=t*this.originZoomX*this._zoom-this.scrollLeft,y:e=e*this.originZoomY*this._zoom-this.scrollTop,width:i=i*this.originZoomX*this._zoom,height:o=o*this.originZoomY*this._zoom}},p.prototype.setZoom=function(t){if(this.isZoom=!0,"stretch"===this.fitType)return!1;t>this._maxZoom&&(t=this._maxZoom),t<this._minZoom&&(t=this._minZoom),this.useRelativeZoom||(t/=this.originZoomX),this.zoomTo(t,!1),this.emit("render"),this.emit("_onClearCropBoxes")},p.prototype.setMinZoom=function(t){this._minZoom=t},p.prototype.getMinZoom=function(){return this._minZoom},p.prototype.setMaxZoom=function(t){this._maxZoom=t},p.prototype.getMaxZoom=function(){return this._maxZoom},Object.defineProperty(p.prototype,"minZoom",{get:function(){return this._minZoom},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"maxZoom",{get:function(){return this._maxZoom},enumerable:!0,configurable:!0}),p.prototype.setFitType=function(t){-1!==["window","width","height","stretch","origin","none"].indexOf(t)&&(this.isZoom=!1,"none"!==(this.fitType=t)&&("stretch"!==t&&(this._lastFitType4Stretch=t,this._lastZoom4Stretch=this.zoom),this.lastFitType=t))},p.prototype.stretchImage=function(){this._startX=0,this._startY=0,this._drawWidth=this.canvasInnerWidth,this._drawHeight=this.canvasInnerHeight,this._isStretch=!0,this.emit("render")},p.prototype._getCropLimitAreaForScroll=function(){var t=this.newRect;return{x:this.scrollLeft,y:this.scrollTop,width:t.width*this.originZoomX*this._zoom,height:t.height*this.originZoomY*this._zoom}},p.prototype._getCropLimitAreaForCrop=function(){var t=this.newRect.width*this.originZoomX*this._zoom,e=this.newRect.height*this.originZoomY*this._zoom,i=(this.canvasCssWidth-t)/2,o=(this.canvasCssHeight-e)/2;return{x:(i-=this.scrollLeft-this._maxScrollLeft/2)<0?0:i,y:(o-=this.scrollTop-this._maxScrollTop/2)<0?0:o,width:t>this.canvasCssWidth?this.canvasInnerWidth:t,height:e>this.canvasCssHeight?this.canvasInnerHeight:e}},p.prototype.setSelectionRectAspectRatio=function(t){v.default.isNumber(t)&&0<t&&(this.selectionRectAspectRatio=t)},p.prototype._calFitWidth=function(t,e){var i=1;return{zoomX:(i=t<=this.canvasCssWidth?1:this.canvasCssWidth/t)||1,zoomY:i||1}},p.prototype._calFitHeight=function(t,e){var i=1;return{zoomX:(i=e<=this.canvasCssHeight?1:this.canvasCssHeight/e)||1,zoomY:i||1}},p.prototype._calFitWindow=function(t,e){return t<=this.canvasCssWidth&&e<=this.canvasCssHeight||t>this.canvasCssWidth&&e<=this.canvasCssHeight||!(t<=this.canvasCssWidth&&e>this.canvasCssHeight)&&t/this.canvasCssWidth>=e/this.canvasCssHeight?this._calFitWidth(t,e):this._calFitHeight(t,e)},p.prototype._calFitStretch=function(t,e){return{zoomX:this.canvasCssWidth/t||1,zoomY:this.canvasCssHeight/e||1}},p.prototype._calFitOrigin=function(t,e){return{zoomX:1,zoomY:1}},p.prototype._calPosition=function(t,e,i){this._getCanvasInnerSize();var o=null;if("width"===i)o=this._calFitWidth(t,e);else if("height"===i)o=this._calFitHeight(t,e);else if("window"===i)o=this._calFitWindow(t,e);else if("origin"===i)o=this._calFitOrigin(t,e);else{if("stretch"!==i)throw new Error("The fitType is error.");o=this._calFitStretch(t,e)}return this.realZoom=o.zoomX,o},p.prototype._calStartPoint=function(){var t=this.zoom;return{startX:this._drawWidth*t<this.canvasInnerWidth?(this.canvasInnerWidth-this._drawWidth*t)/2:0,startY:this._drawHeight*t<this.canvasInnerHeight?(this.canvasInnerHeight-this._drawHeight*t)/2:0}},p.prototype._calScrollerArea=function(t,e){this._initScrollerPosition(),this.setValidArea(this.canvasCssWidth,this.canvasCssHeight,t,e)},p.prototype.onCanvasResize=function(){document.getElementById(this.containerId)&&(this.setCanvasSize(),this._getCanvasInnerSize(),this._initScrollerPosition(),this._crop.setValidAreaSize(this.canvasCssWidth,this.canvasCssHeight),this._tempImage?this._crop.setImageSize(this._tempImage.naturalWidth,this._tempImage.naturalHeight):this._crop.setImageSize(0,0),this.emit("_onSendCropLimitArea"),this.emit("render"))},p.prototype.setCanvasSize=function(){var t=document.getElementById(this.containerId);this.canvasCssWidth=t.getBoundingClientRect().width,this.canvasCssHeight=t.getBoundingClientRect().height,this._canvas.setCanvasSize(this.canvasCssWidth,this.canvasCssHeight)},p.prototype._getCanvasInnerSize=function(){this.canvasInnerWidth=this._canvas.innerWidth,this.canvasInnerHeight=this._canvas.innerHeight},p.prototype.unbindCanvasContainer=function(){this.isZoom=!1,document.getElementById(this.containerId).addEventListener("touchmove",function(t){t.preventDefault(),t.stopPropagation()});var t=document.getElementById("canvasWrapper"+this._canvasPostfix);t&&(t.removeChild(this._canvas.lowerCanvas),t.removeChild(this._canvas.upperCanvas))},p.prototype.bindCanvasContainer=function(t){if(this.isZoom=!1,t){this.containerId=t;var e=document.getElementById(t);if(e){var i=document.createElement("div");return i.id="canvasWrapper"+this._canvasPostfix,i.appendChild(this._canvas.lowerCanvas),i.appendChild(this._canvas.upperCanvas),e.appendChild(i),this.emit("_onCanvasResize"),!0}return this._throwError(u.ELEMENT_NOT_EXIST),!1}return this._throwError(u.PARAMETER_TYPE),!1},p.prototype._throwError=function(t){this.emit("dvs_error",t)},p.prototype._calDistance=function(t){return Math.sqrt(Math.pow(t[0].pageX-t[1].pageX,2)+Math.pow(t[0].pageY-t[1].pageY,2))},p.prototype._bindScrollerEvent=function(){var e,i=this;"ontouchstart"in window?(this.getUpperCanvasElement().addEventListener("touchstart",function(t){t.touches[0]&&t.touches[0].target&&t.touches[0].target.tagName.match(/input|textarea|select/i)||i.isFreeCrop||(i._pageX=t.pageX,i._pageY=t.pageY,"stretch"!==i.fitType&&(1<t.touches.length&&(i._startDistance=i._calDistance(t.touches)),i._touchStartHandler(t.touches,t.timeStamp)))},!1),document.addEventListener("touchmove",function(t){var e;"stretch"!==i.fitType&&((e=1)<t.touches.length&&(e=i._calDistance(t.touches)/i._startDistance),t.scale&&(e=t.scale),i._touchMoveHandler(t.touches,t.timeStamp,e),i.emit("_onExistImage"),i._existImage&&(i.emit("_onCanvasZoom",i._getCropLimitAreaForScroll()),i.emit("render")))},!1),document.addEventListener("touchend",function(t){var e;i._startDistance=0,"stretch"!==i.fitType&&(i.isClickToZoom&&(e=t.changedTouches[0],i._pageX===e.pageX&&i._pageY===e.pageY&&(i.isZoom=!0,i.zoomTo(i._zoom*i.zoomInDelta,!1,e.pageX-i._outerLeft,e.pageY-i._outerTop),i.emit("render"))),i._toucheEndHandler(t.timeStamp))},!1),document.addEventListener("touchcancel",function(t){i._startDistance=0,"stretch"!==i.fitType&&i._toucheEndHandler(t.timeStamp)},!1)):(e=!1,this.getUpperCanvasElement().addEventListener("mousedown",function(t){t.target.tagName.match(/input|textarea|select/i)||i.isFreeCrop||(i._pageX=t.pageX,i._pageY=t.pageY,"stretch"!==i.fitType&&i._touchStartHandler([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),t.preventDefault(),e=!0)},!1),document.addEventListener("mousemove",function(t){e&&("stretch"!==i.fitType&&(i._touchMoveHandler([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),i.emit("_onExistImage"),i._existImage&&(0===i.scrollLeft&&0===i.scrollTop||i.emit("render"))),t.preventDefault(),e=!0)},!1),document.addEventListener("mouseup",function(t){e&&("stretch"!==i.fitType&&(i.isClickToZoom&&i._pageX===t.pageX&&i._pageY===t.pageY&&(i.isZoom=!0,i.userZoom*=i.zoomInDelta,i.zoomTo(i._zoom*i.zoomInDelta,!1,t.pageX-i._outerLeft,t.pageY-i._outerTop),i.emit("render")),i._toucheEndHandler(t.timeStamp)),t.preventDefault(),e=!1)},!1),this.getUpperCanvasElement().addEventListener("wheel",function(t){i._onWheelHandler(t)},!1))},p.prototype._onWheelHandler=function(t){t.preventDefault();var e=1,i=0,e=t.wheelDelta?t.wheelDelta:-t.deltaY;t.ctrlKey&&"stretch"!==this.fitType?(i=0<e?1.05:.95,this.isZoom=!0,this.userZoom*=i,this._mouseZoomHandler(e,t.timeStamp,t.pageX,t.pageY)):t.shiftKey?(i=e<0?30:-30,this.scrollTo(this._scrollLeft+i,this._scrollTop,!1)):(i=e<0?30:-30,this.scrollTo(this._scrollLeft,this._scrollTop+i,!1)),this.emit("render")},p.prototype.on=function(t,e){this._pubSub.on(t,e)},p.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},p.prototype.off=function(t,e){this._pubSub.off(t,e)},p.prototype.setValidArea=function(t,e,i,o){t===+t&&(this._outerWidth=t),e===+e&&(this._outerHeight=e),i===+i&&(this._innerWidth=i),o===+o&&(this._innerHeight=o),this._calMaxScroll()},p.prototype.setPosition=function(t,e){this._outerLeft=t||0,this._outerTop=e||0},p.prototype.getValues=function(){return{left:this._scrollLeft,top:this._scrollTop,zoom:this._zoom}},p.prototype.getScrollMax=function(){return{left:this._maxScrollLeft,top:this._maxScrollTop}},p.prototype.zoomTo=function(t,e,i,o,n){if(!v.default.isNumber(t))return this._throwError(u.PARAMETER_TYPE),!1;if(t<=0)return this._throwError(u.PARAMETER_RANGE),!1;if(!this.zooming)throw new Error("Zooming is not enabled!");this.isZoom=!0,n&&(this._zoomComplete=n),this._isDecelerating&&(this._stop(this._isDecelerating),this._isDecelerating=!1);var r=this._zoom;null==i&&(i=this._outerWidth/2),null==o&&(o=this._outerHeight/2),t=Math.max(Math.min(t,this.maxZoom),this.minZoom),this._calMaxScroll(t);var s=(i+this._scrollLeft)*t/r-i,a=(o+this._scrollTop)*t/r-o;return s>this._maxScrollLeft?s=this._maxScrollLeft:s<0&&(s=0),a>this._maxScrollTop?a=this._maxScrollTop:a<0&&(a=0),this._innerWidth*r<this._outerWidth&&(s=this._maxScrollLeft/2),this._innerHeight*r<this._outerHeight&&(a=this._maxScrollTop/2),this._publish(s,a,t,e),this.emit("_onCanvasZoom",this._getCropLimitAreaForScroll()),!0},p.prototype.zoomBy=function(t,e,i,o,n){this.zoomTo(this._zoom*t,e,i,o,n)},p.prototype.scrollTo=function(t,e,i,o){this._isDecelerating&&(this._stop(this._isDecelerating),this._isDecelerating=!1),null!=o&&o!==this._zoom?this.zooming&&(t*=o,e*=o,this._calMaxScroll(o)):o=this._zoom,this.scrollingX||(t=this._scrollLeft),this.scrollingY||(e=this._scrollTop),t=Math.max(Math.min(this._maxScrollLeft,t),0),e=Math.max(Math.min(this._maxScrollTop,e),0),t===this._scrollLeft&&e===this._scrollTop&&(i=!1),this._isProcessing||(this._publish(t,e,o,i),this.emit("_onExistImage"),this._existImage&&this.emit("_onCanvasZoom",this._getCropLimitAreaForScroll()))},p.prototype.scrollBy=function(t,e,i){var o=this._isAnimating?this._scheduledLeft:this._scrollLeft,n=this._isAnimating?this._scheduledTop:this._scrollTop;this.scrollTo(o+(t||0),n+(e||0),i)},p.prototype._mouseZoomHandler=function(t,e,i,o){var n=0<t?1.05:.95;return this.zoomTo(this._zoom*n,!1,i-this._outerLeft,o-this._outerTop)},p.prototype._touchStartHandler=function(t,e){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var i,o;this._interruptedAnimation=!0,this._isDecelerating&&(this._stop(this._isDecelerating),this._isDecelerating=!1),this._isAnimating&&(this._stop(this._isAnimating),this._isAnimating=!1),this._isSingleTouch=1===t.length,o=this._isSingleTouch?(i=t[0].pageX,t[0].pageY):(i=Math.abs(t[0].pageX+t[1].pageX)/2,Math.abs(t[0].pageY+t[1].pageY)/2),this._initialTouchLeft=i,this._initialTouchTop=o,this._zoomStart=this._zoom,this._lastTouchLeft=i,this._lastTouchTop=o,this._lastTouchMove=e,this._lastTouchStart=e,this._lastZoom=1,this._enableScrollX=!this._isSingleTouch&&this.scrollingX,this._enableScrollY=!this._isSingleTouch&&this.scrollingY,this._isProcessing=!0,this._isDecelerationComplete=!1,this._isDragging=!this._isSingleTouch,this._positions=[]},p.prototype._touchMoveHandler=function(t,e,i){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var o,n,r,s,a,l,h,c,u,d,p,f,g,m,_,v;this._isProcessing&&(n=2===t.length?(o=Math.abs(t[0].pageX+t[1].pageX)/2,Math.abs(t[0].pageY+t[1].pageY)/2):(o=t[0].pageX,t[0].pageY),r=this._positions,this._isDragging?(s=o-this._lastTouchLeft,a=n-this._lastTouchTop,u=this._scrollLeft,d=this._scrollTop,p=this._zoom,null!=i&&this.zooming&&!this._isSliding&&(p=(l=p)/this._lastZoom*i,l!==(p=Math.max(Math.min(p,this.maxZoom),this.minZoom))&&(u=((h=o-this._outerLeft)+u)*p/l-h,d=((c=n-this._outerTop)+d)*p/l-c,this._calMaxScroll(p))),this._enableScrollX&&(u-=s*this.speedDelta,(f=this._maxScrollLeft)<u&&(u=f),u<0&&(u=0)),this._enableScrollY&&(d-=a*this.speedDelta,(g=this._maxScrollTop)<d&&(d=g),d<0&&(d=0)),60<r.length&&r.splice(0,30),r.push(u,d,e),this._publish(u,d,p)):(m=this.locking?3:0,_=Math.abs(o-this._initialTouchLeft),v=Math.abs(n-this._initialTouchTop),this._enableScrollX=this.scrollingX&&m<=_,this._enableScrollY=this.scrollingY&&m<=v,r.push(this._scrollLeft,this._scrollTop,e),this._isDragging=(this._enableScrollX||this._enableScrollY)&&(5<=_||5<=v),this._isDragging&&(this._interruptedAnimation=!1)),this._lastTouchLeft=o,this._lastTouchTop=n,this._lastTouchMove=e,this._lastZoom=i,t.length<=1&&this.ifAllowSlide&&this._zoom<=1&&0===this._maxScrollTop&&0===this._maxScrollLeft&&this._existImage&&(this._slideMove=!0,this._pageChangeMoveHandler()))},p.prototype._toucheEndHandler=function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);if(this._isProcessing){if(this._isProcessing=!1,this._isDragging)if(this._isDragging=!1,this.ifAllowSlide&&this._pageChangeHandler(t),this._isSingleTouch&&this.animating&&t-this._lastTouchMove<=100){for(var e,i,o,n=this._positions,r=n.length-1,s=r,a=r;0<a&&n[a]>this._lastTouchMove-100;a-=3)s=a;s!==r?(e=n[r]-n[s],i=this._scrollLeft-n[s-2],o=this._scrollTop-n[s-1],this._decelerationVelocityX=i/e*(1e3/60),this._decelerationVelocityY=o/e*(1e3/60),1<Math.abs(this._decelerationVelocityX)||1<Math.abs(this._decelerationVelocityY)?this._startDeceleration(t):this.emit("scrollingComplete")):this.emit("scrollingComplete")}else 100<t-this._lastTouchMove&&this.emit("scrollingComplete");this._isDecelerating||((this._interruptedAnimation||this._isDragging)&&this.emit("scrollingComplete"),this.scrollTo(this._scrollLeft,this._scrollTop,!0,this._zoom)),this._positions.length=0}},p.prototype._pageChangeMoveHandler=function(){var t=this._canvas.lowerCanvas.parentNode;if(t&&this._slideMove){var e=this._lastTouchLeft-this._initialTouchLeft;if(Math.abs(e)<=5)return void(this._slideMove=!1);t.style.transform="translate3d("+e+"px,0,0)",this._isSliding=!0}},p.prototype._pageChangeHandler=function(t){if(!this._slideMove)return!1;this._slideMove=!1;var e=this._lastTouchLeft-this._initialTouchLeft,i=Math.abs(e/(t-this._lastTouchStart)*1e3);e>=this._outerWidth/2||0<e&&200<i?this.emit("slideSwitch","left"):(-e>=this._outerWidth/2||e<0&&200<i)&&this.emit("slideSwitch","right");var o=this._canvas.lowerCanvas.parentNode;o&&(o.style.transform="none"),this._isSliding=!1},p.prototype._publish=function(t,e,i,o){var n,r,s,a,l,h,c=this,u=this._isAnimating;u&&(this._stop(u),this._isAnimating=!1),o&&this.animating?(this._scheduledLeft=t,this._scheduledTop=e,this._scheduledZoom=i,n=this._scrollLeft,r=this._scrollTop,s=this._zoom,a=t-n,l=e-r,h=i-s,this._isAnimating=this._start(function(t,e,i){i&&(c._scrollLeft=n+a*t,c._scrollTop=r+l*t,c._zoom=s+h*t,c.emit("publishScrollResult",{left:c.scrollLeft,top:c.scrollTop,zoom:c._zoom}))},function(t){return c._isAnimating===t},function(t,e,i){e===c._isAnimating&&(c._isAnimating=!1),(c._isDecelerationComplete||i)&&c.emit("scrollingComplete"),c.zooming&&(c._calMaxScroll(),c._zoomComplete&&(c._zoomComplete(),c._zoomComplete=null))},this.animationDuration,u?this._easeOutCubic:this._easeInOutCubic)):(this._scheduledLeft=this._scrollLeft=t,this._scheduledTop=this._scrollTop=e,this._scheduledZoom=this._zoom=i,this.emit("publishScrollResult",{left:t,top:e,zoom:i}),this.zooming&&(this._calMaxScroll(),this._zoomComplete&&(this._zoomComplete(),this._zoomComplete=null)))},p.prototype._calMaxScroll=function(t){null==t&&(t=this._zoom),this._maxScrollLeft=Math.max(this._innerWidth*t-this._outerWidth,0),this._maxScrollTop=Math.max(this._innerHeight*t-this._outerHeight,0),this.scrollLeft>this._maxScrollLeft&&(this.scrollLeft=this._maxScrollLeft),this.scrollTop>this._maxScrollTop&&(this.scrollTop=this._maxScrollTop)},p.prototype._startDeceleration=function(t){var o=this;this._minDecelerationScrollLeft=0,this._minDecelerationScrollTop=0,this._maxDecelerationScrollLeft=this._maxScrollLeft,this._maxDecelerationScrollTop=this._maxScrollTop,this._isDecelerating=this._start(function(t,e,i){o._stepThroughDeceleration(i)},function(){return.001<=Math.abs(o._decelerationVelocityX)||.001<=Math.abs(o._decelerationVelocityY)||!(o._isDecelerationComplete=!0)},function(t,e,i){o._isDecelerating=!1,o._isDecelerationComplete&&o.emit("scrollingComplete"),o.scrollTo(o._scrollLeft,o._scrollTop,!1)})},p.prototype._stepThroughDeceleration=function(t){var e=this._scrollLeft+this._decelerationVelocityX,i=this._scrollTop+this._decelerationVelocityY,o=Math.max(Math.min(this._maxDecelerationScrollLeft,e),this._minDecelerationScrollLeft);o!==e&&(e=o,this._decelerationVelocityX=0);var n=Math.max(Math.min(this._maxDecelerationScrollTop,i),this._minDecelerationScrollTop);n!==i&&(i=n,this._decelerationVelocityY=0),t?this._publish(e,i,this._zoom):(this._scrollLeft=e,this._scrollTop=i),this._decelerationVelocityX*=.95,this._decelerationVelocityY*=.95},p.prototype._stop=function(t){var e=null!=this._running[t];return e&&(this._running[t]=null),e},p.prototype._isRunning=function(t){return null!=this._running[t]},p.prototype._start=function(s,a,l,h,c){var u=this,d=this._time(),p=d,f=0,g=0,m=this._counter++;if(m%16==0){var t={};for(var e in this._running)t[e]=!0;this._running=t}var _=function(t){var e=!0!==t,i=u._time();if(!u._running[m]||a&&!a(m))return u._running[m]=null,void(l&&l(u._fps-g/((i-d)/1e3),m,!1));if(e)for(var o=Math.round((i-p)/(1e3/u._fps))-1,n=0;n<Math.min(o,4);n++)_(!0),g++;h&&1<(f=(i-d)/h)&&(f=1);var r=c?c(f):f;!1!==s(r,i,e)&&1!==f||!e?e&&(p=i,v.default.requestAnimationFrame(_)):(u._running[m]=null,l&&l(u._fps-g/((i-d)/1e3),m,1===f||null==h))};return this._running[m]=!0,v.default.requestAnimationFrame(_),m},p.prototype.drawRectangle=function(t,e,i,o,n,r,s,a,l,h){e=e||0,i=i||0,o=o||0,n=n||0,r=r||"#000000",s=s||"#000000",a=a||0,c.Rectangle.draw(t,e,i,o,n,r,s,a,l,h)},p.prototype._getLine=function(t,e){return t[0]==e[0]?t[1]<e[1]?[t,e]:[e,t]:t[0]<e[0]?[t,e]:[e,t]},p.prototype._isOnLine=function(t,e){return e[0][0]===e[1][0]?t[1]>=e[0][1]&&t[1]<=e[1][1]:t[0]>=e[0][0]&&t[0]<=e[1][0]},p.prototype._isRectCross=function(t,e,i,o){var n=Math.min,r=Math.max;return n(t[0],e[0])<=r(i[0],o[0])&&n(i[0],o[0])<=r(t[0],e[0])&&n(t[1],e[1])<=r(i[1],o[1])&&n(i[1],o[1])<=r(t[1],e[1])},p.prototype._isLineSegmentCross=function(t,e,i,o){var n=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),r=t[0]*(o[1]-e[1])+e[0]*(t[1]-o[1])+o[0]*(e[1]-t[1]);return!(0<=(n^r)&&0!=n&&0!=r||0<=((n=i[0]*(t[1]-o[1])+o[0]*(i[1]-t[1])+t[0]*(o[1]-i[1]))^(r=i[0]*(e[1]-o[1])+o[0]*(i[1]-e[1])+e[0]*(o[1]-i[1])))&&0!=n&&0!=r)},p.prototype.getIntersection=function(t,e,i,o){if(this._isRectCross(t,e,i,o)&&this._isLineSegmentCross(t,e,i,o)){var n,r=void 0,s=(o[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-o[1]),r=(t[1]-i[1])*(e[0]-t[0])*(o[0]-i[0])+i[0]*(o[1]-i[1])*(e[0]-t[0])-t[0]*(e[1]-t[1])*(o[0]-i[0]);if(0==s||0===r){var a=this._getLine(t,e),l=this._getLine(i,o),h=a[0],c=a[1],u=l[0],d=l[1];if(c[0]==u[0]&&c[1]==u[1])return c;if(h[0]==d[0]&&h[1]==d[1])return h;if(this._isOnLine(c,l)&&this._isOnLine(u,a))return[u,c];if(this._isOnLine(h,l)&&this._isOnLine(d,a))return[h,d];if(this._isOnLine(h,l)&&this._isOnLine(c,l))return[h,c];if(this._isOnLine(u,l)&&this._isOnLine(d,l))return[u,d]}return n=r/s,s=(t[0]-e[0])*(o[1]-i[1])-(e[1]-t[1])*(i[0]-o[0]),[n,(r=e[1]*(t[0]-e[0])*(o[1]-i[1])+(o[0]-e[0])*(o[1]-i[1])*(t[1]-e[1])-o[1]*(i[0]-o[0])*(e[1]-t[1]))/s]}return!1},p);function p(t){this.totalcount=0,this.pageWidth=0,this.pageHeight=0,this.ifAllowSlide=!0,this.scrollTop=0,this.scrollLeft=0,this._existImage=!1,this._lastZoom4Stretch=1,this._lastFitType4Stretch="window",this.zoomInStretch=!1,this.isClickToZoom=!1,this.zoom=1,this.realZoom=1,this.zoomInDelta=1.2,this.zoomOutDelta=1.2,this.canvasInnerWidth=375,this.canvasInnerHeight=667,this.fitType="window",this.lastFitType="window",this.viewMode="onePage",this.selectionRectAspectRatio=1,this.canvasContainer=null,this.mouseShape="default",this._clickEventTimer=null,this._isStretch=!1,this._minZoom=.1,this._maxZoom=8,this._slideMove=!1,this._isSliding=!1,this._isSingleTouch=!1,this._isProcessing=!1,this._isDecelerationComplete=!1,this._isDragging=!1,this._isDecelerating=!1,this._isAnimating=!1,this._outerLeft=0,this._outerTop=0,this._outerWidth=0,this._outerHeight=0,this._innerWidth=0,this._innerHeight=0,this._zoom=1,this._scrollLeft=0,this._scrollTop=0,this._maxScrollLeft=0,this._maxScrollTop=0,this._scheduledLeft=0,this._scheduledTop=0,this._scheduledZoom=0,this._lastTouchLeft=null,this._lastTouchTop=null,this._lastTouchStart=null,this._lastTouchMove=null,this._positions=null,this._minDecelerationScrollLeft=null,this._minDecelerationScrollTop=null,this._maxDecelerationScrollLeft=null,this._maxDecelerationScrollTop=null,this._decelerationVelocityX=null,this._decelerationVelocityY=null,this.scrollingX=!0,this.scrollingY=!0,this.animating=!1,this.animationDuration=250,this.bouncing=!0,this.locking=!1,this.zooming=!0,this.speedDelta=1,this.scrollingComplete=null,this.penetrationDeceleration=.03,this.penetrationAcceleration=.08,this.keepZoom=!1,this.useRelativeZoom=!0,this._tempImage=null,this.containerId=null,this._imgArr=[],this._renderUid=null,this._renderUrl=null,this._renderImage=null,this._editorStack=null,this.calcWidth=0,this.calcHeight=0,this.toBeRenderUid=null,this.userZoom=1,this.isZoom=!1,this.scrollerWidth=0,this.scrollerHeight=0,this.newRect={x:0,y:0,width:0,height:0},this.originZoomX=1,this.originZoomY=1,this._firstZoomAngle=null,this.isScrollerBar=!1,this.tempCanvas=null,this.tempCanvas1=null,this.fitZoom={zoomX:1,zoomY:1},this.cropAndEraseNum=0,this.curImageUid=null,this.cropSides=[],this.cropVertexes=[],this.cropMidpoints=[],this.probePoints=[],this.isKeepRatio=!1,this.isFreeCrop=!1,this.probePiontRadius=6,this.sensorRadius=10,this.cropLineWidth=2,this.defaultCropLineColor="rgba(0,0,0,1)",this.invalidCropLineColor="rgba(255,0,0,1)",this._cropLineColor="rgba(0,0,0,1)",this.defaultFirstPointColor="rgba(255,0,0,1)",this.invalidFirstPointColor="rgba(0,0,0,1)",this._firstPointColor="rgba(255,0,0,1)",this.pointFillColor="rgba(255,255,255,0)",this.cropDashLine=[0,0],this.isPointSelected=!1,this.slopRatio=[],this.activeProbePoint=null,this.moveLeft=0,this.moveTop=0,this._freeCropStartX=0,this._freeCropStartY=0,this.canvasLeft=0,this.canvasTop=0,this._crop=null,this.cropPoint=[],this._longpressStart=null,this._longpressEnd=null,this._longpressTimer=null,this._rightClickFlag=!1,this.isNormalCrop=!0,this._canvasPostfix="",this._easeOutCubic=function(t){return Math.pow(t-1,3)+1},this._easeInOutCubic=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},this._pubSub=t.pubsub,this.emit("_onAddLog","Initialization canvas."),this.canvasCssHeight=t.canvasCssHeight||0,this.canvasCssWidth=t.canvasCssWidth||0,this.backgroundColor=t.backgroundColor||"rgba(67,66,70,1)",this.scaleCoefficient=t.scaleCoefficient||1,this._scrollerConfig=t.scrollerConfig,this._canvasPostfix="_"+v.default.uid(11),this._initDevicePixelRatio(),this._initAnimation(),this._initCanvas(),this._initScroller(t.scrollerConfig),this._initTransformStack(),this._initCrop(this._editorStack),this.on("publishScrollResult",function(t){this.scrollLeft=t.left,this.scrollTop=t.top,this.zoom=t.zoom}.bind(this)),this.on("_onCanvasScroll",function(t){this.scrollTo(t.left,t.top,!1),this.emit("render")}.bind(this)),this.on("_onImageAreaSelected",function(t){var e=this._getImageRelArea(t.x,t.y,t.width,t.height);this.emit("imageAreaSelected",{index:t.index,x:e.x,y:e.y,width:e.width,height:e.height,areaIndex:t.areaIndex})}.bind(this)),this.on("_getImageCountForCanvas",function(t){this._existImage=0<t}.bind(this)),this.on("getDrawImageData",function(t){this._imgArr=[];for(var e=t.length,i=0;i<e;i++){var o={};o.uid=t[i].uid,o.url=t[i].originalData,o.width=null,o.height=null,o.angle=0,o.naturalWidth=null,o.naturalHeight=null,this._imgArr.push(o)}}.bind(this)),this.on("resetTransform",function(){this._editorStack.reset(),this._zoom=1,this.originZoomX=1,this.originZoomY=1,this.isScrollerBar=!1,this._firstZoomAngle=0,this.newRect={x:0,y:0,width:0,height:0},this.isZoom=!1}.bind(this)),this.on("_onScrollWheel",function(t){this._onWheelHandler(t)}.bind(this)),this.on("_onSetRenderImageUid",function(t){this.toBeRenderUid=t}.bind(this)),this.emit("_onAddLog","Initialization canvas conpleted.")}e.Graphic=d},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(39),a=(r=s.BasicCanvas,n(l,r),l.prototype.initUpperCanvas=function(){this.upperCanvas=this.createCanvasElement("upperCanvas"),this.upperContext=this.upperCanvas.getContext("2d")},l.prototype.setCanvasSize=function(t,e){r.prototype.setCanvasSize.call(this,t,e),this.initCanvasSize(this.upperCanvas),this.upperContext.transform(1,0,0,1,this.innerWidth/2,this.innerHeight/2),this.upperContext.scale(this.devicePixelRatio,this.devicePixelRatio)},l.prototype.setMouseShape=function(t){this.upperCanvas.style.cursor=t,this.lowerCanvas.style.cursor=t},l.prototype.clearLowerCanvas=function(t,e,i,o){r.prototype.clearCanvas.call(this,t,e,i,o),this.upperContext.clearRect(t,e,i,o)},l.prototype.clearUpperCanvas=function(t,e,i,o){this.upperContext.clearRect(t,e,i,o)},l.prototype.render=function(t,e,i,o,n,r,s,a,l){this.lowerContext.clearRect(-this.innerWidth,-this.innerHeight,2*this.innerWidth,2*this.innerHeight),this.lowerContext.drawImage(t,e,i,o,n,r,s,a,l)},l.prototype.pointRotate=function(t,e,i,o,n){return n=n/180*Math.PI,{x:(t-i)*Math.cos(n)-(e-o)*Math.sin(n)+i,y:(t-i)*Math.sin(n)-(e-o)*Math.cos(n)+o}},l.prototype.rectangleRotate=function(t,e,i,o,n){var r=t+i/2,s=e+o/2,a=this.pointRotate(t,e,r,s,n),l=this.pointRotate(t+i,e,r,s,n),h=this.pointRotate(t+i,e+o,r,s,n),c=this.pointRotate(t,e+o,r,s,n),u=[a.x,l.x,h.x,c.x].sort(function(t,e){return t-e}),d=[a.y,l.y,h.y,c.y].sort(function(t,e){return t-e});return{x:u[0],y:d[0],width:u[3]-u[0],height:d[3]-d[0]}},l);function l(t){var e=r.call(this,t)||this;return e.initUpperCanvas(),e.initCanvasSize(e.upperCanvas),e.initCanvasScale(e.upperCanvas),e}e.Canvas=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.initCanvas=function(){this.lowerCanvas=this.createCanvasElement("lowerCanvas"),this.lowerContext=this.lowerCanvas.getContext("2d")},n.prototype.initCanvasSize=function(t){t.style.width=this.cssWidth+"px",t.style.height=this.cssHeight+"px",t.width=this.innerWidth,t.height=this.innerHeight},n.prototype.inintCanvasBackground=function(t){t.style.background=this.backgroundColor},n.prototype.initCanvasScale=function(t){this.lowerContext.scale(this.devicePixelRatio,this.devicePixelRatio)},n.prototype.setBackgroundColor=function(t){this.lowerCanvas.style.background=t},n.prototype.clearCanvas=function(t,e,i,o){this.lowerContext.clearRect(t,e,i,o)},n.prototype.setCanvasInnerSize=function(){this.innerWidth=this.cssWidth*this.devicePixelRatio,this.innerHeight=this.cssHeight*this.devicePixelRatio},n.prototype.setCanvasSize=function(t,e){this.cssWidth=t,this.cssHeight=e,this.setCanvasInnerSize(),this.initCanvasSize(this.lowerCanvas),this.lowerContext.transform(1,0,0,1,this.innerWidth/2,this.innerHeight/2),this.lowerContext.scale(this.devicePixelRatio,this.devicePixelRatio)},n.prototype.createCanvasElement=function(t){var e=document.createElement("canvas");return e.setAttribute("id",t),e.style.position="absolute",e.style.top="0px",e.style.left="0px",e},n.prototype.getLowerContext=function(){return this.lowerContext},n.prototype.getPixelRatio=function(){return this.devicePixelRatio},n.prototype.setPixelRatio=function(t){t&&(this.devicePixelRatio=t)},n.prototype.setWidth=function(t){this.cssWidth=t,this.lowerCanvas.width=t},n.prototype.setHeight=function(t){this.cssHeight=t,this.lowerCanvas.height=t},n.prototype.getWidth=function(){return this.cssWidth},n.prototype.getHeight=function(){return this.cssHeight},n.prototype.getScale=function(){return this.scaleCoefficient},n.prototype.setScale=function(t){t&&(this.scaleCoefficient=t)},n.prototype.setSize=function(t,e){},n.prototype.toDataURL=function(t,e){},n.prototype.rotate=function(){},n.prototype.renderAll=function(){},n);function n(t){this.cssWidth=0,this.cssHeight=0,this.devicePixelRatio=1,this.cssWidth=t.canvasCssWidth,this.cssHeight=t.canvasCssHeight,this.devicePixelRatio=t.devicePixelRatio,this.backgroundColor=t.backgroundColor,this.initCanvas(),this.setCanvasInnerSize(),this.initCanvasSize(this.lowerCanvas),this.inintCanvasBackground(this.lowerCanvas),this.initCanvasScale(this.lowerCanvas)}e.BasicCanvas=o},function(t,e,i){"use strict";var o=this&&this.__awaiter||function(t,s,a,l){return new(a=a||Promise)(function(i,e){function o(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}r((l=l.apply(t,s||[])).next())})},n=this&&this.__generator||function(i,o){var n,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&e[0]?r.return:e[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,e[1])).done)return s;switch(r=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=o.call(i,a)}catch(t){e=[6,t],r=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=r(i(0)),a=i(6),l=(h.prototype.init=function(){this.canvas=s.default.createCanvas().canvas,this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1},h.prototype._initTransformStack=function(){this._editorStack=new a.Transform2d},h.prototype.setCanvasSize=function(t,e){this.canvas.width=t||300,this.canvas.height=e||150},h.prototype.resetCanvas=function(){this.setCanvasSize(300,150),this.width=300,this.height=150,this.imageData=null},h.prototype.getImageData=function(t){this._editorStack.setTransform(this.context),this.context.drawImage(t,0,0,this.width,this.height,0,0,this.width,this.height),this.imageData=this.context.getImageData(0,0,this.width,this.height)},h.prototype.getImageBlob=function(){return o(this,void 0,void 0,function(){var i=this;return n(this,function(t){switch(t.label){case 0:return[4,new Promise(function(e,t){i.canvas.toBlob(function(t){e(t)})})];case 1:return[2,t.sent()]}})})},h);function h(){this._editorStack=null,this.width=0,this.height=0,this.init()}e.CanvasCache=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Rectangle={draw:function(t,e,i,o,n,r,s,a,l,h){t.save(),t.globalAlpha=h,t.fillStyle=s,t.fillRect(e+a,i+a,o-a,n-a),a&&(t.globalAlpha=l,t.lineWidth=a,t.strokeStyle=r,t.strokeRect(e+a/2,i+a/2,o,n)),t.restore()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype._init=function(t){for(var e=Object.keys(t),i=0,o=e.length;i<o;i++)this[e[i]]=t[e[i]]},n.prototype.bindCallback=function(t){this._callback=t},n.prototype.setZoom=function(t,e){this.zoomX=t,this.zoomY=e},n.prototype.setValidAreaSize=function(t,e){this.outerWidth=t,this.outerHeight=e},n.prototype.setMoveDistance=function(t,e){this.moveLeft=t,this.moveTop=e},n.prototype.setImageSize=function(t,e){this.width=t,this.height=e},n.prototype.setFreeCropBox=function(t){if(this.mode=1,!this.isCrop)return!1;if(8!==t.length)return!1;if(!this.checkRectConvexity(t))return!1;for(var e=0;e<4;e++){var i=this.getPointToCanvas(t[2*e],t[2*e+1]),i=this.transformToCanvasCenterCoordinate(i.x,i.y);t[2*e]=i.x,t[2*e+1]=i.y}return this.vertexes=t.slice(),this.midpoints=this.calcMidpoint(t).slice(),this.probePoints=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),this._publish(),!0},n.prototype.setCropArea=function(t,e,i,o){this.mode=0;var n=[t,e,t+i,e,t+i,e+o,t,e+o];if(!this.isCrop)return!1;if(8!==n.length)return!1;if(!this.checkRectConvexity(n))return!1;for(var r=0;r<4;r++){var s=this.transformToImageCenterCoordinate(n[2*r],n[2*r+1]),s=this.getPointToCanvas(s.x,s.y);n[2*r]=s.x,n[2*r+1]=s.y}return this.vertexes=n.slice(),this.midpoints=this.calcMidpoint(n).slice(),this.probePoints=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),this._publish(),!0},n.prototype.transformToImageCenterCoordinate=function(t,e){return{x:t-=this.width/2,y:e-=this.height/2}},n.prototype.transformToCanvasCenterCoordinate=function(t,e){return{x:t-=this.outerWidth/2,y:e-=this.outerHeight/2}},n.prototype.transformToCanvasLeftTopCoordinate=function(t,e){return{x:t+=this.outerWidth/2,y:e+=this.outerHeight/2}},n.prototype.calcMidpoint=function(t){for(var e=t.slice(0,8).concat(t[0],t[1]),i=[],o=0;o<4;o++){var n=(e[2*o]+e[2*o+2])/2,r=(e[2*o+1]+e[2*o+3])/2;i.push(n,r)}return i},n.prototype.calcSlopeRatio=function(t){for(var e=[],i=null,o=t.slice(0,8).concat(t[0],t[1]),n=0;n<4;n++)i=o[2*n+3]-o[2*n+1]==0&&o[2*n+2]-o[2*n]==0?0:(o[2*n+3]-o[2*n+1])/(o[2*n+2]-o[2*n]),e.push(i);return e},n.prototype.checkRectConvexity=function(t){var e=(t[6]-t[0])*(t[3]-t[1])-(t[7]-t[1])*(t[2]-t[0]),i=(t[0]-t[2])*(t[5]-t[3])-(t[1]-t[3])*(t[4]-t[2]),o=(t[2]-t[4])*(t[7]-t[5])-(t[3]-t[5])*(t[6]-t[4]),n=(t[4]-t[6])*(t[1]-t[7])-(t[5]-t[7])*(t[0]-t[6]);if(e*i*o*n<0)return!1;var r=t.slice().concat(t.slice(0,2));if(this.slopeRatio.length)for(var s=0;s<2;s++)if(this.slopeRatio[s]!==this.slopeRatio[s+2]&&this.calcIntersection(r.slice(2*s,2*s+2),r.slice(2*s+2,2*s+4),r.slice(2*s+4,2*s+6),r.slice(2*s+6,2*s+8)))return!1;return 0<e*i*o*n},n.prototype.checkImageEdge=function(t,e){var i=this.getPointToCanvas(0,0),o=this.getPointToCanvas(this.width,this.height),n=o.x-i.x,r=o.y-i.y;return-n/2<=t&&t<=n/2&&-r/2<=e&&e<=r/2},n.prototype.getPointToImage=function(t,e){return{x:t=(t-(this.outerWidth/2-this.width*this.zoomX/2-this.moveLeft))/this.zoomX,y:e=(e-(this.outerHeight/2-this.height*this.zoomY/2-this.moveTop))/this.zoomY}},n.prototype.getPointToCanvas=function(t,e){return{x:t=t*this.zoomX+(this.outerWidth/2-this.width*this.zoomX/2-this.moveLeft),y:e=e*this.zoomY+(this.outerHeight/2-this.height*this.zoomY/2-this.moveTop)}},n.prototype.checkProbePoint=function(t,e){for(var i=this.sensorRadius,o=0;o<8;o++){var n=this.probePoints[2*o],r=this.probePoints[2*o+1],s={x:t,y:e};if(this.transformStack&&(s=this.transformStack.setPointTransform(t,e)),s.x<=n+i&&s.x>=n-i&&s.y<=r+i&&s.y>=r-i)return o}return null},n.prototype.pointRotate=function(t,e,i,o,n){return n%360?(n=n/180*Math.PI,{x:(t-i)*Math.cos(n)-(e-o)*Math.sin(n)+i,y:(t-i)*Math.sin(n)+(e-o)*Math.cos(n)+o}):{x:t,y:e}},n.prototype.onStartHandler=function(t){var e,i,o,n;this.isCrop&&(e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,this._StartX=e-this.canvasLeft,this._StartY=i-this.canvasTop,o={x:this._StartX,y:this._StartY},o=this.transformToCanvasCenterCoordinate(o.x,o.y),null!==(n=this.checkProbePoint(o.x,o.y))?(this.isPointSelected=!0,this.activeProbePoint=n):(this.isPointSelected=!1,this.activeProbePoint=null))},n.prototype.onMoveHandler=function(t){if(this.isPointSelected&&null!==this.activeProbePoint){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,o=e-this.canvasLeft,n=i-this.canvasTop,r=this.activeProbePoint,s=this.transformToCanvasCenterCoordinate(o,n);this.transformStack&&(s=this.transformStack.setPointTransform(s.x,s.y));for(var a=s.x,l=s.y,h=this.probePoints.slice(),h=0===this.mode?this._moveNormalCropBox(h,r,a,l):this._moveFreeCropBox(h,r,a,l),c=!1,u=0;u<4;u++)if(!this.checkImageEdge(h[2*u],h[2*u+1])){c=!0;break}c||(this.probePoints=h.slice()),this.checkRectConvexity(this.probePoints)?(this._lineColor=this.defaultLinecolor,this._firstPointColor=this.defaultFirstPointColor):(this._lineColor=this.invalidLineColor,this._firstPointColor=this.invalidFirstPointColor);var d=this.calcMidpoint(this.probePoints);this.probePoints=this.probePoints.slice(0,8).concat(d),this._publish()}},n.prototype.onEndHandler=function(t){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,o=e-this.canvasLeft,n=i-this.canvasTop,r=this._StartX,s=this._StartY;if(this._StartX=0,this._StartY=0,this._lineColor=this.defaultLinecolor,this._firstPointColor=this.defaultFirstPointColor,this.isPointSelected&&null!==this.activeProbePoint){this.activeProbePoint=null,this.isPointSelected=!1;var a=this.checkRectConvexity(this.probePoints);if(r===o&&s===n||!a)return this.probePoints=this.vertexes.slice().concat(this.midpoints),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),void this._publish();this.vertexes=this.probePoints.slice(0,8),this.midpoints=this.probePoints.slice(8,16),this._publish()}},n.prototype._moveNormalCropBox=function(t,e,i,o){var n,r,s,a,l,h;return e<4?(n=i-t[2*e],r=o-t[2*e+1],t[2*e]=i,t[2*e+1]=o,s=(e+1)%4,a=(e+3)%4,e%2?(t[2*s]+=n,t[2*a+1]+=r):(t[2*s+1]+=n,t[2*a]+=r)):(l=e-4,0===(h=this.slopeRatio[l%4])?(t[(2*l+3)%8]=o,t[(2*l+1)%8]=o):h!==1/0&&h!==-1/0||(t[(2*l+2)%8]=i,t[(2*l+0)%8]=i)),t},n.prototype._moveFreeCropBox=function(t,e,i,o){var n,r,s,a,l,h,c,u,d,p,f,g,m,_;return e<4?(n=this.getPointToCanvas(0,0),s=(r=this.getPointToCanvas(this.width,this.height)).x-n.x,a=r.y-n.y,t[2*e]=i,t[2*e+1]=o,t[2*e]=Math.min(Math.max(-s/2,t[2*e]),s/2),t[2*e+1]=Math.min(Math.max(-a/2,t[2*e+1]),a/2),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4)):(l=e-4,u=-(c=o-(h=this.slopeRatio[l%4])*i)/h,p=-(d=t[(2*l+9)%8]-h*t[(2*l+8)%8])/h,f=this.slopeRatio[(1+l)%4],g=t[(2*l+3)%8]-f*t[(2*l+2)%8],m=this.slopeRatio[(3+l)%4],_=t[(2*l+1)%8]-m*t[(2*l+0)%8],0===h?(t[(2*l+3)%8]=o,f!==1/0&&f!==-1/0&&(t[(2*l+2)%8]=(o-g)/f),t[(2*l+1)%8]=o,m!==1/0&&m!==-1/0&&(t[(2*l+0)%8]=(o-_)/m)):h===1/0||h===-1/0?(t[(2*l+2)%8]=i,t[(2*l+3)%8]=f*i+g,t[(2*l+0)%8]=i,t[(2*l+1)%8]=m*i+_):(0===f?t[(2*l+2)%8]+=u-p:f===1/0||f===-1/0?t[(2*l+3)%8]+=c-d:(t[(2*l+2)%8]=(g-c)/(h-f),t[(2*l+3)%8]=(f*c-h*g)/(f-h)),0===m?t[(2*l+0)%8]+=u-p:m===1/0||m===-1/0?t[(2*l+1)%8]+=c-d:(t[(2*l+0)%8]=(_-c)/(h-m),t[(2*l+1)%8]=(m*c-h*_)/(m-h)))),t},n.prototype._publish=function(){if(this._callback){for(var t=this.probePoints.slice(0,8),e=0;e<4;e++){var i=this.transformToCanvasLeftTopCoordinate(t[2*e],t[2*e+1]),i=this.getPointToImage(i.x,i.y);t[2*e]=i.x,t[2*e+1]=i.y}this._callback(t.slice())}},n.prototype.calcIntersection=function(t,e,i,o){if(this._isRectCross(t,e,i,o)&&this._isLineSegmentCross(t,e,i,o)){var n,r=void 0,s=(o[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-o[1]),r=(t[1]-i[1])*(e[0]-t[0])*(o[0]-i[0])+i[0]*(o[1]-i[1])*(e[0]-t[0])-t[0]*(e[1]-t[1])*(o[0]-i[0]);if(0==s||0===r){var a=this._getLine(t,e),l=this._getLine(i,o),h=a[0],c=a[1],u=l[0],d=l[1];if(c[0]===u[0]&&c[1]===u[1])return c;if(h[0]===d[0]&&h[1]===d[1])return h;if(this._isOnLine(c,l)&&this._isOnLine(u,a))return[u,c];if(this._isOnLine(h,l)&&this._isOnLine(d,a))return[h,d];if(this._isOnLine(h,l)&&this._isOnLine(c,l))return[h,c];if(this._isOnLine(u,l)&&this._isOnLine(d,l))return[u,d]}return n=r/s,s=(t[0]-e[0])*(o[1]-i[1])-(e[1]-t[1])*(i[0]-o[0]),[n,(r=e[1]*(t[0]-e[0])*(o[1]-i[1])+(o[0]-e[0])*(o[1]-i[1])*(t[1]-e[1])-o[1]*(i[0]-o[0])*(e[1]-t[1]))/s]}return!1},n.prototype._getLine=function(t,e){return t[0]===e[0]?t[1]<e[1]?[t,e]:[e,t]:t[0]<e[0]?[t,e]:[e,t]},n.prototype._isOnLine=function(t,e){return e[0][0]===e[1][0]?t[1]>=e[0][1]&&t[1]<=e[1][1]:t[0]>=e[0][0]&&t[0]<=e[1][0]},n.prototype._isRectCross=function(t,e,i,o){var n=Math.min,r=Math.max;return n(t[0],e[0])<=r(i[0],o[0])&&n(i[0],o[0])<=r(t[0],e[0])&&n(t[1],e[1])<=r(i[1],o[1])&&n(i[1],o[1])<=r(t[1],e[1])},n.prototype._isLineSegmentCross=function(t,e,i,o){var n=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),r=t[0]*(o[1]-e[1])+e[0]*(t[1]-o[1])+o[0]*(e[1]-t[1]);return!(0<=(n^r)&&0!==n&&0!==r||0<=((n=i[0]*(t[1]-o[1])+o[0]*(i[1]-t[1])+t[0]*(o[1]-i[1]))^(r=i[0]*(e[1]-o[1])+o[0]*(i[1]-e[1])+e[0]*(o[1]-i[1])))&&0!==n&&0!==r)},n);function n(t){this.mode=0,this.vertexes=[],this.midpoints=[],this.probePoints=[],this.slopeRatio=[],this.isCrop=!1,this.probePointRadius=6,this.sensorRadius=10,this.defaultLinecolor="rgba(0,0,0,1)",this.defaultFirstPointColor="rgba(255,0,0,1)",this.invalidLineColor="rgba(255,0,0,1)",this.invalidFirstPointColor="rgba(0,0,0,1)",this._lineColor="rgba(0,0,0,1)",this._firstPointColor="rgba(255,0,0,1)",this.pointFillColor="rgba(255,255,255,0)",this.lineWidth=2,this.dashLine=[4,2],this.isPointSelected=!1,this.activeProbePoint=null,this.moveLeft=0,this.moveTop=0,this._StartX=0,this._StartY=0,this.canvasLeft=0,this.canvasTop=0,this.angle=0,this.width=0,this.height=0,this.outerWidth=0,this.outerHeight=0,this.zoomX=1,this.zoomY=1,this._callback=null,this.transformStack=null,this._init(t)}e.Crop=o},function(t,e,i){"use strict";var a=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o};Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)},n.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var n=this._events[t];if(!n||0===n.length)return!1;for(var r=n.length,s=0;s<r;s++)(e=n[s]).call.apply(e,a([null],i))},n.prototype.off=function(t,e){var i=this._events[t];if(!i)return!1;if(e)for(var o=i.length,n=0;n<o;n++)i[n]===e&&i.splice(n,1);else i&&(i.length=0)},n);function n(){this._events=[]}e.PublishSubscribe=o},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,s,a,l){return new(a=a||Promise)(function(i,e){function o(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}r((l=l.apply(t,s||[])).next())})},a=this&&this.__generator||function(i,o){var n,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&e[0]?r.return:e[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,e[1])).done)return s;switch(r=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=o.call(i,a)}catch(t){e=[6,t],r=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(45)),l=o(i(46)),h=i(48),c=o(i(49)),u=i(50),d=o(i(51)),p=o(i(5)).default.ErrorMessage,f=(g.prototype._bindEvents=function(){var e=this;[["onLog",this._onLog],["onResolutionChanged",this.show],["onCameraChanged",this._cameraChangedHandler],["onCameraSelChanged",this._onCameraSelChanged],["onPlayed",this.drawRegionsults],["onThrowError",this._throwError],["onParaTypeError",this._throwParaTypeError],["onParaValueError",this._throwParaValueError]].forEach(function(t){e.on(t[0],t[1])}),window.addEventListener("resize",function(){e.drawRegionsults()})},g.prototype._cameraChangedHandler=function(t){this._camera&&(r.default.cameraExist(this._camera._cameraInfo,t)||(this.emit("onLog","camera plug out."),this._camera.setPlugout(),this.emit("onThrowError",p.CAMERA_PLUG_OUT)))},g.prototype._onLog=function(t){this._logs+=t+"\n"},g.prototype._cameraManageInit=function(){this._cameraManager=new r.default(this._pub)},g.prototype.destroy=function(){this.off("onLog"),this.unbindUI(),this._closeCamera(),this._cameraManager.destroy(),this.unbindRealTimeRender()},g.prototype.getVideoElement=function(){return this._video},g.prototype._throwError=function(t){if(t.code&&t.message)throw this.errorCode=t.code,this.errorMessage=t.message,c.default.cameraException(t)},g.prototype._throwParaTypeError=function(t,e){throw this.errorCode=-4212,this.errorMessage="Argument of type '"+t+"' is not assignable to parameter of type '"+e+"'.",c.default.cameraException({code:this.errorCode,message:this.errorMessage})},g.prototype._throwParaValueError=function(t,e){throw this.errorCode=-4213,this.errorMessage="The argument '"+t+"' is not valid for the parameter '"+e+"'",c.default.cameraException({code:this.errorCode,message:this.errorMessage})},g.prototype.show=function(){this._checkCamera(),this._videoContainer&&"none"==this._videoContainer.style.display&&(this._videoContainer.style.display=""),this.drawRegionsults(null)},g.prototype.hidden=function(){return!!this._videoContainer&&"none"==this._videoContainer.style.display},g.prototype.hide=function(){this._videoContainer&&(this._videoContainer.style.display="none")},g.prototype.playDirectly=function(o,n,r){return s(this,void 0,void 0,function(){var e,i;return a(this,function(t){switch(t.label){case 0:return e={},this._camera?this._camera.playing()?[3,2]:[4,this._camera.play(n,r)]:[3,4];case 1:return e=t.sent(),[3,3];case 2:e=this._camera._curResolution,t.label=3;case 3:return[3,8];case 4:return(i=this._cameraManager._allCamerasInfo).length?[3,6]:[4,this._cameraManager.getAllCamerasInfo()];case 5:i=t.sent(),t.label=6;case 6:return this._camera=new l.default(null,this._video,i,o,this._pub),[4,this._camera.play(n,r)];case 7:e=t.sent(),t.label=8;case 8:return[2,e]}})})},g.prototype.playing=function(){return!!this._camera&&this._camera.playing()},g.prototype.paused=function(){return!!this._camera&&this._camera.paused()},g.prototype._closeCamera=function(){this._camera&&(this._camera.destroy(),this._camera=null)},g.prototype._checkCamera=function(){return!!this._camera&&void 0},g.prototype.bindResolutionsSelector=function(t){return!!this._camera&&this._camera.bindResolutionsSelector(t)},g.prototype.unbindResolutionsSelector=function(){return!!this._camera&&this._camera.unbindResolutionsSelector()},g.prototype.drawRegionsults=function(t){var e,i;this._video&&this._cvsDrawArea&&(e=this._cvsDrawArea,this.calPixelRatio()&&(e.width=e.clientWidth,e.height=e.clientHeight,(i=e.getContext("2d")).strokeStyle=this.lineStrokeStyle,i.strokeRect(0,0,e.width,e.height)))},g.prototype.calPixelRatio=function(){if(this._video&&this._cvsDrawArea){var t=this._video,e=t.videoWidth,i=t.videoHeight,o=t.clientWidth,n=t.clientHeight;if(0===o||0===n)return 0;var r=Math.max(o/e,n/i);return r===1/0&&(r=0),this._pixelRatio=r}},g.prototype._clearCanvasRect=function(){this._cvsDrawArea&&this._cvsDrawArea.getContext("2d").clearRect(0,0,this._cvsDrawArea.width,this._cvsDrawArea.height)},g.prototype._clearRegionsults=function(){this._cvsDrawArea&&(this._cvsDrawArea.width=this._cvsDrawArea.height=0)},g.prototype.bindCameraSelector=function(t){return this._cameraManager.bindCameraSelector(t)},g.prototype.unbindCameraSelector=function(){return this._cameraManager.unbindCameraSelector()},g.prototype._onCameraSelChanged=function(t){var e=this;this.setCurrentCamera(t).then(function(t){e.hide(),t.getResolutions()})},g.prototype.setCurrentCamera=function(i,o){return s(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return this._closeCamera(),(e=this._cameraManager._allCamerasInfo)?[3,2]:[4,this._cameraManager.getAllCamerasInfo()];case 1:e=t.sent(),t.label=2;case 2:return this._camera=new l.default(i,this._video,e,o,this._pub),[2,this._camera]}})})},g.prototype.getCurrentCamera=function(){return this._camera},g.prototype.on=function(t,e){this._pub.on(t,e.bind(this))},g.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pub).emit.apply(e,n([t],i))},g.prototype.off=function(t,e){this._pub.off(t,e)},g.prototype.bindUI=function(t,e){var i,o=this;return void 0===e&&(e=!0),this.unbindUI(),(!this._licenseCallback||0===this._licenseCallback().errorCode)&&(t?(""===t.style.position&&(t.style.position="relative"),this._videoContainer=document.createElement("div"),this._videoContainer.setAttribute("class","dynamsoft-cvs-container"),t.appendChild(this._videoContainer),this._video=document.createElement("video"),this._video.setAttribute("class","dynamsoft-video"),this._video.setAttribute("playsinline","true"),this._videoContainer.appendChild(this._video),this._camera&&(this._camera._videoEle=this._video),this._cvsDrawArea=document.createElement("canvas"),this._cvsDrawArea.setAttribute("class","dynamsoft-cvs-drawarea"),this._videoContainer.appendChild(this._cvsDrawArea),this._resultImg=document.createElement("img"),this._resultImg.setAttribute("class","dynamsoft-resultImg"),this._videoContainer.appendChild(this._resultImg),e&&((i=document.createElement("div")).setAttribute("class","dynamsoft-cvs-exit ds-dvs-ui-iconfont ds-dvs-ui-exitMutiple"),this._videoContainer.appendChild(i),i&&i.addEventListener("click",function(){o.emit("onExitCamera")})),this.bindControlBox(),!0):void 0)},g.prototype.unbindUI=function(){var t;this._clearRegionsults(),!this._videoContainer||(t=this._videoContainer.parentNode)&&t.removeChild(this._videoContainer),this._videoContainer=null,this._video=null,this._cvsDrawArea=null,this._divScanLight=null,this._divScanLight=null,this._btnClose=null},g.prototype.getImageData=function(){this._drawRealCameraArea();var t=this._tempCanvas;return t.getContext("2d").getImageData(0,0,t.width,t.height)},g.prototype.getBlobData=function(t){if(t=t||this._tempCanvas,this._video)return new Promise(function(e){t.toBlob(function(t){e(t)})})},g.prototype._drawRealCameraArea=function(){var t,e,i,o,n,r,s;this._video&&(t=this._tempCanvas,e=this._cvsDrawArea,i=this._pixelRatio,o=e.width/i,n=e.height/i,t.width=o,t.height=n,r=(this._video.videoWidth-o)/2,s=(this._video.videoHeight-n)/2,t.getContext("2d").drawImage(this._video,r,s,o,n,0,0,o,n))},g.prototype.emptyTempCanvas=function(){var t=this._tempCanvas;t.width=0,t.height=0},g.prototype.bindRealTimeRender=function(t){var i=this;if(this.unbindRealTimeRender(),!this._areaDetectFn)return!1;var e=1e3/t;this._isDrawing=!0;var o=function(e){i.freeCropTimer=setTimeout(function(){return s(i,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return this._isDrawing?[4,this.drawCropArea()]:[3,2];case 1:t.sent(),o(e),t.label=2;case 2:return[2]}})})},e)};return o(e),!0},g.prototype.unbindRealTimeRender=function(){clearTimeout(this.freeCropTimer),this._isDrawing=!1,this.drawRegionsults()},g.prototype.bindAreaDetectFunction=function(t){return!!d.default.isFunction(t)&&(this._areaDetectFn=t,!0)},g.prototype.bindPerspectiveFunction=function(t){return!!d.default.isFunction(t)&&(this._perspectiveCallback=t,!0)},g.prototype.bindLicenseCallback=function(t){return!!d.default.isFunction(t)&&(this._licenseCallback=t,!0)},g.prototype.detectArea=function(){return s(this,void 0,void 0,function(){var e,i;return a(this,function(t){switch(t.label){case 0:return e=this.getImageData(),i=[],this._areaDetectFn?[4,this._areaDetectFn(e.data,e.width,e.height)]:[3,2];case 1:i=t.sent(),e=null,t.label=2;case 2:return[2,i.slice(0)]}})})},g.prototype.perspective=function(i){return s(this,void 0,void 0,function(){var e;return a(this,function(t){return Array.isArray(i)?(e=this.getImageData(),this._perspectiveCallback?[2,this._perspectiveCallback.call(this,e.data,i,e.width,e.height)]:[2]):[2,!1]})})},g.prototype.drawArea=function(o){var n=this,t=this._cvsDrawArea;if(t){var r=t.getContext("2d");return o?(this._clearCanvasRect(),r.strokeStyle=this.areaFillStyle,r.fillStyle=this.areaFillStyle,r.lineWidth=5,r.clearRect(0,0,t.width,t.height),r.save(),r.beginPath(),r.moveTo(o[0][0]*this._pixelRatio,o[0][1]*this._pixelRatio),o.forEach(function(t,e){var i=(e+1)%4;r.lineTo(o[i][0]*n._pixelRatio,o[i][1]*n._pixelRatio)}),r.stroke(),r.closePath(),r.restore(),!0):(r.clearRect(0,0,t.width,t.height),!1)}},g.prototype.drawCropArea=function(){return s(this,void 0,void 0,function(){var e,i;return a(this,function(t){switch(t.label){case 0:return[4,this.detectArea()];case 1:return e=t.sent(),Array.isArray(e)&&e.length&&this._isDrawing?(i=[e.slice(0,2),e.slice(2,4),e.slice(4,6),e.slice(6,8)],this.drawArea(i),[2,!0]):[2,!1]}})})},g.prototype.bindControlBox=function(t){if(!document.getElementById(t)&&!this._controlBox)return!1;this.bindCustomBox(t,{blank1:{className:"camera-empty"},captureBtn:{className:"camera-main",iconClass:"ds-dvs-ui-zhaoxiangji",onButtonClick:"onCapture"},detectBtn:{className:"camera-right",iconClass:"ds-dvs-ui-shibie-chuanti",onButtonClick:"onDetect"}})},g.prototype.bindConfirmBox=function(t){if(!document.getElementById(t)&&!this._controlBox)return!1;this.bindCustomBox(t,{remakeBtn:{className:"camera-left",iconClass:"ds-dvs-ui-shangyibu",onButtonClick:"onRemake"},blank1:{className:"camera-editEmpty"},perspectiveBtn:{className:"camera-right",iconClass:"ds-dvs-ui-xiayibu",onButtonClick:"onPerspective"}})},g.prototype.bindSaveBox=function(t){if(!document.getElementById(t)&&!this._controlBox)return!1;this.bindCustomBox(t,{backBtn:{className:"camera-around",iconClass:"ds-dvs-ui-shangyibu",onButtonClick:"onBack"},blank1:{className:"camera-saveEmpty"},remakeBtn:{className:"camera-around",iconClass:"ds-dvs-ui-zhongpai",onButtonClick:"onRemake"},confirmBtn:{className:"camera-around",iconClass:"ds-dvs-ui-lijiquerenx",onButtonClick:"onConfirm"}})},g.prototype.bindCustomBox=function(t,e,i){var n=this;e=e||{};var o=document.getElementById(t)||this._controlBox;if(!o)return!1;var r={};d.default.mergeJSON(e,r);var s="<div id='controlwrapper' class='controlwrapper "+d.default.rValue(i)+"'>";for(var a in r){var l=(l=r[a])||{};s+="<div id='"+a+"' class='"+a+"  "+(d.default.rValue(l.className)?d.default.rValue(l.className):"camera-empty")+"'>",s+="<div class='ds-dvs-ui-iconfont "+d.default.rValue(l.iconClass)+"'></div>",s+="<text>"+d.default.rValue(l.text)+"</text>",s+="</div>"}for(var a in s+="</div>",o.innerHTML=s,r)!function(t){var e=(e=r[t])||{},i=d.default.rValue(e.onButtonClick),o=document.getElementById(t);o&&i&&(o.addEventListener("click",function(){n.emit(i)}),o.addEventListener("touchstart",function(t){}))}(a);document.body.addEventListener("touchstart",function(){})},g.prototype.showResultImage=function(t){this._resultImg&&(this._resultImg.style.display="block",this._resultImg.src=t,this._video.style.display="none")},g.prototype.hideResultImage=function(t){var e;this._resultImg&&((e=this._resultImg.src)&&!t&&URL.revokeObjectURL(e),this._resultImg.style.display="none",this._resultImg.src="",this._video.style.display="")},g.prototype._cropInit=function(){var t=this._video,e=this._cropComponent,i=this._cvsDrawArea.getBoundingClientRect();e.setValidAreaSize(t.clientWidth,t.clientHeight),e.setImageSize(t.clientWidth,t.clientWidth),e.bindCallback(this._cropCallback.bind(this)),e.canvasLeft=i.left,e.canvasTop=i.top;var o="mousedown",n="mousemove",r="mouseup";"ontouchstart"in window&&(o="touchstart",n="touchmove",r="touchend"),this._cvsDrawArea&&(this._cvsDrawArea.addEventListener(o,function(t){e.onStartHandler(t)}),this._cvsDrawArea.addEventListener(n,function(t){e.onMoveHandler(t)}),this._cvsDrawArea.addEventListener(r,function(t){e.onEndHandler(t)}))},g.prototype._cropCallback=function(t){var e=this._cvsDrawArea;if(e){var i=e.getContext("2d");if(!t)return i.clearRect(0,0,e.width,e.height),!1;this._clearCanvasRect(),i.strokeStyle="white",i.lineWidth=5,i.clearRect(0,0,e.width,e.height),i.save();var o=this._pixelRatio;i.beginPath(),i.moveTo(t[0]*o,t[1]*o);for(var n=1;n<=4;n++){var r=2*n%8;i.lineTo(t[r]*o,t[r+1]*o)}for(i.closePath(),i.stroke(),n=0;n<4;n++){var s=2*(n+1)%8,a=(t[r=2*n%8]+t[s])*o/2,l=(t[r+1]+t[1+s])*o/2;i.beginPath(),i.arc(t[r]*o,t[r+1]*o,5,0,2*Math.PI),i.closePath(),i.stroke(),i.beginPath(),i.arc(a,l,5,0,2*Math.PI),i.closePath(),i.stroke()}return i.restore(),!0}},g.prototype.getSourceList=function(){return this._cameraManager.getAllCamerasInfo()},g.prototype.selectSource=function(i){return s(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return d.default.isString(i)||this._throwParaTypeError(typeof i,"string"),this._cameraManager._allCamerasInfo&&0!==this._cameraManager._allCamerasInfo.length?[3,2]:[4,this._cameraManager.getAllCamerasInfo()];case 1:t.sent(),t.label=2;case 2:return(e=this._cameraManager.selectCamera(i))||this.emit("onThrowError",p.SOURCE_NOT_FOUND),[4,this.setCurrentCamera(e)];case 3:return t.sent(),[2,e]}})})},g.prototype.getCurrentSource=function(){return s(this,void 0,void 0,function(){return a(this,function(t){return this._camera?[2,this._camera._cameraInfo]:[2,null]})})},g.prototype.closeSource=function(){var o=this;return new Promise(function(t,e){var i;o._camera?(i=o._camera._cameraInfo,o._camera.destroy(),o._camera=null,t(i)):o.emit("onThrowError",p.NO_CAMERA_SELECTED)})},g.prototype.play=function(e,i,o){return s(this,void 0,void 0,function(){return a(this,function(t){return void 0!==e&&(d.default.isElement(e)?this._videoContainer&&e===this._videoContainer.parentNode||(this.playing()&&this.emit("onThrowError",p.VIDEO_NOT_STOP),this.bindUI(e,!1)):this._throwParaTypeError(typeof e,"HTMLElement")),[2,this.playDirectly(null,i,o)]})})},g.prototype.capture=function(){return s(this,void 0,void 0,function(){var i;return a(this,function(t){return this._camera||this.emit("onThrowError",p.NO_CAMERA_SELECTED),this._video?(this.playing()||this._throwError(p.VIDEO_NOT_PLAY),i=this._tempCanvas,this.calPixelRatio(),this._drawRealCameraArea(),[2,new Promise(function(e,t){i.toBlob(function(t){i.width=0,i.height=0,e(t)})})]):(this.emit("onThrowError",p.VIDEO_ELEMENT_REQUIRED),[2])})})},g.prototype.pause=function(){this._camera&&this._camera.pause()},g.prototype.stop=function(){this._camera&&(this._clearCanvasRect(),this._camera.stop())},g.prototype.resume=function(){this._camera&&this._camera.resume()},g.prototype.getStatus=function(){return this._camera?this.playing()?this.paused()?"paused":"playing":"stopped":""},g.prototype.getResolution=function(){return s(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return this._camera?[4,this._camera.getResolutions()]:[3,2];case 1:return[2,t.sent()];case 2:this.emit("onThrowError",p.NO_CAMERA_SELECTED),t.label=3;case 3:return[2]}})})},g.prototype.setResolution=function(e){return s(this,void 0,void 0,function(){return a(this,function(t){return this._camera?(d.default.isObject(e)||this._throwParaTypeError(typeof e,"Object"),0<e.width&&0<e.height||this._throwParaValueError(JSON.stringify(e),"resolution"),this.playing()?[2,this._camera.setResolution(e.width,e.height)]:[2,this._camera._curResolution=e]):(this.emit("onThrowError",p.NO_CAMERA_SELECTED),[2])})})},g.prototype.getCurrentResolution=function(){return s(this,void 0,void 0,function(){return a(this,function(t){return this._camera?[2,this._camera._curResolution]:(this.emit("onThrowError",p.NO_CAMERA_SELECTED),[2])})})},g);function g(t,e,i){this._cropComponent=null,this._isDrawing=!1,this._iResolution=null,this._camera=null,this._tempCanvas=document.createElement("canvas"),this.errorCode=0,this.errorMessage="Successful.",this._cropArea=[],this._logs="",this._videoContainer=null,this._video=null,this._resultImg=null,this._controlBox=null,this._cvsDrawArea=null,this._divScanArea=null,this._divScanLight=null,this._btnClose=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this.areaFillStyle="rgba(254,180,32,0.3)",this.lineStrokeStyle="rgba(254,180,32,0.9)",this.lineWidth=1,this._pub=new u.PublishSubscribe,this._cropComponent=new h.Crop({}),this._iResolution={deviceId:e,resolution:i},t&&this.bindUI(document.getElementById(t),!1),this._cameraManageInit(),this._bindEvents()}e.default=f},function(t,e,i){"use strict";var o=this&&this.__awaiter||function(t,s,a,l){return new(a=a||Promise)(function(i,e){function o(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}r((l=l.apply(t,s||[])).next())})},v=this&&this.__generator||function(i,o){var n,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&e[0]?r.return:e[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,e[1])).done)return s;switch(r=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=o.call(i,a)}catch(t){e=[6,t],r=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(5)).default.ErrorMessage,s=(a.prototype._requestCamera=function(){return o(this,void 0,void 0,function(){var e,i;return v(this,function(t){switch(t.label){case 0:if(this._cameraPermission)return[2,!1];void 0===navigator.mediaDevices&&(location.origin.startsWith("https://")?this._pub.emit("onThrowError",r.MEDIADEVICES_NOT_IMPL):this._pub.emit("onThrowError",r.HTTPS_REQUIRED)),void 0===navigator.mediaDevices.getUserMedia&&this._pub.emit("onThrowError",r.GETUSERMEDIA_NOT_IMPL),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}})];case 2:return(e=t.sent())&&(e.getTracks().forEach(function(t){t.stop()}),this._cameraPermission=!0),[3,4];case 3:throw i=t.sent(),this._pub.emit("onThrowError",i),i;case 4:return[2]}})})},a.prototype._bindEvents=function(){this._pub.on("onCameraSelChange",this._onCameraSelChange.bind(this))},a.prototype._trackCameraDeviceChanged=function(){var e=this;if(null==navigator.mediaDevices)return!1;navigator.mediaDevices.ondevicechange=function(t){e.getAllCamerasInfo().then(function(t){t&&e._fireCameraChanged(t)},function(t){e._pub.emit("onLog",t)})}},a.prototype.getAllCamerasInfo=function(){return o(this,void 0,void 0,function(){var e,i,o,n,r,s,a,l,h,c,u,d,p,f,g,m,_;return v(this,function(t){switch(t.label){case 0:return[4,this._requestCamera()];case 1:return t.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(e=t.sent(),i=[],n=o=0;n<e.length;n++)if("videoinput"==(r=e[n]).kind){for(s=!1,a=0,l=i;a<l.length;a++)if(l[a].deviceId===r.deviceId){s=!0;break}s||((h={}).deviceId=r.deviceId,h.label=!r.label||/^camera\s[0-9]+$/.test(r.label)?"camera "+o++:r.label,i.push(h))}if(c=!0,i.length==this._allCamerasInfo.length){for(d=u=0,p=i;d<p.length;d++)for(f=p[d],g=0,m=this._allCamerasInfo;g<m.length;g++)if((_=m[g]).deviceId==f.deviceId&&_.label==f.label){u++;break}c=u!=i.length}return c&&(this._allCamerasInfo=i,this._renderSelCameraInfo()),[2,Promise.resolve(this._allCamerasInfo)]}})})},a.prototype._fireCameraChanged=function(t){this._pub.emit("onCameraChanged",t)},a.prototype.destroy=function(){this.unbindCameraSelector(),this._pub.off("onCameraChanged"),this._selCameraInfo=null},a.prototype._fireCameraSelChanged=function(t){this._pub.emit("onCameraSelChanged",t)},a.prototype._renderSelCameraInfo=function(){var t={},e=null;if(this._cameraSelector){for(var i in t.deviceId=this._cameraSelector.value,t.label=this._cameraSelector.innerText,this._cameraSelector.innerHTML="",this._allCamerasInfo){var o=this._allCamerasInfo[i],n=document.createElement("option");n.value=o.deviceId,n.innerText=o.label,this._cameraSelector.append(n),t.deviceId==o.deviceId&&(e=n)}var r=this._cameraSelector.options;if(!e&&this._selCameraInfo&&r.length)for(var s=0;s<r.length;s++)if(this._selCameraInfo.deviceId==r.item(s).value){e=r.item(s);break}e&&(this._cameraSelector.value=e.value),!t.deviceId&&0==this._allCamerasInfo.length||this._onCameraSelChange()}},a.prototype.bindCameraSelector=function(t){var e=this;this.unbindCameraSelector(),this._cameraSelector=t||document.createElement("select"),this._cameraSelector&&(this._cameraSelector.addEventListener("change",function(){e._pub.emit("onCameraSelChange")}),this._renderSelCameraInfo())},a.prototype.unbindCameraSelector=function(){this._cameraSelector&&(this._cameraSelector.removeEventListener("change",this._onCameraSelChange),this._cameraSelector.innerHTML="",this._cameraSelector=null)},a.cameraExist=function(t,e){for(var i=0,o=e;i<o.length;i++){var n=o[i];if(n.deviceId==t.deviceId&&n.label==t.label)return!0}return!1},a.prototype.selectCamera=function(t){if(!t)return null;var e={};if(this._cameraSelector){var i=void 0,o=void 0;"object"==typeof t&&t&&(i=t.deviceId,o=t.label),"string"==typeof t&&(o=i=t);for(var n=this._cameraSelector.options,r=0;r<n.length;r++)if(i==(s=n[r]).value)return e.deviceId=s.value,e.label=s.innerText,this._cameraSelector.value=s.value,e;for(var s,r=0;r<n.length;r++)if(o==(s=n.item(r)).innerText)return e.deviceId=s.value,e.label=s.innerText,this._cameraSelector.value=s.value,e}if(this._allCamerasInfo)for(var a={deviceId:"",label:""},l=0;l<this._allCamerasInfo.length;l++){var h=this._allCamerasInfo[l];if(t===h.deviceId)return a.deviceId=h.deviceId,a.label=h.label,a}return null},a);function a(t){var o=this;this._cameraPermission=!1,this._allCamerasInfo=[],this._selCameraInfo=null,this._cameraSelector=null,this._onCameraSelChange=function(){var t=!0;o._selCameraInfo&&0<o._cameraSelector.options.length&&o._selCameraInfo.deviceId==o._cameraSelector.value&&(t=!1);var e={},i=o._cameraSelector.selectedOptions;t&&(i&&0<i.length?(e.deviceId=i[0].value,e.label=i[0].innerText):e=o._allCamerasInfo[0]),e.deviceId?o._selCameraInfo=e:e=null,t&&o._fireCameraSelChanged(e)},this._pub=t,this._trackCameraDeviceChanged(),this._bindEvents()}e.default=s},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,s,a,l){return new(a=a||Promise)(function(i,e){function o(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}r((l=l.apply(t,s||[])).next())})},f=this&&this.__generator||function(i,o){var n,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&e[0]?r.return:e[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,e[1])).done)return s;switch(r=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=o.call(i,a)}catch(t){e=[6,t],r=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(5)),s=i(47),p=r.default.ErrorMessage,a=(l.prototype.setPlugout=function(){this._isPlugOut=!0},l.prototype._checkPlugout=function(){this._isPlugOut&&this._pub.emit("video-error",p.CAMERA_PLUG_OUT)},l.prototype._initBrowserInfo=function(t){this._browserInfo=t||this._getBrowser()},l.prototype._getBrowser=function(){var t=new s.BrowserDetect;return{safari:"Safari"==t.browser,chrome:"Chrome"==t.browser,firefox:"Firefox"==t.browser,mobile:t.detectmobilebrowser()}},l.prototype._fireResolutionChanged=function(t,e,i){var o={};o.width=t,o.height=e,o.type=i,this._pub.emit("onResolutionChanged",o)},l.prototype._renderSelResolution=function(){var t,e={},i=null;if(!this._resolutionSelector||(t=this._resolutionSelector.options[this._resolutionSelector.selectedIndex])&&(e=JSON.parse(t.value),this._resolutionSelector.innerHTML=""),this._resolutionSelector){for(var o=0,n=this._allResolutions;o<n.length;o++){var r=n[o],s=document.createElement("option");s.value=JSON.stringify(r),s.innerText=r.width+" x "+r.height,this._resolutionSelector.append(s),e.width==r.width&&e.height==r.height&&(i=s)}var a=this._resolutionSelector.options;if(!i&&this._curResolution&&a.length)for(var l=JSON.stringify(this._curResolution),h=0;h<a.length;h++)if(l==a.item(h).value){i=a.item(h);break}i&&(this._resolutionSelector.value=i.value),!e.width&&0==this._allResolutions.length||this._onResolutionSelChange()}},l.prototype.bindResolutionsSelector=function(t){var e=this;this.unbindResolutionsSelector(),this._checkPlugout(),this._resolutionSelector=t||document.createElement("select"),this._resolutionSelector&&(this._resolutionSelector.addEventListener("change",function(){e._pub.emit("onResolutionSelChange")}),this._renderSelResolution())},l.prototype.unbindResolutionsSelector=function(){this._resolutionSelector&&this._resolutionSelector.removeEventListener("change",this._onResolutionSelChange),this._resolutionSelector=null},l.prototype._getResolution=function(h,c,u,d){return n(this,void 0,void 0,function(){var e,i,o,n,r,s,a,l;return f(this,function(t){switch(t.label){case 0:this._checkPlugout(),e={},o=i=null,t.label=1;case 1:return t.trys.push([1,5,,6]),this._fireLog("request constraints: width="+c+", height="+u),[4,this._getMediaStream(this._getMediaTrackConstraints(h,c,u,d,!1))];case 2:return(i=t.sent())?(document&&document.createElement?o=document.createElement("video"):this._videoEle?o=this._videoEle:this._pub.emit("onThrowError",p.VIDEO_ELEMENT_REQUIRED),n="exact"==d,!this._browserInfo.firefox&&n?[3,4]:(o.srcObject=i,[4,o.play()])):[2,e];case 3:t.sent(),t.label=4;case 4:return e.type=d,n?(r=i.getVideoTracks()[0],(s=r.getConstraints())&&s.width?(e.height=s.height.exact?s.height.exact:s.height,e.width=s.width.exact?s.width.exact:s.width,this._fireLog("Result constraints: "+JSON.stringify(s))):(a=r.getSettings(),e.height=a.height.exact?a.height.exact:a.height,e.width=a.width.exact?a.width.exact:a.width,this._fireLog("Result constraints(getSettings): "+JSON.stringify(a)))):(e.height=o.videoHeight,e.width=o.videoWidth),[3,6];case 5:return l=t.sent(),this._fireLog("_getResolution exception:"+(l.message||l)),[3,6];case 6:return i?(this._browserInfo.firefox&&(o.srcObject=null),[4,i.getTracks().forEach(function(t){t.stop()})]):[3,8];case 7:t.sent(),o=i=null,t.label=8;case 8:return[2,e]}})})},l.prototype.getResolutions=function(){return n(this,void 0,void 0,function(){var e,i,o,n,r,s,a,l,h,c,u,d,p;return f(this,function(t){switch(t.label){case 0:if(0<this._allResolutions.length)return[2,this._allResolutions];e=[],i=[{width:320,height:240,type:"exact"},{width:640,height:480,type:"exact"},{width:640,height:360,type:"exact"},{width:800,height:600,type:"exact"},{width:1280,height:720,type:"exact"},{width:1920,height:1080,type:"exact"},{width:2560,height:1440,type:"exact"},{width:3840,height:2160,type:"exact"}],o=null,this._allResolutions=[],n=0,r=i,t.label=1;case 1:return n<r.length?(s=r[n],a=s.height,l=s.width,h=s.type,this._cameraInfo?[4,this._getResolution(this._cameraInfo.deviceId,l,a,h)]:[2,null]):[3,6];case 2:return(o=t.sent())&&o.height&&(!o||!o.height||o.height==a&&o.width==l||o.height==l&&o.width==a)?[3,4]:(this._fireLog("getResolutions try to get ideal resolution: "+l+" x "+a),this._cameraInfo?[4,this._getResolution(this._cameraInfo.deviceId,l,a,"ideal")]:[2,null]);case 3:o=t.sent(),t.label=4;case 4:if(o&&o.height){for(c=!1,u=0,d=e;u<d.length;u++)if((p=d[u]).height==o.height&&p.width==o.width){c=!0;break}if(!c){if(this._fireLog("got resolution: "+JSON.stringify(o)),delete o.type,e.push(o),null===this._allResolutions)return[2,null];this._allResolutions.push(o)}}t.label=5;case 5:return n++,[3,1];case 6:return this._renderSelResolution(),[2,e]}})})},l.prototype.setResolution=function(e,i){return n(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return this._checkPlugout(),[4,this.play(e,i)];case 1:return[2,t.sent()]}})})},l.prototype.getVideoSettings=function(){return JSON.parse(JSON.stringify(this.videoSettings))},l.prototype.updateVideoSettings=function(t){return this.videoSettings=JSON.parse(JSON.stringify(t)),this.play()},l.prototype.destroy=function(){this.unbindResolutionsSelector(),this.stop(),this._cameraInfo=null,this._allCameras=null,this._allResolutions=null,this._videoEle=null},l.prototype.stop=function(){this._videoEle&&this._videoEle.srcObject&&(this._fireLog("======stop video========"),this._videoEle.srcObject.getTracks().forEach(function(t){t.stop()}),this._videoEle.srcObject=null,this._videoTrack=null)},l.prototype.pause=function(){this._videoEle&&this._videoEle.pause()},l.prototype.resume=function(){this._videoEle&&this.paused()&&this.playing()&&this._videoEle.play()},l.prototype.paused=function(){return!!this._videoEle&&this._videoEle.paused},l.prototype.playing=function(){if(this._isPlugOut)return!1;if(this._videoEle&&this._videoEle.srcObject)try{var t=this._videoEle.srcObject;if(t){var e=t.getVideoTracks();if(e&&0!=e.length)return!0}}catch(t){this._fireLog("get video status: "+(t.message||t))}return!1},l.prototype._getMediaTrackConstraints=function(t,e,i,o,n){var r=JSON.parse(JSON.stringify(this.videoSettings));"boolean"==typeof r.video&&(r.video={});var s="exact"==o;if(e&&(r.video.width=s?{exact:e}:{ideal:e}),i&&(r.video.height=s?{exact:i}:{ideal:i}),n&&(e&&(r.video.width={ideal:e}),i&&(r.video.height={ideal:i})),this._browserInfo.mobile&&this._browserInfo.safari&&n&&(r.video.width=r.video.height,delete r.video.height),t)delete r.video.facingMode,r.video.deviceId={exact:t};else if(r.video.facingMode){var a=r.video.facingMode;if(a instanceof Array&&a.length&&(a=a[0]),"environment"===(a=a.exact||a.ideal||a)&&this._allCameras){for(var l=0,h=this._allCameras;l<h.length;l++){var c=h[l],u=c.label.toLowerCase();if(u&&-1!=u.indexOf("facing back")&&/camera[0-9]?\s0,/.test(u)){delete r.video.facingMode,r.video.deviceId={ideal:c.deviceId};break}}r.bFmEnvironment=!!r.video.facingMode}}return r},l.prototype._getMediaStream=function(i,o){return n(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:this._fireLog("======try getUserMedia========"),"boolean"==typeof i.video&&(i.video={}),this._fireLog("ask "+JSON.stringify(i.video.width)+"x"+JSON.stringify(i.video.height)),t.label=1;case 1:return t.trys.push([1,3,,4]),this._fireLog(i),[4,navigator.mediaDevices.getUserMedia(i)];case 2:return[2,t.sent()];case 3:if(e=t.sent(),this._fireLog(e),e.name&&"OverconstrainedError"==e.name){if(o)throw e;return[2,null]}return this._fireLog("======try getUserMedia again========"),this._browserInfo.mobile&&this._browserInfo.safari?(delete i.video.width,delete i.video.height):i.bFmEnvironment?(delete i.video.facingMode,this._allCameras&&this._allCameras.length&&(i.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):i.video=!0,this._fireLog(i),[2,navigator.mediaDevices.getUserMedia(i)];case 4:return[2]}})})},l.prototype._supportedResolution=function(t,e){for(var i=0,o=this._allResolutions;i<o.length;i++){var n=o[i];if(n.height==e&&n.width==t)return n.type}return"ideal"},l.prototype.play=function(c,u){return n(this,void 0,void 0,function(){var e,i,o,n,r,s,a,l,h;return f(this,function(t){switch(t.label){case 0:this._videoEle||this._pub.emit("onThrowError",p.VIDEO_ELEMENT_REQUIRED),"number"==typeof c&&0<c&&"number"==typeof u&&0<u||(c=this._curResolution?this._curResolution.width:1280,u=this._curResolution?this._curResolution.height:720),e=this._supportedResolution(c,u),this._checkPlugout(),this.stop(),this._fireLog("======before video========"),this.videoSettings=this._getMediaTrackConstraints(this._cameraInfo.deviceId,c,u,e,!0),i=this.videoSettings,o=null,n={},t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._getMediaStream(i,!0)];case 2:return(o=t.sent())&&(r=o.getVideoTracks()).length&&(this._videoTrack=r[0],n=this._videoTrack.getSettings(),s={deviceId:n.deviceId,label:this._videoTrack.label},this._cameraInfo=s),[3,4];case 3:return a=t.sent(),this._fireLog("======get user media exception========"+(a.message||a)),"NotAllowedError"===a.name||"Permission denied"===a.message?this._pub.emit("onThrowError",p.CAMERA_NOT_OPEN):this._pub.emit("onThrowError",p.FAILED_GET_USERMEDIA),[3,4];case 4:this._videoEle.srcObject=o,this._fireLog("======play video========"),t.label=5;case 5:return t.trys.push([5,7,,10]),[4,this._videoEle.play()];case 6:return t.sent(),[3,10];case 7:return l=t.sent(),this._fireLog("======play video exception========"+(l.message||l)),[4,new Promise(function(t){setTimeout(t,1e3)})];case 8:return t.sent(),[4,this._videoEle.play()];case 9:return t.sent(),[3,10];case 10:return this._fireLog("======after played video========"),h=n.width?{width:n.width,height:n.height}:{width:this._videoEle.videoWidth,height:this._videoEle.videoHeight},this._curResolution=h,this._pub.emit("onPlayed"),[2,h]}})})},l.prototype.getCapabilities=function(){return this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}},l.prototype.getCameraSettings=function(){return this._videoTrack.getSettings()},l.prototype.getConstraints=function(){return this._videoTrack.getConstraints()},l.prototype._throwNotSupportException=function(){this._pub.emit("onThrowError",p.CAMERA_SETTINGS_NOT_SUPPORT)},l.prototype._fireLog=function(t){this._pub.emit("onLog",t)},l.prototype.applyConstraints=function(e){return n(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return this._videoTrack.applyConstraints||this._throwNotSupportException(),[4,this._videoTrack.applyConstraints(e)];case 1:return[2,t.sent()]}})})},l.prototype.turnOnTorch=function(){return n(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return this.getCapabilities().torch?[4,this._videoTrack.applyConstraints({advanced:[{torch:!0}]})]:[3,2];case 1:return[2,t.sent()];case 2:this._throwNotSupportException(),t.label=3;case 3:return[2]}})})},l.prototype.turnOffTorch=function(){return n(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return this.getCapabilities().torch?[4,this._videoTrack.applyConstraints({advanced:[{torch:!1}]})]:[3,2];case 1:return[2,t.sent()];case 2:this._throwNotSupportException(),t.label=3;case 3:return[2]}})})},l.prototype.setColorTemperature=function(i){return n(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return(e=this.getCapabilities().colorTemperature)||this._throwNotSupportException(),i<e.min?i=e.min:i>e.max&&(i=e.max),[4,this._videoTrack.applyConstraints({advanced:[{colorTemperature:i}]})];case 1:return[2,t.sent()]}})})},l.prototype.setExposureCompensation=function(i){return n(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return(e=this.getCapabilities().exposureCompensation)||this._throwNotSupportException(),i<e.min?i=e.min:i>e.max&&(i=e.max),[4,this._videoTrack.applyConstraints({advanced:[{exposureCompensation:i}]})];case 1:return[2,t.sent()]}})})},l.prototype.setZoom=function(i){return n(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return(e=this.getCapabilities().zoom)||this._throwNotSupportException(),i<e.min?i=e.min:i>e.max&&(i=e.max),[4,this._videoTrack.applyConstraints({advanced:[{zoom:i}]})];case 1:return[2,t.sent()]}})})},l.prototype.setFrameRate=function(i){return n(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return(e=this.getCapabilities().frameRate)||this._throwNotSupportException(),i<e.min?i=e.min:i>e.max&&(i=e.max),[4,this._videoTrack.applyConstraints({width:{ideal:Math.max(this._videoEle.videoWidth,this._videoEle.videoHeight)},frameRate:i})];case 1:return[2,t.sent()]}})})},l);function l(t,e,i,o,n){var r=this;this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this._browserInfo={chrome:!1,firefox:!1,safari:!1,mobile:!1},this._isPlugOut=!1,this._resolutionSelector=null,this._cameraInfo=null,this._allCameras=null,this._videoTrack=null,this._allResolutions=[],this._curResolution=null,this._videoEle=null,this._onResolutionSelChange=function(){var t,e,i=!0;r._curResolution&&0<r._resolutionSelector.options.length&&JSON.stringify(r._curResolution)==r._resolutionSelector.value&&(i=!1),0<r._resolutionSelector.options.length&&(e={},r._resolutionSelector&&-1!=r._resolutionSelector.selectedIndex&&(t=r._resolutionSelector.options[r._resolutionSelector.selectedIndex],e=JSON.parse(t.value)),r.play(e.width,e.height).then(function(){i&&r._fireResolutionChanged(e.width,e.height,e.type)}).catch(function(t){r._fireLog("Play video failed: "+(t.message||t))}))},this._pub=n,this._initBrowserInfo(o),t?this._cameraInfo=t:(this._cameraInfo={},this._cameraInfo.deviceId="",this._cameraInfo.label=""),e&&(this._videoEle=e),this._allCameras=i,this._pub.on("onResolutionSelChange",this._onResolutionSelChange.bind(this))}e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.init=function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS"},n.prototype.searchString=function(t){for(var e=0;e<t.length;e++){var i=t[e].string,o=t[e].prop;if(this.versionSearchString=t[e].versionSearch||t[e].identity,i){if(-1!=i.indexOf(t[e].subString))return t[e].identity}else if(o)return t[e].identity}},n.prototype.searchVersion=function(t){var e=t.indexOf(this.versionSearchString);if(-1!=e)return parseFloat(t.substring(e+this.versionSearchString.length+1))},n.prototype.detectmobilebrowser=function(){var t=window,e=navigator.userAgent||navigator.vendor||t.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|android|playbook|silk|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))return!0;if(null!==e.match(/Macintosh/i)){var i=document.createElement("canvas");if(null!==i){var o=i.getContext("webgl")||i.getContext("experimental-webgl");if(o){var n=o.getExtension("WEBGL_debug_renderer_info");if(n&&-1!==o.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Apple"))return!0}}}return!1},n);function n(){this.dataBrowser=[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],this.dataOS=[{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],this.init()}e.BrowserDetect=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype._init=function(t){for(var e=Object.keys(t),i=0,o=e.length;i<o;i++)this[e[i]]=t[e[i]]},n.prototype.bindCallback=function(t){this._callback=t},n.prototype.setZoom=function(t,e){this.zoomX=t,this.zoomY=e},n.prototype.setValidAreaSize=function(t,e){this.outerWidth=t,this.outerHeight=e},n.prototype.setMoveDistance=function(t,e){this.moveLeft=t,this.moveTop=e},n.prototype.setImageSize=function(t,e){this.width=t,this.height=e},n.prototype.setFreeCropBox=function(t){if(this.mode=1,!this.isCrop)return!1;if(8!==t.length)return!1;if(!this.checkRectConvexity(t))return!1;for(var e=0;e<4;e++){var i=this.getPointToCanvas(t[2*e],t[2*e+1]),i=this.transformToCanvasCenterCoordinate(i.x,i.y);t[2*e]=i.x,t[2*e+1]=i.y}return this.vertexes=t.slice(),this.midpoints=this.calcMidpoint(t).slice(),this.probePoints=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),this._publish(),!0},n.prototype.setCropArea=function(t,e,i,o){this.mode=0;var n=[t,e,t+i,e,t+i,e+o,t,e+o];if(!this.isCrop)return!1;if(8!==n.length)return!1;if(!this.checkRectConvexity(n))return!1;for(var r=0;r<4;r++){var s=this.transformToImageCenterCoordinate(n[2*r],n[2*r+1]),s=this.getPointToCanvas(s.x,s.y);n[2*r]=s.x,n[2*r+1]=s.y}return this.vertexes=n.slice(),this.midpoints=this.calcMidpoint(n).slice(),this.probePoints=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),this._publish(),!0},n.prototype.transformToImageCenterCoordinate=function(t,e){return{x:t-=this.width/2,y:e-=this.height/2}},n.prototype.transformToCanvasCenterCoordinate=function(t,e){return{x:t-=this.outerWidth/2,y:e-=this.outerHeight/2}},n.prototype.transformToCanvasLeftTopCoordinate=function(t,e){return{x:t+=this.outerWidth/2,y:e+=this.outerHeight/2}},n.prototype.calcMidpoint=function(t){for(var e=t.slice(0,8).concat(t[0],t[1]),i=[],o=0;o<4;o++){var n=(e[2*o]+e[2*o+2])/2,r=(e[2*o+1]+e[2*o+3])/2;i.push(n,r)}return i},n.prototype.calcSlopeRatio=function(t){for(var e=[],i=null,o=t.slice(0,8).concat(t[0],t[1]),n=0;n<4;n++)i=o[2*n+3]-o[2*n+1]==0&&o[2*n+2]-o[2*n]==0?0:(o[2*n+3]-o[2*n+1])/(o[2*n+2]-o[2*n]),e.push(i);return e},n.prototype.checkRectConvexity=function(t){var e=(t[6]-t[0])*(t[3]-t[1])-(t[7]-t[1])*(t[2]-t[0]),i=(t[0]-t[2])*(t[5]-t[3])-(t[1]-t[3])*(t[4]-t[2]),o=(t[2]-t[4])*(t[7]-t[5])-(t[3]-t[5])*(t[6]-t[4]),n=(t[4]-t[6])*(t[1]-t[7])-(t[5]-t[7])*(t[0]-t[6]);if(e*i*o*n<0)return!1;var r=t.slice().concat(t.slice(0,2));if(this.slopeRatio.length)for(var s=0;s<2;s++)if(this.slopeRatio[s]!==this.slopeRatio[s+2]&&this.calcIntersection(r.slice(2*s,2*s+2),r.slice(2*s+2,2*s+4),r.slice(2*s+4,2*s+6),r.slice(2*s+6,2*s+8)))return!1;return 0<e*i*o*n},n.prototype.checkImageEdge=function(t,e){var i=this.getPointToCanvas(0,0),o=this.getPointToCanvas(this.width,this.height),n=o.x-i.x,r=o.y-i.y;return-n/2<=t&&t<=n/2&&-r/2<=e&&e<=r/2},n.prototype.getPointToImage=function(t,e){return{x:t=(t-(this.outerWidth/2-this.width*this.zoomX/2-this.moveLeft))/this.zoomX,y:e=(e-(this.outerHeight/2-this.height*this.zoomY/2-this.moveTop))/this.zoomY}},n.prototype.getPointToCanvas=function(t,e){return{x:t=t*this.zoomX+(this.outerWidth/2-this.width*this.zoomX/2-this.moveLeft),y:e=e*this.zoomY+(this.outerHeight/2-this.height*this.zoomY/2-this.moveTop)}},n.prototype.checkProbePoint=function(t,e){for(var i=this.sensorRadius,o=0;o<8;o++){var n=this.probePoints[2*o],r=this.probePoints[2*o+1],s={x:t,y:e};if(this.transformStack&&(s=this.transformStack.setPointTransform(t,e)),s.x<=n+i&&s.x>=n-i&&s.y<=r+i&&s.y>=r-i)return o}return null},n.prototype.pointRotate=function(t,e,i,o,n){return n%360?(n=n/180*Math.PI,{x:(t-i)*Math.cos(n)-(e-o)*Math.sin(n)+i,y:(t-i)*Math.sin(n)+(e-o)*Math.cos(n)+o}):{x:t,y:e}},n.prototype.onStartHandler=function(t){var e,i,o,n;this.isCrop&&(e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,this._StartX=e-this.canvasLeft,this._StartY=i-this.canvasTop,o={x:this._StartX,y:this._StartY},o=this.transformToCanvasCenterCoordinate(o.x,o.y),null!==(n=this.checkProbePoint(o.x,o.y))?(this.isPointSelected=!0,this.activeProbePoint=n):(this.isPointSelected=!1,this.activeProbePoint=null))},n.prototype.onMoveHandler=function(t){if(this.isPointSelected&&null!==this.activeProbePoint){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,o=e-this.canvasLeft,n=i-this.canvasTop,r=this.activeProbePoint,s=this.transformToCanvasCenterCoordinate(o,n);this.transformStack&&(s=this.transformStack.setPointTransform(s.x,s.y));for(var a=s.x,l=s.y,h=this.probePoints.slice(),h=0===this.mode?this._moveNormalCropBox(h,r,a,l):this._moveFreeCropBox(h,r,a,l),c=!1,u=0;u<4;u++)if(!this.checkImageEdge(h[2*u],h[2*u+1])){c=!0;break}c||(this.probePoints=h.slice()),this.checkRectConvexity(this.probePoints)?(this._lineColor=this.defaultLinecolor,this._firstPointColor=this.defaultFirstPointColor):(this._lineColor=this.invalidLineColor,this._firstPointColor=this.invalidFirstPointColor);var d=this.calcMidpoint(this.probePoints);this.probePoints=this.probePoints.slice(0,8).concat(d),this._publish()}},n.prototype.onEndHandler=function(t){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,o=e-this.canvasLeft,n=i-this.canvasTop,r=this._StartX,s=this._StartY;if(this._StartX=0,this._StartY=0,this._lineColor=this.defaultLinecolor,this._firstPointColor=this.defaultFirstPointColor,this.isPointSelected&&null!==this.activeProbePoint){this.activeProbePoint=null,this.isPointSelected=!1;var a=this.checkRectConvexity(this.probePoints);if(r===o&&s===n||!a)return this.probePoints=this.vertexes.slice().concat(this.midpoints),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),void this._publish();this.vertexes=this.probePoints.slice(0,8),this.midpoints=this.probePoints.slice(8,16),this._publish()}},n.prototype._moveNormalCropBox=function(t,e,i,o){var n,r,s,a,l,h;return e<4?(n=i-t[2*e],r=o-t[2*e+1],t[2*e]=i,t[2*e+1]=o,s=(e+1)%4,a=(e+3)%4,e%2?(t[2*s]+=n,t[2*a+1]+=r):(t[2*s+1]+=n,t[2*a]+=r)):(l=e-4,0===(h=this.slopeRatio[l%4])?(t[(2*l+3)%8]=o,t[(2*l+1)%8]=o):h!==1/0&&h!==-1/0||(t[(2*l+2)%8]=i,t[(2*l+0)%8]=i)),t},n.prototype._moveFreeCropBox=function(t,e,i,o){var n,r,s,a,l,h,c,u,d,p,f,g,m,_;return e<4?(n=this.getPointToCanvas(0,0),s=(r=this.getPointToCanvas(this.width,this.height)).x-n.x,a=r.y-n.y,t[2*e]=i,t[2*e+1]=o,t[2*e]=Math.min(Math.max(-s/2,t[2*e]),s/2),t[2*e+1]=Math.min(Math.max(-a/2,t[2*e+1]),a/2),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4)):(l=e-4,u=-(c=o-(h=this.slopeRatio[l%4])*i)/h,p=-(d=t[(2*l+9)%8]-h*t[(2*l+8)%8])/h,f=this.slopeRatio[(1+l)%4],g=t[(2*l+3)%8]-f*t[(2*l+2)%8],m=this.slopeRatio[(3+l)%4],_=t[(2*l+1)%8]-m*t[(2*l+0)%8],0===h?(t[(2*l+3)%8]=o,f!==1/0&&f!==-1/0&&(t[(2*l+2)%8]=(o-g)/f),t[(2*l+1)%8]=o,m!==1/0&&m!==-1/0&&(t[(2*l+0)%8]=(o-_)/m)):h===1/0||h===-1/0?(t[(2*l+2)%8]=i,t[(2*l+3)%8]=f*i+g,t[(2*l+0)%8]=i,t[(2*l+1)%8]=m*i+_):(0===f?t[(2*l+2)%8]+=u-p:f===1/0||f===-1/0?t[(2*l+3)%8]+=c-d:(t[(2*l+2)%8]=(g-c)/(h-f),t[(2*l+3)%8]=(f*c-h*g)/(f-h)),0===m?t[(2*l+0)%8]+=u-p:m===1/0||m===-1/0?t[(2*l+1)%8]+=c-d:(t[(2*l+0)%8]=(_-c)/(h-m),t[(2*l+1)%8]=(m*c-h*_)/(m-h)))),t},n.prototype._publish=function(){if(this._callback){for(var t=this.probePoints.slice(0,8),e=0;e<4;e++){var i=this.transformToCanvasLeftTopCoordinate(t[2*e],t[2*e+1]),i=this.getPointToImage(i.x,i.y);t[2*e]=i.x,t[2*e+1]=i.y}this._callback(t.slice())}},n.prototype.calcIntersection=function(t,e,i,o){if(this._isRectCross(t,e,i,o)&&this._isLineSegmentCross(t,e,i,o)){var n,r=void 0,s=(o[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-o[1]),r=(t[1]-i[1])*(e[0]-t[0])*(o[0]-i[0])+i[0]*(o[1]-i[1])*(e[0]-t[0])-t[0]*(e[1]-t[1])*(o[0]-i[0]);if(0==s||0===r){var a=this._getLine(t,e),l=this._getLine(i,o),h=a[0],c=a[1],u=l[0],d=l[1];if(c[0]===u[0]&&c[1]===u[1])return c;if(h[0]===d[0]&&h[1]===d[1])return h;if(this._isOnLine(c,l)&&this._isOnLine(u,a))return[u,c];if(this._isOnLine(h,l)&&this._isOnLine(d,a))return[h,d];if(this._isOnLine(h,l)&&this._isOnLine(c,l))return[h,c];if(this._isOnLine(u,l)&&this._isOnLine(d,l))return[u,d]}return n=r/s,s=(t[0]-e[0])*(o[1]-i[1])-(e[1]-t[1])*(i[0]-o[0]),[n,(r=e[1]*(t[0]-e[0])*(o[1]-i[1])+(o[0]-e[0])*(o[1]-i[1])*(t[1]-e[1])-o[1]*(i[0]-o[0])*(e[1]-t[1]))/s]}return!1},n.prototype._getLine=function(t,e){return t[0]===e[0]?t[1]<e[1]?[t,e]:[e,t]:t[0]<e[0]?[t,e]:[e,t]},n.prototype._isOnLine=function(t,e){return e[0][0]===e[1][0]?t[1]>=e[0][1]&&t[1]<=e[1][1]:t[0]>=e[0][0]&&t[0]<=e[1][0]},n.prototype._isRectCross=function(t,e,i,o){var n=Math.min,r=Math.max;return n(t[0],e[0])<=r(i[0],o[0])&&n(i[0],o[0])<=r(t[0],e[0])&&n(t[1],e[1])<=r(i[1],o[1])&&n(i[1],o[1])<=r(t[1],e[1])},n.prototype._isLineSegmentCross=function(t,e,i,o){var n=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),r=t[0]*(o[1]-e[1])+e[0]*(t[1]-o[1])+o[0]*(e[1]-t[1]);return!(0<=(n^r)&&0!==n&&0!==r||0<=((n=i[0]*(t[1]-o[1])+o[0]*(i[1]-t[1])+t[0]*(o[1]-i[1]))^(r=i[0]*(e[1]-o[1])+o[0]*(i[1]-e[1])+e[0]*(o[1]-i[1])))&&0!==n&&0!==r)},n);function n(t){this.mode=0,this.vertexes=[],this.midpoints=[],this.probePoints=[],this.slopeRatio=[],this.isCrop=!1,this.probePointRadius=6,this.sensorRadius=10,this.defaultLinecolor="rgba(0,0,0,1)",this.defaultFirstPointColor="rgba(255,0,0,1)",this.invalidLineColor="rgba(255,0,0,1)",this.invalidFirstPointColor="rgba(0,0,0,1)",this._lineColor="rgba(0,0,0,1)",this._firstPointColor="rgba(255,0,0,1)",this.pointFillColor="rgba(255,255,255,0)",this.lineWidth=2,this.dashLine=[4,2],this.isPointSelected=!1,this.activeProbePoint=null,this.moveLeft=0,this.moveTop=0,this._StartX=0,this._StartY=0,this.canvasLeft=0,this.canvasTop=0,this.angle=0,this.width=0,this.height=0,this.outerWidth=0,this.outerHeight=0,this.zoomX=1,this.zoomY=1,this._callback=null,this.transformStack=null,this._init(t)}e.Crop=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(n.cameraException=function(t,e){var i={};return(i=new Error(e||t.message)).code=t.code,i},n);function n(){}e.default=o},function(t,e,i){"use strict";var a=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var o=Array(t),n=0,e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o};Object.defineProperty(e,"__esModule",{value:!0});var o=(n.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)},n.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var n=this._events[t];if(!n||0===n.length)return!1;for(var r=n.length,s=0;s<r;s++)(e=n[s]).call.apply(e,a([null],i))},n.prototype.off=function(t,e){var i=this._events[t];if(!i)return!1;if(e)for(var o=i.length,n=0;n<o;n++)i[n]===e&&i.splice(n,1);else i&&(i.length=0)},n);function n(){this._events=[]}e.PublishSubscribe=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={isArray:function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isBoolean:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},isElement:function(t){return t instanceof HTMLElement},mergeJSON:function(t,e){for(var i in t)void 0!==e[i]&&this.isObject(t[i])?this.mergeJSON(t[i],e[i]):e[i]=t[i]},rValue:function(t){return void 0===t?"":t}}},function(t,e,i){},function(t,e,i){}]);