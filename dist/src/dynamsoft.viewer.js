/*! Date: Mon Jun 08 2020 15:02:16 GMT+0800 (China Standard Time) */!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={extend:function(t,e){},isArray:function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isBoolean:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},isColor:function(t){var e=document.createElement("span");return e.style.background=t,!!e.style.background},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},addEvent:function(t,e,i,n){try{if(!t)throw new Error("element is not exit");t.addEventListener(e,i,n)}catch(t){console.log(t)}},mergeJSON:function(t,e){for(var i in t)void 0===e[i]?e[i]=t[i]:this.isObject(t[i])?this.mergeJSON(t[i],e[i]):e[i]=t[i]},ajax:function(t,e){},throttle:function(t,e,i){var n=!0;return function(){var o=this;n&&(n=!1,setTimeout((function(){t.apply(o,i),n=!0}),e))}},stable:function(t,e,i){var n;return void 0===i&&(i=!1),function(){var o=this;i?t.apply(this):(n&&clearTimeout(n),n=setTimeout((function(){t.apply(o)}),e))}},query:function(t){return document.querySelector(t)},queryAll:function(t){return Array.from?Array.from(document.querySelectorAll(t)):this.arrayFrom(document.querySelectorAll(t))},arrayFrom:function(t){var e=[];if(this.isArray(t))for(var i=0;i<t.length;i++)e.push(t[i]);else if(this.isObject)for(var n=Object.keys(t),o=0;o<n.length;o++)e.push(t[n[o]]);else e=[];return e},stopBubble:function(t){t&&t.stopPropagation?t.stopPropagation():t&&(t.cancelBubble=!0)},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},id:function(t){return document.getElementById(t)},hiddenByQuery:function(t){var e=this.query(t);this.hiddenByDom(e)},hiddenByDom:function(t){t.classList.contains("DVS_nodisplay")||t.classList.add("DVS_nodisplay")},animation:function(t,e,i,n,o){if(void 0===n&&(n=200),void 0===o&&(o=13),!this.isString(e)||!this.isNumber(i))return!1;var r=!1;this.isString(t[e])&&-1!==t[e].indexOf("px")&&(r=!0);var s=parseInt(t[e]);if(this.isNumber(s))var a=(i-s)/o,l=setInterval((function(){a>0&&s<i?s+=a:a<0&&s>i?s+=a:(clearInterval(l),s=i),t[e]=r?s+"px":s}),n/o)},toggleHidden:function(t){t.classList.toggle("DVS_hidden")},toggleDisplayByDom:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=window.event);var n=!t.classList.toggle("DVS_nodisplay");return e&&this.stopBubble(i),n},toggleDisplayByQuery:function(t,e){void 0===e&&(e=!0);var i=this.query(t);return this.toggleDisplayByDom(i,e)},isFullscreen:function(){var t=window.document;return t.fullscreenElement||t.msFullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||!1},launchFullscreen:function(t){return t.requestFullscreen?(t.requestFullscreen(),!0):t.mozRequestFullScreen?(t.mozRequestFullScreen(),!0):t.msRequestFullscreen?(t.msRequestFullscreen(),!0):t.oRequestFullscreen?(t.oRequestFullscreen(),!0):t.webkitRequestFullscreen?(t.webkitRequestFullScreen(),!0):(alert("Your browser does not support full screen!"),!1)},exitFullscreen:function(){var t=window.document;return t.exitFullScreen?(t.exitFullScreen(),!0):t.mozCancelFullScreen?(t.mozCancelFullScreen(),!0):t.webkitExitFullscreen?(t.webkitExitFullscreen(),!0):t.msExitFullscreen?(t.msExitFullscreen(),!0):void 0},getIndex:function(t){for(var e=t.parentNode.children,i=0;i<e.length;i++)if(e[i]===t)return i},getByClass:function(t){return document.getElementsByClassName(t)},insertAfter:function(t,e){var i=e.parentNode;i.lastChild==e?i.appendChild(t):i.insertBefore(t,e.nextSibling)},throw:function(t){throw new Error("WebViewer_Error: ErrorCode: "+t.errorCode+" ErrorString: "+t.message)},error:function(t){console.log("WebViewer_Error: ErrorCode: "+t.errorCode+" ErrorString: "+t.message)},uid:function(t){var e=Math.random().toString(35).substr(2);return e.length<11&&(e+=Math.random().toString(35).substr(2)),e=e.substr(0,t>8?t<11?t:11:8)},createCanvas:function(){var t=document.createElement("canvas"),e=t.getContext("2d");return{canvas:t,context:e}},deepCopy:function(t){var e=Array.isArray(t)?[]:{};for(var i in t)"object"==typeof t[i]?e[i]=this.deepCopy(t[i]):e[i]=t[i];return e},deepClone:function(t){var e;if(this.isArray(t))e=[];else{if(!this.isObject(t))return t;e={}}for(var i in t){var n=t[i];this.isArray(t)||this.isObject(t)?e[i]=this.deepClone(n):e[i]=n}return e},requestAnimationFrame:function(t){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=!!e;if(e&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(e.toString())&&(i=!1),i)return e(t);var n={},o=1,r=null,s=+new Date;return function(t,e){var i=o++;return n[i]=t,0,null===r&&(r=setInterval((function(){var t=+new Date,e=n;for(var i in n={},0,e)Object.prototype.hasOwnProperty.call(e,i)&&(e[i](t),s=t);t-s>2500&&(clearInterval(r),r=null)}),1e3/60)),i}(t)},devicePixelRatio:function(){var t=window;return t?t.devicePixelRatio?t.devicePixelRatio:t.screen.deviceXDPI&&t.screen.logicalXDPI?t.screen.deviceXDPI/t.screen.logicalXDPI:1:1},formatTime:function(t){var e=new Date,i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return t},formatLog:function(t,e,i){var n="";return 1===arguments.length&&(n+=arguments[0]),2!==arguments.length&&3!==arguments.length||(n+="execute "+arguments[0],arguments[1]?n+=" successful":n+=" failed",3===arguments.length&&(n+=": "+arguments[2])),n},unique:function(t){for(var e=0;e<t.length;e++)for(var i=e+1;i<t.length;i++)t[e]==t[i]&&(t.splice(i,1),i--);return t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="undefined"!=typeof window;n&&window,!!n&&window.document.documentElement;e.default={keyCodes:{SHIFT:16,CTRL:17,BACKSPACE:8,DEL:46,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,Y:89,Z:90},errorMessages:{OK:{code:0,message:"ok."},PARAMETER_TYPE:{code:80001,message:"The parameter type is wrong."},PARAMETER_RANGE:{code:80002,message:"The parameter is out of range."},IMG_NOT_EXIST:{code:80003,message:"The image dose not exist."},IMG_LOAD_FAILED:{code:80004,message:"The image load failed."},BACK_TO_TOP:{code:80005,message:"The current folder is root folder."},FILE_NOT_EXIST:{code:80006,message:"The file dose not exist."},IMG_HAVE_EXIST:{code:80007,message:"The image has existed."},EMPTY_IN_ARRAY:{code:80008,message:"There is some empty element in array."},TAG_NOT_EXIST:{code:80009,message:"Tag dose not exist."},TAG_HAVE_EXIST:{code:80010,message:"Tag has existed."},ELEMENT_NOT_EXIST:{code:80011,message:"Element dose not exist."},PAGE_NOT_EXIST:{code:80012,message:"Page dose not exist."},NO_IMAGE_EXIST:{code:80012,message:"There is no image."},PARAMETER_INVALID:{code:80013,message:"The parameter include invalid char."},URL_INVALID:{code:80014,message:"The url is invalid."},FOLDER_NOT_EXIST:{code:80015,message:"The folder dose not exist."},COLOR_INVALID:{code:80016,message:"The color is invalid."},IMG_STORAGE_FAILED:{code:80017,message:"Failed to save image to database."},IMG_REMOVE_FAILED:{code:80018,message:"Failed to remove image from database by uid."},PATH_ERROR:{code:80019,message:"The path of file or folder dose not exist."}},lineType:{FREE_LINE:0,STRAIGHT_LINE:1,BROKEN_LINE:2},dashType:{a:null,b:null},shapeType:{RECTANGLE:0,CIRCLE:1,TRIANGLE:2},operationMode:{HAND:0,CROP:1,CLICK_TO_ZOOM:2}}},function(t,e){var i,n,o=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&p())}function p(){if(!c){var t=a(d);c=!0;for(var e=u.length;e;){for(l=u,u=[];++h<e;)l&&l[h].run();h=-1,e=u.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new f(t,e)),1!==u.length||c||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)),r=i(30);e.default={createVnode:function(t,e,i,n,s){if(void 0===e&&(e={}),void 0===i&&(i=[]),o.default.isObject(e)&&o.default.isArray(i))return new r.VNode(t,e,i,n,s)},sameVnode:function(t,e){return e.el===t.el||"IMG"===e.tagName&&"IMG"===t.tagName||e.data.key===t.data.key&&e.sel===t.sel&&e.text===t.text},createKeyHashList:function(t,e,i){var n,o,r,s={};for(n=e;n<=i;++n)(r=t[n])&&r.data&&(o=r.data.key)&&(s[o]=n);return s},removeVnodes:function(t,e,i,n){for(;i<=n;){var o=e[i];null!=o&&o.el&&("IMG"===o.tagName&&(o.el.onload=void 0,o.el.src=""),t.removeChild(o.el)),++i}},addVnodes:function(t,e,i,n,r){for(var s=function(){var r=i[n];if(r){e?t.insertBefore(r.el,e):t.appendChild(r.el);var s=r.el;o.default.arrayFrom(Object.keys(r.data)).forEach((function(t){s[t]||0===s[t]?"style"===t?s.getAttribute(t)?r.data[t]=s.getAttribute(t):s.setAttribute(t,r.data[t]):r.data[t]=s[t]:s[t]!==r.data[t]&&(s[t]=r.data[t])}));var l=r.children;l&&l.length&&a.addVnodes(r.el,null,l,0,l.length)}++n},a=this;n<=r;)s()},addOneVnode:function(t,e,i){if(!t||!t.children)return!1;var n=t.children[e]&&t.children[e].el;return t.children.splice(e,0,i),this.addVnodes(t.el,n,[i],0,0)},patchVnode:function(t,e){var i=e.el=t.el;Object.keys(e.data).forEach((function(i){t.el[i]!==e.data[i]&&(t.el[i]=e.data[i])}));var n=t.children,o=e.children;t!==e&&(""!==t.text&&""!==e.text&&t.text!==e.text?i.textContent=e.text:(t.el=e.el,n.length&&o.length&&n!==o?this.updateChildren(i,n,o):o&&o.length?this.addVnodes(i,null,o,0,o.length):n&&n.length&&this.removeVnodes(i,n,0,n.length)))},updateChildren:function(t,e,i){for(var n,o,r,s,a=0,l=0,u=e.length-1,c=e[0],h=e[u],d=i.length-1,p=i[0],f=i[d];a<=u&&l<=d;)null==c?c=e[++a]:null==h?h=e[--u]:null==p?p=i[++l]:null==f?f=i[--d]:this.sameVnode(c,p)?(this.patchVnode(c,p),c=e[++a],p=i[++l]):this.sameVnode(h,f)?(this.patchVnode(h,f),h=e[--u],f=i[--d]):this.sameVnode(c,f)?(this.patchVnode(c,f),t.insertBefore(c.el,h.el.nextSibling),c=e[++a],f=i[--d]):this.sameVnode(h,p)?(this.patchVnode(h,p),t.insertBefore(h.el,c.el),h=e[--u],p=i[++l]):(void 0===n&&(n=this.createKeyHashList(e,a,u)),void 0===(o=n[p.data.key])?(this.addVnodes(t,c.el,i,l,l),p=i[++l]):((r=e[o]).sel!==p.sel?this.addVnodes(t,c.el,e,o,o):(this.patchVnode(r,p),t.insertBefore(p.el,c.el),e[o]=null),p=i[++l]));a>u?(s=null==i[d+1]?null:i[d+1].el,this.addVnodes(t,s,i,l,d)):l>d&&this.removeVnodes(t,e,a,u)},patch:function(t,e){if(this.sameVnode(t,e))this.patchVnode(t,e);else{var i=t.el,n=i.parentNode;null!==n&&(n.insertBefore(e.el,i.nextSibling),n.removeChild(t.el),t=null)}return e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.cropStack=[],this.rotateAndFlipStack=[],this.allStepsStack=[],this.resultStack=[],this.angle=0,this.flipNum=0,this.flipNumX=0,this.flipNumY=0,this.totalAngle=0,this.tx=0,this.ty=0,this.obj={uid:"xxx",type:"crop/rotate/flip",cor:[],angle:0,totalAngle:0,zoom:1}}return t.prototype.matrixMultiplication3x3=function(t,e){for(var i=[],n=0;n<3;n++)for(var o=0;o<3;o++){var r=t[3*n+0]*e[o]+t[3*n+1]*e[o+3]+t[3*n+2]*e[o+6];i.push(r)}return i},t.prototype.pushCropStack=function(t){this.cropStack.push(t)},t.prototype.popCropStack=function(){return this.cropStack.pop()},t.prototype.clearCropStack=function(){this.cropStack=[]},t.prototype.pushRotateAndFlipStack=function(t){this.rotateAndFlipStack.push(t)},t.prototype.popRotateAndFlipStack=function(){return this.rotateAndFlipStack.pop()},t.prototype.clearRotateAndFilpStack=function(){this.rotateAndFlipStack=[]},t.prototype.pushAllStepsStack=function(t){this.allStepsStack.push(t)},t.prototype.popAllStepsStack=function(){return this.allStepsStack.pop()},t.prototype.clearAllStepsStack=function(){this.allStepsStack=[]},t.prototype.pushResultStack=function(t){this.resultStack.push(t)},t.prototype.popResultStack=function(){return this.resultStack.pop()},t.prototype.clearResultStack=function(){this.resultStack=[]},t.prototype.rotateMatrix=function(t,e,i){t=t/180*Math.PI;var n=Math.sin(t),o=Math.cos(t);return[o,-n,(1-o)*e+i*n,n,o,(1-o)*i-e*n,0,0,1]},t.prototype.moveMatrix=function(t,e){return[1,0,t,0,1,e,0,0,1]},t.prototype.scaleMatrix=function(t){return[t,0,0,0,t,0,0,0,1]},t.prototype.flipMatrix=function(t,e){return[1-2*Math.pow(t,2),-2*t*e,0,-2*t*e,1-2*Math.pow(e,2),0,0,0,1]},t.prototype.convertToCanvasMatrix=function(t){for(var e=[0,3,1,4,2,5],i=[],n=0;n<e.length;n++)i.push(t[e[n]]);return i},t.prototype.getLatestResult=function(){return 0!==this.resultStack.length?this.resultStack[this.resultStack.length-1].slice():null},t.prototype.setTransform=function(t){for(var e=[],i=0;i<this.rotateAndFlipStack.length;i++)e=this.rotateAndFlipStack[i],e=this.convertToCanvasMatrix(e),t.transform.apply(t,e)},t.prototype.pointRotate=function(t,e,i,n,o){return o=o/180*Math.PI,{x:(t-i)*Math.cos(o)-(e-n)*Math.sin(o)+i,y:(t-i)*Math.sin(o)+(e-n)*Math.cos(o)+n}},t.prototype.rectangleRotate=function(t,e,i,n,o){var r=t+i/2,s=e+n/2,a=this.pointRotate(t,e,r,s,o),l=this.pointRotate(t+i,e,r,s,o),u=this.pointRotate(t+i,e+n,r,s,o),c=this.pointRotate(t,e+n,r,s,o),h=[l.x,a.x,c.x,u.x].sort((function(t,e){return t-e})),d=[l.y,a.y,c.y,u.y].sort((function(t,e){return t-e}));return{x:h[0],y:d[0],width:h[3]-h[0],height:d[3]-d[0]}},t.prototype.calcLineEquation=function(t,e){var i=e.y-t.y,n=t.x-e.x,o=e.x*t.y-t.x*e.y,r=i*i+n*n,s=[];return s.push((n*n-i*i)/r,-2*i*n/r,-2*i*o/r,-2*i*n/r,(i*i-n*n)/r,-2*n*o/r,0,0,1/r),s},t.prototype.flip=function(t){this.flipNum+=1;var e=this.totalAngle/180*Math.PI,i=Math.cos(e),n=-Math.sin(e),o=-Math.sin(e),r=-Math.cos(e);this.flipNumX%2&&(o=-o,r=-r),this.flipNumY%2&&(i=-i,n=-n);var s={x:i,y:n},a={x:o,y:r},l={x:0,y:0},u=null;if(0===t)this.flipNumX+=1,u=this.calcLineEquation(s,l);else{if(1!==t)return;this.flipNumY+=1,u=this.calcLineEquation(a,l)}this.pushRotateAndFlipStack(u),this.pushAllStepsStack(u);var c=this.getLatestResult();c=c?this.matrixMultiplication3x3(u,c):u,this.pushResultStack(c)},t.prototype.calcFlipMatrix=function(t,e){return[1-2*t*t,-2*t*e,0,-2*t*e,1-2*e*e,0,0,0,1]},t.prototype.rotate=function(t,e,i){this.flipNum%2?(this.totalAngle-=t,t=-t):this.totalAngle+=t;var n=this.rotateMatrix(t,e||0,i||0);this.pushRotateAndFlipStack(n),this.pushAllStepsStack(n);var o=this.getLatestResult();o=o?this.matrixMultiplication3x3(n,o):n,this.pushResultStack(o)},t.prototype.translate=function(t,e){var i=this.moveMatrix(t,e);this.pushRotateAndFlipStack(i),this.pushAllStepsStack(i);var n=this.getLatestResult();n=n?this.matrixMultiplication3x3(i,n):i,this.pushResultStack(n)},t.prototype.addAngle=function(t){this.angle+=t},t.prototype.calcTranslateDis=function(t,e){var i=this.totalAngle/180*Math.PI,n=t*Math.cos(i),o=-t*Math.sin(i),r=e*Math.sin(i),s=e*Math.cos(i);return this.flipNumX%2&&(r=-r,s=-s),this.flipNumY%2&&(n=-n,o=-o),{x:n+r,y:o+s}},t.prototype.reset=function(){this.clearAllStepsStack(),this.clearResultStack(),this.clearRotateAndFilpStack(),this.clearCropStack(),this.totalAngle=0,this.flipNumX=0,this.flipNumY=0,this.flipNum=0},t}();e.Transform2d=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),window.Promise=i(7);var n,o,r,s,a=i(10);(e.DVS=a.DVS,i(44),i(45),"undefined"!=typeof document&&"undefined"!=typeof window)&&(window.DVS=a.DVS);Array.from||(Array.from=(n=Object.prototype.toString,o=function(t){return"function"==typeof t||"[object Function]"===n.call(t)},r=Math.pow(2,53)-1,s=function(t){var e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),r)},function(t){var e=this,i=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!o(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(n=arguments[2])}for(var a,l=s(i.length),u=o(e)?Object(new e(l)):new Array(l),c=0;c<l;)a=i[c],u[c]=r?void 0===n?r(a,c):r.call(n,a,c):a,c+=1;return u.length=l,u}))},function(t,e,i){(function(e,i,n){var o;o=function(){var t,o,r;return function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof _dereq_&&_dereq_;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[s]={exports:{}};e[s][0].call(c.exports,(function(t){var i=e[s][1][t];return o(i||t)}),c,c.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof _dereq_&&_dereq_,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"use strict";e.exports=function(t){var e=t._SomePromiseArray;function i(t){var i=new e(t),n=i.promise();return i.setHowMany(1),i.setUnwrap(),i.init(),n}t.any=function(t){return i(t)},t.prototype.any=function(){return i(this)}}},{}],2:[function(t,i,n){"use strict";var o;try{throw new Error}catch(t){o=t}var r=t("./schedule"),s=t("./queue");function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._haveDrainedQueues=!1;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=r}function l(t){for(;t.length()>0;)u(t)}function u(t){var e=t.shift();if("function"!=typeof e)e._settlePromises();else{var i=t.shift(),n=t.shift();e.call(i,n)}}a.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(t,i){i?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},a.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout((function(){t(e)}),0);else try{this._schedule((function(){t(e)}))}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.prototype.invokeLater=function(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()},a.prototype.invoke=function(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()},a.prototype.settlePromises=function(t){this._normalQueue._pushOne(t),this._queueTick()},a.prototype._drainQueues=function(){l(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,l(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},i.exports=a,i.exports.firstLineError=o},{"./queue":26,"./schedule":29}],3:[function(t,e,i){"use strict";e.exports=function(t,e,i,n){var o=!1,r=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(r,r,null,this,t)},a=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},l=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(r){o||(o=!0,t.prototype._propagateFrom=n.propagateFromFunction(),t.prototype._boundValue=n.boundValueFunction());var u=i(r),c=new t(e);c._propagateFrom(this,1);var h=this._target();if(c._setBoundTo(u),u instanceof t){var d={promiseRejectionQueued:!1,promise:c,target:h,bindingPromise:u};h._then(e,s,void 0,c,d),u._then(a,l,void 0,c,d),c._setOnCancel(u)}else c._resolveCallback(h);return c},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,i){return t.resolve(i).bind(e)}}},{}],4:[function(t,e,i){"use strict";var n;"undefined"!=typeof Promise&&(n=Promise);var o=t("./promise")();o.noConflict=function(){try{Promise===o&&(Promise=n)}catch(t){}return o},e.exports=o},{"./promise":22}],5:[function(t,e,i){"use strict";var n=Object.create;if(n){var o=n(null),r=n(null);o[" size"]=r[" size"]=0}e.exports=function(e){var i=t("./util"),n=i.canEvaluate;function o(t){return function(t,n){var o;if(null!=t&&(o=t[n]),"function"!=typeof o){var r="Object "+i.classString(t)+" has no method '"+i.toString(n)+"'";throw new e.TypeError(r)}return o}(t,this.pop()).apply(t,this)}function r(t){return t[this]}function s(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}i.isIdentifier,e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(o,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e;if("number"==typeof t)e=s;else if(n){var i=(void 0)(t);e=null!==i?i:r}else e=r;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(t,e,i){"use strict";e.exports=function(e,i,n,o){var r=t("./util"),s=r.tryCatch,a=r.errorObj,l=e._async;e.prototype.break=e.prototype.cancel=function(){if(!o.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=i}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(r.isArray(t))for(var i=0;i<t.length;++i)this._doInvokeOnCancel(t[i],e);else if(void 0!==t)if("function"==typeof t){if(!e){var n=s(t).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),l.throwLater(n.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,i){"use strict";e.exports=function(e){var i=t("./util"),n=t("./es5").keys,o=i.tryCatch,r=i.errorObj;return function(t,s,a){return function(l){var u=a._boundValue();t:for(var c=0;c<t.length;++c){var h=t[c];if(h===Error||null!=h&&h.prototype instanceof Error){if(l instanceof h)return o(s).call(u,l)}else if("function"==typeof h){var d=o(h).call(u,l);if(d===r)return d;if(d)return o(s).call(u,l)}else if(i.isObject(l)){for(var p=n(h),f=0;f<p.length;++f){var g=p[f];if(h[g]!=l[g])continue t}return o(s).call(u,l)}}return e}}}},{"./es5":13,"./util":36}],8:[function(t,e,i){"use strict";e.exports=function(t){var e=!1,i=[];function n(){this._trace=new n.CapturedTrace(o())}function o(){var t=i.length-1;if(t>=0)return i[t]}return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},n.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},n.prototype._popContext=function(){if(void 0!==this._trace){var t=i.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},n.CapturedTrace=null,n.create=function(){if(e)return new n},n.deactivateLongStackTraces=function(){},n.activateLongStackTraces=function(){var i=t.prototype._pushContext,r=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,l=t.prototype._promiseCreated;n.deactivateLongStackTraces=function(){t.prototype._pushContext=i,t.prototype._popContext=r,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=l,e=!1},e=!0,t.prototype._pushContext=n.prototype._pushContext,t.prototype._popContext=n.prototype._popContext,t._peekContext=t.prototype._peekContext=o,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},n}},{}],9:[function(t,i,n){"use strict";i.exports=function(i,n,o,r){var s,a,l,u,c=i._async,h=t("./errors").Warning,d=t("./util"),p=t("./es5"),f=d.canAttachTrace,g=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,m=/\((?:timers\.js):\d+:\d+\)/,_=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,v=null,y=null,b=!1,C=!(0==d.env("BLUEBIRD_DEBUG")),T=!(0==d.env("BLUEBIRD_WARNINGS")||!C&&!d.env("BLUEBIRD_WARNINGS")),x=!(0==d.env("BLUEBIRD_LONG_STACK_TRACES")||!C&&!d.env("BLUEBIRD_LONG_STACK_TRACES")),E=0!=d.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(T||!!d.env("BLUEBIRD_W_FORGOTTEN_RETURN"));!function(){var t=[];function e(){for(var e=0;e<t.length;++e)t[e]._notifyUnhandledRejection();n()}function n(){t.length=0}u=function(i){t.push(i),setTimeout(e,1)},p.defineProperty(i,"_unhandledRejectionCheck",{value:e}),p.defineProperty(i,"_unhandledRejectionClear",{value:n})}(),i.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},i.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),u(this))},i.prototype._notifyUnhandledRejectionIsHandled=function(){q("rejectionHandled",s,void 0,this)},i.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},i.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},i.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),q("unhandledRejection",a,t,this)}},i.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},i.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},i.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},i.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},i.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},i.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},i.prototype._warn=function(t,e,i){return W(t,e,i||this)},i.onPossiblyUnhandledRejection=function(t){var e=i._getContext();a=d.contextBind(e,t)},i.onUnhandledRejectionHandled=function(t){var e=i._getContext();s=d.contextBind(e,t)};var w=function(){};i.longStackTraces=function(){if(c.haveItemsQueued()&&!it.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!it.longStackTraces&&$()){var t=i.prototype._captureStackTrace,e=i.prototype._attachExtraTrace,o=i.prototype._dereferenceTrace;it.longStackTraces=!0,w=function(){if(c.haveItemsQueued()&&!it.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");i.prototype._captureStackTrace=t,i.prototype._attachExtraTrace=e,i.prototype._dereferenceTrace=o,n.deactivateLongStackTraces(),it.longStackTraces=!1},i.prototype._captureStackTrace=H,i.prototype._attachExtraTrace=z,i.prototype._dereferenceTrace=U,n.activateLongStackTraces()}},i.hasLongStackTraces=function(){return it.longStackTraces&&$()};var S={unhandledrejection:{before:function(){var t=d.global.onunhandledrejection;return d.global.onunhandledrejection=null,t},after:function(t){d.global.onunhandledrejection=t}},rejectionhandled:{before:function(){var t=d.global.onrejectionhandled;return d.global.onrejectionhandled=null,t},after:function(t){d.global.onrejectionhandled=t}}},I=function(){var t=function(t,e){if(!t)return!d.global.dispatchEvent(e);var i;try{return i=t.before(),!d.global.dispatchEvent(e)}finally{t.after(i)}};try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return d.global.dispatchEvent(e),function(e,i){e=e.toLowerCase();var n=new CustomEvent(e,{detail:i,cancelable:!0});return p.defineProperty(n,"promise",{value:i.promise}),p.defineProperty(n,"reason",{value:i.reason}),t(S[e],n)}}return"function"==typeof Event?(e=new Event("CustomEvent"),d.global.dispatchEvent(e),function(e,i){e=e.toLowerCase();var n=new Event(e,{cancelable:!0});return n.detail=i,p.defineProperty(n,"promise",{value:i.promise}),p.defineProperty(n,"reason",{value:i.reason}),t(S[e],n)}):((e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),d.global.dispatchEvent(e),function(e,i){e=e.toLowerCase();var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!0,i),t(S[e],n)})}catch(t){}return function(){return!1}}(),R=d.isNode?function(){return e.emit.apply(e,arguments)}:d.global?function(t){var e="on"+t.toLowerCase(),i=d.global[e];return!!i&&(i.apply(d.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function L(t,e){return{promise:e}}var A={promiseCreated:L,promiseFulfilled:L,promiseRejected:L,promiseResolved:L,promiseCancelled:L,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:L},D=function(t){var e=!1;try{e=R.apply(null,arguments)}catch(t){c.throwLater(t),e=!0}var i=!1;try{i=I(t,A[t].apply(null,arguments))}catch(t){c.throwLater(t),i=!0}return i||e};function k(){return!1}function M(t,e,i){var n=this;try{t(e,i,(function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+d.toString(t));n._attachCancellationCallback(t)}))}catch(t){return t}}function P(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?d.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function B(){return this._onCancelField}function F(t){this._onCancelField=t}function N(){this._cancellationParent=void 0,this._onCancelField=void 0}function O(t,e){if(0!=(1&e)){this._cancellationParent=t;var i=t._branchesRemainingToCancel;void 0===i&&(i=0),t._branchesRemainingToCancel=i+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}i.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?i.longStackTraces():!t.longStackTraces&&i.hasLongStackTraces()&&w()),"warnings"in t){var e=t.warnings;it.warnings=!!e,E=it.warnings,d.isObject(e)&&"wForgottenReturn"in e&&(E=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!it.cancellation){if(c.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");i.prototype._clearCancellationData=N,i.prototype._propagateFrom=O,i.prototype._onCancel=B,i.prototype._setOnCancel=F,i.prototype._attachCancellationCallback=P,i.prototype._execute=M,V=O,it.cancellation=!0}if("monitoring"in t&&(t.monitoring&&!it.monitoring?(it.monitoring=!0,i.prototype._fireEvent=D):!t.monitoring&&it.monitoring&&(it.monitoring=!1,i.prototype._fireEvent=k)),"asyncHooks"in t&&d.nodeSupportsAsyncResource){var n=it.asyncHooks,s=!!t.asyncHooks;n!==s&&(it.asyncHooks=s,s?o():r())}return i},i.prototype._fireEvent=k,i.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},i.prototype._onCancel=function(){},i.prototype._setOnCancel=function(t){},i.prototype._attachCancellationCallback=function(t){},i.prototype._captureStackTrace=function(){},i.prototype._attachExtraTrace=function(){},i.prototype._dereferenceTrace=function(){},i.prototype._clearCancellationData=function(){},i.prototype._propagateFrom=function(t,e){};var V=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function j(){var t=this._boundTo;return void 0!==t&&t instanceof i?t.isFulfilled()?t.value():void 0:t}function H(){this._trace=new tt(this._peekContext())}function z(t,e){if(f(t)){var i=this._trace;if(void 0!==i&&e&&(i=i._parent),void 0!==i)i.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=Y(t);d.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),d.notEnumerableProp(t,"__stackCleaned__",!0)}}}function U(){this._trace=void 0}function W(t,e,n){if(it.warnings){var o,r=new h(t);if(e)n._attachExtraTrace(r);else if(it.longStackTraces&&(o=i._peekContext()))o.attachExtraTrace(r);else{var s=Y(r);r.stack=s.message+"\n"+s.stack.join("\n")}D("warning",r)||Z(r,"",!0)}}function X(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],o="    (No stack trace)"===n||v.test(n),r=o&&K(n);o&&!r&&(b&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function Y(t){var e=t.stack,i=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var n=e[i];if("    (No stack trace)"===n||v.test(n))break}return i>0&&"SyntaxError"!=t.name&&(e=e.slice(i)),e}(t):["    (No stack trace)"],{message:i,stack:"SyntaxError"==t.name?e:X(e)}}function Z(t,e,i){if("undefined"!=typeof console){var n;if(d.isObject(t)){var o=t.stack;n=e+y(o,t)}else n=e+String(t);"function"==typeof l?l(n,i):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function q(t,e,i,n){var o=!1;try{"function"==typeof e&&(o=!0,"rejectionHandled"===t?e(n):e(i,n))}catch(t){c.throwLater(t)}"unhandledRejection"===t?D(t,i,n)||o||Z(i,"Unhandled rejection "):D(t,n)}function G(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{if(e=t&&"function"==typeof t.toString?t.toString():d.toString(t),/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){return t.length<41?t:t.substr(0,38)+"..."}(e)+">, no stack trace)"}function $(){return"function"==typeof et}var K=function(){return!1},Q=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function J(t){var e=t.match(Q);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function tt(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);et(this,tt),e>32&&this.uncycle()}d.inherits(tt,Error),n.CapturedTrace=tt,tt.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},n=0,o=this;void 0!==o;++n)e.push(o),o=o._parent;for(n=(t=this._length=n)-1;n>=0;--n){var r=e[n].stack;void 0===i[r]&&(i[r]=n)}for(n=0;n<t;++n){var s=i[e[n].stack];if(void 0!==s&&s!==n){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var a=n>0?e[n-1]:this;s<t-1?(a._parent=e[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var l=a._length+1,u=n-2;u>=0;--u)e[u]._length=l,l++;return}}}},tt.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=Y(t),i=e.message,n=[e.stack],o=this;void 0!==o;)n.push(X(o.stack.split("\n"))),o=o._parent;!function(t){for(var e=t[0],i=1;i<t.length;++i){for(var n=t[i],o=e.length-1,r=e[o],s=-1,a=n.length-1;a>=0;--a)if(n[a]===r){s=a;break}for(a=s;a>=0;--a){var l=n[a];if(e[o]!==l)break;e.pop(),o--}e=n}}(n),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(n),d.notEnumerableProp(t,"stack",function(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}(i,n)),d.notEnumerableProp(t,"__stackCleaned__",!0)}};var et=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():G(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,v=t,y=e;var i=Error.captureStackTrace;return K=function(t){return g.test(t)},function(t,e){Error.stackTraceLimit+=6,i(t,e),Error.stackTraceLimit-=6}}var n,o=new Error;if("string"==typeof o.stack&&o.stack.split("\n")[0].indexOf("stackDetection@")>=0)return v=/@/,y=e,b=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){n="stack"in t}return"stack"in o||!n||"number"!=typeof Error.stackTraceLimit?(y=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?G(e):e.toString()},null):(v=t,y=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(l=function(t){console.warn(t)},d.isNode&&e.stderr.isTTY?l=function(t,e){var i=e?"[33m":"[31m";console.warn(i+t+"[0m\n")}:d.isNode||"string"!=typeof(new Error).stack||(l=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var it={warnings:T,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1};return x&&i.longStackTraces(),{asyncHooks:function(){return it.asyncHooks},longStackTraces:function(){return it.longStackTraces},warnings:function(){return it.warnings},cancellation:function(){return it.cancellation},monitoring:function(){return it.monitoring},propagateFromFunction:function(){return V},boundValueFunction:function(){return j},checkForgottenReturns:function(t,e,i,n,o){if(void 0===t&&null!==e&&E){if(void 0!==o&&o._returnedNonUndefined())return;if(0==(65535&n._bitField))return;i&&(i+=" ");var r="",s="";if(e._trace){for(var a=e._trace.stack.split("\n"),l=X(a),u=l.length-1;u>=0;--u){var c=l[u];if(!m.test(c)){var h=c.match(_);h&&(r="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(l.length>0){var d=l[0];for(u=0;u<a.length;++u)if(a[u]===d){u>0&&(s="\n"+a[u-1]);break}}}var p="a promise was created in a "+i+"handler "+r+"but was not returned from it, see http://goo.gl/rRqMUw"+s;n._warn(p,!0,e)}},setBounds:function(t,e){if($()){for(var i,n,o=(t.stack||"").split("\n"),r=(e.stack||"").split("\n"),s=-1,a=-1,l=0;l<o.length;++l)if(u=J(o[l])){i=u.fileName,s=u.line;break}for(l=0;l<r.length;++l){var u;if(u=J(r[l])){n=u.fileName,a=u.line;break}}s<0||a<0||!i||!n||i!==n||s>=a||(K=function(t){if(g.test(t))return!0;var e=J(t);return!!(e&&e.fileName===i&&s<=e.line&&e.line<=a)})}},warn:W,deprecated:function(t,e){var i=t+" is deprecated and will be removed in a future version.";return e&&(i+=" Use "+e+" instead."),W(i)},CapturedTrace:tt,fireDomEvent:I,fireGlobalEvent:R}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(t,e,i){"use strict";e.exports=function(t){function e(){return this.value}function i(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(i){return i instanceof t&&i.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:i},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(i,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:t},void 0);var e=arguments[1],n=function(){throw e};return this.caught(t,n)},t.prototype.catchReturn=function(i){if(arguments.length<=1)return i instanceof t&&i.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:i},void 0);var n=arguments[1];n instanceof t&&n.suppressUnhandledRejections();var o=function(){return n};return this.caught(i,o)}}},{}],11:[function(t,e,i){"use strict";e.exports=function(t,e){var i=t.reduce,n=t.all;function o(){return n(this)}t.prototype.each=function(t){return i(this,t,e,0)._then(o,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return i(this,t,e,e)},t.each=function(t,n){return i(t,n,e,0)._then(o,void 0,void 0,t,void 0)},t.mapSeries=function(t,n){return i(t,n,e,e)}}},{}],12:[function(t,e,i){"use strict";var n,o,r=t("./es5"),s=r.freeze,a=t("./util"),l=a.inherits,u=a.notEnumerableProp;function c(t,e){function i(n){if(!(this instanceof i))return new i(n);u(this,"message","string"==typeof n?n:e),u(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(i,Error),i}var h=c("Warning","warning"),d=c("CancellationError","cancellation error"),p=c("TimeoutError","timeout error"),f=c("AggregateError","aggregate error");try{n=TypeError,o=RangeError}catch(t){n=c("TypeError","type error"),o=c("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<g.length;++m)"function"==typeof Array.prototype[g[m]]&&(f.prototype[g[m]]=Array.prototype[g[m]]);r.defineProperty(f.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),f.prototype.isOperational=!0;var _=0;function v(t){if(!(this instanceof v))return new v(t);u(this,"name","OperationalError"),u(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(u(this,"message",t.message),u(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}f.prototype.toString=function(){var t=Array(4*_+1).join(" "),e="\n"+t+"AggregateError of:\n";_++,t=Array(4*_+1).join(" ");for(var i=0;i<this.length;++i){for(var n=this[i]===this?"[Circular AggregateError]":this[i]+"",o=n.split("\n"),r=0;r<o.length;++r)o[r]=t+o[r];e+=(n=o.join("\n"))+"\n"}return _--,e},l(v,Error);var y=Error.__BluebirdErrorTypes__;y||(y=s({CancellationError:d,TimeoutError:p,OperationalError:v,RejectionError:v,AggregateError:f}),r.defineProperty(Error,"__BluebirdErrorTypes__",{value:y,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:n,RangeError:o,CancellationError:y.CancellationError,OperationalError:y.OperationalError,TimeoutError:y.TimeoutError,AggregateError:y.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(t,e,i){var n=function(){"use strict";return void 0===this}();if(n)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}};else{var o={}.hasOwnProperty,r={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var i in t)o.call(t,i)&&e.push(i);return e};e.exports={isArray:function(t){try{return"[object Array]"===r.call(t)}catch(t){return!1}},keys:a,names:a,defineProperty:function(t,e,i){return t[e]=i.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return s}},isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,i){"use strict";e.exports=function(t,e){var i=t.map;t.prototype.filter=function(t,n){return i(this,t,n,e)},t.filter=function(t,n,o){return i(t,n,o,e)}}},{}],15:[function(t,e,i){"use strict";e.exports=function(e,i,n){var o=t("./util"),r=e.CancellationError,s=o.errorObj,a=t("./catch_filter")(n);function l(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function u(t){this.finallyHandler=t}function c(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function h(){return p.call(this,this.promise._target()._settledValue())}function d(t){if(!c(this,t))return s.e=t,s}function p(t){var o=this.promise,a=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?a.call(o._boundValue()):a.call(o._boundValue(),t);if(l===n)return l;if(void 0!==l){o._setReturnedNonUndefined();var p=i(l,o);if(p instanceof e){if(null!=this.cancelPromise){if(p._isCancelled()){var f=new r("late cancellation observer");return o._attachExtraTrace(f),s.e=f,s}p.isPending()&&p._attachCancellationCallback(new u(this))}return p._then(h,d,void 0,this,void 0)}}}return o.isRejected()?(c(this),s.e=t,s):(c(this),t)}return l.prototype.isFinallyHandler=function(){return 0===this.type},u.prototype._resultCancelled=function(){c(this.finallyHandler)},e.prototype._passThrough=function(t,e,i,n){return"function"!=typeof t?this.then():this._then(i,n,void 0,new l(this,e,t),void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThrough(t,0,p,p)},e.prototype.tap=function(t){return this._passThrough(t,1,p)},e.prototype.tapCatch=function(t){var i=arguments.length;if(1===i)return this._passThrough(t,1,void 0,p);var n,r=new Array(i-1),s=0;for(n=0;n<i-1;++n){var l=arguments[n];if(!o.isObject(l))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+o.classString(l)));r[s++]=l}r.length=s;var u=arguments[n];return this._passThrough(a(r,u,this),1,void 0,p)},l}},{"./catch_filter":7,"./util":36}],16:[function(t,e,i){"use strict";e.exports=function(e,i,n,o,r,s){var a=t("./errors").TypeError,l=t("./util"),u=l.errorObj,c=l.tryCatch,h=[];function d(t,i,o,r){if(s.cancellation()){var a=new e(n),l=this._finallyPromise=new e(n);this._promise=a.lastly((function(){return l})),a._captureStackTrace(),a._setOnCancel(this)}else(this._promise=new e(n))._captureStackTrace();this._stack=r,this._generatorFunction=t,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof o?[o].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}l.inherits(d,r),d.prototype._isResolved=function(){return null===this._promise},d.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},d.prototype._promiseCancelled=function(){if(!this._isResolved()){var t;if(void 0!==this._generator.return)this._promise._pushContext(),t=c(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var i=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=i,this._promise._attachExtraTrace(i),this._promise._pushContext(),t=c(this._generator.throw).call(this._generator,i),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},d.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=c(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=c(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},d.prototype.promise=function(){return this._promise},d.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},d.prototype._continue=function(t){var i=this._promise;if(t===u)return this._cleanup(),this._cancellationPhase?i.cancel():i._rejectCallback(t.e,!1);var n=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?i.cancel():i._resolveCallback(n);var r=o(n,this._promise);if(r instanceof e||null!==(r=function(t,i,n){for(var r=0;r<i.length;++r){n._pushContext();var s=c(i[r])(t);if(n._popContext(),s===u){n._pushContext();var a=e.reject(u.e);return n._popContext(),a}var l=o(s,n);if(l instanceof e)return l}return null}(r,this._yieldHandlers,this._promise))){var s=(r=r._target())._bitField;0==(50397184&s)?(this._yieldedPromise=r,r._proxy(this,null)):0!=(33554432&s)?e._async.invoke(this._promiseFulfilled,this,r._value()):0!=(16777216&s)?e._async.invoke(this._promiseRejected,this,r._reason()):this._promiseCancelled()}else this._promiseRejected(new a("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},e.coroutine=function(t,e){if("function"!=typeof t)throw new a("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,n=d,o=(new Error).stack;return function(){var e=t.apply(this,arguments),r=new n(void 0,void 0,i,o),s=r.promise();return r._generator=e,r._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new a("expecting a function but got "+l.classString(t));h.push(t)},e.spawn=function(t){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return i("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new d(t,this),o=n.promise();return n._run(e.spawn),o}}},{"./errors":12,"./util":36}],17:[function(t,e,i){"use strict";e.exports=function(e,i,n,o,r){var s=t("./util");s.canEvaluate,s.tryCatch,s.errorObj,e.join=function(){var t,e=arguments.length-1;e>0&&"function"==typeof arguments[e]&&(t=arguments[e]);var n=[].slice.call(arguments);t&&n.pop();var o=new i(n).promise();return void 0!==t?o.spread(t):o}}},{"./util":36}],18:[function(t,e,i){"use strict";e.exports=function(e,i,n,o,r,s){var a=t("./util"),l=a.tryCatch,u=a.errorObj,c=e._async;function h(t,i,n,o){this.constructor$(t),this._promise._captureStackTrace();var s=e._getContext();if(this._callback=a.contextBind(s,i),this._preservedValues=o===r?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],c.invoke(this._asyncInit,this,void 0),a.isArray(t))for(var l=0;l<t.length;++l){var u=t[l];u instanceof e&&u.suppressUnhandledRejections()}}function d(t,i,o,r){if("function"!=typeof i)return n("expecting a function but got "+a.classString(i));var s=0;if(void 0!==o){if("object"!=typeof o||null===o)return e.reject(new TypeError("options argument must be an object but it is "+a.classString(o)));if("number"!=typeof o.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+a.classString(o.concurrency)));s=o.concurrency}return new h(t,i,s="number"==typeof s&&isFinite(s)&&s>=1?s:0,r).promise()}a.inherits(h,i),h.prototype._asyncInit=function(){this._init$(void 0,-2)},h.prototype._init=function(){},h.prototype._promiseFulfilled=function(t,i){var n=this._values,r=this.length(),a=this._preservedValues,c=this._limit;if(i<0){if(n[i=-1*i-1]=t,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return n[i]=t,this._queue.push(i),!1;null!==a&&(a[i]=t);var h=this._promise,d=this._callback,p=h._boundValue();h._pushContext();var f=l(d).call(p,t,i,r),g=h._popContext();if(s.checkForgottenReturns(f,g,null!==a?"Promise.filter":"Promise.map",h),f===u)return this._reject(f.e),!0;var m=o(f,this._promise);if(m instanceof e){var _=(m=m._target())._bitField;if(0==(50397184&_))return c>=1&&this._inFlight++,n[i]=m,m._proxy(this,-1*(i+1)),!1;if(0==(33554432&_))return 0!=(16777216&_)?(this._reject(m._reason()),!0):(this._cancel(),!0);f=m._value()}n[i]=f}return++this._totalResolved>=r&&(null!==a?this._filter(n,a):this._resolve(n),!0)},h.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(i[n],n)}},h.prototype._filter=function(t,e){for(var i=e.length,n=new Array(i),o=0,r=0;r<i;++r)t[r]&&(n[o++]=e[r]);n.length=o,this._resolve(n)},h.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return d(this,t,e,null)},e.map=function(t,e,i,n){return d(t,e,i,n)}}},{"./util":36}],19:[function(t,e,i){"use strict";e.exports=function(e,i,n,o,r){var s=t("./util"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var n=new e(i);n._captureStackTrace(),n._pushContext();var o=a(t).apply(this,arguments),s=n._popContext();return r.checkForgottenReturns(o,s,"Promise.method",n),n._resolveFromSyncValue(o),n}},e.attempt=e.try=function(t){if("function"!=typeof t)return o("expecting a function but got "+s.classString(t));var n,l=new e(i);if(l._captureStackTrace(),l._pushContext(),arguments.length>1){r.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],c=arguments[2];n=s.isArray(u)?a(t).apply(c,u):a(t).call(c,u)}else n=a(t)();var h=l._popContext();return r.checkForgottenReturns(n,h,"Promise.try",l),l._resolveFromSyncValue(n),l},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,i){"use strict";var n=t("./util"),o=n.maybeWrapAsError,r=t("./errors").OperationalError,s=t("./es5"),a=/^(?:name|message|stack|cause)$/;function l(t){var e;if(function(t){return t instanceof Error&&s.getPrototypeOf(t)===Error.prototype}(t)){(e=new r(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var i=s.keys(t),o=0;o<i.length;++o){var l=i[o];a.test(l)||(e[l]=t[l])}return e}return n.markAsOriginatingFromRejection(t),t}e.exports=function(t,e){return function(i,n){if(null!==t){if(i){var r=l(o(i));t._attachExtraTrace(r),t._reject(r)}else if(e){var s=[].slice.call(arguments,1);t._fulfill(s)}else t._fulfill(n);t=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,i){"use strict";e.exports=function(e){var i=t("./util"),n=e._async,o=i.tryCatch,r=i.errorObj;function s(t,e){if(!i.isArray(t))return a.call(this,t,e);var s=o(e).apply(this._boundValue(),[null].concat(t));s===r&&n.throwLater(s.e)}function a(t,e){var i=this._boundValue(),s=void 0===t?o(e).call(i,null):o(e).call(i,null,t);s===r&&n.throwLater(s.e)}function l(t,e){if(!t){var i=new Error(t+"");i.cause=t,t=i}var s=o(e).call(this._boundValue(),t);s===r&&n.throwLater(s.e)}e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var i=a;void 0!==e&&Object(e).spread&&(i=s),this._then(i,l,void 0,this,t)}return this}}},{"./util":36}],22:[function(t,i,n){"use strict";i.exports=function(){var n=function(){return new v("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},o=function(){return new M.PromiseInspection(this._target())},r=function(t){return M.reject(new v(t))};function s(){}var a={},l=t("./util");l.setReflectHandler(o);var u=function(){var t=e.domain;return void 0===t?null:t},c=function(){return{domain:u(),async:null}},h=l.isNode&&l.nodeSupportsAsyncResource?t("async_hooks").AsyncResource:null,d=function(){return{domain:u(),async:new h("Bluebird::Promise")}},p=l.isNode?c:function(){return null};l.notEnumerableProp(M,"_getContext",p);var f=t("./es5"),g=t("./async"),m=new g;f.defineProperty(M,"_async",{value:m});var _=t("./errors"),v=M.TypeError=_.TypeError;M.RangeError=_.RangeError;var y=M.CancellationError=_.CancellationError;M.TimeoutError=_.TimeoutError,M.OperationalError=_.OperationalError,M.RejectionError=_.OperationalError,M.AggregateError=_.AggregateError;var b=function(){},C={},T={},x=t("./thenables")(M,b),E=t("./promise_array")(M,b,x,r,s),w=t("./context")(M),S=w.create,I=t("./debuggability")(M,w,(function(){p=d,l.notEnumerableProp(M,"_getContext",d)}),(function(){p=c,l.notEnumerableProp(M,"_getContext",c)})),R=(I.CapturedTrace,t("./finally")(M,x,T)),L=t("./catch_filter")(T),A=t("./nodeback"),D=l.errorObj,k=l.tryCatch;function M(t){t!==b&&function(t,e){if(null==t||t.constructor!==M)throw new v("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new v("expecting a function but got "+l.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function P(t){this.promise._resolveCallback(t)}function B(t){this.promise._rejectCallback(t,!1)}function F(t){var e=new M(b);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return M.prototype.toString=function(){return"[object Promise]"},M.prototype.caught=M.prototype.catch=function(t){var e=arguments.length;if(e>1){var i,n=new Array(e-1),o=0;for(i=0;i<e-1;++i){var s=arguments[i];if(!l.isObject(s))return r("Catch statement predicate: expecting an object but got "+l.classString(s));n[o++]=s}if(n.length=o,"function"!=typeof(t=arguments[i]))throw new v("The last argument to .catch() must be a function, got "+l.toString(t));return this.then(void 0,L(n,t,this))}return this.then(void 0,t)},M.prototype.reflect=function(){return this._then(o,o,void 0,this,void 0)},M.prototype.then=function(t,e){if(I.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var i=".then() only accepts functions but was passed: "+l.classString(t);arguments.length>1&&(i+=", "+l.classString(e)),this._warn(i)}return this._then(t,e,void 0,void 0,void 0)},M.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},M.prototype.spread=function(t){return"function"!=typeof t?r("expecting a function but got "+l.classString(t)):this.all()._then(t,void 0,void 0,C,void 0)},M.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},M.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new E(this).promise()},M.prototype.error=function(t){return this.caught(l.originatesFromRejection,t)},M.getNewLibraryCopy=i.exports,M.is=function(t){return t instanceof M},M.fromNode=M.fromCallback=function(t){var e=new M(b);e._captureStackTrace();var i=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=k(t)(A(e,i));return n===D&&e._rejectCallback(n.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},M.all=function(t){return new E(t).promise()},M.cast=function(t){var e=x(t);return e instanceof M||((e=new M(b))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},M.resolve=M.fulfilled=M.cast,M.reject=M.rejected=function(t){var e=new M(b);return e._captureStackTrace(),e._rejectCallback(t,!0),e},M.setScheduler=function(t){if("function"!=typeof t)throw new v("expecting a function but got "+l.classString(t));return m.setScheduler(t)},M.prototype._then=function(t,e,i,n,o){var r=void 0!==o,s=r?o:new M(b),a=this._target(),u=a._bitField;r||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&u)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var c=p();if(0!=(50397184&u)){var h,d,f=a._settlePromiseCtx;0!=(33554432&u)?(d=a._rejectionHandler0,h=t):0!=(16777216&u)?(d=a._fulfillmentHandler0,h=e,a._unsetRejectionIsUnhandled()):(f=a._settlePromiseLateCancellationObserver,d=new y("late cancellation observer"),a._attachExtraTrace(d),h=e),m.invoke(f,a,{handler:l.contextBind(c,h),promise:s,receiver:n,value:d})}else a._addCallbacks(t,e,s,n,c);return s},M.prototype._length=function(){return 65535&this._bitField},M.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},M.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},M.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},M.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},M.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},M.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},M.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},M.prototype._isFinal=function(){return(4194304&this._bitField)>0},M.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},M.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},M.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},M.prototype._setAsyncGuaranteed=function(){if(!m.hasCustomScheduler()){var t=this._bitField;this._bitField=t|(536870912&t)>>2^134217728}},M.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},M.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==a)return void 0===e&&this._isBound()?this._boundValue():e},M.prototype._promiseAt=function(t){return this[4*t-4+2]},M.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},M.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},M.prototype._boundValue=function(){},M.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,i=t._rejectionHandler0,n=t._promise0,o=t._receiverAt(0);void 0===o&&(o=a),this._addCallbacks(e,i,n,o,null)},M.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),o=t._promiseAt(e),r=t._receiverAt(e);void 0===r&&(r=a),this._addCallbacks(i,n,o,r,null)},M.prototype._addCallbacks=function(t,e,i,n,o){var r=this._length();if(r>=65531&&(r=0,this._setLength(0)),0===r)this._promise0=i,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=l.contextBind(o,t)),"function"==typeof e&&(this._rejectionHandler0=l.contextBind(o,e));else{var s=4*r-4;this[s+2]=i,this[s+3]=n,"function"==typeof t&&(this[s+0]=l.contextBind(o,t)),"function"==typeof e&&(this[s+1]=l.contextBind(o,e))}return this._setLength(r+1),r},M.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},M.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(n(),!1);var i=x(t,this);if(!(i instanceof M))return this._fulfill(t);e&&this._propagateFrom(i,2);var o=i._target();if(o!==this){var r=o._bitField;if(0==(50397184&r)){var s=this._length();s>0&&o._migrateCallback0(this);for(var a=1;a<s;++a)o._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else if(0!=(33554432&r))this._fulfill(o._value());else if(0!=(16777216&r))this._reject(o._reason());else{var l=new y("late cancellation observer");o._attachExtraTrace(l),this._reject(l)}}else this._reject(n())}},M.prototype._rejectCallback=function(t,e,i){var n=l.ensureErrorObject(t),o=n===t;if(!o&&!i&&I.warnings()){var r="a promise was rejected with a non-error: "+l.classString(t);this._warn(r,!0)}this._attachExtraTrace(n,!!e&&o),this._reject(t)},M.prototype._resolveFromExecutor=function(t){if(t!==b){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,n=this._execute(t,(function(t){e._resolveCallback(t)}),(function(t){e._rejectCallback(t,i)}));i=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)}},M.prototype._settlePromiseFromHandler=function(t,e,i,n){var o=n._bitField;if(0==(65536&o)){var r;n._pushContext(),e===C?i&&"number"==typeof i.length?r=k(t).apply(this._boundValue(),i):(r=D).e=new v("cannot .spread() a non-array: "+l.classString(i)):r=k(t).call(e,i);var s=n._popContext();0==(65536&(o=n._bitField))&&(r===T?n._reject(i):r===D?n._rejectCallback(r.e,!1):(I.checkForgottenReturns(r,s,"",n,this),n._resolveCallback(r)))}},M.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},M.prototype._followee=function(){return this._rejectionHandler0},M.prototype._setFollowee=function(t){this._rejectionHandler0=t},M.prototype._settlePromise=function(t,e,i,n){var r=t instanceof M,a=this._bitField,l=0!=(134217728&a);0!=(65536&a)?(r&&t._invokeInternalOnCancel(),i instanceof R&&i.isFinallyHandler()?(i.cancelPromise=t,k(e).call(i,n)===D&&t._reject(D.e)):e===o?t._fulfill(o.call(i)):i instanceof s?i._promiseCancelled(t):r||t instanceof E?t._cancel():i.cancel()):"function"==typeof e?r?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,n,t)):e.call(i,n,t):i instanceof s?i._isResolved()||(0!=(33554432&a)?i._promiseFulfilled(n,t):i._promiseRejected(n,t)):r&&(l&&t._setAsyncGuaranteed(),0!=(33554432&a)?t._fulfill(n):t._reject(n))},M.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,n=t.receiver,o=t.value;"function"==typeof e?i instanceof M?this._settlePromiseFromHandler(e,n,o,i):e.call(n,o,i):i instanceof M&&i._reject(o)},M.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},M.prototype._settlePromise0=function(t,e,i){var n=this._promise0,o=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,o,e)},M.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},M.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=n();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():m.settlePromises(this),this._dereferenceTrace())}},M.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return m.fatalError(t,l.isNode);(65535&e)>0?m.settlePromises(this):this._ensurePossibleRejectionHandled()}},M.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var n=this._fulfillmentHandlerAt(i),o=this._promiseAt(i),r=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(o,n,r,e)}},M.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var n=this._rejectionHandlerAt(i),o=this._promiseAt(i),r=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(o,n,r,e)}},M.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var i=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,i,t),this._rejectPromises(e,i)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)}this._clearCancellationData()},M.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&f.defineProperty(M.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),M.defer=M.pending=function(){return I.deprecated("Promise.defer","new Promise"),{promise:new M(b),resolve:P,reject:B}},l.notEnumerableProp(M,"_makeSelfResolutionError",n),t("./method")(M,b,x,r,I),t("./bind")(M,b,x,I),t("./cancel")(M,E,r,I),t("./direct_resolve")(M),t("./synchronous_inspection")(M),t("./join")(M,E,x,b,m),M.Promise=M,M.version="3.7.2",t("./call_get.js")(M),t("./generators.js")(M,r,b,x,s,I),t("./map.js")(M,E,r,x,b,I),t("./nodeify.js")(M),t("./promisify.js")(M,b),t("./props.js")(M,E,x,r),t("./race.js")(M,b,x,r),t("./reduce.js")(M,E,r,x,b,I),t("./settle.js")(M,E,I),t("./some.js")(M,E,r),t("./timers.js")(M,b,I),t("./using.js")(M,r,x,S,b,I),t("./any.js")(M),t("./each.js")(M,b),t("./filter.js")(M,b),l.toFastProperties(M),l.toFastProperties(M.prototype),F({a:1}),F({b:2}),F({c:3}),F(1),F((function(){})),F(void 0),F(!1),F(new M(b)),I.setBounds(g.firstLineError,l.lastLineError),M}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(t,e,i){"use strict";e.exports=function(e,i,n,o,r){var s=t("./util");function a(t){var n=this._promise=new e(i);t instanceof e&&(n._propagateFrom(t,3),t.suppressUnhandledRejections()),n._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.isArray,s.inherits(a,r),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function t(i,r){var a=n(this._values,this._promise);if(a instanceof e){var l=(a=a._target())._bitField;if(this._values=a,0==(50397184&l))return this._promise._setAsyncGuaranteed(),a._then(t,this._reject,void 0,this,r);if(0==(33554432&l))return 0!=(16777216&l)?this._reject(a._reason()):this._cancel();a=a._value()}if(null!==(a=s.asArray(a)))0!==a.length?this._iterate(a):-5===r?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(r));else{var u=o("expecting an array or an iterable object but got "+s.classString(a)).reason();this._promise._rejectCallback(u,!1)}},a.prototype._iterate=function(t){var i=this.getActualLength(t.length);this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values;for(var o=this._promise,r=!1,s=null,a=0;a<i;++a){var l=n(t[a],o);s=l instanceof e?(l=l._target())._bitField:null,r?null!==s&&l.suppressUnhandledRejections():null!==s?0==(50397184&s)?(l._proxy(this,a),this._values[a]=l):r=0!=(33554432&s)?this._promiseFulfilled(l._value(),a):0!=(16777216&s)?this._promiseRejected(l._reason(),a):this._promiseCancelled(a):r=this._promiseFulfilled(l,a)}r||o._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var i=0;i<t.length;++i)t[i]instanceof e&&t[i].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},{"./util":36}],24:[function(t,e,i){"use strict";e.exports=function(e,i){var n={},o=t("./util"),r=t("./nodeback"),s=o.withAppended,a=o.maybeWrapAsError,l=o.canEvaluate,u=t("./errors").TypeError,c={__isPromisified__:!0},h=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),d=function(t){return o.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function p(t){return!h.test(t)}function f(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function g(t,e,i){var n=o.getDataPropertyOrDefault(t,e+i,c);return!!n&&f(n)}function m(t,e,i,n){for(var r=o.inheritedDataKeys(t),s=[],a=0;a<r.length;++a){var l=r[a],c=t[l],h=n===d||d(l,c,t);"function"!=typeof c||f(c)||g(t,l,e)||!n(l,c,t,h)||s.push(l,c)}return function(t,e,i){for(var n=0;n<t.length;n+=2){var o=t[n];if(i.test(o))for(var r=o.replace(i,""),s=0;s<t.length;s+=2)if(t[s]===r)throw new u("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(s,e,i),s}var _=function(t){return t.replace(/([$])/,"\\$")},v=l?void 0:function(t,l,u,c,h,d){var p=function(){return this}(),f=t;function g(){var o=l;l===n&&(o=this);var u=new e(i);u._captureStackTrace();var c="string"==typeof f&&this!==p?this[f]:t,h=r(u,d);try{c.apply(o,s(arguments,h))}catch(t){u._rejectCallback(a(t),!0,!0)}return u._isFateSealed()||u._setAsyncGuaranteed(),u}return"string"==typeof f&&(t=c),o.notEnumerableProp(g,"__isPromisified__",!0),g};function y(t,e,i,r,s){for(var a=new RegExp(_(e)+"$"),l=m(t,e,a,i),u=0,c=l.length;u<c;u+=2){var h=l[u],d=l[u+1],p=h+e;if(r===v)t[p]=v(h,n,h,d,e,s);else{var f=r(d,(function(){return v(h,n,h,d,e,s)}));o.notEnumerableProp(f,"__isPromisified__",!0),t[p]=f}}return o.toFastProperties(t),t}e.promisify=function(t,e){if("function"!=typeof t)throw new u("expecting a function but got "+o.classString(t));if(f(t))return t;var i=function(t,e,i){return v(t,e,void 0,t,null,i)}(t,void 0===(e=Object(e)).context?n:e.context,!!e.multiArgs);return o.copyDescriptors(t,i,p),i},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new u("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var i=!!(e=Object(e)).multiArgs,n=e.suffix;"string"!=typeof n&&(n="Async");var r=e.filter;"function"!=typeof r&&(r=d);var s=e.promisifier;if("function"!=typeof s&&(s=v),!o.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=o.inheritedDataKeys(t),l=0;l<a.length;++l){var c=t[a[l]];"constructor"!==a[l]&&o.isClass(c)&&(y(c.prototype,n,r,s,i),y(c,n,r,s,i))}return y(t,n,r,s,i)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,i){"use strict";e.exports=function(e,i,n,o){var r,s=t("./util"),a=s.isObject,l=t("./es5");"function"==typeof Map&&(r=Map);var u=function(){var t=0,e=0;function i(i,n){this[t]=i,this[t+e]=n,t++}return function(n){e=n.size,t=0;var o=new Array(2*n.size);return n.forEach(i,o),o}}();function c(t){var e,i=!1;if(void 0!==r&&t instanceof r)e=u(t),i=!0;else{var n=l.keys(t),o=n.length;e=new Array(2*o);for(var s=0;s<o;++s){var a=n[s];e[s]=t[a],e[s+o]=a}}this.constructor$(e),this._isMap=i,this._init$(void 0,i?-6:-3)}function h(t){var i,r=n(t);return a(r)?(i=r instanceof e?r._then(e.props,void 0,void 0,void 0,void 0):new c(r).promise(),r instanceof e&&i._propagateFrom(r,2),i):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}s.inherits(c,i),c.prototype._init=function(){},c.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var i;if(this._isMap)i=function(t){for(var e=new r,i=t.length/2|0,n=0;n<i;++n){var o=t[i+n],s=t[n];e.set(o,s)}return e}(this._values);else{i={};for(var n=this.length(),o=0,s=this.length();o<s;++o)i[this._values[o+n]]=this._values[o]}return this._resolve(i),!0}return!1},c.prototype.shouldCopyValues=function(){return!1},c.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return h(this)},e.props=function(t){return h(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,i){"use strict";function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},n.prototype.push=function(t,e,i){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var o=this._front+n-3;this._checkCapacity(n);var r=this._capacity-1;this[o+0&r]=t,this[o+1&r]=e,this[o+2&r]=i,this._length=n},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,i,n,o){for(var r=0;r<o;++r)i[r+n]=t[r+e],t[r+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},e.exports=n},{}],27:[function(t,e,i){"use strict";e.exports=function(e,i,n,o){var r=t("./util"),s=function(t){return t.then((function(e){return a(e,t)}))};function a(t,a){var l=n(t);if(l instanceof e)return s(l);if(null===(t=r.asArray(t)))return o("expecting an array or an iterable object but got "+r.classString(t));var u=new e(i);void 0!==a&&u._propagateFrom(a,3);for(var c=u._fulfill,h=u._reject,d=0,p=t.length;d<p;++d){var f=t[d];(void 0!==f||d in t)&&e.cast(f)._then(c,h,void 0,u,null)}return u}e.race=function(t){return a(t,void 0)},e.prototype.race=function(){return a(this,void 0)}}},{"./util":36}],28:[function(t,e,i){"use strict";e.exports=function(e,i,n,o,r,s){var a=t("./util"),l=a.tryCatch;function u(t,i,n,o){this.constructor$(t);var s=e._getContext();this._fn=a.contextBind(s,i),void 0!==n&&(n=e.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=o===r?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function c(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function h(t,e,i,o){return"function"!=typeof e?n("expecting a function but got "+a.classString(e)):new u(t,e,i,o).promise()}function d(t){this.accum=t,this.array._gotAccum(t);var i=o(this.value,this.array._promise);return i instanceof e?(this.array._currentCancellable=i,i._then(p,void 0,void 0,this,void 0)):p.call(this,i)}function p(t){var i,n=this.array,o=n._promise,r=l(n._fn);o._pushContext(),(i=void 0!==n._eachValues?r.call(o._boundValue(),t,this.index,this.length):r.call(o._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(n._currentCancellable=i);var a=o._popContext();return s.checkForgottenReturns(i,a,void 0!==n._eachValues?"Promise.each":"Promise.reduce",o),i}a.inherits(u,i),u.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==r&&this._eachValues.push(t)},u.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},u.prototype._init=function(){},u.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},u.prototype.shouldCopyValues=function(){return!1},u.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},u.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},u.prototype._iterate=function(t){var i,n;this._values=t;var o=t.length;void 0!==this._initialValue?(i=this._initialValue,n=0):(i=e.resolve(t[0]),n=1),this._currentCancellable=i;for(var r=n;r<o;++r){var s=t[r];s instanceof e&&s.suppressUnhandledRejections()}if(!i.isRejected())for(;n<o;++n){var a={accum:null,value:t[n],index:n,length:o,array:this};i=i._then(d,void 0,void 0,a,void 0),0==(127&n)&&i._setNoAsyncGuarantee()}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(c,c,void 0,i,this)},e.prototype.reduce=function(t,e){return h(this,t,e,null)},e.reduce=function(t,e,i,n){return h(t,e,i,n)}}},{"./util":36}],29:[function(t,o,r){"use strict";var s,a,l,u,c,h=t("./util"),d=h.getNativePromise();if(h.isNode&&"undefined"==typeof MutationObserver){var p=i.setImmediate,f=e.nextTick;s=h.isRecentNode?function(t){p.call(i,t)}:function(t){f.call(e,t)}}else if("function"==typeof d&&"function"==typeof d.resolve){var g=d.resolve();s=function(t){g.then(t)}}else s="undefined"!=typeof MutationObserver&&("undefined"==typeof window||!window.navigator||!window.navigator.standalone&&!window.cordova)&&"classList"in document.documentElement?(a=document.createElement("div"),l={attributes:!0},u=!1,c=document.createElement("div"),new MutationObserver((function(){a.classList.toggle("foo"),u=!1})).observe(c,l),function(t){var e=new MutationObserver((function(){e.disconnect(),t()}));e.observe(a,l),u||(u=!0,c.classList.toggle("foo"))}):void 0!==n?function(t){n(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")};o.exports=s},{"./util":36}],30:[function(t,e,i){"use strict";e.exports=function(e,i,n){var o=e.PromiseInspection;function r(t){this.constructor$(t)}t("./util").inherits(r,i),r.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},r.prototype._promiseFulfilled=function(t,e){var i=new o;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},r.prototype._promiseRejected=function(t,e){var i=new o;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},e.settle=function(t){return n.deprecated(".settle()",".reflect()"),new r(t).promise()},e.allSettled=function(t){return new r(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,i){"use strict";e.exports=function(e,i,n){var o=t("./util"),r=t("./errors").RangeError,s=t("./errors").AggregateError,a=o.isArray,l={};function u(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function c(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new u(t),o=i.promise();return i.setHowMany(e),i.init(),o}o.inherits(u,i),u.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=a(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},u.prototype.init=function(){this._initialized=!0,this._init()},u.prototype.setUnwrap=function(){this._unwrap=!0},u.prototype.howMany=function(){return this._howMany},u.prototype.setHowMany=function(t){this._howMany=t},u.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},u.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},u.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},u.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new s,e=this.length();e<this._values.length;++e)this._values[e]!==l&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},u.prototype._fulfilled=function(){return this._totalResolved},u.prototype._rejected=function(){return this._values.length-this.length()},u.prototype._addRejected=function(t){this._values.push(t)},u.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},u.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},u.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new r(e)},u.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return c(t,e)},e.prototype.some=function(t){return c(this,t)},e._SomePromiseArray=u}},{"./errors":12,"./util":36}],32:[function(t,e,i){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},o=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},r=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return r.call(this._target())},t.prototype.isFulfilled=function(){return o.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,i){"use strict";e.exports=function(e,i){var n=t("./util"),o=n.errorObj,r=n.isObject,s={}.hasOwnProperty;return function(t,a){if(r(t)){if(t instanceof e)return t;var l=function(t){try{return function(t){return t.then}(t)}catch(t){return o.e=t,o}}(t);if(l===o){a&&a._pushContext();var u=e.reject(l.e);return a&&a._popContext(),u}if("function"==typeof l)return function(t){try{return s.call(t,"_promise0")}catch(t){return!1}}(t)?(u=new e(i),t._then(u._fulfill,u._reject,void 0,u,null),u):function(t,r,s){var a=new e(i),l=a;s&&s._pushContext(),a._captureStackTrace(),s&&s._popContext();var u=!0,c=n.tryCatch(r).call(t,(function(t){a&&(a._resolveCallback(t),a=null)}),(function(t){a&&(a._rejectCallback(t,u,!0),a=null)}));return u=!1,a&&c===o&&(a._rejectCallback(c.e,!0,!0),a=null),l}(t,l,a)}return t}}},{"./util":36}],34:[function(t,e,i){"use strict";e.exports=function(e,i,n){var o=t("./util"),r=e.TimeoutError;function s(t){this.handle=t}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var a=function(t){return l(+this).thenReturn(t)},l=e.delay=function(t,o){var r,l;return void 0!==o?(r=e.resolve(o)._then(a,null,null,t,void 0),n.cancellation()&&o instanceof e&&r._setOnCancel(o)):(r=new e(i),l=setTimeout((function(){r._fulfill()}),+t),n.cancellation()&&r._setOnCancel(new s(l)),r._captureStackTrace()),r._setAsyncGuaranteed(),r};function u(t){return clearTimeout(this.handle),t}function c(t){throw clearTimeout(this.handle),t}e.prototype.delay=function(t){return l(t,this)},e.prototype.timeout=function(t,e){var i,a;t=+t;var l=new s(setTimeout((function(){i.isPending()&&function(t,e,i){var n;n="string"!=typeof e?e instanceof Error?e:new r("operation timed out"):new r(e),o.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._reject(n),null!=i&&i.cancel()}(i,e,a)}),t));return n.cancellation()?(a=this.then(),(i=a._then(u,c,void 0,l,void 0))._setOnCancel(l)):i=this._then(u,c,void 0,l,void 0),i}}},{"./util":36}],35:[function(t,e,i){"use strict";e.exports=function(e,i,n,o,r,s){var a=t("./util"),l=t("./errors").TypeError,u=t("./util").inherits,c=a.errorObj,h=a.tryCatch,d={};function p(t){setTimeout((function(){throw t}),0)}function f(t,i){var o=0,s=t.length,a=new e(r);return function r(){if(o>=s)return a._fulfill();var l=function(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(t[o++]);if(l instanceof e&&l._isDisposable()){try{l=n(l._getDisposer().tryDispose(i),t.promise)}catch(t){return p(t)}if(l instanceof e)return l._then(r,p,null,null,null)}r()}(),a}function g(t,e,i){this._data=t,this._promise=e,this._context=i}function m(t,e,i){this.constructor$(t,e,i)}function _(t){return g.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function v(t){this.length=t,this.promise=null,this[t-1]=null}g.prototype.data=function(){return this._data},g.prototype.promise=function(){return this._promise},g.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():d},g.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var n=e!==d?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,n},g.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},u(m,g),m.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},v.prototype._resultCancelled=function(){for(var t=this.length,i=0;i<t;++i){var n=this[i];n instanceof e&&n.cancel()}},e.using=function(){var t=arguments.length;if(t<2)return i("you must pass at least 2 arguments to Promise.using");var o,r=arguments[t-1];if("function"!=typeof r)return i("expecting a function but got "+a.classString(r));var l=!0;2===t&&Array.isArray(arguments[0])?(t=(o=arguments[0]).length,l=!1):(o=arguments,t--);for(var u=new v(t),d=0;d<t;++d){var p=o[d];if(g.isDisposer(p)){var m=p;(p=p.promise())._setDisposable(m)}else{var y=n(p);y instanceof e&&(p=y._then(_,null,null,{resources:u,index:d},void 0))}u[d]=p}var b=new Array(u.length);for(d=0;d<b.length;++d)b[d]=e.resolve(u[d]).reflect();var C=e.all(b).then((function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return c.e=i.error(),c;if(!i.isFulfilled())return void C.cancel();t[e]=i.value()}T._pushContext(),r=h(r);var n=l?r.apply(void 0,t):r(t),o=T._popContext();return s.checkForgottenReturns(n,o,"Promise.using",T),n})),T=C.lastly((function(){var t=new e.PromiseInspection(C);return f(u,t)}));return u.promise=T,T._setOnCancel(u),T},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new m(t,this,o());throw new l}}},{"./errors":12,"./util":36}],36:[function(t,n,o){"use strict";var r=t("./es5"),s="undefined"==typeof navigator,a={e:{}},l,u="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:void 0!==this?this:null;function c(){try{var t=l;return l=null,t.apply(this,arguments)}catch(t){return a.e=t,a}}function h(t){return l=t,c}var d=function(t,e){var i={}.hasOwnProperty;function n(){for(var n in this.constructor=t,this.constructor$=e,e.prototype)i.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}return n.prototype=e.prototype,t.prototype=new n,t.prototype};function p(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function f(t){return"function"==typeof t||"object"==typeof t&&null!==t}function g(t){return p(t)?new Error(I(t)):t}function m(t,e){var i,n=t.length,o=new Array(n+1);for(i=0;i<n;++i)o[i]=t[i];return o[i]=e,o}function _(t,e,i){if(!r.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:i:void 0}function v(t,e,i){if(p(t))return t;var n={value:i,configurable:!0,enumerable:!1,writable:!0};return r.defineProperty(t,e,n),t}function y(t){throw t}var b=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1};if(r.isES5){var i=Object.getOwnPropertyNames;return function(t){for(var n=[],o=Object.create(null);null!=t&&!e(t);){var s;try{s=i(t)}catch(t){return n}for(var a=0;a<s.length;++a){var l=s[a];if(!o[l]){o[l]=!0;var u=Object.getOwnPropertyDescriptor(t,l);null!=u&&null==u.get&&null==u.set&&n.push(l)}}t=r.getPrototypeOf(t)}return n}}var n={}.hasOwnProperty;return function(i){if(e(i))return[];var o=[];t:for(var r in i)if(n.call(i,r))o.push(r);else{for(var s=0;s<t.length;++s)if(n.call(t[s],r))continue t;o.push(r)}return o}}(),C=/this\s*\.\s*\S+\s*=/;function T(t){try{if("function"==typeof t){var e=r.names(t.prototype),i=r.isES5&&e.length>1,n=e.length>0&&!(1===e.length&&"constructor"===e[0]),o=C.test(t+"")&&r.names(t).length>0;if(i||n||o)return!0}return!1}catch(t){return!1}}function x(t){function e(){}e.prototype=t;var i=new e;function n(){return typeof i.foo}return n(),n(),t}var E=/^[a-z$_][a-z$_0-9]*$/i;function w(t){return E.test(t)}function S(t,e,i){for(var n=new Array(t),o=0;o<t;++o)n[o]=e+o+i;return n}function I(t){try{return t+""}catch(t){return"[no string representation]"}}function R(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function L(t){try{v(t,"isOperational",!0)}catch(t){}}function A(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function D(t){return R(t)&&r.propertyIsWritable(t,"stack")}var k="stack"in new Error?function(t){return D(t)?t:new Error(I(t))}:function(t){if(D(t))return t;try{throw new Error(I(t))}catch(t){return t}};function M(t){return{}.toString.call(t)}function P(t,e,i){for(var n=r.names(t),o=0;o<n.length;++o){var s=n[o];if(i(s))try{r.defineProperty(e,s,r.getDescriptor(t,s))}catch(t){}}}var B=function(t){return r.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var F="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],n=t[Symbol.iterator]();!(e=n.next()).done;)i.push(e.value);return i};B=function(t){return r.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?F(t):null}}var N=void 0!==e&&"[object process]"===M(e).toLowerCase(),O=void 0!==e&&void 0!==e.env,V;function j(t){return O?e.env[t]:void 0}function H(){if("function"==typeof Promise)try{if("[object Promise]"===M(new Promise((function(){}))))return Promise}catch(t){}}function z(t,e){if(null===t||"function"!=typeof e||e===V)return e;null!==t.domain&&(e=t.domain.bind(e));var i=t.async;if(null!==i){var n=e;e=function(){var t=new Array(2).concat([].slice.call(arguments));return t[0]=n,t[1]=this,i.runInAsyncScope.apply(i,t)}}return e}var U={setReflectHandler:function(t){V=t},isClass:T,isIdentifier:w,inheritedDataKeys:b,getDataPropertyOrDefault:_,thrower:y,isArray:r.isArray,asArray:B,notEnumerableProp:v,isPrimitive:p,isObject:f,isError:R,canEvaluate:s,errorObj:a,tryCatch:h,inherits:d,withAppended:m,maybeWrapAsError:g,toFastProperties:x,filledRange:S,toString:I,canAttachTrace:D,ensureErrorObject:k,originatesFromRejection:A,markAsOriginatingFromRejection:L,classString:M,copyDescriptors:P,isNode:N,hasEnvVariables:O,env:j,global:u,getNativePromise:H,contextBind:z},W;U.isRecentNode=U.isNode&&(e.versions&&e.versions.node?W=e.versions.node.split(".").map(Number):e.version&&(W=e.version.split(".").map(Number)),0===W[0]&&W[1]>10||W[0]>0),U.nodeSupportsAsyncResource=U.isNode&&function(){var e=!1;try{e="function"==typeof t("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(t){e=!1}return e}(),U.isNode&&U.toFastProperties(e);try{throw new Error}catch(t){U.lastLineError=t}n.exports=U},{"./es5":13,async_hooks:void 0}]},{},[4])(4)},t.exports=o(),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,i(2),i(3),i(8).setImmediate)},function(t,e,i){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function r(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new r(o.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new r(o.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},i(9),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(3))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,o,r,s,a,l=1,u={},c=!1,h=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick((function(){f(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?t.MessageChannel?((r=new MessageChannel).port1.onmessage=function(t){f(t.data)},n=function(t){r.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(o=h.documentElement,n=function(t){var e=h.createElement("script");e.onreadystatechange=function(){f(t),e.onreadystatechange=null,o.removeChild(e),e=null},o.appendChild(e)}):n=function(t){setTimeout(f,0,t)}:(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&f(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),n=function(e){t.postMessage(s+e,"*")}),d.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var o={callback:t,args:e};return u[l]=o,n(l),l++},d.clearImmediate=p}function p(t){delete u[t]}function f(t){if(c)setTimeout(f,0,t);else{var e=u[t];if(e){c=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{p(t),c=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(3),i(2))},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},r=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a,l=i(11),u=i(28),c=i(37),h=s(i(0)),d=i(38),p=s(i(0)),f=i(43),g=s(i(1)).default.errorMessages;!function(t){t[t.HAND=0]="HAND",t[t.CROP=1]="CROP",t[t.CLICK_TO_ZOOM=2]="CLICK_TO_ZOOM"}(a||(a={}));var m=function(){function t(t){this._operationMode=a.HAND,this.errorMessage="ok",this.errorCode=0,this.postfix="_"+h.default.uid(9),this._logLevel=1,this._logs=[],this._cancelArr=[],this._isCanvasVisiable=!0,this._renderTimer=null,this._addLog("Init DVS."),this.publishSubscribe=new f.PublishSubscribe,this.on("_onAddLog",this._onAddLog.bind(this)),this.viewer=new c.Viewer(this.postfix,t.uiConfig,this.publishSubscribe),this.graphic=new d.Graphic({pubsub:this.publishSubscribe,backgroundColor:this.viewer._canvasBackgroundColor,scrollerConfig:t.scrollerConfig});var e=this.viewer.uiConfig,i=e.tag.visibility,n=e.tree.visibility;this.dataHandler=new l.DataHandler(t,this.publishSubscribe,i,n),this._bindEvent(),this._windowResize(),this.on("render",function(t){this.render(t)}.bind(this)),this.on("dvs_error",function(t){this.errorCode=t.code,this.errorMessage=t.message}.bind(this)),this.containerId=t.containerId,this.bindViewer(t.containerId,t.uiConfig),this._addLog("Init DVS completed")}return t.prototype._bindEvent=function(){var t=this,e={_onTagChange:this._onTagChange,_onCanvasResize:this._onCanvasResize,_onLoadImage:this._onLoadImage,_onAppendImage:this._onAppendImage,_onAddTag:this._onAddTag,_onRenameTag:this._onRenameTag,_onOpenTag:this._onOpenTag,_onAddNode:this._onAddNode,_onAddFile:this._onAddFile,_onAddFolder:this._onAddFolder,_onRenameNode:this._onRenameNode,_onRenameFolder:this._onRenameFolder,_onRenameFile:this._onRenameFile,_onOpenNode:this._onOpenNode,_onOpenFile:this._onOpenFile,_onOpenFolder:this._onOpenFolder,_onBackToPrevious:this._onBackToPrevious,_onPreviousPage:this._onPreviousPage,_onNextPage:this._onNextPage,_onDirectoryChange:this._onDirectoryChange,_onUiRefresh:this._onUiRefresh,_onReOrderThumbnail:this._onReOrderThumbnail,_onSetSelectedIndexes:this._onSetSelectedIndexes,_onFirstPage:this._onFirstPage,_onLastPage:this._onLastPage,_onGotoPage:this._onGotoPage,_onAddImageTag:this._onAddImageTag,_onRemoveImageTag:this._onRemoveImageTag,_onRemoveTag:this._onRemoveTag,_onEmptyTag:this._onEmptyTag,_onRemoveNode:this._onRemoveNode,_onRemoveFile:this._onRemoveFile,_onRemoveFolder:this._onRemoveFolder,_onRemove:this._onRemove,_onRemoveAll:this._onRemoveAll,_onFitType:this._onFitType,_onSendCropLimitArea:this._onSendCropLimitArea,_onCrop:this._onCrop,_onZoomIn:this._onZoomIn,_onZoomOUt:this._onZoomOut,_onSetClickToZoom:this._onSetClickToZoom,_onGetOperationMode:this._onGetOperationMode,_onOpenAll:this._onOpenAll,_onSendMiniImgSize:this._onSendMiniImgSize,_onThumbnailScrollTo:this._onThumbnailScrollTo,_onExistImage:this._onExistImage,_onShowCanvas:this._onShowCanvas,slideSwitch:this._slideSwitch,_onUpdateImage:this._onUpdateImage,_onRotate:this._onRotate,_onFlip:this._onFlip,_onMirror:this._onMirror,_onUpdateMetaData:this._onUpdateMetaData};Object.keys(e).forEach((function(i){t.on(i,e[i].bind(t))}))},t.prototype._onTagChange=function(){this.dataHandler.onTagChange()},t.prototype._onCanvasResize=function(){this.graphic.onCanvasResize()},t.prototype._onLoadImage=function(t){this.dataHandler.loadImage(t)},t.prototype._onAppendImage=function(t,e){this.appendImage(t,e).catch((function(t){return console.log(t)}))},t.prototype._onAddTag=function(t){this.addTag(t)},t.prototype._onRenameTag=function(t,e){this.renameTag(t,e)},t.prototype._onOpenTag=function(t){this.setDefaultTag(t),this.openTag(t)},t.prototype._onAddNode=function(t,e){this.addFolder(t,e)},t.prototype._onAddFile=function(t,e){this.addFile(t,e)},t.prototype._onAddFolder=function(t,e){this.addFolder(t,e)},t.prototype._onRenameNode=function(t,e){this.renameNode(t,e)},t.prototype._onRenameFile=function(t,e){this.renameFile(t,e)},t.prototype._onRenameFolder=function(t,e){this.renameFolder(t,e)},t.prototype._onOpenNode=function(t){this.openNode(t)},t.prototype._onOpenFile=function(t){this.openFile(t)},t.prototype._onOpenFolder=function(t){this.openFolder(t)},t.prototype._onBackToPrevious=function(){this.backToPrevious()},t.prototype._onPreviousPage=function(){this.prevPage()},t.prototype._onNextPage=function(){this.nextPage()},t.prototype._onFirstPage=function(){this.firstPage()},t.prototype._onLastPage=function(){this.lastPage()},t.prototype._onGotoPage=function(t){this.goToPage(t)},t.prototype._onDirectoryChange=function(){this.dataHandler.onDirectoryChange()},t.prototype._onUiRefresh=function(){this.dataHandler.onDirectoryChange(),this.dataHandler.onTagChange(),this.dataHandler.onThumbnailChange()},t.prototype._onReOrderThumbnail=function(t,e){this.dataHandler.reorderThumbnail(t,e)},t.prototype._onSetSelectedIndexes=function(t){this.setSelectedIndexes(t)},t.prototype._onAddImageTag=function(t,e){this.addImageTag(t,e)},t.prototype._onRemoveImageTag=function(t,e){this.removeImageTag(t,e)},t.prototype._onRemoveTag=function(t){this.removeTag(t)},t.prototype._onEmptyTag=function(t){this.emptyTag(t)},t.prototype._onRemoveNode=function(t){this.removeFolder(t)},t.prototype._onRemoveFile=function(t){this.removeFile(t)},t.prototype._onRemoveFolder=function(t){this.removeFolder(t)},t.prototype._onRemove=function(t){this.remove(t)},t.prototype._onRemoveAll=function(){this.removeAll()},t.prototype._onFitType=function(t){this.fitType=t},t.prototype._onSendCropLimitArea=function(){var t=this.graphic._getCropLimitAreaForCrop();this.emit("_onGetCropLimitArea",t)},t.prototype._onCrop=function(t){var e=t.slice(0).pop(),i=this.graphic._getImageRelArea(e.left,e.top,e.width,e.height);this.graphic.crop(i.x,i.y,i.width,i.height)},t.prototype._onZoomIn=function(){this.zoomIn()},t.prototype._onZoomOut=function(){this.zoomOut()},t.prototype._onSetClickToZoom=function(t){2===t&&(this.graphic.isClickToRoom=!0)},t.prototype._onGetOperationMode=function(t){this.operationMode=t},t.prototype._onOpenAll=function(){this.openAll()},t.prototype._onSendMiniImgSize=function(){var t=this,e=this.dataHandler.currentContents;if(0!==e.length){var i=this.getCurrentIndex(),n=this.getMetaDataByIndex(i);if(n.imageWidth)this.emit("_onGetMiniImgSize",{width:n.imageWidth,height:n.imageHeight});else if(null!==i&&!(i>=e.length)){var o=e[i].originalData,r=new Image;r.crossOrigin="anonymous",r.src=o,r.onload=function(){var e=r.naturalWidth||0,i=r.naturalHeight||0;t.emit("_onGetMiniImgSize",{width:e,height:i}),r=null},r.onerror=function(){t.emit("_onGetMiniImgSize",{width:0,height:0}),r=null}}}else this.graphic.clearCanvas()},t.prototype._onThumbnailScrollTo=function(t){this.thumbnailScrollTo(t)},t.prototype._onAddLog=function(t){this._addLog(t)},t.prototype._onExistImage=function(){this.emit("_getImageCountForCanvas",this.currentImageCount)},t.prototype._onShowCanvas=function(t){this._isCanvasVisiable=t},t.prototype._slideSwitch=function(t){switch(t){case"left":this.prevPage();break;case"right":this.nextPage()}},t.prototype._onUpdateImage=function(t,e,i){t&&this.updateImageSync(t,e,i)},t.prototype._onRotate=function(t){this.rotate(t)},t.prototype._onFlip=function(){this.flip()},t.prototype._onMirror=function(){this.mirror()},t.prototype._onUpdateMetaData=function(t,e){var i=this.getCurrentIndex();if(null!==i){var n=this.getMetaDataByIndex(i);n.imageWidth&&(n.imageWidth=t,n.imageHeight=e,this.setMetaDataByIndex(i,n),this.emit("_onGetMiniImgSize",{width:t,height:e}))}},t.prototype._windowResize=function(){var t=this;window.addEventListener("resize",(function(){t.uiEventControl&&t.uiEventControl.styleChange()}))},t.prototype.cancelRender=function(){var t=this;this._cancelArr.forEach((function(e,i){e.cancel(),delete t._cancelArr[i]}))},t.prototype.makeCancel=function(t){var e=!1;return{promise:new Promise((function(i,n){t.then((function(t){return e?n({isCanceled:!0}):i(t)})),t.catch((function(t){return n(e?{isCanceled:!0}:t)}))})),cancel:function(){e=!0}}},t.prototype.render=function(t){if(this._isCanvasVisiable){var e=this.dataHandler.currentContents;if(0===e.length)return this.graphic.clearCanvas(),void(this._renderImage=null);var i=this.getCurrentIndex();null!==i&&(i>=e.length||this.graphic.render(i,t))}},t.prototype.setSelectedImageArea=function(t,e,i,n,o){if(null===this.getCurrentIndex())return this._throwErr(g.NO_IMAGE_EXIST,"setSelectedImageArea"),!1;if(!(h.default.isNumber(t)&&h.default.isNumber(e)&&h.default.isNumber(i)&&h.default.isNumber(n)))return this._throwErr(g.PARAMETER_TYPE,"setSelectedImageArea"),!1;if(t<0||e<0||i<0||n<0)return this._throwErr(g.PARAMETER_RANGE,"setSelectedImageArea"),!1;if(void 0!==o&&!h.default.isBoolean(o))return this._throwErr(g.PARAMETER_TYPE,"setSelectedImageArea"),!1;var r=this.graphic.getCropAreaRelativeToImage(t,e,i,n);return this.uiEventControl&&this.uiEventControl.setCropArea(r.x,r.y,r.width,r.height,o)},t.prototype.setSelectedThumbnailArea=function(t,e,i,n,o){var r=this.getCurrentIndex();return null===r?(this._throwErr(g.NO_IMAGE_EXIST,"setSelectedThumbnailArea"),!1):h.default.isNumber(t)&&h.default.isNumber(e)&&h.default.isNumber(i)&&h.default.isNumber(n)?t<0||e<0||i<0||n<0?(this._throwErr(g.PARAMETER_RANGE,"setSelectedThumbnailArea"),!1):void 0===o||h.default.isBoolean(o)?!!(this.uiEventControl&&this.uiEventControl.setThumbnailCropArea(r,t,e,i,n,o)):(this._throwErr(g.PARAMETER_TYPE,"setSelectedThumbnailArea"),!1):(this._throwErr(g.PARAMETER_TYPE,"setSelectedThumbnailArea"),!1)},t.prototype.getCustomDataByIndex=function(t){return this.dataHandler.getCustomDataByIndex(t)},Object.defineProperty(t.prototype,"selectionRectAspectRatio",{get:function(){return this.uiEventControl&&this.uiEventControl.getCropRatio()},set:function(t){p.default.isNumber(t)&&t>0&&this.uiEventControl&&this.uiEventControl.setCropRatio(t)},enumerable:!0,configurable:!0}),t.prototype.appendImage=function(t,e){return n(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.dataHandler.appendImage(t,e)];case 1:return[2,i.sent()]}}))}))},t.prototype.appendImageSync=function(t,e){return this.dataHandler.appendImageSync(t,e)},t.prototype.insertImage=function(t,e,i){return n(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,this.dataHandler.insertImage(t,e,i)];case 1:return[2,n.sent()]}}))}))},t.prototype.insertImageSync=function(t,e,i){return this.dataHandler.insertImageSync(t,e,i)},t.prototype.setLoadCallback=function(t){return this.dataHandler.setLoadCallback(t)},t.prototype.setLoadInfoCallback=function(t){return this.dataHandler.setInfoCallback(t)},t.prototype.save=function(){alert("not achieve ...")},t.prototype.print=function(){alert("not achieve ...")},t.prototype.remove=function(t){return this.dataHandler.remove(t)},t.prototype.removeSync=function(t){return this.dataHandler.removeSync(t)},t.prototype.removeAll=function(){return this.dataHandler.removeAll()},t.prototype.removeAllSync=function(){return this.dataHandler.removeAllSync()},t.prototype.getCurrentIndex=function(){return this.dataHandler.getCurrentIndex()},t.prototype.setCurrentIndex=function(t){return this.dataHandler.setCurrentIndex(t)},t.prototype.mirror=function(){return this.graphic.flip(1)},t.prototype.flip=function(){return this.graphic.flip(0)},t.prototype.rotate=function(t){return this.graphic.rotate(t)},t.prototype.crop=function(t,e,i,n){return this.graphic.crop(t,e,i,n)},t.prototype.erase=function(t,e,i,n,o){return this.graphic.erase(t,e,i,n,o)},t.prototype.saveTransformResult=function(){return this.graphic.saveTransformResult()},t.prototype.addData=function(t,e){return this.dataHandler.addData(t,e)},t.prototype.getData=function(t){return this.dataHandler.getDataPro(t)},t.prototype.removeData=function(t){return this.dataHandler.removeData(t)},t.prototype.updateData=function(t,e){return this.dataHandler.updateData(t,e)},t.prototype.openAll=function(){return this.dataHandler.openAll()},t.prototype.getAllContents=function(){return this.dataHandler.getAllContents()},t.prototype.getCurrentNode=function(){return this.dataHandler.getCurrentNode()},t.prototype.getFileContents=function(t){return this.dataHandler.getFileContents(t)},t.prototype.addFile=function(t,e){return this.dataHandler.addFile(t,e)},t.prototype.addFolder=function(t,e){return this.dataHandler.addFolder(t,e)},t.prototype.openNode=function(t){return/\//g.test(t)?this.dataHandler.openFileByPath(t):this.dataHandler.openFile(t)},t.prototype.openFile=function(t){return/\//g.test(t)?this.dataHandler.openFileByPath(t):this.dataHandler.openFile(t)},t.prototype.openFolder=function(t){return/\//g.test(t)?this.dataHandler.openFolderByPath(t):this.dataHandler.openFolder(t)},t.prototype.backToPrevious=function(){return this.dataHandler.backToPrevious()},t.prototype.removeFile=function(t){return/\//g.test(t)?this.dataHandler.removeFileByPath(t):this.dataHandler.removeFile(t)},t.prototype.removeFolder=function(t){return/\//g.test(t)?this.dataHandler.removeFolderByPath(t):this.dataHandler.removeFolder(t)},t.prototype.renameNode=function(t,e){return this.dataHandler.renameFile(t,e)},t.prototype.renameFile=function(t,e){return this.dataHandler.renameFile(t,e)},t.prototype.renameFolder=function(t,e){return this.dataHandler.renameFolder(t,e)},t.prototype.nextPage=function(){return this.dataHandler.nextPage()},t.prototype.prevPage=function(){return this.dataHandler.previousPage()},t.prototype.firstPage=function(){return this.dataHandler.firstPage()},t.prototype.lastPage=function(){return this.dataHandler.lastPage()},t.prototype.goToPage=function(t){return this.dataHandler.goToPage(t)},t.prototype.moveImage=function(t,e){return this.dataHandler.moveImage(t,e)},t.prototype.switchImage=function(t,e){return this.dataHandler.switchImage(t,e)},t.prototype.getUidByIndex=function(t){return this.dataHandler.getUidByIndex(t)},t.prototype.getIndexByUid=function(t){return this.dataHandler.getIndexByUid(t)},t.prototype.updateImage=function(t,e,i){return this.dataHandler.updateImage(t,e,i)},t.prototype.updateImageSync=function(t,e,i){return this.dataHandler.updateImageSync(t,e,i)},t.prototype.getMetaDataByIndex=function(t){return this.dataHandler.getMetaDataByIndex(t)},t.prototype.setMetaDataByIndex=function(t,e){return this.dataHandler.setMetaDataByIndex(t,e)},t.prototype.setSelectedIndexes=function(t){return this.dataHandler.setSelectedIndexes(t)},t.prototype.getSelectedIndexes=function(){return this.dataHandler.getSelectedIndexes()},t.prototype.getThumbnailUids=function(){return this.dataHandler.getThumbnailUids()},t.prototype.selectAll=function(){return this.dataHandler.selectAll()},t.prototype.emptyThumbnail=function(){return this.dataHandler.removeAllThumbnailItem()},t.prototype.insertBefore=function(t,e){return this.dataHandler.insertBefore(t,e)},t.prototype.insertAfter=function(t,e){return this.dataHandler.insertAfter(t,e)},t.prototype.overlayRectangle=function(t,e,i,n,o,r,s){var a=this,l=this.getUidByIndex(t),u=this.dataHandler.getThumbnailContents();return!!l&&(this.dataHandler.getData(l).then((function(e){return a.dataHandler.getImageFromCanvas(e,u[t])})).then((function(t){var l=t.ctx,u=t.r;a.graphic.drawRectangle(l,e/u,i/u,n/u,o/u,"#000000",r,0,1,s);var c=l.canvas.toDataURL("image/jpeg",1);return Promise.resolve(c)})).then((function(t){a.updateImage(l,{minData:t},!0)})),!0)},Object.defineProperty(t.prototype,"currentImageCount",{get:function(){return this.dataHandler.getCurrentImageCounts()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalImageCount",{get:function(){return this.dataHandler._all.imgLists.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageMargin",{get:function(){return this.viewer.uiConfig.thumbnail.imageSpace},set:function(t){this.uiEventControl&&this.uiEventControl.changeMargin(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showPageNumber",{get:function(){return this.viewer.showPageNumber},set:function(t){this.viewer.setShowPageNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSelectBox",{get:function(){return this.viewer.showSelectBox},set:function(t){this.viewer.setShowSelectBox(t)},enumerable:!0,configurable:!0}),t.prototype.addTag=function(t,e){return this.dataHandler.addTag(t,e)},t.prototype.removeTag=function(t){return this.dataHandler.removeTag(t)},t.prototype.addImageTag=function(t,e){return this.dataHandler.addImageTag(t,e)},t.prototype.emptyTag=function(t){return this.dataHandler.emptyTag(t)},t.prototype.removeImageTag=function(t,e){return this.dataHandler.removeImageTag(t,e)},t.prototype.getTagContents=function(t){return this.dataHandler.getTagContents(t)},t.prototype.renameTag=function(t,e){return this.dataHandler.renameTag(t,e)},t.prototype.openTag=function(t){return this.dataHandler.openTag(t)},t.prototype.getTagList=function(){return this.dataHandler.getTagList()},t.prototype.setDefaultTag=function(t){return this.dataHandler.setDefaultTag(t)},t.prototype.getDefaultTag=function(){return this.dataHandler.getDefaultTag()},t.prototype.getCurrentTag=function(){return this.dataHandler.getCurrentTag()},t.prototype.on=function(t,e){this.publishSubscribe.on(t,e)},t.prototype.emit=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];(e=this.publishSubscribe).emit.apply(e,r([t],i))},t.prototype.off=function(t,e){this.publishSubscribe.off(t,e)},t.prototype.addTab=function(t){return this.dataHandler.addTab(t)},t.prototype.removeTab=function(t){return this.dataHandler.removeTab(t)},t.prototype.getTab=function(t){return this.dataHandler.getTab(t)},t.prototype.showTab=function(t){this.dataHandler.showTab(t)},t.prototype._throwErr=function(t,e){this.emit("dvs_error",t),void 0!==e&&void 0!==t.message&&this.emit("_onAddLog",h.default.formatLog(e,!1,t.message))},t.prototype._ok=function(){this.emit("dvs_error",g.OK)},t.prototype.zoomIn=function(){return this.graphic.zoomIn()},t.prototype.zoomOut=function(){return this.graphic.zoomOut()},t.prototype.zoomTo=function(t,e,i){return!h.default.isNumber(t)||void 0!==e&&!h.default.isNumber(e)||void 0!==i&&!h.default.isNumber(i)?(this._throwErr(g.PARAMETER_TYPE,"zoomTo"),!1):t<=0?(this._throwErr(g.PARAMETER_RANGE,"zoomTo"),!1):(this.graphic.useRelativeZoom||(t/=this.graphic.realZoom),this.graphic.zoomTo(t,!1,e,i),this.render(),this._ok(),!0)},t.prototype.fullScreen=function(){var t=this.viewer.fullScreen();return this.uiEventControl&&this.uiEventControl.styleChange(),t},t.prototype.cancelFullScreen=function(){var t=this.viewer.cancelFullScreen();return this.uiEventControl&&this.uiEventControl.styleChange(),t},t.prototype.fullPage=function(){var t=this.viewer.fullPage();return this.uiEventControl&&this.uiEventControl.styleChange(),t},t.prototype.cancelFullPage=function(){var t=this.viewer.cancelFullPage();return this.uiEventControl&&this.uiEventControl.styleChange(),t},t.prototype.setViewMode=function(t,e){return h.default.isNumber(t)&&h.default.isNumber(e)?t<0&&e<0?(this._throwErr(g.PARAMETER_RANGE,"setViewMode"),!1):this.uiEventControl&&this.uiEventControl.setViewMode(t,e):(this._throwErr(g.PARAMETER_TYPE,"setViewMode"),!1)},t.prototype.thumbnailScrollTo=function(t){return h.default.isNumber(t)?this.uiEventControl&&this.uiEventControl.scrollTo(t):(this._throwErr(g.PARAMETER_TYPE,"thumbnailScrollTo"),!1)},t.prototype.bindViewer=function(t,e){if(!h.default.isString(t))return this._throwErr(g.PARAMETER_TYPE,"bindViewer"),!1;if(e&&!h.default.isObject(e))return this._throwErr(g.PARAMETER_TYPE,"bindViewer"),!1;for(var i in e)if(!this.viewer.uiConfig[i])return this._throwErr(g.PARAMETER_INVALID,"bindViewer"),!1;var n=h.default.id(t);if(n){this.containerId=t;var o=h.default.id("WebViewer"+this.postfix);return o&&!e?(n.appendChild(o),!0):(this.viewer.unbindAllMainContent(),o&&this.unbindViewer(),h.default.mergeJSON(e,this.viewer.uiConfig),this.viewer.initUI(t),this.viewer.bindAllMainContent(),this.graphic.bindCanvasContainer("viewPort"+this.postfix),this.bindContent(),this.uiEventControl?this.uiEventControl.uiEventInit():this.uiEventControl=new u.UiEventControl(this.viewer,this.publishSubscribe),this._onUiRefresh(),this.emit("_onAddLog",h.default.formatLog("bindViewer",!0)),!0)}return this._throwErr(g.ELEMENT_NOT_EXIST,"bindViewer"),!1},t.prototype.bindContent=function(t,e,i){if(t&&!h.default.isString(t))return this._throwErr(g.PARAMETER_TYPE,"bindContent"),!1;if(e&&i&&(!h.default.isNumber(e)||!h.default.isNumber(e)))return this._throwErr(g.PARAMETER_TYPE,"bindContent"),!1;if(e<0||i<0)return this._throwErr(g.PARAMETER_RANGE,"bindContent"),!1;var n=this.viewer.bindContent(t,e,i);return this.uiEventControl&&this.uiEventControl.styleChange(),n},t.prototype.unbindContent=function(t){var e=this.viewer.unbindContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},t.prototype.updateUISettings=function(t){if(!t||!h.default.isObject(t))return this._throwErr(g.PARAMETER_TYPE,"updateUISettings"),!1;var e=h.default.id("WebViewer"+this.postfix),i=e&&e.parentNode&&e.parentNode.id||this.containerId,n=h.default.deepClone(this.viewer.defaultUiConfig);return h.default.mergeJSON(t,n),i&&h.default.id(i)&&e?(this.viewer.unbindAllMainContent(!0),e&&this.unbindViewer(),this.viewer.initUI(i,n),this.viewer.bindAllMainContent(),this.graphic.bindCanvasContainer("viewPort"+this.postfix),this.bindContent(),this.uiEventControl?this.uiEventControl.uiEventInit():this.uiEventControl=new u.UiEventControl(this.viewer,this.publishSubscribe),this._onUiRefresh(),this._ok(),this.emit("_onAddLog",h.default.formatLog("updateUISettings",!0)),!0):(this.viewer.uiConfig=n,this._ok(),!0)},t.prototype.refreshUi=function(){this.dataHandler.showCurrentTab()},t.prototype.unbindViewer=function(){var t=h.default.id("WebViewer"+this.postfix);if(t){var e=t.parentNode;return this.graphic.unbindCanvasContainer(),this.uiEventControl&&this.uiEventControl.unbindEvents(),this.unbindContent(!0),e&&e.removeChild(t),!0}return this._throwErr(g.ELEMENT_NOT_EXIST,"unbindViewer"),!1},t.prototype.setButtonClass=function(t,e){return h.default.isString(t)&&h.default.isString(e)?this.viewer.changeButtonClass(t,e):(this._throwErr(g.PARAMETER_TYPE,"setButtonClass"),!1)},t.prototype.switchToTreeTab=function(){return this.viewer.switchToTreeTab()?(this._ok(),!0):(this._throwErr(g.ELEMENT_NOT_EXIST,"switchToTreeTab"),!1)},t.prototype.switchToTagTab=function(){return this.viewer.switchToTagTab()?(this._ok(),!0):(this._throwErr(g.ELEMENT_NOT_EXIST,"switchToTagTab"),!1)},t.prototype.switchThumbnailDirection=function(t,e){return h.default.isString(t)&&(void 0===e||h.default.isNumber(e))?"row"!==t&&"column"!==t?(this._throwErr(g.PARAMETER_RANGE,"switchThumbnailDirection"),!1):!!(this.uiEventControl&&this.uiEventControl.switchThumbnailDirection(t,e))&&(this._ok(),!0):(this._throwErr(g.PARAMETER_TYPE,"switchThumbnailDirection"),!1)},t.prototype.bindCustomElement=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=!1);var n=this.viewer.bindMainContent(t,e,i);return this.uiEventControl&&this.uiEventControl.styleChange(),n},t.prototype.unbindCustomElement=function(t){var e=this.viewer.unbindMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},t.prototype.toggleCustomElement=function(t){var e=this.viewer.toggleMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},t.prototype.showCustomElement=function(t){var e=this.viewer.toggleMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},t.prototype.hideCustomElement=function(t){var e=this.viewer.hideMainContent(t);return this.uiEventControl&&this.uiEventControl.styleChange(),e},t.prototype.setOuterScroll=function(t,e){return h.default.isNumber(t)&&h.default.isNumber(e)?!!this.uiEventControl&&this.uiEventControl.setOuterScroll(t,e):(this._throwErr(g.PARAMETER_TYPE),!1)},t.prototype.updateVideoContainer=function(t){return h.default.isString(t)?this.uiEventControl?this.uiEventControl.updateVideoContainer(t):void 0:(this._throwErr(g.PARAMETER_TYPE,"updateVideoContainer"),!1)},t.prototype.setLogLevel=function(t){return!!p.default.isNumber(t)&&((1===t||0===t)&&(this._logLevel=t,!0))},t.prototype.setLogFunc=function(t){return this._logLevel?(t(this._logs.slice()),!0):(t([]),!1)},t.prototype._addLog=function(t){var e=p.default.formatTime("yyyy-MM-dd hh:mm:ss")+" DVS: "+t;this._logs.push(e)},t.prototype.clearLogs=function(){this._logs=[]},Object.defineProperty(t.prototype,"zoom",{get:function(){var t=this.graphic._zoom;return this.graphic.useRelativeZoom||(t*=this.graphic.originZoomX),t},set:function(t){h.default.isNumber(t)&&t>0?this.graphic.setZoom(t):this._throwErr(g.PARAMETER_TYPE,"zoom")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minZoom",{get:function(){return this.graphic.getMinZoom()},set:function(t){h.default.isNumber(t)&&t>0?this.graphic.setMinZoom(t):this._throwErr(g.PARAMETER_TYPE,"minZoom")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxZoom",{get:function(){return this.graphic.getMaxZoom()},set:function(t){h.default.isNumber(t)&&t>0?this.graphic.setMaxZoom(t):this._throwErr(g.PARAMETER_TYPE,"maxZoom")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showHeader",{get:function(){return this.viewer.showHeader},set:function(t){h.default.isBoolean(t)?(this.viewer.setShowHeader(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(g.PARAMETER_TYPE,"showHeader")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headerColor",{get:function(){return this.viewer.headerColor},set:function(t){h.default.isColor(t)?this.viewer.setHeaderColor(t):this._throwErr(g.PARAMETER_TYPE,"headerColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showTopMenu",{get:function(){return this.viewer.showTopMenu},set:function(t){h.default.isBoolean(t)?(this.viewer.setShowTopMenu(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(g.PARAMETER_TYPE,"showTopMenu")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topMenuColor",{get:function(){return this.viewer.topMenuColor},set:function(t){h.default.isColor(t)?this.viewer.setTopMenuColor(t):this._throwErr(g.PARAMETER_TYPE,"headerColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSideBar",{get:function(){return this.viewer.showSideBar},set:function(t){h.default.isBoolean(t)?(this.viewer.setShowSideBar(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(g.PARAMETER_TYPE,"showSideBar")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showThumbnail",{get:function(){return this.viewer.showThumbnail},set:function(t){h.default.isBoolean(t)?(this.viewer.setShowThumbnail(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(g.PARAMETER_TYPE,"showThumbnail")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showVideoContainer",{get:function(){return this.viewer.showVideoContainer},set:function(t){h.default.isBoolean(t)?(this.viewer.setshowVideoContainer(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(g.PARAMETER_TYPE,"showVideoContainer")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showAside",{get:function(){return this.viewer.showAside},set:function(t){h.default.isBoolean(t)?(this.viewer.setShowAside(t),this.uiEventControl&&this.uiEventControl.styleChange(),this._ok()):this._throwErr(g.PARAMETER_TYPE,"showAside")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showMain",{get:function(){return this.viewer.showMain},set:function(t){h.default.isBoolean(t)?(this.viewer.setShowMain(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(g.PARAMETER_TYPE,"showMain")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showFooter",{get:function(){return this.viewer.showFooter},set:function(t){h.default.isBoolean(t)?(this.viewer.setShowFooter(t),this.uiEventControl&&this.uiEventControl.styleChange()):this._throwErr(g.PARAMETER_TYPE,"showFooter")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerColor",{get:function(){return this.viewer.footerColor},set:function(t){h.default.isColor(t)?this.viewer.setFooterColor(t):this._throwErr(g.PARAMETER_TYPE,"headerColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showThumbnailControl",{get:function(){return this.viewer.showThumbnailControl},set:function(t){h.default.isBoolean(t)?this.viewer.setShowThumbnailControl(t):this._throwErr(g.PARAMETER_TYPE,"showThumbnailControl")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"themeColor",{get:function(){return this.viewer.themeColor},set:function(t){h.default.isString(t)?this.viewer.setThemeColor(t):this._throwErr(g.PARAMETER_TYPE,"themeColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursorOverThumbnailsView",{get:function(){return this.viewer.mouseShape},set:function(t){h.default.isString(t)?this.viewer.changeMouseShape(t):this._throwErr(g.PARAMETER_TYPE,"cursorOverThumbnailsView")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvasMouseShape",{get:function(){return this.graphic.mouseShape},set:function(t){h.default.isString(t)?this.graphic.changeMouseShape(t):this._throwErr(g.PARAMETER_TYPE,"mouseShape")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fitType",{get:function(){return this.graphic.fitType},set:function(t){h.default.isString(t)?(this.graphic.setFitType(t),this.graphic.resetScroller4FitType(),this.render()):this._throwErr(g.PARAMETER_TYPE,"fitType")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvasBackground",{get:function(){return this.graphic.backgroundColor},set:function(t){h.default.isColor(t)?this.graphic.setCanvasBackgroundColor(t):this._throwErr(g.COLOR_INVALID,"canvasBackground")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bOnlyShowThumbnailsView",{get:function(){return this.viewer.fullThumbnail},set:function(t){h.default.isBoolean(t)?(this.viewer.setFullThumbnail(t),this._onCanvasResize()):this._throwErr(g.PARAMETER_TYPE,"bOnlyShowThumbnailsView ")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbnailBackground",{get:function(){return this.viewer.thumbnailBackground},set:function(t){h.default.isColor(t)?this.viewer.setThumbnailBackground(t):this._throwErr(g.COLOR_INVALID,"thumbnailBackground")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbnailBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.thumbnailBorderColor},set:function(t){h.default.isColor(t)?this.viewer.setThumbnailBorderColor(t):this._throwErr(g.COLOR_INVALID,"thumbnailBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedImageBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.selectedBorderColor},set:function(t){h.default.isColor(t)?this.viewer.setSelectedImageBorderColor(t):this._throwErr(g.COLOR_INVALID,"selectedImageBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedImageBackground",{get:function(){return this.viewer.uiConfig.thumbnail.selectedBackgroundColor},set:function(t){h.default.isColor(t)?this.viewer.setSelectedBackgroundColor(t):this._throwErr(g.COLOR_INVALID,"selectedImageBackground")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.imageBorderColor},set:function(t){h.default.isColor(t)?this.viewer.setImageBorderColor(t):this._throwErr(g.COLOR_INVALID,"imageBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageBackgroundColor",{get:function(){return this.viewer.uiConfig.thumbnail.imageBackgroundColor},set:function(t){h.default.isColor(t)?this.viewer.setImageBackgroundColor(t):this._throwErr(g.COLOR_INVALID,"imageBackgroundColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hoverBorderColor",{get:function(){return this.viewer.uiConfig.thumbnail.hoverBorderColor},set:function(t){h.default.isColor(t)?this.viewer.setHoverBorderColor(t):this._throwErr(g.COLOR_INVALID,"hoverBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hoverBackgroundColor",{get:function(){return this.viewer.uiConfig.thumbnail.hoverBackgroundColor},set:function(t){h.default.isColor(t)?this.viewer.setHoverBackgroundColor(t):this._throwErr(g.COLOR_INVALID,"hoverBackgroundColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"placeholderBackgroundColor",{get:function(){return this.viewer.uiConfig.thumbnail.placeholderBackgroundColor},set:function(t){h.default.isColor(t)?(this.viewer.setPlaceholderBackgroundColor(t),this._ok()):this._throwErr(g.COLOR_INVALID,"placeholderBackgroundColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewerBorderColor",{get:function(){return this.viewer.viewerBorderColor},set:function(t){h.default.isColor(t)?(this.viewer.setViewerBorderColor(t),this._ok()):this._throwErr(g.COLOR_INVALID,"viewerBorderColor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sidebarWidth",{get:function(){return this.viewer.sidebarWidth},set:function(t){h.default.isNumber(t)||h.default.isString(t)?(this.viewer.setSidebarWidth(t),this.uiEventControl&&this.uiEventControl.styleChange(),this._ok()):this._throwErr(g.PARAMETER_TYPE,"sidebarWidth")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbnailWidth",{get:function(){return this.viewer.thumbnailWidth},set:function(t){h.default.isNumber(t)||h.default.isString(t)?(this.viewer.setThumbnailWidth(t),this.uiEventControl&&this.uiEventControl.styleChange(),this._ok()):this._throwErr(g.PARAMETER_TYPE,"thumbnailWidth")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.viewer.getViewerWidth()},set:function(t){this.viewer.setViewerWidth(t),this.uiEventControl&&this.uiEventControl.styleChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.viewer.getViewerHeight()},set:function(t){this.viewer.setViewerHeight(t),this.uiEventControl&&this.uiEventControl.styleChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uiConfig",{get:function(){return this.viewer.uiConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showLatestImage",{get:function(){return this.dataHandler.showLatestImage},set:function(t){h.default.isBoolean(t)?(this.dataHandler.showLatestImage=t,this._ok()):this._throwErr(g.PARAMETER_TYPE,"showLatestImage")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"operationMode",{get:function(){return this._operationMode},set:function(t){h.default.isNumber(t)?-1===[0,1,2].indexOf(t)?this._throwErr(g.PARAMETER_RANGE,"operationMode"):(this._operationMode=t,this.graphic.onSetOperationMode(t),this.emit("_onSetOperationMode",t),this._ok()):this._throwErr(g.PARAMETER_TYPE,"operationMode")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keepZoom",{get:function(){return this.graphic.keepZoom},set:function(t){h.default.isBoolean(t)?(this.graphic.keepZoom=t,this._ok()):this._throwErr(g.PARAMETER_TYPE,"keepZoom")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ifAllowSlide",{get:function(){return this.graphic.ifAllowSlide},set:function(t){this.graphic.ifAllowSlide=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useOuterDrop",{get:function(){return this.uiEventControl&&!this.uiEventControl.useMyEvent},set:function(t){h.default.isBoolean(t)?(this.uiEventControl&&(this.uiEventControl.useMyEvent=!t),this._ok()):this._throwErr(g.PARAMETER_TYPE,"useOuterDrop")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedImageCount",{get:function(){return this.dataHandler.selectedImagesCount},set:function(t){p.default.isNumber(t)&&(this.dataHandler.selectedImagesCount=t,this._ok())},enumerable:!0,configurable:!0}),t.prototype.setSelectImageIndex=function(t,e){return this.dataHandler.setSelectImageIndex(t,e)},t.prototype.testThumbnail=function(){this.bOnlyShowThumbnailsView=!0,this.showThumbnailControl=!1,this.setViewMode(1,1)},t.prototype.loadcallback=function(t){var e=t.customData.index;return console.log("loadCallback index:",t.customData.index),0===e?Promise.resolve("http://img1.imgtn.bdimg.com/it/u=1834278928,1334462001&fm=26&gp=0.jpg"):1===e?Promise.resolve("https://dss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1925436222,738093984&fm=111&gp=0.jpg"):Promise.resolve("https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3173584241,3533290860&fm=26&gp=0.jpg")},t}();e.DVS=m},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},r=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=s(i(0)),l=i(12),u=i(14),c=i(16),h=i(21),d=i(23),p=i(24),f=i(25),g=s(i(1)),m=i(27),_=g.default.errorMessages,v=a.default.uid,y=function(){function t(t,e,i,n){var o=this;this.showLatestImage=!0,this.useIndexedDB=!0,this.pageSpace=0,this._timer=null,this.selectedImagesCount=0,this._selectedImageArr=[],this.cancelArr=[],this.cancelRenderArr=[],this.requestArr=[],this.loadCallback=null,this._pubSub=e,this.emit("_onAddLog","Initialization dataHandler."),this.useTag=i,this.useTree=n,this._selectedIndexes=[],this.currentContents=[],this.scrollLeft=0,this.scrollTop=0,this.zoom=1,this._invoker=new l.Invoker,this._tag=new u.Tags(t.tagConfig),this._interlayer=new m.Interlayer,this._directoryTree=new c.DirectoryTree,this._thumbnail=new h.Thumbnail,this._dataStorage=new d.DataStorage,this._pager=new p.Pager({currentPage:0,totalPages:0}),this._initAll(),this._tab=new f.Tab,this._tab.selectedTabId=this._all.id,this.addTab({tabId:this._tab.selectedTabId,tabName:this._all.name,type:"file",imgLists:[]}),this.showTab(this._tab.selectedTabId),this.emit("_onAddLog","Initialization dataHandler completed."),this.on("sendDrawImageData",(function(t){o.emit("getDrawImageData",o.currentContents.slice())}))}return t.prototype._initAll=function(){this._all={id:a.default.uid(11),name:"All",imgLists:[]}},t.prototype.getAllContents=function(){return this._all.imgLists},t.prototype.openAll=function(){return n(this,void 0,void 0,(function(){var t,e;return o(this,(function(i){switch(i.label){case 0:return t=this._tab.checkTab(this._all.id),e=this._all.imgLists,-1===t&&this._tab.addTab({tabId:this._all.id,tabName:this._all.name,type:"file",imgLists:e.slice(0),selectedImageUids:e.slice(0,1)}),[4,this.showTab(this._all.id)];case 1:return i.sent(),this._ok(),[2,this._all.name]}}))}))},t.prototype._clearSelectedImage=function(){this._selectedImageArr=[],this.selectedImagesCount=1},t.prototype.setSelectImageIndex=function(t,e){if(!a.default.isNumber(t)||!a.default.isNumber(e))return this._throwError(_.PARAMETER_TYPE),!1;if(t>=this.selectedImagesCount||t<0||e<0||e+1>this._thumbnail.counts)return this._throwError(_.PARAMETER_RANGE),!1;if(this._selectedImageArr.filter((function(t){return t===e})).length>0)return this._throwError(_.IMG_HAVE_EXIST),!1;for(var i=0;i<t;i++)if(void 0===this._selectedImageArr[i])return this._throwError(_.EMPTY_IN_ARRAY),!1;this._selectedImageArr[t]=e;var n=this.getCurrentTab();if(!n)return!1;var o=this._getUidsByIndexes(this._selectedImageArr);n.setSelectedImageUids(o),this._selectedIndexes=o,this._pager.setPageData({currentPage:e});var r=this._pager.getPageData();return this.emit("pagerRefresh",r),this.emit("_onPagerRefresh",r),this.emit("imageSelected",this._selectedImageArr),this.emit("render"),this._ok(),!0},t.prototype.getCustomDataByIndex=function(t){if(!a.default.isNumber(t))return this._throwError(_.PARAMETER_TYPE),{};if(t<0||t>=this.getCurrentImageCounts())return this._throwError(_.PARAMETER_RANGE),{};var e=this.getUidByIndex(t);if(e){var i=this._getInterlayerData(e);return this._ok(),i.customData}},t.prototype.cancel=function(){var t=this;this.cancelArr.forEach((function(e,i){e.cancel(),delete t.cancelArr[i]}))},t.prototype.cancelRender=function(){var t=this;this.cancelArr.forEach((function(e,i){e.cancel(),delete t.cancelRenderArr[i]}))},t.prototype.makeCancel=function(t){var e=!1;return{promise:new Promise((function(i,n){t.then((function(t){return e?n({isCanceled:!0}):i(t)})),t.catch((function(t){return n(e?{isCanceled:!0}:t)}))})),cancel:function(){e=!0}}},t.prototype.setLoadCallback=function(t){this.loadCallback=t},t.prototype.getMetaDataByIndex=function(t){var e=this.getUidByIndex(t);if(e){var i=this._dataStorage.getDataSync(e);if(i&&i.metaData)return i.metaData}return{}},t.prototype.setMetaDataByIndex=function(t,e){var i=this,n=this.getUidByIndex(t);if(n){var o=this._dataStorage.getDataSync(n);return o&&o.metaData&&(o.metaData=e,this._dataStorage.updateDataSync(n,o)),this._dataStorage.getData(n).then((function(t){t&&t.metaData&&(t.metaData=e,i._dataStorage.updateData(n,t))})).catch((function(t){console.log("setMetaData error.")})),!0}return!1},t.prototype.appendImageSync=function(t,e){var i=this;if(!this._checkString(t)||!this._checkArray(e))return[];var n=this.findChild(this.getCurrentNode(),t),o=null;n?o=n.treeId:(o=this._directoryTree.addNewNode(t,"file",[]),n=this.findChild(this.getCurrentNode(),t));var r=this._loadImageSync(t,e,o);r.forEach((function(t){n.children.push(t)}));var s=!1;return e.forEach((function(t){t.tags&&t.tags.length>0&&(s=!0)})),s&&this.onTagChange(),this.onDirectoryChange(),clearTimeout(this._timer),this._timer=setTimeout((function(){i.showTab(i._tab.selectedTabId).then((function(t){if(i.showLatestImage){var e=i.getIndexByUid(r.slice(0).pop());i.emit("_onThumbnailScroll",e)}}))}),0),this.emit("_onAddLog",a.default.formatLog("appendImage",!0)),this._ok(),r},t.prototype.appendImage=function(t,e){return n(this,void 0,void 0,(function(){var i,n,r,s,l=this;return o(this,(function(o){switch(o.label){case 0:return this._checkString(t)&&this._checkArray(e)?(i=this.findChild(this.getCurrentNode(),t),n=null,i?n=i.treeId:(n=this._directoryTree.addNewNode(t,"file",[]),i=this.findChild(this.getCurrentNode(),t)),[4,this._loadImage(t,e,n)]):(this.emit("_onAddLog",a.default.formatLog("appendImage",!1,"Parameter error.")),[2,Promise.reject("parameter error.")]);case 1:return(r=o.sent()).forEach((function(t){i.children.push(t)})),s=!1,e.forEach((function(t){t.tags&&t.tags.length>0&&(s=!0)})),s&&this.onTagChange(),this.onDirectoryChange(),clearTimeout(this._timer),this._timer=setTimeout((function(){l.showTab(l._tab.selectedTabId).then((function(t){if(l.showLatestImage){var e=l.getIndexByUid(r.slice(0).pop());l.emit("_onThumbnailScroll",e)}}))}),0),this.emit("_onAddLog",a.default.formatLog("appendImage",!0)),this._ok(),[2,r]}}))}))},t.prototype.insertImageSync=function(t,e,i){var n=this;if(!this._checkString(t)||!this._checkArray(e))return this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("insertImage",!1,"Parameter error.")),Promise.reject(_.PARAMETER_TYPE);var o=this.findChild(this.getCurrentNode(),t);if(!o)return this._throwError(_.FILE_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("insertImage",!1,"File dose not exist.")),Promise.reject(_.FILE_NOT_EXIST);var r=o.children.length;if(void 0!==i&&!a.default.isNumber(i)||i<0||i>r-1)return this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("insertImage",!1,"Parameter error.")),Promise.reject(_.PARAMETER_TYPE);if(void 0===i)return this.appendImageSync(t,e);var s;s=o.treeId;var l=this._loadImageSync(t,e,s,i);o.children;return l.forEach((function(t){o.children.splice(i++,0,t)})),this.onTagChange(),this.onDirectoryChange(),clearTimeout(this._timer),this._timer=setTimeout((function(){n.showTab(n._tab.selectedTabId).then((function(t){if(n.showLatestImage){var e=n.getIndexByUid(l.slice(0).pop());n.emit("_onThumbnailScroll",e)}}))}),0),this.emit("_onAddLog",a.default.formatLog("insertImage",!0)),this._ok(),l},t.prototype.insertImage=function(t,e,i){return n(this,void 0,void 0,(function(){var n,r,s,l,u=this;return o(this,(function(o){switch(o.label){case 0:return this._checkString(t)&&this._checkArray(e)?(n=this.findChild(this.getCurrentNode(),t))?(r=n.children.length,void 0!==i&&!a.default.isNumber(i)||i<0||i>r-1?(this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("insertImage",!1,"Parameter error.")),[2,Promise.reject(_.PARAMETER_TYPE)]):void 0!==i?[3,2]:[4,this.appendImage(t,e)]):(this._throwError(_.FILE_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("insertImage",!1,"File dose not exist.")),[2,Promise.reject(_.FILE_NOT_EXIST)]):(this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("insertImage",!1,"Parameter error.")),[2,Promise.reject(_.PARAMETER_TYPE)]);case 1:return[2,o.sent()];case 2:return null,s=n.treeId,[4,this._loadImage(t,e,s,i)];case 3:return l=o.sent(),n.children,l.forEach((function(t){n.children.splice(i++,0,t)})),this.onTagChange(),this.onDirectoryChange(),clearTimeout(this._timer),this._timer=setTimeout((function(){u.showTab(u._tab.selectedTabId).then((function(t){if(u.showLatestImage){var e=u.getIndexByUid(l.slice(0).pop());u.emit("_onThumbnailScroll",e)}}))}),0),this.emit("_onAddLog",a.default.formatLog("insertImage",!0)),this._ok(),[2,l]}}))}))},t.prototype._loadImage=function(t,e,i,r){return n(this,void 0,void 0,(function(){var t,n,s,a,l,u,c,h,d,p,f,g,m;return o(this,(function(o){switch(o.label){case 0:this.emit("beforeLoad",e),t=[],n=e.length,s=this.getCurrentTab(),a=0,o.label=1;case 1:return a<n?((l=e[a]).tags||(l.tags=[]),this._tag.defaultTagName&&-1===l.tags.indexOf(this._tag.defaultTagName)&&l.tags.push(this._tag.defaultTagName),u=this._formatData(l),[4,this.addData(u.uid,u.image).then((function(t){})).catch((function(t){}))]):[3,4];case 2:for(o.sent(),t.push(u.uid),c={uid:u.uid,minData:null,originalData:null,customData:null,tags:l.tags.slice(0),dataType:1,active:!1},this._addInterlayerData(u.uid,c),this._tab.selectedTabId&&(h=this._tab.selectedTabId,(d=this._tag.getTag(this.getDefaultTag()))||(d={tagId:null}),h!==this._all.id&&h!==i&&h!==d.tagId||null!==s&&(void 0!==r?s.insertImage(r+a,u.uid):s.addImg(u.uid))),void 0!==r?this._all.imgLists.splice(r,0,u.uid):this._all.imgLists.push(u.uid),p=l.tags,f=0;f<p.length;f++)this._tag.addTag(p[f]),(g=this._getTag(p[f]))&&g.imgLists.push(u.uid);o.label=3;case 3:return a++,[3,1];case 4:return this.showLatestImage?(s.setSelectedImageUids([t.slice(0).pop()]),this._selectedIndexes=[t.slice(0).pop()],m=this.getIndexByUid(t.slice(0).pop()),this.emit("_onThumbnailScroll",m)):s.setSelectedImageUids(s.selectedImageUids.length?s.selectedImageUids:[this.getUidByIndex(0)]),this.emit("afterLoad",t),[2,t]}}))}))},t.prototype._checkOriginalType=function(t){var e=Object.prototype.toString.call(t);return"[object Blob]"===e?1:"[object Object]"===e?2:"[object String]"===e?3:/data:image\/\w+;base64/.test(t)?4:/\[object ArrayBuffer\]|\[object \w+Array\]/.test(e)?5:0},t.prototype._loadImageSync=function(t,e,i,n){this.emit("beforeLoad",e);for(var o=[],r=e.length,s=this.getCurrentTab(),a=0;a<r;a++){var l=e[a];l.tags||(l.tags=[]);var u=1;if(!l.originalData&&l.customData.src){u=2;var c=l.customData.src;l.customData.src=null,this._dataStorage.addData(l.customData.srcId.toString(),c)}if(this._tag.defaultTagName)-1===l.tags.indexOf(this._tag.defaultTagName)&&l.tags.push(this._tag.defaultTagName);var h=this._formatData(l);this._dataStorage.addDataSync(h.uid,h.image),this._dataStorage.addData(h.uid,h.image),o.push(h.uid);var d={uid:h.uid,minData:null,originalData:null,customData:l.customData||{},tags:l.tags.slice(0),dataType:u,active:!1};if(this._addInterlayerData(h.uid,d),this._tab.selectedTabId){var p=this._tab.selectedTabId,f=this._tag.getTag(this.getDefaultTag());f||(f={tagId:null}),p!==this._all.id&&p!==i&&p!==f.tagId||null!==s&&(void 0!==n?s.insertImage(n+a,h.uid):s.addImg(h.uid))}void 0!==n?this._all.imgLists.splice(n,0,h.uid):this._all.imgLists.push(h.uid);for(var g=l.tags,m=0;m<g.length;m++){this._tag.addTag(g[m]);var _=this._getTag(g[m]);_&&_.imgLists.push(h.uid)}}if(this.showLatestImage){s.setSelectedImageUids([o.slice(0).pop()]),this._selectedIndexes=[o.slice(0).pop()];var v=this.getIndexByUid(o.slice(0).pop());this.emit("_onThumbnailScroll",v)}else s.setSelectedImageUids(s.selectedImageUids.length?s.selectedImageUids:[this.getUidByIndex(0)]);return this.emit("afterLoad",o),o},t.prototype._convertImageData=function(t,e){t.customData&&(e.customData=t.customData),t.metaData&&(e.metaData=t.metaData),t.tags&&(e.tags=a.default.unique(e.tags.concat(t.tags)));var i=this._createUrl(t.originalData);return e.originalData=i,t.minData?e.minData=this._createUrl(t.minData):e.minData=i,e},t.prototype._convertImageDataSync=function(t,e){var i=this.loadCallback(t);i.customData&&(e.customData=i.customData),i.tags&&(e.tags=a.default.unique(e.tags.concat(i.tags)));var n=this._createUrl(i.originalData);return e.originalData=n,i.minData?e.minData=this._createUrl(i.minData):e.minData=n,e},t.prototype.loadImage=function(t){return n(this,void 0,void 0,(function(){return o(this,(function(e){return this._typeIdentify(t.fileType),[2,this.appendImage(t.name,t.contents)]}))}))},t.prototype._setCurrentcontents=function(t,e){this.scrollLeft=t.scrollLeft,this.scrollTop=t.scrollTop,this.zoom=t.zoom,this.currentContents=e,this.emit("getDrawImageData",this.currentContents.slice())},t.prototype.getCurrentIndex=function(){var t=this.getCurrentTab();return t?t.getCurrentIndex():null},t.prototype.setCurrentIndex=function(t){return!!this._checkIndex(t)&&(this._clearSelectedImage(),this.setSelectedIndexes([t]),this._ok(),!0)},t.prototype.save=function(){},t.prototype.removeSync=function(t){var e=this;if(!this._checkArray(t))return this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),!1;for(var i=this.getCurrentTab(),n=t.length,o=[],r=0;r<n;r++){if(!a.default.isNumber(t[r]))return this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),!1;if(t[r]<0||t[r]>=this.getCurrentImageCounts())return this._throwError(_.PARAMETER_RANGE),this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),!1;var s=this.getUidByIndex(t[r]);if(!s)return this._throwError(_.FILE_NOT_EXIST),!1;o.push(s)}if(i){for(var l=0;l<n;l++){if(i.getCurrentUid()===o[l]){var u=i.imgLists.indexOf(o[l]),c=i.imgLists.length;u===c-1?c-2<0?i.setSelectedImageUids([]):i.setSelectedImageUids([i.imgLists[c-2]]):i.setSelectedImageUids([i.imgLists[u+1]])}i.removeImg(o[l]),this._removeSync(o[l],i)}clearTimeout(this._timer),this._timer=setTimeout((function(){e.showTab(e._tab.selectedTabId).then((function(i){0===e.getCurrentImageCounts()&&e.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),e.emit("getRemoveIndexes",t)}))}),0)}return this.emit("_onAddLog",a.default.formatLog("remove",!0)),this._ok(),o},t.prototype._removeSync=function(t,e){return n(this,void 0,void 0,(function(){var e,i,n;return o(this,(function(o){return this.removeImageTag(t),e=this._getInterlayerData(t),this._revokeUrl(e.originalData),e.originalData!==e.minData&&this._revokeUrl(e.minData),this._removeInterlayerData(t),-1!==(i=this._all.imgLists.indexOf(t))&&this._all.imgLists.splice(i,1),n=null,(n=this._findImageByUid(t,this._directoryTree.rootNode))?(n.removeImg(t),this.removeData(t),[2,t]):[2,[]]}))}))},t.prototype.remove=function(t){return n(this,void 0,void 0,(function(){var e,i,n,r,s,l,u,c;return o(this,(function(o){switch(o.label){case 0:if(!this._checkArray(t))return this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),[2,Promise.reject(_.PARAMETER_TYPE)];for(e=this.getCurrentTab(),i=t.length,n=[],r=0;r<i;r++){if(!a.default.isNumber(t[r]))return this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),[2,Promise.reject(_.PARAMETER_TYPE)];if(t[r]<0||t[r]>=this.getCurrentImageCounts())return this._throwError(_.PARAMETER_RANGE),this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),[2,Promise.reject(_.PARAMETER_RANGE)];if(!(s=this.getUidByIndex(t[r])))return this._throwError(_.FILE_NOT_EXIST),[2,Promise.reject(_.FILE_NOT_EXIST)];n.push(s)}if(!e)return[3,2];for(l=0;l<i;l++)e.getCurrentUid()===n[l]&&(u=e.imgLists.indexOf(n[l]),c=e.imgLists.length,u===c-1?c-2<0?e.setSelectedImageUids([]):e.setSelectedImageUids([e.imgLists[c-2]]):e.setSelectedImageUids([e.imgLists[u+1]])),e.removeImg(n[l]),this._remove(n[l],e);return[4,this.showTab(e.tabId)];case 1:o.sent(),o.label=2;case 2:return this.emit("_onAddLog",a.default.formatLog("remove",!0)),0===this.getCurrentImageCounts()&&this.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),this.emit("getRemoveIndexes",t),this._ok(),[2,n]}}))}))},t.prototype._remove=function(t,e){return n(this,void 0,void 0,(function(){var e,i,n;return o(this,(function(o){switch(o.label){case 0:return this.removeImageTag(t),e=this._getInterlayerData(t),this._revokeUrl(e.originalData),e.originalData!==e.minData&&this._revokeUrl(e.minData),this._removeInterlayerData(t),-1!==(i=this._all.imgLists.indexOf(t))&&this._all.imgLists.splice(i,1),n=null,(n=this._findImageByUid(t,this._directoryTree.rootNode))?(n.removeImg(t),[4,this.removeData(t)]):[2,Promise.reject(_.FILE_NOT_EXIST)];case 1:return o.sent(),[2,t]}}))}))},t.prototype._removeImageFromCurrentByUid=function(t){var e=this.getIndexByUid(t);if(null!==e){var i=this.currentContents.length;0===i||e>i-1||this.currentContents.splice(e,1)}},t.prototype._findImageByUid=function(t,e){for(var i=e.children,n=i.length,o=0;o<n;o++)if(i[o].children){var r=this._findImageByUid(t,i[o]);if(r)return r}else if(i[o]===t)return e},t.prototype.removeAll=function(){return n(this,void 0,void 0,(function(){var t,e,i,n,r=this;return o(this,(function(o){switch(o.label){case 0:if(this.currentContents=[],!(t=this.getTab(this._tab.selectedTabId)))return this._throwError(_.FILE_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("removeAll",!1,"File dose not exist.")),[2,Promise.reject(_.FILE_NOT_EXIST)];e=t.imgLists.slice(),i=e.length,n=0,o.label=1;case 1:return n<i?[4,this._remove(e[n],t)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return t.emptyTab(),clearTimeout(this._timer),this._timer=setTimeout((function(){r.showTab(r._tab.selectedTabId),r.emit("getRemoveIndexes",[])}),0),this.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),this._ok(),[2,e]}}))}))},t.prototype.removeAllSync=function(){var t=this;this.currentContents=[];var e=this.getTab(this._tab.selectedTabId);if(!e)return this._throwError(_.FILE_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("removeAll",!1,"File dose not exist.")),!1;for(var i=e.imgLists.slice(),n=i.length,o=0;o<n;o++)this._removeSync(i[o],e);return e.emptyTab(),clearTimeout(this._timer),this._timer=setTimeout((function(){t.showTab(t._tab.selectedTabId).then((function(e){t.emit("getRemoveIndexes",[])}))}),0),this.emit("_onCanvasZoom",{x:0,y:0,width:0,height:0}),this.emit("_onAddLog",a.default.formatLog("remove",!1,"Parameter error.")),this._ok(),i},t.prototype.print=function(){alert("待实现...")},t.prototype._formatData=function(t){return{uid:v(11),image:t}},t.prototype._typeIdentify=function(t){return/(jpg|png|webp|jpeg)$/.test(t)?"single":/(pdf|tiff)$/.test(t)?"multiple":void 0},t.prototype.addData=function(t,e){return n(this,void 0,void 0,(function(){var i=this;return o(this,(function(n){switch(n.label){case 0:return this._checkString(t)&&a.default.isObject(e)?[4,this._dataStorage.addData(t,e).then((function(t){return i._ok(),t})).catch((function(t){return i._throwError(_.IMG_STORAGE_FAILED),Promise.reject(_.IMG_STORAGE_FAILED)}))]:(this._throwError(_.PARAMETER_TYPE),[2,Promise.reject(_.PARAMETER_TYPE)]);case 1:return[2,n.sent()]}}))}))},t.prototype.getData=function(t){return n(this,void 0,void 0,(function(){var e=this;return o(this,(function(i){switch(i.label){case 0:return this._checkString(t)?[4,this._dataStorage.getData(t).then((function(t){return e._ok(),Promise.resolve(t)})).catch((function(t){return e._throwError(_.IMG_NOT_EXIST),Promise.reject(_.IMG_NOT_EXIST)}))]:(this._throwError(_.PARAMETER_TYPE),[2,Promise.reject(_.PARAMETER_TYPE)]);case 1:return[2,i.sent()]}}))}))},t.prototype.getDataPro=function(t){return n(this,void 0,void 0,(function(){var e,i,n,r,s,a,l,u,c;return o(this,(function(o){switch(o.label){case 0:return this._checkString(t)?(e={},[4,this._dataStorage.getData(t)]):(this._throwError(_.PARAMETER_TYPE),[2,Promise.reject(_.PARAMETER_TYPE)]);case 1:return(i=o.sent()).originalData?[3,5]:[4,this._dataStorage.getData(i.customData.srcId)];case 2:return n=o.sent(),(r=i.customData).src=n,[4,this.getRealImageData(t,i)];case 3:return s=o.sent(),r.src=null,i.originalData=s,[4,this._dataStorage.updateData(t,i)];case 4:for(o.sent(),a=Object.keys(i),l=0,u=a;l<u.length;l++)c=u[l],e[c]=i[c];return e.originalData=s,[3,6];case 5:e=i,o.label=6;case 6:return[2,e]}}))}))},t.prototype.removeData=function(t){return n(this,void 0,void 0,(function(){var e=this;return o(this,(function(i){switch(i.label){case 0:return this._checkString(t)?[4,this._dataStorage.removeData(t).then((function(t){return e._ok(),t})).catch((function(t){return e._throwError(_.IMG_REMOVE_FAILED),Promise.reject(_.IMG_REMOVE_FAILED)}))]:(this._throwError(_.PARAMETER_TYPE),[2,Promise.reject(_.PARAMETER_TYPE)]);case 1:return[2,i.sent()]}}))}))},t.prototype.updateData=function(t,e){return n(this,void 0,void 0,(function(){var i=this;return o(this,(function(n){switch(n.label){case 0:return this._checkString(t)?[4,this._dataStorage.updateData(t,e).then((function(t){return i._ok(),t})).catch((function(t){return i._throwError(_.IMG_NOT_EXIST),Promise.reject(_.IMG_NOT_EXIST)}))]:(this._throwError(_.PARAMETER_TYPE),[2,Promise.reject(_.PARAMETER_TYPE)]);case 1:return[2,n.sent()]}}))}))},t.prototype.getCurrentNode=function(){return this._ok(),this._directoryTree.currentNode},t.prototype.onDirectoryChange=function(){var t=this.getCurrentNode();this.emit("directoryRefresh",t),this.emit("_onDirectoryRefresh",t);this._directoryTree.getSelectedNode()},t.prototype.addFile=function(t,e){if(!this._checkNameString(t)||e&&!this._checkArray(e))return this.emit("_onAddLog",a.default.formatLog("addFile",!1,_.PARAMETER_TYPE.message)),!1;this._directoryTree.addNewNode(t,"file",e);return this.onDirectoryChange(),this.emit("_onAddLog",a.default.formatLog("addFile",!0)),this._ok(),!0},t.prototype.addFolder=function(t,e){if(!this._checkNameString(t)||e&&!this._checkArray(e))return this.emit("_onAddLog",a.default.formatLog("addFolder",!1,_.PARAMETER_TYPE.message)),!1;this._directoryTree.addNewNode(t,"folder",e);return this.onDirectoryChange(),this.emit("_onAddLog",a.default.formatLog("addFolder",!0)),this._ok(),!0},t.prototype.getFileContents=function(t){if(!this._checkString(t))return[];var e=this._directoryTree.enterFile(t);return e?e.children.slice():[]},t.prototype.creatNewNode=function(t,e,i){var n=this._directoryTree.addNewNode(t,e,i);return this.onDirectoryChange(),n},t.prototype.openFile=function(t){return n(this,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return this._checkString(t)?(e=this._directoryTree.enterFile(t))?(this.addTab({tabId:e.treeId,tabName:e.name,type:"file",imgLists:e.children.slice(0),selectedImageUids:e.children.slice(0,1)}),[4,this.showTab(e.treeId)]):[3,2]:(this.emit("_onAddLog",a.default.formatLog("openFile",!1,_.PARAMETER_TYPE.message)),[2,!1]);case 1:return i.sent(),this.emit("_onThumbnailScrollTo",0),this.emit("fileSelected",e.name),this.emit("_onAddLog",a.default.formatLog("openTag",!0)),this._ok(),[2,e.name];case 2:return this._throwError(_.FILE_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("openFile",!1,_.FILE_NOT_EXIST.message)),[2,!1]}}))}))},t.prototype.openFolder=function(t){return this._checkString(t)?this._directoryTree.enterFolder(t)?(this.onDirectoryChange(),this._ok(),this.emit("_onAddLog",a.default.formatLog("openFolder",!0)),!0):(this._throwError(_.FOLDER_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("openFolder",!1,_.FOLDER_NOT_EXIST.message)),!1):(this.emit("_onAddLog",a.default.formatLog("openFolder",!1,_.PARAMETER_TYPE.message)),!1)},t.prototype.openFolderByPath=function(t){return!!this._checkString(t)&&(this._directoryTree.enterFolderByPath(t)?(this.onDirectoryChange(),this._ok(),!0):(this._throwError(_.PATH_ERROR),!1))},t.prototype.openFileByPath=function(t){return n(this,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return this._checkString(t)?(e=this._directoryTree.enterFileByPath(t))?(this.addTab({tabId:e.treeId,tabName:e.name,type:"file",imgLists:e.children.slice(0),selectedImageUids:e.children.slice(0,1)}),[4,this.showTab(e.treeId)]):[3,2]:[2,!1];case 1:return i.sent(),this.emit("fileSelected",e.name),this._ok(),[2,!0];case 2:return this._throwError(_.FILE_NOT_EXIST),[2,!1]}}))}))},t.prototype._enterFolder=function(t){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return"folder"!==t?[3,1]:(this.onDirectoryChange(),[3,3]);case 1:return this.addTab({tabId:t.treeId,tabName:t.name,type:"file",imgLists:t.children.slice(0),selectedImageUids:t.children.slice(0,1)}),[4,this.showTab(t.treeId)];case 2:e.sent(),this.emit("fileSelected",t.name),e.label=3;case 3:return[2,!0]}}))}))},t.prototype.backToPrevious=function(){return this._directoryTree.backToPreviousNode()?(this.onDirectoryChange(),this._ok(),!0):(this._throwError(_.BACK_TO_TOP),!1)},t.prototype.removeFile=function(t){if(!this._checkString(t))return this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("removeFile",!1,_.PARAMETER_TYPE.message)),!1;var e=this._directoryTree.removeFile(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this.emit("_onAddLog",a.default.formatLog("removeFile",!0)),this._ok(),!0):(this._throwError(_.FILE_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("removeFile",!1,_.FILE_NOT_EXIST.message)),!1)},t.prototype.removeFileByPath=function(t){if(!this._checkString(name))return!1;var e=this._directoryTree.removeFileByPath(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this._ok(),!0):(this._throwError(_.FILE_NOT_EXIST),!1)},t.prototype.removeFolder=function(t){if(!this._checkString(t))return this._throwError(_.PARAMETER_TYPE),this.emit("_onAddLog",a.default.formatLog("removeFolder",!1,_.PARAMETER_TYPE.message)),!1;var e=this._directoryTree.removeFolder(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this.emit("_onAddLog",a.default.formatLog("removeFolder",!0)),this._ok(),!0):(this._throwError(_.FOLDER_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("removeFolder",!1,_.FOLDER_NOT_EXIST.message)),!1)},t.prototype.removeFolderByPath=function(t){if(!this._checkString(name))return!1;var e=this._directoryTree.removeFolderByPath(t);return e?(this._removeNodeContents(e),this.onDirectoryChange(),e.treeId===this._tab.selectedTabId&&this.showCurrentTab(),this._ok(),!0):(this._throwError(_.FILE_NOT_EXIST),!1)},t.prototype._removeNodeContents=function(t){var e=this,i=t.children;if(i){var n=i.length;if(0===n)return;for(var o=0;o<n;o++)this._removeNodeContents(i[o])}else{this._getInterlayerData(t).tags.forEach((function(i){e.removeImageTag(t,i)}))}},t.prototype.renameFile=function(t,e){return!(!this._checkString(t)||!this._checkString(e))&&(this._directoryTree.renameNode(t,e,"file")?(this.onDirectoryChange(),this._ok(),!0):(this._throwError(_.FILE_NOT_EXIST),!1))},t.prototype.renameFolder=function(t,e){return!(!this._checkString(t)||!this._checkString(e))&&(this._directoryTree.renameNode(t,e,"folder")?(this.onDirectoryChange(),this._ok(),!0):(this._throwError(_.FILE_NOT_EXIST),!1))},t.prototype.findChild=function(t,e){return this._directoryTree._findNode(t,e,"file")},t.prototype.nextPage=function(){return this._pager.nextPage()?(this._onpagechange(),this._ok(),!0):(this._throwError(_.PAGE_NOT_EXIST),!1)},t.prototype.previousPage=function(){return this._pager.prevPage()?(this._onpagechange(),this._ok(),!0):(this._throwError(_.PAGE_NOT_EXIST),!1)},t.prototype.firstPage=function(){return this._pager.homePage()?(this._onpagechange(),this._ok(),!0):(this._throwError(_.PAGE_NOT_EXIST),!1)},t.prototype.lastPage=function(){return this._pager.endPage()?(this._onpagechange(),this._ok(),!0):(this._throwError(_.PAGE_NOT_EXIST),!1)},t.prototype.goToPage=function(t){if(void 0!==t){if(!this._checkIndex(t))return!1;this._pager.goToPage(t)}return this._onpagechange(),this._ok(),!0},t.prototype._onpagechange=function(){var t=this._pager.getPageData(),e=this.getUidByIndex(t.currentPage),i=this.getCurrentTab();i&&(e?i.setSelectedImageUids([e]):i.setSelectedImageUids([]),this.emit("pagerRefresh",t),this.emit("_onPagerRefresh",t),this.emit("imageSelected",[t.currentPage]),this.emit("render"))},t.prototype.getThumbnailUids=function(){var t=this.getCurrentTab();return t?(this._ok(),t.imgLists.slice(0)):[]},t.prototype.selectAll=function(){for(var t=this.getThumbnailUids().length,e=[],i=0;i<t;i++)e.push(i);return this.setSelectedIndexes(e)},t.prototype.getUidByIndex=function(t){if(!this._checkIndex(t))return null;var e=this.getCurrentTab();return e?(this._ok(),e.imgLists[t]):null},t.prototype._getUidsByIndexes=function(t){for(var e=t.length,i=[],n=0;n<e;n++)i.push(this.getUidByIndex(t[n]));return i},t.prototype._getIndexesByUids=function(t){for(var e=t.length,i=[],n=0;n<e;n++)i.push(this.getIndexByUid(t[n]));return i},t.prototype.getIndexByUid=function(t){if(!this._checkString(t))return null;var e=[],i=this.getCurrentTab();if(!i)return this._throwError(_.IMG_NOT_EXIST),null;var n=(e=i.imgLists.slice(0)).length;if(0===n)return this._throwError(_.IMG_NOT_EXIST),null;for(var o=0;o<n;o++)if(e[o]===t)return this._ok(),o;return this._throwError(_.IMG_NOT_EXIST),null},t.prototype.updateImage=function(t,e,i){return n(this,void 0,void 0,(function(){var n,r,s,a=this;return o(this,(function(o){switch(o.label){case 0:return this._checkString(t)?[4,this.getData(t)]:[2,Promise.reject(_.PARAMETER_TYPE)];case 1:return n=o.sent(),r=this._getInterlayerData(t),i&&(this._revokeUrl(r.originalData),r.originalData!==r.minData&&this._revokeUrl(r.minData)),s={},Object.keys(n).forEach((function(t){if(void 0!==e[t]){if("customData"!==t){var i=a._createUrl(e[t]);r[t]=i}s[t]=e[t]}else s[t]=n[t]})),[4,this.updateData(t,s)];case 2:return o.sent(),[4,this.showTab(this._tab.selectedTabId)];case 3:return o.sent(),this._ok(),[2,t]}}))}))},t.prototype._combineData=function(t,e){for(var i=Object.keys(e),n=0;n<i.length;n++){var o=e[i[n]];if("originalData"!==i[n]&&"minData"!==i[n]||!o){if("metaData"===i[n])for(var r=Object.keys(o),s=0;s<r.length;s++)t.metaData[r[n]]=o[r[n]];else if("customData"===i[n])for(var a=Object.keys(o),l=0;l<a.length;l++)t.customData[a[n]]=o[a[n]]}else t[i[n]]=o}return t},t.prototype.updateImageSync=function(t,e,i){var n=this;if(void 0===i&&(i=!0),!this._checkString(t))return!1;var o=1;if(e.originalData)this.updateData(t,e),this._dataStorage.updateDataSync(t,e),this.emit("_onSendMiniImgSize");else{o=2;var r=e.customData.src;this._dataStorage.addData(e.customData.srcId.toString(),r),e.customData.src=null,this._dataStorage.updateData(t,e),this._dataStorage.updateDataSync(t,e),this.emit("_onSendMiniImgSize")}var s=this._getInterlayerData(t);return i&&(this._revokeUrl(s.originalData),s.originalData!==s.minData&&this._revokeUrl(s.minData)),s.active=!1,s.dataType=o,this._updateInterlayerData(t,s),this.emit("resetTrnasform"),clearTimeout(this._timer),this._timer=setTimeout((function(){n.showTab(n._tab.selectedTabId)}),0),this._ok(),!0},t.prototype.setSelectedIndexes=function(t){if(!a.default.isArray(t))return this._throwError(_.PARAMETER_TYPE),!1;for(var e=t.length,i=0;i<e;i++)if(!this._checkIndex(t[i]))return!1;var n=this.getCurrentTab();if(!n)return!1;this.getCurrentIndex();var o=n.getSelectedImageUids(),r=this._getUidsByIndexes(t);if(o.toString()===r.toString())return this._ok(),!0;n.setSelectedImageUids(r),this._clearSelectedImage(),this._selectedIndexes=r,this._pager.setPageData({currentPage:t[t.length-1],totalPages:this.getCurrentImageCounts()});var s=this._pager.getPageData();return this.emit("pagerRefresh",s),this.emit("_onPagerRefresh",s),this.emit("imageSelected",t),this.emit("render"),this._ok(),!0},t.prototype.getSelectedIndexes=function(){var t=this.getCurrentTab();return t?(this._ok(),this._getIndexesByUids(t.selectedImageUids)):null},t.prototype.getThumbnailContents=function(){return this._thumbnail.getThumbnailContents()},t.prototype.setThumbnailContents=function(t){return n(this,void 0,void 0,(function(){var e,i,n,r,s,a,l=this;return o(this,(function(o){for(this.clearThumbnail(),e=t.length,[],i=0;i<e;i++)n=t[i],r={uid:n.uid,data:n.minData,tags:n.tags},this.addThumbnailItem(r);return s=this.getThumbnailContents(),a={currentPage:this.getCurrentIndex()||0,totalPages:e},this._pager.setPageData(a),this.emit("thumbnailRefresh",s),this.emit("_onThumbnailRefresh",s),this.emit("pagerRefresh",a),this.emit("_onPagerRefresh",a),clearTimeout(this._timer),this._timer=setTimeout((function(){l.emit("render")}),0),[2,!0]}))}))},t.prototype.onThumbnailChange=function(){var t=this.getThumbnailContents();this.emit("thumbnailRefresh",t),this.emit("_onThumbnailRefresh",t),this._onpagechange()},t.prototype.addThumbnailItem=function(t){return this._thumbnail.addThumbnailItem(t)},t.prototype.clearThumbnail=function(){this._thumbnail.clearThumbnail()},t.prototype.removeThumbnailItem=function(t){this._thumbnail.removeThumbnailItem(t);var e=this.getThumbnailContents();return this.emit("thumbnailRefresh",e),this.emit("_onThumbnailRefresh",e),!0},t.prototype.removeThumbnailItemByUid=function(t){for(var e=this.getThumbnailContents(),i=0;i<e.length;i++)if(e[i].uid===t)return e.splice(i,1),this._thumbnail.counts--,this.emit("thumbnailRefresh",e),this.emit("_onThumbnailRefresh",e),!0;return!1},t.prototype.removeAllThumbnailItem=function(){this._thumbnail.contents=[],this._thumbnail.counts=0;var t=this.getThumbnailContents();return this.emit("thumbnailRefresh",t),this.emit("_onThumbnailRefresh",t),!0},t.prototype.thumbnailCopy=function(t){alert("Copy todo")},t.prototype._initClipboard=function(){},t.prototype.insertBefore=function(t,e){alert("待实现。。。")},t.prototype.insertAfter=function(t,e){alert("待实现。。。")},t.prototype.reorderThumbnail=function(t,e){if(!this._checkArray(t))return!1;for(var i=t.length,n=0,o=0;o<i;o++){if(!this._checkIndex(t[o]))return!1;t[o]===o&&n++}if(n!==i){var r=this.getCurrentTab(),s=null;if("file"===r.type)if(r.tabId===this._all.id)s=this._all.imgLists;else{var a=this._directoryTree.enterFile(r.tabName);s=a?a.children:[]}else s=this._tag.getCurrentTag().imgLists;for(var l=0;l<i;l++){t[l];if(t[l]!==l){this._thumbnail.contents=this._reorder(this._thumbnail.contents,t),this.currentContents=this._reorder(this.currentContents,t),r.imgLists=this._reorder(r.imgLists,t),s=this._reorder(s,t);var u=this._getUidsByIndexes(e);return r.setSelectedImageUids(u),void this.showCurrentTab()}}}},t.prototype._reorder=function(t,e){for(var i=t.length,n=[],o=0;o<i;o++)n[o]=t[e[o]];return n},t.prototype.moveImage=function(t,e){if(!this._checkIndex(t)||!this._checkIndex(e))return!1;var i=this.getCurrentTab();if(i){var n=null,o=(n="file"===i.type?i.tabId===this._all.id?this._all.imgLists:this.findChild(this.getCurrentNode(),i.tabName).children:this._tag.getCurrentTag().imgLists).splice(t,1);n.splice(e,0,o[0]);var r=i.imgLists,s=r.splice(t,1);r.splice(e,0,s[0]);var a=this.getUidByIndex(e);return i.setSelectedImageUids([a]),this.showCurrentTab(),this._ok(),!0}return!1},t.prototype.switchImage=function(t,e){if(!this._checkIndex(t)||!this._checkIndex(e))return!1;var i=this.getCurrentTab();if(i){var n=null;n="file"===i.type?i.tabId===this._all.id?this._all.imgLists:this.findChild(this.getCurrentNode(),i.tabName).children:this._tag.getCurrentTag().imgLists,this._switch(t,e,n);var o=this.getCurrentIndex();return o===t?this.setCurrentIndex(e):o===e&&this.setCurrentIndex(t),this._switch(t,e,i.imgLists),this.showCurrentTab(),this._ok(),!0}return!1},t.prototype._switch=function(t,e,i){if(!(i.length<2)){var n=i[t];i[t]=i[e],i[e]=n}},t.prototype.addTag=function(t,e,i){if(!this._checkNameString(t)||e&&!a.default.isColor(e))return this.emit("_onAddLog",a.default.formatLog("addTag",!1,"Parameter error.")),!1;var n=this._tag.addTag(t,e,i);if(-1===n)return this._throwError(_.TAG_HAVE_EXIST),!1;var o=this.getTagList();return this.emit("tagRefresh",o),this.emit("_onTagRefresh",o),this.emit("_onAddLog",a.default.formatLog("addTag",!0)),this._ok(),n},t.prototype._getTag=function(t){var e=this._tag.getTag(t);return e||(this._throwError(_.TAG_NOT_EXIST),!1)},t.prototype.removeTag=function(t){if(!this._checkString(t))return this.emit("_onAddLog",a.default.formatLog("removeTag",!1,"Parameter error.")),!1;var e=this._getTag(t);if(!e)return this._throwError(_.TAG_NOT_EXIST),!1;for(var i=e.imgLists.slice(0),n=i.length,o=0;o<n;o++)this.removeImageTag(i[o],t);if(e.tagId===this._tab.selectedTabId&&this.showCurrentTab(),!this._tag.removeTag(t))return this._throwError(_.TAG_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("removeTag",!1,"Tag dose not exist.")),!1;var r=this.getTagList();return this.emit("tagRefresh",r),this.emit("_onTagRefresh",r),this.emit("_onAddLog",a.default.formatLog("remove",!0)),this._ok(),!0},t.prototype.emptyTag=function(t){if(!this._checkString(t))return!1;var e=this._getTag(t);if(!e)return this._throwError(_.TAG_NOT_EXIST),!1;for(var i=e.imgLists.slice(0),n=i.length,o=0;o<n;o++)this.removeImageTag(i[o],t);var r=this.getTagList();return this.emit("tagRefresh",r),this.emit("_onTagRefresh",r),this._tab.selectedTabId===e.tagId&&this.showTab(e.tagId),this._ok(),!0},t.prototype.onTagChange=function(){var t=this.getTagList();this.emit("tagRefresh",t),this.emit("_onTagRefresh",t)},t.prototype.addImageTag=function(t,e){if(!this._checkString(t)||!this._checkString(e))return!1;var i=this._getTag(e);if(!i)return this._throwError(_.TAG_NOT_EXIST),!1;i.imgLists.push(t);var n=this._getInterlayerData(t);if(void 0===n)return this._throwError(_.IMG_NOT_EXIST),!1;var o=n.tags;return-1!==o.indexOf(e)?(this._throwError(_.TAG_HAVE_EXIST),!1):(o.push(e),this._ok(),!0)},t.prototype.removeImageTag=function(t,e){var i=this;if(!t||t&&!this._checkString(t)||e&&!this._checkString(e))return!1;var n=this._getInterlayerData(t);if(void 0===n)return this._throwError(_.IMG_NOT_EXIST),!1;var o=n.tags;if(e){var r=o.indexOf(e);if(-1===r)return this._throwError(_.TAG_NOT_EXIST),!1;if(o.splice(r,1),!this._removeImageTag(t,e))return!1}else o.forEach((function(e){if(!i._removeImageTag(t,e))return!1})),o.splice(0);return this._ok(),!0},t.prototype._removeImageTag=function(t,e){var i=this._getTag(e);if(!i)return this._throwError(_.TAG_NOT_EXIST),!1;if(!i.removeImg(t))return this._throwError(_.IMG_NOT_EXIST),!1;if(this._tab.selectedTabId===i.tagId){var n=this._tab.getTab(this._tab.selectedTabId);if(!n)return!1;var o=n.imgLists.indexOf(t);-1!==o&&n.imgLists.splice(o,1),this.removeThumbnailItemByUid(t),this._removeImageFromCurrentByUid(t)}return this._ok(),!0},t.prototype.getTagContents=function(t){if(t){if(!this._checkString(t))return!1}else t=this.getDefaultTag();var e=this._tag.filterByTag(t);return-1===e?(this._throwError(_.TAG_NOT_EXIST),!1):(this._ok(),e)},t.prototype.renameTag=function(t,e){if(!this._checkString(t)||!this._checkString(e))return this.emit("_onAddLog",a.default.formatLog("renameTag",!1,"Parameter error.")),!1;if(t===e)return!0;if(-1!==this.checkTag(e))return this.emit("_onAddLog",a.default.formatLog("renameTag",!1,_.TAG_HAVE_EXIST.message)),this._throwError(_.TAG_HAVE_EXIST),!1;var i=this._getTag(t);if(!i)return this.emit("_onAddLog",a.default.formatLog("renameTag",!1,_.TAG_NOT_EXIST.message)),this._throwError(_.TAG_NOT_EXIST),!1;for(var n=i.imgLists.slice(),o=n.length,r=0;r<o;r++){var s=this._getInterlayerData(n[r]).tags;if(void 0===s)return this._throwError(_.IMG_NOT_EXIST),!1;var l=s.indexOf(t);if(-1===l)return this._throwError(_.TAG_NOT_EXIST),!1;s.splice(l,1,e)}i.name=e;var u=this.getTagList();return this.emit("tagRefresh",u),this.emit("_onTagRefresh",u),this.emit("_onAddLog",a.default.formatLog("renameTag",!0)),this._ok(),!0},t.prototype.getCurrentTag=function(){var t=this._tag.getCurrentTag();return t?(this._ok(),t.name):(this._throwError(_.TAG_NOT_EXIST),!1)},t.prototype.setDefaultTag=function(t){return!!this._checkString(t)&&(""===t?(this._tag.defaultTagName=null,this._ok(),!0):-1===this.checkTag(t)?(this._throwError(_.TAG_NOT_EXIST),!1):(this._tag.defaultTagName=t,this._ok(),!0))},t.prototype.getDefaultTag=function(){return this._ok(),this._tag.defaultTagName},t.prototype.openTag=function(t){return n(this,void 0,void 0,(function(){var e,i,n;return o(this,(function(o){switch(o.label){case 0:return this._checkString(t)?(this.emit("tagSelected",t),(e=this._tag.getTag(t))?e.tagId!==this._tab.selectedTabId?[3,2]:[4,this.showTab(e.tagId)]:(this._throwError(_.TAG_NOT_EXIST),this.emit("_onAddLog",a.default.formatLog("openTag",!1,_.TAG_NOT_EXIST.message)),[2,Promise.reject(_.TAG_NOT_EXIST)])):(this.emit("_onAddLog",a.default.formatLog("openTag",!1,_.PARAMETER_TYPE.message)),[2,Promise.reject(_.PARAMETER_TYPE)]);case 1:return o.sent(),this._ok(),[2,e.imgLists];case 2:return this._tag.selectedTagId=e.tagId,i=this._tab.checkTab(e.tagId),n=e.imgLists,-1===i&&this._tab.addTab({tabId:e.tagId,tabName:t,type:"tag",imgLists:n.slice(0),selectedImageUids:n.slice(0,1)}),[4,this.showTab(e.tagId)];case 3:return o.sent(),this.emit("_onAddLog",a.default.formatLog("openTag",!0)),this._ok(),[2,e.imgLists]}}))}))},t.prototype.getTagList=function(){return this._tag.getTagList()},t.prototype.checkTag=function(t){return this._tag.checkTag(t)},t.prototype.on=function(t,e){this._pubSub.on(t,e)},t.prototype.emit=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];(e=this._pubSub).emit.apply(e,r([t],i))},t.prototype.off=function(t,e){this._pubSub.off(t,e)},t.prototype.onTabChange=function(){this.showTab(this._tab.selectedTabId)},t.prototype.addTab=function(t){return-1===this._tab.checkTab(t.tabId)&&this._tab.addTab(t)},t.prototype.removeTab=function(t){return this._tab.removeTab(t)},t.prototype.getTab=function(t){return this._tab.getTab(t)},t.prototype.showCurrentTab=function(){var t=this._tab.getTab(this._tab.selectedTabId);if(t){var e;return e=this._getImageUrlByUid(t.imgLists),this._setCurrentcontents(t,e),this.setThumbnailContents(e),this.emit("imageSelected",this.getSelectedIndexes()),!0}},t.prototype.showTab=function(t){return n(this,void 0,void 0,(function(){var e,i,n,r,s,a,l,u,c,h,d,p;return o(this,(function(o){switch(o.label){case 0:if(!(e=this._tab.getTab(t)))return[2,!1];this._tab.selectedTabId!==t&&(this._tab.selectedTabId=t,this.emit("_onCurTabChange",{name:e.tabName,tabId:t}),this.showLatestImage&&(i=this.getIndexByUid(e.imgLists.slice(0).pop()),this.emit("_onThumbnailScroll",i))),this.setCurrentIndex(this.getIndexByUid(e.selectedImageUids.slice(0).pop())),n=e.imgLists.slice(0),r=[],s=0,a=n,o.label=1;case 1:return s<a.length?(l=a[s],u=null,c=this._getInterlayerData(l),h=null,n.slice(),c.active?[3,10]:[4,this._dataStorage.getData(l)]):[3,12];case 2:return d=o.sent(),2!==c.dataType?[3,8]:d.originalData?[3,6]:[4,this._dataStorage.getData(d.customData&&d.customData.srcId)];case 3:return p=o.sent(),d.customData.src=p,[4,this.getRealImageData(l,d)];case 4:return h=o.sent(),d.customData.src=null,this._dataStorage.updateDataSync(l,d),d.originalData=h,[4,this.updateData(l,d)];case 5:return o.sent(),[3,7];case 6:h=d.originalData,o.label=7;case 7:return u={uid:l,minData:null,originalData:h,metaData:d.metaData,customData:d.customData,tags:d.tags},[3,9];case 8:u=d,o.label=9;case 9:this._convertImageData(u,c),c.active=!0,o.label=10;case 10:r.push(c),o.label=11;case 11:return s++,[3,1];case 12:return this._setCurrentcontents(e,r),this.setThumbnailContents(r),this.emit("imageSelected",this.getSelectedIndexes()),[2,!0]}}))}))},t.prototype.showTab1=function(t){return n(this,void 0,void 0,(function(){var e,i,n,r,s,a,l;return o(this,(function(o){switch(o.label){case 0:if(!(e=this._tab.getTab(t)))return[2,!1];if(this._tab.selectedTabId===t)return[3,4];this._tab.selectedTabId=t,this.emit("_onCurTabChange",{name:e.tabName,tabId:t}),this.showLatestImage&&(i=this.getIndexByUid(e.imgLists.slice(0).pop()),this.emit("_onThumbnailScroll",i)),this.setCurrentIndex(this.getIndexByUid(e.selectedImageUids.slice(0).pop())),n=e.imgLists.length,r=0,o.label=1;case 1:return r<n?[4,this.getData(e.imgLists[r])]:[3,4];case 2:s=o.sent(),a=this._getInterlayerData(e.imgLists[r]),this._convertImageData(s,a),o.label=3;case 3:return r++,[3,1];case 4:return null,l=this._getImageUrlByUid(e.imgLists),this._setCurrentcontents(e,l),this.setThumbnailContents(l),this.emit("imageSelected",this.getSelectedIndexes()),[2,!0]}}))}))},t.prototype.closeTab=function(t){var e=this,i=this._tab.getTab(t);if(-1===i)return!1;i.imgLists.forEach((function(t){var i=e._getInterlayerData(t);if(!i)return!1;var n=i.originalData,o=i.minData;e._revokeUrl(n),n!==o&&e._revokeUrl(o),i.originalData=null,i.minData=null})),this.removeTab(t),this.showCurrentTab()},t.prototype.closeCurrentTab=function(){var t=this._tab.selectedTabId;return this.closeTab(t)},t.prototype.getCurrentTab=function(){var t=this._tab.getCurrentTab();return t?(this._ok(),t):(this._throwError(_.NO_IMAGE_EXIST),null)},t.prototype.emptyTab=function(){this.removeAllThumbnailItem(),this.currentContents=[];var t=this.getTab(this._tab.selectedTabId);return t?(t.emptyTab(),this.showCurrentTab(),this._ok(),!0):(this._throwError(_.FILE_NOT_EXIST),!1)},t.prototype.getCurrentImageCounts=function(){var t=this.getCurrentTab();return this._ok(),t?t.getImageCounts():0},t.prototype.getTotalImageCounts=function(){},t.prototype._getImageUrlByUid=function(t){var e=t.length,i=[];if(0!==e){for(var n=0;n<e;n++){var o=this._getInterlayerData(t[n]);i.push(o)}return i}return[]},t.prototype._createUrl=function(t){var e=Object.prototype.toString.call(t);return"[object Blob]"===e?this._blobToImg(t):/\[object ArrayBuffer\]|\[object \w+Array\]/.test(e)?this._ArrayBufferToImg(t):(/data:image\/\w+;base64/.test(t),t)},t.prototype._revokeUrl=function(t){return(window.URL||window.webkitURL).revokeObjectURL(t)},t.prototype._blobToImg=function(t){return(window.URL||window.webkitURL).createObjectURL(t)},t.prototype._urlToImg=function(t){return new Promise((function(e,i){var n=new Image;n.src=t,n.onload=function(){e(n)},n.onerror=function(t){i("img load failed.")}}))},t.prototype._ArrayBufferToImg=function(t){var e=new Blob([t]);return this._blobToImg(e)},t.prototype._base64ToImg=function(t){return this._urlToImg(t)},t.prototype._getInterlayerData=function(t){return this._interlayer.getData(t)},t.prototype._addInterlayerData=function(t,e){return this._interlayer.addData(t,e)},t.prototype._removeInterlayerData=function(t){return this._interlayer.removeData(t)},t.prototype._updateInterlayerData=function(t,e){return this._interlayer.updateData(t,e)},t.prototype._checkArray=function(t){return!!a.default.isArray(t)||(this._throwError(_.PARAMETER_TYPE),!1)},t.prototype._checkString=function(t){return!!a.default.isString(t)||(this._throwError(_.PARAMETER_TYPE),!1)},t.prototype._checkIndex=function(t){return a.default.isNumber(t)?!(t<0||t>=this.getCurrentImageCounts())||(this._throwError(_.PARAMETER_RANGE),!1):(this._throwError(_.PARAMETER_TYPE),!1)},t.prototype._checkNameString=function(t){return a.default.isString(t)&&0!==t.length||(this._throwError(_.PARAMETER_TYPE),!1)},t.prototype._checkColor=function(t){if(!a.default.isString(t))return this._throwError(_.PARAMETER_TYPE),!1;return!!/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/.test(t)||(!!/^[rR][gG][Bb][Aa]?[\(]([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}[\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?[\s]*(0\.\d{1,2}|1|0)?[\)]{1}$/g.test(t)||(this._throwError(_.PARAMETER_TYPE),!1))},t.prototype._ok=function(){this.emit("dvs_error",_.OK)},t.prototype._throwError=function(t){this.emit("dvs_error",t)},t.prototype.getImageFromCanvas=function(t){return n(this,void 0,void 0,(function(){var e,i,n,r,s,a,l;return o(this,(function(o){switch(o.label){case 0:return e=null,null,e=t.minData?t.minData:t.originalData,i=t.originalData,n=this._createUrl(e),r=this._createUrl(i),s=new Image,a=new Image,s.setAttribute("crossOrigin","Anonymous"),a.setAttribute("crossOrigin","Anonymous"),s.src=n,a.src=r,l=document.createElement("canvas"),[4,new Promise((function(t,e){s.onload=function(){var e=s.naturalWidth;l.style.width=e+"px",l.width=e;var i=e/(s.naturalWidth/s.naturalHeight);l.style.height=i+"px",l.height=i,a.onload=function(){var e=a.naturalWidth/s.naturalWidth,i=l.getContext("2d");i.drawImage(s,0,0,s.naturalWidth,s.naturalHeight,0,0,l.width,l.height),t({ctx:i,r:e})}},s.onerror=function(t){e(t)}}))];case 1:return[2,o.sent()]}}))}))},t.prototype.getRealImageData=function(t,e){var i=this;return-1===this.requestArr.indexOf(t)&&(this.loadCallback(e).then((function(e){i.emit(t,e)})),this.requestArr.push(t)),new Promise((function(e,n){i.on(t,function(i){var n=this.requestArr.indexOf(t);-1!==n&&this.requestArr.splice(n,1),e(i)}.bind(i))}))},t}();e.DataHandler=y},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(0)),s=i(13),a=r.default.isFunction,l=r.default.isString,u=function(){function t(){this._undoStack=[],this._redoStack=[],this._isLock=!1,this._isSilent=!1}return t.prototype._execute=function(t){var e=this;this._isLock=!0;var i=t.args;return i=i||[],t.execute.apply(t,i).then((function(i){return e._isSilent||e.pushToUndoStack(t),e._isLock=!1,a(t.executeCallback)&&t.executeCallback(i),i})).catch((function(t){return e._isLock=!1,Promise.reject(t)}))},t.prototype._undo=function(t){var e=this;this._isLock=!0;var i=t.args;return i=i||[],t.undo.apply(t,i).then((function(i){return e.pushToRedoStack(t),e._isLock=!1,a(t.undoCallback)&&t.undoCallback(i),i})).catch((function(t){return e._isLock=!1,Promise.reject(t)}))},t.prototype.pushToUndoStack=function(t,e){this._undoStack.push(t)},t.prototype.pushToRedoStack=function(t,e){this._redoStack.push(t)},t.prototype.executeSilent=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this._isSilent=!0,this.execute.apply(this,n(e,[this._isSilent])).then((function(){t._isSilent=!1}))},t.prototype.execute=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(this._isLock)return Promise.reject("the state of current command is locked.");var n=e[0];return l(n)&&(n=s.createCommand.apply(void 0,e)),this._execute(n).then((function(e){return t.clearRedoStack(),e}))},t.prototype.undo=function(){var t,e=this._undoStack.pop(),i="";return e&&this._isLock&&(this.pushToUndoStack(e,!0),e=null),e?(this.isEmptyUndoStack(),t=this._undo(e)):(i="The promise of undo command is reject.",this._isLock&&(i+=" Because the state of current command is locked."),t=Promise.reject(i)),t},t.prototype.redo=function(){var t,e=this._redoStack.pop(),i="";return e&&this._isLock&&(this.pushToRedoStack(e,!0),e=null),e?(this.isEmptyRedoStack(),t=this._execute(e)):(i="The promise of redo command is reject.",this._isLock&&(i+=" Because the state of current command is locked."),t=Promise.reject(i)),t},t.prototype.clearRedoStack=function(){this.isEmptyRedoStack()||(this._redoStack=[])},t.prototype.clearUndoStack=function(){this.isEmptyUndoStack()||(this._undoStack=[])},t.prototype.isEmptyRedoStack=function(){return 0===this._redoStack.length},t.prototype.isEmptyUndoStack=function(){return 0===this._undoStack.length},t}();e.Invoker=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.name=t.name,this.args=e,this.execute=t.execute,this.undo=t.undo,this.executeCallback=t.executeCallback||null,this.undoCallback=t.undoCallback||null,this.undoData={}}return t.prototype.execute=function(){throw new Error("method 'execute' should be implemented !")},t.prototype.undo=function(){throw new Error("Method 'undo' should be implemented !")},t.prototype.setExecuteCallback=function(t){return this.executeCallback=t,this},t.prototype.setUndoCallback=function(t){return this.undoCallback=t,this},t}();e.Command=n;var o={};e.createCommand=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=o[t];return r?new n(r,e):null},e.registerCommand=function(t){o[t.name]=t}},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=i(15),r=n(i(0)),s=function(){function t(t){this._tagList=[],this.defaultTagColor="#4c4d4a",this.defaultTagName=null,this.defaultTagId=null,this.selectedTagId=null}return t.prototype.initDefaultTag=function(){var t=new o.TagItem({tagId:r.default.uid(11),name:this.defaultTagName,color:this.defaultTagColor,imgLists:[]});this._tagList.push(t),this.selectedTagId=t.tagId},t.prototype.getCurrentTag=function(){return this.getTagById(this.selectedTagId)},t.prototype.addTag=function(t,e,i){if(-1!==this.checkTag(t))return-1;var n=new o.TagItem({name:t,color:e||this.defaultTagColor,imgLists:i||[]});return this._tagList.push(n),!0},t.prototype.removeTag=function(t){var e=this.checkTag(t);return-1!==e&&(t===this.defaultTagName&&(this.defaultTagName=null),this._tagList.splice(e,1)[0])},t.prototype.renameTag=function(t,e){this.getTag(t).name=e},t.prototype.checkTag=function(t){var e=this._tagList.length;if(!e)return-1;for(var i=0;i<e;i++)if(this._tagList[i].name===t)return i;return-1},t.prototype.getTagList=function(){return this._tagList},t.prototype.getTag=function(t){var e=this.checkTag(t);return-1===e?null:this._tagList[e]},t.prototype.getTagById=function(t){for(var e=this._tagList.length,i=0;i<e;i++)if(this._tagList[i].tagId===t)return this._tagList[i];return null},t.prototype.filterByTag=function(t){var e=this.checkTag(t);return-1===e?-1:this._tagList[e].imgLists},t}();e.Tags=s},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)).default.uid,r=function(){function t(t){this.name=t.name,this.color=t.color,this.imgLists=t.imgLists||[],this.tagId=t.tagId||o(11)}return t.prototype.addImg=function(t){this.imgLists.push(t)},t.prototype.removeImg=function(t){if(0===this.imgLists.length)return!0;var e=this.imgLists.indexOf(t);return-1===e||this.imgLists.splice(e,1).length>0},t.prototype.emptyTag=function(){this.imgLists=[]},t}();e.TagItem=r},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o,r=i(17),s=i(20),a=n(i(0));!function(t){t.ROOT="root",t.FOLDER="folder",t.SINGLE="single",t.MULTIPLE="multiple"}(o||(o={}));var l=function(){function t(){this.root="root",this.rootNode=new s.TreeNode({treeId:a.default.uid(11),name:"root",type:o.ROOT,parentNode:null,children:[]}),this.currentNode=this.rootNode,this.selectedNodeId=null}return t.prototype.generateDirectory=function(){},t.prototype.backToPreviousNode=function(){var t=this.currentNode.parentNode;return!!t&&(this.currentNode=t,!0)},t.prototype.enterNodeFromCurrent=function(t){var e=this.findChild(this.currentNode,t);return this._checkNode(e)},t.prototype.enterFile=function(t){var e=this._findNode(this.currentNode,t,"file");return!!e&&(this.selectedNodeId=e.treeId,e)},t.prototype.enterFileByPath=function(t){var e=this._pathResolve(t);this.currentPath=t;for(var i=this.rootNode,n=e.length,o=0;o<n-1;o++)if(!(i=this._findNode(i,e[o],"folder")))return!1;return!!(i=this._findNode(i,e[n],"file"))&&(this.selectedNodeId=i.treeId,i)},t.prototype.enterFolder=function(t){var e=this._findNode(this.currentNode,t,"folder");return!!e&&(this.currentNode=e,!0)},t.prototype.enterFolderByPath=function(t){var e=this._pathResolve(t);this.currentPath=t;for(var i=this.rootNode,n=0,o=e.length;n<o;n++)if(!(i=this._findNode(i,e[n],"folder")))return!1;this.currentNode=i},t.prototype._findNode=function(t,e,i){if(!e)return!1;if(t.children.length>=0){var n=t.children.filter((function(t){return t.name===e&&t.type===i}));return!!n.length&&n[0]}return!1},t.prototype.enterNode=function(t){var e=this._pathResolve(t);this.currentPath=t;for(var i=this.rootNode,n=0,o=e.length;n<o;n++)i=this.findChild(i,e[n]);return this._checkNode(i)},t.prototype._checkNode=function(t){return!t||"folder"!==t.type&&"root"!==t.type?(this.selectedNodeId=t.treeId,t):(this.currentNode=t,"folder")},t.prototype.addNewNode=function(t,e,i){for(var n=t,o=1;this._checkChildren(this.currentNode,n,e);)n=t+"("+o+")",o++;var r=a.default.uid(11),l=new s.TreeNode({treeId:r,name:n,type:e,parentNode:this.currentNode,children:i||[]});if("folder"===e)this.currentNode.children.unshift(l);else{var u=this._getSpiltIndex(this.currentNode.children);this.currentNode.children.splice(u,0,l)}return r},t.prototype._getSpiltIndex=function(t){for(var e=t.length,i=0;i<e;i++)if("folder"!==t[i].type)return i;return e},t.prototype.removeFromCurrentNode=function(t){return this.currentNode.removeChildren(t,"file")},t.prototype.removeFile=function(t){return this.currentNode.removeChildren(t,"file")},t.prototype.removeFileByPath=function(t){for(var e=this._pathResolve(t),i=this.rootNode,n=e.length,o=0;o<n-1;o++)i=this._findNode(i,e[o],"folder");return this.currentNode.name===e[n-1]&&(this.currentNode=i),!!i&&i.removeChildren(e[n-1],"file")},t.prototype.removeFolder=function(t){return this.currentNode.removeChildren(t,"folder")},t.prototype.removeFolderByPath=function(t){for(var e=this._pathResolve(t),i=this.rootNode,n=e.length,o=0;o<n-1;o++)i=this._findNode(i,e[o],"folder");return this.currentNode.name===e[n-1]&&(this.currentNode=i),!!i&&i.removeChildren(e[n-1],"folder")},t.prototype.removeNode=function(t){for(var e=this._pathResolve(t),i=this.rootNode,n=e.length,o=0;o<n-1;o++)i=this.findChild(i,e[o]);return i.parentNode&&this.currentNode.parentNode&&i.parentNode.name===this.currentNode.parentNode.name&&i.name===this.currentNode.name&&(this.currentNode=this.currentNode.parentNode),!!i&&i.removeChildren(e[n-1],"file")},t.prototype.renameNode=function(t,e,i){var n=this._findNode(this.currentNode,t,i);return!!n&&(n.setName(e),!0)},t.prototype.addToNode=function(t,e){for(var i=this._pathResolve(t),n=this.rootNode,o=i.length,r=0;r<o;r++)n=this.findChild(n,i[r]);var a=new s.TreeNode({name:e.name,type:e.type,parentNode:n,children:e.children});n.children.push(a)},t.prototype._pathResolve=function(t){r.isString(t);var e=[];return t.replace(/([\w+\.|\w+]+)/g,(function(t,i){return e.push(i),t})),e},t.prototype._checkChildren=function(t,e,i){for(var n=t.children,o=n.length,r=0;r<o;r++)if(n[r].name===e&&n[r].type===i)return!0;return!1},t.prototype.findChild=function(t,e){if(!e)return!1;if(t.children.length>=0){var i=t.children.filter((function(t){return t.name===e}));return!!i.length&&i[0]}return!1},t.prototype.getSelectedNode=function(){for(var t=this.currentNode.children,e=0,i=t.length;e<i;e++)if(t[e].treeId===this.selectedNodeId&&("single"===t[e].type||"multiple"===t[e].type))return t[e];return null},t}();e.DirectoryTree=l},function(t,e,i){(function(t){var n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},n=0;n<e.length;n++)i[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return i},o=/%[sdj%]/g;e.format=function(t){if(!_(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(a(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,r=n.length,s=String(t).replace(o,(function(t){if("%%"===t)return"%";if(i>=r)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}})),l=n[i];i<r;l=n[++i])g(l)||!b(l)?s+=" "+l:s+=" "+a(l);return s},e.deprecate=function(i,n){if(void 0!==t&&!0===t.noDeprecation)return i;if(void 0===t)return function(){return e.deprecate(i,n).apply(this,arguments)};var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),o=!0}return i.apply(this,arguments)}};var r,s={};function a(t,i){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(i)?n.showHidden=i:i&&e._extend(n,i),v(n.showHidden)&&(n.showHidden=!1),v(n.depth)&&(n.depth=2),v(n.colors)&&(n.colors=!1),v(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,t,n.depth)}function l(t,e){var i=a.styles[e];return i?"["+a.colors[i][0]+"m"+t+"["+a.colors[i][1]+"m":t}function u(t,e){return t}function c(t,i,n){if(t.customInspect&&i&&x(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var o=i.inspect(n,t);return _(o)||(o=c(t,o,n)),o}var r=function(t,e){if(v(e))return t.stylize("undefined","undefined");if(_(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(m(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,i);if(r)return r;var s=Object.keys(i),a=function(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(i)),T(i)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(i);if(0===s.length){if(x(i)){var l=i.name?": "+i.name:"";return t.stylize("[Function"+l+"]","special")}if(y(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(C(i))return t.stylize(Date.prototype.toString.call(i),"date");if(T(i))return h(i)}var u,b="",E=!1,w=["{","}"];(p(i)&&(E=!0,w=["[","]"]),x(i))&&(b=" [Function"+(i.name?": "+i.name:"")+"]");return y(i)&&(b=" "+RegExp.prototype.toString.call(i)),C(i)&&(b=" "+Date.prototype.toUTCString.call(i)),T(i)&&(b=" "+h(i)),0!==s.length||E&&0!=i.length?n<0?y(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),u=E?function(t,e,i,n,o){for(var r=[],s=0,a=e.length;s<a;++s)R(e,String(s))?r.push(d(t,e,i,n,String(s),!0)):r.push("");return o.forEach((function(o){o.match(/^\d+$/)||r.push(d(t,e,i,n,o,!0))})),r}(t,i,n,a,s):s.map((function(e){return d(t,i,n,a,e,E)})),t.seen.pop(),function(t,e,i){if(t.reduce((function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(u,b,w)):w[0]+b+w[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,i,n,o,r){var s,a,l;if((l=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?a=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(a=t.stylize("[Setter]","special")),R(n,o)||(s="["+o+"]"),a||(t.seen.indexOf(l.value)<0?(a=g(i)?c(t,l.value,null):c(t,l.value,i-1)).indexOf("\n")>-1&&(a=r?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),v(s)){if(r&&o.match(/^\d+$/))return a;(s=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function p(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function g(t){return null===t}function m(t){return"number"==typeof t}function _(t){return"string"==typeof t}function v(t){return void 0===t}function y(t){return b(t)&&"[object RegExp]"===E(t)}function b(t){return"object"==typeof t&&null!==t}function C(t){return b(t)&&"[object Date]"===E(t)}function T(t){return b(t)&&("[object Error]"===E(t)||t instanceof Error)}function x(t){return"function"==typeof t}function E(t){return Object.prototype.toString.call(t)}function w(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(i){if(v(r)&&(r=t.env.NODE_DEBUG||""),i=i.toUpperCase(),!s[i])if(new RegExp("\\b"+i+"\\b","i").test(r)){var n=t.pid;s[i]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",i,n,t)}}else s[i]=function(){};return s[i]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=f,e.isNull=g,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=_,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=v,e.isRegExp=y,e.isObject=b,e.isDate=C,e.isError=T,e.isFunction=x,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i(18);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var t=new Date,e=[w(t.getHours()),w(t.getMinutes()),w(t.getSeconds())].join(":");return[t.getDate(),S[t.getMonth()],e].join(" ")}function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",I(),e.format.apply(e,arguments))},e.inherits=i(19),e._extend=function(t,e){if(!e||!b(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t};var L="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function A(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(L&&t[L]){var e;if("function"!=typeof(e=t[L]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,L,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,n=new Promise((function(t,n){e=t,i=n})),o=[],r=0;r<arguments.length;r++)o.push(arguments[r]);o.push((function(t,n){t?i(t):e(n)}));try{t.apply(this,o)}catch(t){i(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),L&&Object.defineProperty(e,L,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=L,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function i(){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);var o=i.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var r=this,s=function(){return o.apply(r,arguments)};e.apply(this,i).then((function(e){t.nextTick(s,null,e)}),(function(e){t.nextTick(A,e,s)}))}return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.defineProperties(i,n(e)),i}}).call(this,i(2))},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.treeId=t.treeId,this.name=t.name,this.type=t.type,this.parentNode=t.parentNode,this.children=t.children}return t.prototype.removeImg=function(t){if(0===this.children.length)return!1;var e=this.children.indexOf(t);return-1!==e&&(this.children.splice(e,1),!0)},t.prototype.emptyChildren=function(){this.children=[]},t.prototype.removeChildren=function(t,e){var i=this.children.length;if(i){for(var n=0;n<i;n++){if(this.children[n].name===t&&this.children[n].type===e)return this.children.splice(n,1)[0]}return!1}return!1},t.prototype.setName=function(t){this.name=t},t}();e.TreeNode=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(22),o=function(){function t(){this.counts=0,this.contents=[]}return t.prototype.getThumbnailContents=function(){return this.contents},t.prototype.addThumbnailItem=function(t){var e=new n.ThumbnailItem(t);return this.contents.push(e),this.counts++,e},t.prototype.clearThumbnail=function(){this.counts=0,this.contents.forEach((function(t){})),this.contents=[]},t.prototype.removeThumbnailItem=function(t){return t>=0&&t<=this.counts&&(window.URL.revokeObjectURL(this.contents[t]),this.contents.splice(t,1),this.counts--,!0)},t}();e.Thumbnail=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){this.uid=t.uid,this.data=t.data,this.tags=t.tags};e.ThumbnailItem=n},function(t,e,i){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILURE=1]="FAILURE",t[t.OVERFLOW=2]="OVERFLOW",t[t.TIMEOUT=3]="TIMEOUT"}(n||(n={}));var o=function(){function t(){this.datas={},this.syncdata={}}return t.prototype.addData=function(t,e){var i=this;return new Promise((function(n,o){i.datas[t]=e,n(!0)}))},t.prototype.getData=function(t){var e=this;return new Promise((function(i,n){e._checkData(t)?i(e.datas[t]):n("not exist.")}))},t.prototype.removeData=function(t){var e=this;return new Promise((function(i,n){e._checkData(t)?(delete e.datas[t],i(!0)):n(!1)}))},t.prototype.updateData=function(t,e){var i=this;return new Promise((function(n,o){i._checkData(t)?(i.datas[t]=e,n(!0)):o(!1)}))},t.prototype._checkData=function(t){return!!this.datas[t]},t.prototype.addDataSync=function(t,e){return this.syncdata[t]=e,!0},t.prototype.getDataSync=function(t){return!!this._checkDataSync(t)&&this.syncdata[t]},t.prototype.removeDataSync=function(t){return!!this._checkDataSync(t)&&(delete this.syncdata[t],!0)},t.prototype.updateDataSync=function(t,e){return!!this._checkDataSync(t)&&(this.syncdata[t]=e,!0)},t.prototype._checkDataSync=function(t){return!!this.syncdata[t]},t}();e.DataStorage=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.currentPage=t.currentPage,this.totalPages=t.totalPages}return t.prototype.setPageData=function(t){this.currentPage=void 0!==t.currentPage?t.currentPage:this.currentPage,this.totalPages=void 0!==t.totalPages?t.totalPages:this.totalPages},t.prototype.getPageData=function(){return{currentPage:this.currentPage,totalPages:this.totalPages}},t.prototype.prevPage=function(){return 0!==this.currentPage&&(this.currentPage>0&&this.currentPage--,!0)},t.prototype.nextPage=function(){return this.totalPages-this.currentPage>1&&this.currentPage<this.totalPages&&(this.currentPage++,!0)},t.prototype.homePage=function(){return 0!==this.currentPage&&(this.currentPage=0,!0)},t.prototype.endPage=function(){return this.currentPage!==this.totalPages-1&&(this.currentPage=this.totalPages-1,!0)},t.prototype.goToPage=function(t){return"number"==typeof t&&(t=this._checkPage(t),this.currentPage=t,!0)},t.prototype._checkPage=function(t){return t<this.totalPages?t>=0?t:0:this.totalPages-1},t}();e.Pager=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(26),o=function(){function t(){this.tabMode="none",this.tabLists=[],this.selectedTabId="none"}return t.prototype.addTab=function(t){var e=new n.TabItem(t);return"none"===this.tabMode?this.tabLists=[e]:"multiple"===this.tabMode?this.tabLists.push(e):console.log("tabmode error!"),e},t.prototype.getTab=function(t){var e=this.checkTab(t);return-1===e?null:this.tabLists[e]},t.prototype.removeTab=function(t){var e=this.checkTab(t);return-1!==e&&(t===this.selectedTabId&&(this.selectedTabId=null),this.tabLists.splice(e,1),!0)},t.prototype.checkTab=function(t){var e=this.tabLists.length;if(!e)return-1;for(var i=0;i<e;i++)if(this.tabLists[i].tabId===t)return i;return-1},t.prototype.getCurrentTab=function(){return this.getTab(this.selectedTabId)},t.prototype.closeTab=function(){},t}();e.Tab=o},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)).default.uid,r=function(){function t(t){this.selectedImageUids=[],this.tabId=t.tabId||o(11),this.tabName=t.tabName,this.type=t.type,this.scrollTop=t.scrollTop||0,this.scrollLeft=t.scrollLeft||0,this.zoom=t.zoom||1,this.imgLists=t.imgLists||[],this.selectedImageUids=t.selectedImageUids||[]}return t.prototype.addImg=function(t){this.imgLists.push(t)},t.prototype.getImageCounts=function(){return this.imgLists.length},t.prototype.getCurrentUid=function(){var t=this.selectedImageUids.length;return t?this.selectedImageUids[t-1]:null},t.prototype.getCurrentIndex=function(){var t=this.imgLists.indexOf(this.getCurrentUid());return-1===t?null:t},t.prototype.removeImg=function(t){if(0===this.imgLists.length)return!0;var e=this.imgLists.indexOf(t);return-1===e||this.imgLists.splice(e,1).length>0},t.prototype.insertImage=function(t,e){this.imgLists.splice(t,0,e)},t.prototype.emptyTab=function(){this.imgLists=[],this.selectedImageUids=[]},t.prototype.setSelectedImageUids=function(t){this.selectedImageUids=t},t.prototype.getSelectedImageUids=function(){return this.selectedImageUids.slice()},Object.defineProperty(t.prototype,"totalImageCount",{get:function(){return this.imgLists.length},enumerable:!0,configurable:!0}),t}();e.TabItem=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.data={}}return t.prototype.addData=function(t,e){this.data[t]=e},t.prototype.removeData=function(t){delete this.data[t]},t.prototype.updateData=function(t,e){this.data[t]=e},t.prototype.getData=function(t){return this.data[t]},t}();e.Interlayer=n},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(0)),s=i(29),a=i(31),l=i(33),u=i(34),c=i(35),h=i(36),d=o(i(1)).default.errorMessages,p=function(){function t(t,e){this.useMyEvent=!0,this._hasDocumentEvent=!1,this._isMobile=!1,this._tempThumbnailSize={width:1,height:1},this._topImageIndex=0,this.thumbnailDirection="row",this._topImageChange=!0,this._pubSub=e,this.goToThumbnail=!0,this.viewer=t,this.postfix=t.postfix,this.imageLayout={columnsCount:1,rowsCount:4,isrow:!0},this._refreshEvents=[["_onThumbnailRefresh",this._onRefreshThumb],["_onTagRefresh",this._onRefreshTag],["_onDirectoryRefresh",this._onRefreshDirctory],["_onPagerRefresh",this._onRefreshPage]],this._outerEvents=[["imageSelected",this._imageSelected],["imageClick",this.selectThumbImg],["imageRightClick",this.contextThumb],["fileSelected",this._fileSelected],["fileClick",this.enterFolder],["fileRightClick",this.contextTree],["tagSelected",this._tagSelected],["tagClick",this.showTagContent],["tagRightClick",this.contextTag],["onDrop",this.dropFileOnly],["topImageChange",this.preventRepeat],["pageChange",this.pageChange]],this._buttonEvents=[["onLoadImage",this.loadImage],["onPanelChange",this.togglePaneBox],["onSave",this._onSave],["onFullScreen",this.toggleFullScreen],["onFullPage",this.fitPage],["onAutoFit",this.fitWindow],["onFitHeight",this.fitHeight],["onFitWidth",this.fitWidth],["onFlip",this.flip],["onMirror",this.mirror],["onRotate",this.rotate],["onWipe",this.wipe],["onCrop",this.enterCropMode],["onRemove",this.toggleConfirmBox],["onFirstPage",this.homePage],["onPreviousPage",this.prevPage],["onNextPage",this.nextPage],["onLastPage",this.endPage],["onZoomIn",this._canvasZoomIn],["onZoomOut",this._canvasZoomOut],["onToggleThumbnail",this.toggleThumbnail]],this._privateEvents=[["_onGetCropLimitArea",this._onGetCropLimitArea],["_onCanvasZoom",this._changeCanvasSize],["_onSetOperationMode",this._onSetOperationMode],["_onThumbnailScroll",this.scrollTo],["_onCurTabChange",this.getTabItem],["getRemoveIndexes",this.getRemoveIndexes],["_onClearCropBoxes",this._clearCropBoxes]],this._thumbnailRender=new a.ThumbnailRender(t.uiConfig.thumbnail,t.postfix,this._pubSub,this.imageLayout),this._directoryRender=new l.DirectoryRender(t.postfix),this._tagRender=new s.TagRender(t.postfix,this._pubSub),this._cropRender=new u.CropRender(t.postfix,t.uiConfig.cropStyle),this._scrollRender=new c.ScrollRender(t.postfix),this.uiEventInit(),this.bindEvents(),this.styleChange(),this.emit("_onAddLog",r.default.formatLog("uiEventControl init",!0))}return t.prototype.uiEventInit=function(){var t=this;this.sendThumbnailConfig();this.viewer;this._directoryRender.treeInit(),this._thumbnailRender.thumbnailInit(),this._tagRender.tagInit(),this._cropRender.cropInit(),this._scrollRender._addButtonScroll(),this.buttons=this.viewer.uiConfig.buttons;var e=this.viewer.ID.bind(this);Object.keys(this.buttons).forEach((function(e){var i=t.buttons[e],n=r.default.id(e+"Btn"+t.postfix);if(!n)return!1;"loadImage"!==e&&n.classList.add("DVS_iconColor"),i.onButtonClick&&r.default.addEvent(n,"click",(function(e){t._scrollRender.buttonMove?t._scrollRender.buttonMove=!1:e.changedTouches?t.emit(i.onButtonClick,e.changedTouches[0]):t.emit(i.onButtonClick,e)}))})),r.default.addEvent(r.default.id("WebViewer"+this.postfix),"contextmenu",(function(e){t.emit("onMouseRightClick",e),r.default.preventDefault(e)}));var i="click",n="mousedown",o="mousemove",s="mouseup";"ontouchend"in document.documentElement&&(i="touchend",n="touchstart",o="touchmove",s="touchend"),this._hasDocumentEvent||(document.body.addEventListener("touchstart",(function(){})),document.addEventListener(s,(function(e){t._documentMouseUp(e)})),window.addEventListener("resize",(function(){t._windowResize()})),window.ondragstart=function(){return!1},r.default.addEvent(document,"keyup",(function(e){t.selectImageByKey(e)})),this._hasDocumentEvent=!0),r.default.addEvent(e("WebViewer"),i,(function(){t.hideFileTypeBox(),t.hidePaneBox(),t.hideContextMenu(),t.isMobile&&t._selectTab(-1)})),r.default.addEvent(e("besides"),i,(function(e){t.hidePaneBox(),t.hideContextMenu(),r.default.stopBubble(e)})),r.default.addEvent(e("WebViewer"),"dragover",this.dragFileOver),r.default.addEvent(e("WebViewer"),"drop",(function(e){t.emit("onDrop",e)})),r.default.addEvent(e("navChange"),i,(function(e){t.tabChange(e)})),r.default.addEvent(e("cancelRemove"),i,(function(){t.toggleConfirmBox()})),r.default.addEvent(e("confirmRemove"),i,(function(){t.removeSelectedImage()})),e("panelChangeBtn")&&r.default.addEvent(e("panelChangeBtn"),i,(function(t){r.default.stopBubble(t)})),r.default.addEvent(e("isShowPane"),i,(function(e){t.togglePanesSelector(e)})),r.default.addEvent(e("paneSelector"),i,(function(e){t.changePaneShow(e)})),r.default.addEvent(e("thumbnailPane"),i,(function(e){t._changeThumbnailShow(e)})),r.default.addEvent(e("tagLists"),i,(function(e){t.cancelTag(e),t.confrimTag(e)})),r.default.addEvent(r.default.id("addTag"+this.postfix),"click",(function(e){t._tagRender.addNewTag(e)})),r.default.addEvent(r.default.id("tagLists"+this.postfix),"click",(function(e){t._tagRender.quickRenameTag(e),t._tagRender.quickDelTag(e)})),r.default.addEvent(e("tagLists"),"keyup",(function(t){if(13===t.keyCode){var e=t.target.nextSibling.children[0];e&&e.click()}else if(27===t.keyCode){var i=t.target.nextSibling.children[1];i&&i.click()}})),r.default.addEvent(e("treeLists"),i,(function(e){t.confirmFolder(e),t.cancelFolder(e)})),r.default.addEvent(r.default.id("addFolder"+this.postfix),"click",(function(e){t._directoryRender.addNewFolder(e)})),r.default.addEvent(e("treeLists"),"keyup",(function(t){if(13===t.keyCode){var e=t.target.nextSibling.children[0];e&&e.click()}else if(27===t.keyCode){var i=t.target.nextSibling.children[1];i&&i.click()}})),"ontouchstart"in document.documentElement?(r.default.addEvent(r.default.id("thumbLists"+this.postfix),"touchstart",(function(e){t._thumbnailRender.dragStartMobile(e)})),r.default.addEvent(r.default.id("thumbLists"+this.postfix),"touchmove",(function(e){t._thumbnailRender.dragMoveMobile(e)}))):(r.default.addEvent(r.default.id("thumbLists"+this.postfix),"mousedown",(function(e){e.ctrlKey||e.shiftKey||e.metaKey?t._thumbnailRender.isClick=!0:t._thumbnailRender.dragThumbnai(e)})),r.default.addEvent(r.default.id("thumbLists"+this.postfix),"mousemove",(function(e){t._thumbnailRender.dragMove(e)})),r.default.addEvent(r.default.id("thumbLists"+this.postfix),"mouseover",(function(e){t._thumbnailRender.setHoverColor(e)})),r.default.addEvent(r.default.id("thumbLists"+this.postfix),"mouseout",(function(e){t._thumbnailRender.setImageColor(e)})),r.default.addEvent(r.default.id("stretchBar"+this.postfix),"mousedown",(function(e){t._thumbnailRender.stretchMouseDown(e)})),r.default.addEvent(r.default.id("thumbnailStretchBarRight"+this.postfix),"mousedown",(function(e){t._thumbnailRender.thumbnailStretchRightStart(e)})),r.default.addEvent(r.default.id("WebViewer"+this.postfix),"mousemove",(function(e){t._thumbnailRender.stretchMouseMove(e),t._thumbnailRender.thumbnailStretchRightMove(e)}))),r.default.addEvent(e("mutiSelect"),i,(function(){t.enterMutipleMode(),t.viewer.setShowSelectBox(!0)})),r.default.addEvent(r.default.id("selectAll"+this.postfix),i,(function(){t._thumbnailRender.selectAllImage(),t.selectImageByIndexes()})),r.default.addEvent(e("exitMutiple"),i,(function(){t.exitMutipleMode(),t.viewer.setShowSelectBox(!1)})),r.default.addEvent(e("thumbLists"),"scroll",(function(e){r.default.throttle(t.thumbnailScroll,200).bind(t)(),r.default.stopBubble(e)})),e("defaultTag")&&r.default.addEvent(e("defaultTag"),i,(function(){t._onOpenAll(),e("defaultTag").classList.add("DVS_activeAllImage"),t._tagSelected(""),t._fileSelected("")})),r.default.addEvent(e("magnifyImage"),i,(function(){t.thumbnailZoomIn()})),r.default.addEvent(e("shrinkImage"),i,(function(){t.thumbnailZoomOut()})),r.default.addEvent(e("contextMenu"),"mouseenter",(function(e){t.showEditTag(e)}),!0),r.default.addEvent(e("contextMenu"),"mouseleave",(function(e){t.hideEditTag(e)}),!0),r.default.addEvent(e("contextMenu"),i,(function(e){t.toggleSelectedTag(e),t.removeTag(e),t.removeFile(e),t.removeImage(e),t.removeAllImage(e),t.copyImage(e),t.insertImgaeBefore(e),t.insertImageAfter(e),t._tagRender.renameTag(e),t._directoryRender.renameFile(e),t.emptyTag(e)})),r.default.addEvent(e("pageInput"),"blur",(function(e){t.changePageEvent(e)})),r.default.addEvent(e("pageInput"),"keyup",(function(t){13===t.keyCode&&t.target.blur()})),r.default.addEvent(e("cancleSaveBtn"),i,(function(){t.hideSaveSetting()})),r.default.addEvent(e("confirmSaveBtn"),i,(function(){t.hideSaveSetting()})),r.default.addEvent(e("cancleCropBtn"),i,(function(){t.exitCropMode()})),r.default.addEvent(r.default.id("confirmCropBtn"+this.postfix),i,(function(){t._confirmCrop()})),r.default.addEvent(e("cropEditArea"),n,(function(e){t._imageAreaUnselected(e)})),r.default.addEvent(e("cropEditArea"),i,(function(e){t.emit("click",e)})),r.default.addEvent(e("cropEditArea"),o,(function(e){t.emit("move",e)})),r.default.addEvent(e("cropEditArea"),"wheel",(function(e){t.emit("_onScrollWheel",e)})),r.default.addEvent(e("cropEditArea"),"contextmenu",(function(e){t.emit("rightClick",e)})),r.default.addEvent(e("cropEditArea"),"dblclick",(function(e){t.emit("doubleClick",e)})),"ontouchstart"in document.documentElement?r.default.addEvent(e("cropEditArea"),"touchmove",(function(e){t._cropRender._cropMoveMobile(e),t._cropRender._editBoxMoveMobile(e),t._cropRender._dragBoxMoveMobile(e)})):(r.default.addEvent(e("cropEditArea"),"mousemove",(function(e){t._cropRender.cropMove(e),t._cropRender._editBoxMove(e),t._cropRender._dragBoxMove(e)})),"ontouchstart"in document.documentElement?r.default.addEvent(e("cropEditArea"),"touchmove",(function(e){t._cropRender._cropMoveMobile(e),t._cropRender._editBoxMoveMobile(e),t._cropRender._dragBoxMoveMobile(e)})):r.default.addEvent(e("cropEditArea"),"mousemove",(function(e){t._cropRender.cropMove(e),t._cropRender._editBoxMove(e),t._cropRender._dragBoxMove(e)})),r.default.addEvent(r.default.id("cropBar"+this.postfix),"click",(function(e){t._cropRender.setCropRatio(e)})),r.default.addEvent(r.default.id("outer"+this.postfix),"scroll",(function(){t._scrollRender.isMyScroll?t._scrollRender.isMyScroll=!1:(t._scrollRender._xOver||t._scrollRender._yOver)&&t._canvasScroll()})),r.default.addEvent(e("treeLists"),i,(function(e){t.emit("fileClick",e)})),r.default.addEvent(e("tagLists"),i,(function(e){t.emit("tagClick",e)})),r.default.addEvent(e("thumbLists"),o,(function(e){var i=t._thumbnailRender.getImageItem(e);if(i){var n=r.default.getIndex(i);!t._thumbnailRender.isdrag&&t.emit("imageMove",n,e)}})),"ontouchend"in document.documentElement||(r.default.addEvent(e("thumbLists"),"contextmenu",(function(e){var i=t._thumbnailRender.getImageItem(e);if(i){var n=r.default.getIndex(i);if(void 0===n||t._thumbnailRender.isdrag)return!1;t.emit("imageRightClick",n,e),-1===t._thumbnailRender.selectedIndexes.indexOf(n)&&t.selectImageByIndexes([n])}})),r.default.addEvent(e("treeLists"),"contextmenu",(function(e){t.emit("fileRightClick",e)})),r.default.addEvent(e("tagLists"),"contextmenu",(function(e){t.emit("tagRightClick",e)}))))},t.prototype.bindEvents=function(){var t=this;this._refreshEvents.forEach((function(e){t.on(e[0],e[1])})),this._outerEvents.forEach((function(e){t.on(e[0],e[1])})),this._buttonEvents.forEach((function(e){t.on(e[0],e[1])})),this._privateEvents.forEach((function(e){t.on(e[0],e[1])}))},t.prototype.unbindEvents=function(){window.removeEventListener("resize",this._windowResize),document.removeEventListener("mouseup",this._documentMouseUp),document.removeEventListener("touchend",this._documentMouseUp),this._thumbnailRender.content=[],this._tagRender.content=[],this._directoryRender.treeList=[],this._cropRender.unbindCropMask()},t.prototype.bindMyAlert=function(){var t=this,e=window.alert;window.alert=function(i){e(i),t._cropRender.preventCrop(),t._thumbnailRender.preventAllCrop()}},t.prototype.on=function(t,e){this._pubSub.on(t,e.bind(this))},t.prototype.off=function(t,e){this._pubSub.off(t,e)},t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},t.prototype.hideFileTypeBox=function(){r.default.hiddenByQuery("#loadFileType"+this.postfix)},t.prototype.toggleFileTypeBox=function(){r.default.toggleDisplayByQuery("#loadFileType"+this.postfix),this.hidePaneBox()},t.prototype.loadImage=function(){var t=this;(new h.LoadImage).loadImage({type:"input"}).then((function(e){t.emit("_onLoadImage",e)}))},t.prototype.toggleConfirmBox=function(){var t=this._thumbnailRender.selectedIndexes,e=r.default.id("thumbLists"+this.postfix)&&r.default.id("thumbLists"+this.postfix).children;t.length&&e&&e.length?r.default.toggleDisplayByQuery("#confirmBox"+this.postfix):alert("Please selected one image at least!")},t.prototype.removeSelectedImage=function(){var t=this._thumbnailRender.selectedIndexes;this.emit("_onRemove",t),r.default.toggleDisplayByQuery("#confirmBox"+this.postfix)},t.prototype.toggleFullScreen=function(){r.default.id("WebViewer"+this.postfix),r.default.id("fullScreenBtn"+this.postfix);r.default.isFullscreen()?this.viewer.cancelFullScreen():this.viewer.fullScreen()},t.prototype.fitPage=function(){var t=r.default.id("WebViewer"+this.postfix);r.default.id("fullPageBtn"+this.postfix);t.classList.contains("fitPage")?this.viewer.cancelFullPage():this.viewer.fullPage(),this.styleChange()},t.prototype.fitWindow=function(){this.emit("_onFitType","window")},t.prototype.fitWidth=function(){this.emit("_onFitType","width")},t.prototype.fitHeight=function(){this.emit("_onFitType","height")},t.prototype.flip=function(){this.emit("_onFlip")},t.prototype.mirror=function(){this.emit("_onMirror")},t.prototype.rotate=function(){this.emit("_onRotate",90)},t.prototype.wipe=function(){},t.prototype.hideSaveSetting=function(){r.default.hiddenByQuery("#saveSettingBox"+this.postfix)},t.prototype.dragFileOver=function(t){r.default.preventDefault(t)},t.prototype.dropFileOnly=function(t){if(r.default.preventDefault(t),!this.useMyEvent)return!1;for(var e=t.dataTransfer.files,i=0;i<e.length;i++){var n=e[i];if(/^image\/(?!tiff)/.test(n.type)){var o={name:n.name,fileType:n.type,contents:[]},s=URL.createObjectURL(n);o.contents.push({originalData:s,minData:null,tags:[]}),this.emit("_onLoadImage",o)}}},t.prototype.togglePanesSelector=function(t){var e=t.target;if(e&&("SPAN"===e.tagName||e.classList.contains("iconfont"))&&(e=e.parentNode),!e||!e.classList.contains("isShowPane"))return!1;var i=e.children[0],n=e.parentNode.children[1];i.classList.toggle("icon-selected"),i.classList.toggle("icon-mutiple"),r.default.toggleDisplayByDom(n,!0),this.toggleBeside(),i.classList.contains("icon-mutiple")&&(r.default.id("besides"+this.postfix).classList.add("DVS_nodisplay"),this.emit("_onCanvasResize")),r.default.stopBubble(t)},t.prototype.hidePaneBox=function(){r.default.hiddenByQuery("#navigationPane"+this.postfix)},t.prototype.changePaneShow=function(t){var e,i=t.target.tagName;if("LI"==i)e=r.default.getIndex(t.target);else{if("DIV"!==i&&"SPAN"!==i)return this._throwErr(d.ELEMENT_NOT_EXIST),!1;e=r.default.getIndex(t.target.parentNode)}var n=r.default.id("paneSelector"+this.postfix).children[e].children[0],o=r.default.id("navChange"+this.postfix).children,s=r.default.id("paneShow"+this.postfix).children;n.classList.toggle("icon-selected"),n.classList.toggle("icon-mutiple");var a=r.default.toggleDisplayByDom(o[e],!0),l=this.isPaneEmpty();if(-1!=l)(!a&&o[e].classList.contains("activeTab")||1===this.availablePaneLength())&&o[l].children[0].click();else for(var u=0;u<s.length;u++)s[u].classList.add("DVS_nodisplay");this.toggleBeside()},t.prototype._changeThumbnailShow=function(t){var e=t.target;if(e&&("SPAN"===e.tagName||e.classList.contains("iconfont"))&&(e=e.parentNode),!e||!e.classList.contains("thumbnailPane"))return!1;var i=e.children[0];i.classList.toggle("icon-selected"),i.classList.toggle("icon-mutiple");var n=i.classList.contains("icon-mutiple");return this.viewer.setShowThumbnail(!n),this.styleChange(),r.default.stopBubble(t),!0},t.prototype.isPaneEmpty=function(){for(var t=r.default.id("navChange"+this.postfix).children,e=0;e<t.length;e++)if(!t[e].classList.contains("DVS_nodisplay")&&!t[e].classList.contains("DVS_disabled"))return e;return-1},t.prototype.availablePaneLength=function(){for(var t=0,e=r.default.id("navChange"+this.postfix).children,i=0;i<e.length;i++)e[i].classList.contains("DVS_nodisplay")||e[i].classList.contains("DVS_disabled")||t++;return t},t.prototype.toggleBeside=function(){var t=this.availablePaneLength(),e=this.isPaneEmpty(),i=r.default.id("besides"+this.postfix);t>0?(i.classList.remove("DVS_nodisplay"),t>1?r.default.id("navChange"+this.postfix).classList.remove("DVS_nodisplay"):r.default.id("navChange"+this.postfix).classList.add("DVS_nodisplay")):(i.classList.add("DVS_nodisplay"),this.emit("_onCanvasResize")),r.default.queryAll("#navChange"+this.postfix+">li").forEach((function(t,i){t.setAttribute("style",""),t.classList.contains("activeTab")&&i===e&&(t.style.borderLeft="none")})),this.emit("_onCanvasResize")},t.prototype.enterCropMode=function(){var t=r.default.id("thumbLists"+this.postfix);return!(!t||!t.children.length)&&(this.emit("_onGetOperationMode",1),!0)},t.prototype.exitCropMode=function(){var t=this._thumbnailRender.selectedIndexes.slice(0).pop(),e=this._cropRender.cropBoxes;e&&e.length>0&&this.emit("imageAreaUnselected",t),this._cropRender.isCrop=!1,this.emit("_onCanvasResize")},t.prototype._confirmCrop=function(){var t=this._cropRender.cropBoxes;return t.length&&this.emit("_onCrop",t),!0},t.prototype.setCropRatio=function(t){var e;return e=this._cropRender.setCropRatioFun(t),this._thumbnailRender.cropRatio.ratio=t,e},t.prototype.getCropRatio=function(){return this._cropRender.currentRatio},t.prototype.bindCropMask=function(t){this._cropRender.bindCropMask(t)},t.prototype.unbindCropMask=function(){this._cropRender.unbindCropMask()},t.prototype.setCropArea=function(t,e,i,n,o){return this._cropRender.setCropArea(t,e,i,n,o)},t.prototype.setThumbnailCropArea=function(t,e,i,n,o,r){var s=this._thumbnailRender.cropItem;if(!s)return!1;var a=this.imageLayout,l=a.rowsCount,u=a.columnsCount;if(1!==l||1!==u)return!1;var c=s.setCropArea(e,i,n,o),h=s.cropBoxes.length-1;return this.emit("imageAreaSelected",{index:t,x:e,y:i,width:n,height:o,areaIndex:h}),c},t.prototype._imageAreaUnselected=function(t){var e=this._thumbnailRender.selectedIndexes.slice(0).pop(),i=this._cropRender.cropBoxes,n=i&&i.length>0;void 0!==t.button?(this._cropRender.cropStart(t),t.ctrlKey||n&&this.emit("imageAreaUnselected",e)):(this._cropRender.cropStartMobile(t),n&&this.emit("imageAreaUnselected",e))},t.prototype._imageAreaSelected=function(t){if(!this._cropRender.isCrop)return!1;var e=this._cropRender.isCropMove;if(void 0!==t.button?(this._cropRender.cropEnd(),this._cropRender.editBoxEnd(),this._cropRender.dragBoxEnd()):(this._cropRender.cropEndMobile(),this._cropRender.editBoxEndMobile(),this._cropRender.dragBoxEndMobile()),e){this._cropRender.isCropMove=!1;var i=this._cropRender.currentCropBox;if(i){var n=this._thumbnailRender.selectedIndexes.slice(0).pop(),o=-1;this._cropRender.cropBoxes.forEach((function(t,e){t===i&&(o=e)})),-1!==o&&this.emit("_onImageAreaSelected",{index:n,x:i.left>0?i.left:0,y:i.top>0?i.top:0,width:i.width,height:i.height,areaIndex:o})}}},t.prototype.confrimTag=function(t){if(t.target.classList.contains("confirmTag")){var e=this._tagRender.confirmTag(t);e&&this.emit("_onAddTag",e.tagName)}else if(t.target.classList.contains("renameConfireTag")){var i=t.target.parentNode.parentNode.dvs_oldName,n=r.default.id("createBox"+this.postfix).children[0].value;i===n?this.emit("_onTagChange"):this.emit("_onRenameTag",i,n)}},t.prototype.cancelTag=function(t){t.target.classList.contains("cancelTag")&&(this.emit("_onTagChange"),r.default.id("addTag"+this.postfix).style.pointerEvents="auto")},t.prototype.showTagContent=function(t){var e=this._tagRender.getTargetDom(t);if(e){var i=e.dvs_name;i&&(this.emit("_onOpenTag",i),this._tagSelected(i)),this.hideContextMenu(),r.default.stopBubble(t)}},t.prototype._tagSelected=function(t){try{return this._tagRender.selectTagByName(t),!0}catch(t){return this._throwErr(d.ELEMENT_NOT_EXIST),!1}},t.prototype._onRefreshTag=function(t){r.default.id("tagLists"+this.postfix)&&this._tagRender.updateTagList(t)},t.prototype.confirmFolder=function(t){var e=this._directoryRender.confirmFolder(t);if(e)this.emit("_onAddFolder",e,[]);else if(t.target.classList.contains("renameConfirmFile")){var i=t.target.parentNode.parentNode,n=i.dvs_fileName,o=i.children[1].value,r=i.dvs_type;if("folder"===r)this.emit("_onRenameFolder",n,o);else{if("file"!==r)return;this.emit("_onRenameFile",n,o)}}},t.prototype.enterFolder=function(t){var e=this._directoryRender.getTargetDom(t);if(e){var i=e.dvs_type,n=e.dvs_fileName;"folder"===i?this.emit("_onOpenFolder",n):"back"===i?this.emit("_onBackToPrevious"):this.emit("_onOpenFile",n),this.hideContextMenu()}},t.prototype.cancelFolder=function(t){t.target.classList.contains("cancelFolder")&&this.emit("_onDirectoryChange")},t.prototype._fileSelected=function(t){this._directoryRender.selectFileByName(t)},t.prototype._onRefreshDirctory=function(t){if(!r.default.id("treeLists"+this.postfix))return!1;this._directoryRender.updataDirectory(t);var e=r.default.id("addFolder"+this.postfix);e&&e.style&&(e.style.pointerEvents="auto")},t.prototype.enterMutipleMode=function(){this._thumbnailRender.enterMutipleMode()},t.prototype.exitMutipleMode=function(){this._thumbnailRender.exitMutipleMode();var t=this._thumbnailRender.selectedIndexes.slice(0).pop()||0;this.selectImageByIndexes([t])},t.prototype.dragThumbUp=function(t){var e=this._thumbnailRender.dragUp(t);this._dragFunction(e,t)},t.prototype.dragThumbUpMobile=function(t){var e=this._thumbnailRender.dragUpMobile(t);this._dragFunction(e,t)},t.prototype._sendThumbnailRect=function(){if(r.default.isMobile())return!1;var t=r.default.id("Thumbnail"+this.postfix);if(t){var e=t.getBoundingClientRect();if(0==e.width&&0==e.height)return!1;var i=this._tempThumbnailSize;i.width===e.width&&i.height===e.height||(i.width=e.width,i.height=e.height,this.emit("thumbnailStretch",e.width,e.height))}},t.prototype._dragFunction=function(t,e){var i=this;if(t){var n=r.default.id("thumbLists"+this.postfix),o=this._thumbnailRender.selectedIndexes.map((function(t){return n.children[t].DVS_defaultIndex})),s=this._thumbnailRender.getDefaultIndexes(),a=[];o.forEach((function(t){var e=s.indexOf(t);-1!==e&&e!==t&&a.push([t,e])})),this.emit("_onReOrderThumbnail",s,this._thumbnailRender.selectedIndexes),this.selectImageByIndexes(),a.length&&this.emit("dragDone",a)}else{var l=this._thumbnailRender.getTargetDom(e);if(l&&this._thumbnailRender.isClick){var u=r.default.getIndex(l);this._clickFlag&&this._clickTarget===l?(clearTimeout(this._clickTimer),this._clickFlag=!1,this._clickTarget=null,this.emit("imageDoubleClick",u,e)):(this._clickTarget=l,clearTimeout(this._clickTimer),this._clickFlag=!0,this.emit("imageClick",u,e),this._clickTimer=setTimeout((function(){i._clickFlag=!1,i._clickTarget=null}),300))}}},t.prototype.selectThumbImg=function(t,e){var i=this._thumbnailRender.selectedIndexes;if(!e.ctrlKey&&!e.metaKey||e.shiftKey)if(!e.shiftKey||e.ctrlKey||e.metaKey)if((e.ctrlKey||e.metaKey)&&e.shiftKey){var n=i.slice(0);d=n[n.length-1];n.push(t);var o=t,s=t;n.forEach((function(t){t<o?o=t:t>s&&(s=t)}));var a=[];for(f=o;f<=s;f++)f!==d&&a.push(f);d>=0&&a.push(d),this._thumbnailRender.selectedIndexes=a}else{var l=this.imageLayout,u=l.columnsCount,c=l.rowsCount;if(1===u&&1===c){var h=this._thumbnailRender.getTargetDom(e);this._thumbnailRender.selectThumb(h)}}else{var d;if(void 0===(d=i.slice(0).pop()))this._thumbnailRender.selectedIndexes.push(t);else{var p=[];if(d<t)for(var f=t;f>=d;f--)p.push(f);else for(var g=t;g<=d;g++)p.push(g);this._thumbnailRender.selectedIndexes=p}}else{var m=i.indexOf(t);if(-1===m)this._thumbnailRender.selectedIndexes.push(t);else{if(!(this._thumbnailRender.selectedIndexes.length>1))return!1;this._thumbnailRender.selectedIndexes.splice(m,1)}}return this.selectImageByIndexes(),r.default.id("contextMenu"+this.postfix).classList.add("DVS_nodisplay"),!0},t.prototype.selectImageByIndexes=function(t){var e,i=this._thumbnailRender;e=t||i.selectedIndexes,this.emit("_onSetSelectedIndexes",e)},t.prototype.thumbnailScroll=function(){var t=r.default.id("contextMenu"+this.postfix);t&&t.classList.add("DVS_nodisplay");var e=this._getTopImageIndex();if(e>=0&&e!==this._topImageIndex){if(this._topImageIndex=e,this._thumbnailRender.isdrag)return!1;this.emit("topImageChange",e,!0)}},t.prototype.thumbnailWheelScroll=function(t){var e=r.default.id("thumbLists"+this.postfix);if(!e)return!1;if("row"===e.style.flexDirection){if(e.scrollHeight<=e.clientHeight)return!1;r.default.animation(e,"scrollTop",e.scrollTop+t.deltaY,100)}else{if(e.scrollWidth<=e.clientWidth)return!1;e.scrollLeft+=t.deltaX}},t.prototype._getTopImageIndex=function(){var t=r.default.id("thumbLists"+this.postfix);if(!t)return-1;var e=t.children;if(t.scrollWidth<=t.clientWidth&&t.scrollHeight<=t.clientHeight)return-1;if(e.length){var i=e[0].getBoundingClientRect(),n=this.imageLayout,o=n.rowsCount,s=n.columnsCount,a=n.isrow,l=parseInt(this.viewer.uiConfig.thumbnail.imageSpace);1===o&&1===s&&(l=0);var u=void 0;if(a){var c=t.scrollTop;u=Math.floor((c+1)/(i.height+l))*s}else{var h=t.scrollLeft;u=Math.floor((h+1)/(i.width+l))*o}return u}return-1},t.prototype.preventRepeat=function(t){},t.prototype.scrollTo=function(t){if(!r.default.isNumber(t)||t<0)return!1;var e=r.default.id("thumbLists"+this.postfix);if(!e||!e.children||!e.children.length)return!1;if(t>e.children.length-1)return!1;if(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth){var i=e.getBoundingClientRect(),n=e.children[t].getBoundingClientRect(),o=this.imageLayout,s=o.rowsCount,a=o.columnsCount,l=o.isrow,u=this.viewer.uiConfig.thumbnail.imageSpace;1===Math.abs(s)&&1===Math.abs(a)&&(u=0);var c=n.height+u,h=n.width+u,d=void 0,p=void 0;l?i.top>=n.top?d=c*Math.floor(t/a):i.bottom<=n.bottom&&(d=c*Math.floor(t/a-s+1)):i.left>=n.left?p=h*Math.floor(t/s):i.right<=n.right&&(p=h*Math.floor(t/s-a+1)),null!=d&&(e.scrollTop=d),null!=p&&(e.scrollLeft=p);var f=this._getTopImageIndex();if(f>=0&&f!==this._topImageIndex){if(this._topImageIndex=f,this._thumbnailRender.isdrag)return!1;this.emit("topImageChange",f,!1)}return!0}},t.prototype.scrollToWithoutChange=function(t){if(this.scrollTo(t)){var e=this._getTopImageIndex();return e>=0&&e!==this._topImageIndex&&(this._topImageIndex=e),!0}return!1},t.prototype.selectImageByKey=function(t){if(!r.default.id("thumbLists"+this.postfix))return!1;if(!this._totalImageIndex)return!1;var e=this.imageLayout,i=e.isrow,n=e.columnsCount,o=e.rowsCount;if(38===t.keyCode)i?(s=this._currentImageIndex-n)>=0&&this.goToPage(s):this.prevPage();else if(40===t.keyCode){if(i)(s=this._currentImageIndex+n)<this._totalImageIndex&&this.goToPage(s);else this.nextPage()}else if(37===t.keyCode){if(i)this.prevPage();else(s=this._currentImageIndex-o)>=0&&this.goToPage(s)}else if(39===t.keyCode){var s;if(i)this.nextPage();else(s=this._currentImageIndex+o)<this._totalImageIndex&&this.goToPage(s)}r.default.preventDefault(t)},t.prototype.changeMargin=function(t){return this.viewer.uiConfig.thumbnail.imageSpace=t,this.setViewMode()},t.prototype.setViewMode=function(t,e){var i=this;try{var n=r.default.id("thumbLists"+this.postfix),o=this._thumbnailRender.thumbnailConfig.imageSpace;t<0&&e>0?(t=-t,n.style.flexDirection="row",n.style.overflowX="hidden",n.style.overflowY="auto",this.imageLayout.isrow=!0,this.viewer.uiConfig.thumbnail.imageDirection="row"):t>0&&e<0&&(e=-e,n.style.flexDirection="column",n.style.overflowX="auto",n.style.overflowY="hidden",this.imageLayout.isrow=!1,this.viewer.uiConfig.thumbnail.imageDirection="column"),t>0&&e>0?(this.imageLayout.rowsCount=e,this.imageLayout.columnsCount=t):(e=this.imageLayout.rowsCount,t=this.imageLayout.columnsCount),this.viewer.uiConfig.thumbnail.imageSpace=o,o*(t+1)>n.clientWidth-10&&(o=n.clientWidth/(t+1)-5),o*(e+1)>n.clientHeight-10&&(o=n.clientHeight/(e+1)-5),o=o>0?o:0,1===Math.abs(t)&&1===Math.abs(e)&&(o=0);var s="calc("+(100/t).toFixed(1)+"% - "+o+"px)",a="calc("+(100/e).toFixed(1)+"% - "+o+"px)";if(this._thumbnailRender.imageInfo={width:"calc("+(100/t).toFixed(1)+"% - "+(t+1)/t*o+"px)",height:"calc("+(100/e).toFixed(1)+"% - "+(e+1)/e*o+"px)",oldWidth:s,oldHeight:a},n&&n.children.length){var l=r.default.arrayFrom(n.children);this.imageLayout.isrow;l.forEach((function(t){t.style.width=s,t.style.height=a,t.style.margin="0 "+o+"px "+o+"px 0",t.style.cursor=i.viewer.uiConfig.thumbnail.mouseShape,n.style.padding=o+"px 0 0 "+o+"px"})),this._thumbnailRender.getPagerSize()}var u=this._thumbnailRender.selectedIndexes.slice(0).pop();return this.scrollToWithoutChange(u),this._thumbnailRender.selectThumbByIndex(),n.classList.toggle("fixIE"),!0}catch(t){return!1}},t.prototype.thumbnailZoomIn=function(){var t=this.imageLayout,e=t.rowsCount,i=t.columnsCount;e>1&&e--,i>1&&i--,this.imageLayout.rowsCount=e,this.imageLayout.columnsCount=i,this.setViewMode()},t.prototype.thumbnailZoomOut=function(){var t=this.imageLayout,e=t.rowsCount,i=t.columnsCount;e<10&&e++,i<10&&i++,this.imageLayout.rowsCount=e,this.imageLayout.columnsCount=i,this.setViewMode()},t.prototype._imageSelected=function(t){if(r.default.isArray(t)){var e=this._thumbnailRender;e.selectedIndexes=t,e.selectThumbByIndex(t)}},t.prototype._onRefreshThumb=function(t){r.default.id("thumbLists"+this.postfix)&&(this._thumbnailRender.updataContent(t),this.setViewMode())},t.prototype._onTopImageChange=function(t){"single"===this._thumbnailRender.viewMode&&this.selectImageByIndexes([t])},t.prototype.nextPage=function(){this.emit("_onNextPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},t.prototype.prevPage=function(){this.emit("_onPreviousPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},t.prototype.homePage=function(){this.emit("_onFirstPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},t.prototype.endPage=function(){this.emit("_onLastPage"),this._currentImageIndex<this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},t.prototype.goToPage=function(t){this.emit("_onGotoPage",t),this._totalImageIndex&&this.scrollTo(this._currentImageIndex)},t.prototype.changePageEvent=function(t){var e=parseInt(t.target.value);e=e>0?e:0,this.emit("pageChange",e)},t.prototype.pageChange=function(t){var e=t-1;this.goToPage(e),this.scrollTo(e)},t.prototype._onRefreshPage=function(t){var e=r.default.id("pageInput"+this.postfix),i=r.default.id("pageLabel"+this.postfix),n=t.currentPage,o=t.totalPages;this._currentImageIndex=n,this._totalImageIndex=o;var s=o?n+1:0;if(e&&i){e.value=s,i.innerText=o,e.style.fontSize="16px";var a=16*String(o).length+"px";e.style.width=a}this._cropRender.clearEditBoxes()},t.prototype._canvasScroll=function(){var t=r.default.id("outer"+this.postfix),e=t.scrollLeft,i=t.scrollTop;this.emit("_onCanvasScroll",{left:e,top:i})},t.prototype._canvasZoomIn=function(){this.emit("_onZoomIn")},t.prototype._canvasZoomOut=function(){this.emit("_onZoomOUt")},t.prototype.setOuterScroll=function(t,e){return this._scrollRender.setScroller(t,e)},t.prototype.showContextMenu=function(t,e){if(t){var i=r.default.id("contextMenu"+this.postfix),n=r.default.id("WebViewer"+this.postfix).getBoundingClientRect();i.classList.remove("DVS_nodisplay");var o=i.getBoundingClientRect();return i.DVS_activeIndex=r.default.getIndex(t),i.style.left=e.clientX-n.left+"px",o.height+e.clientY<n.bottom?(i.style.top=e.clientY-n.top+"px",i.style.bottom=null):(i.style.bottom=n.bottom-e.clientY+"px",i.style.top=null,e.clientY-o.height<n.top&&(i.style.top="0px",i.style.bottom=null)),i}return!1},t.prototype.contextTree=function(t){var e=this._directoryRender.getTargetDom(t);e&&!e.classList.contains("backTree")&&(this.generateContextTree(),this.showContextMenu(e,t))},t.prototype.contextTag=function(t){var e=this._tagRender.getTargetDom(t);e&&!e.classList.contains("defaultTag")&&(this.generateContextTag(),this.showContextMenu(e,t))},t.prototype.contextThumb=function(t,e){if(this._thumbnailRender.isdrag)return!1;var i=this._thumbnailRender.getTargetDom(e);if(i){var n=r.default.id("contextMenu"+this.postfix),o=this._tagRender.tagList;this.generateContextThumbnail(),this.showContextMenu(i,e);var s=r.default.id("nextMenu"+this.postfix);s&&(o.length>1?s.classList.remove("DVS_nodisplay"):s.classList.add("DVS_nodisplay"),n.DVS_tags=i.DVS_tags,n.DVS_uid=i.DVS_uid,this.generateEditTags())}},t.prototype.showEditTag=function(t){if(t.target.classList.contains("changeTagLi")){var e=r.default.id("nextMenu"+this.postfix);if(e){var i=r.default.id("editTags"+this.postfix);if(!i||e.classList.contains("DVS_nodisplay"))return!1;i.style.top="-1px",i.classList.remove("DVS_nodisplay");var n=i.getBoundingClientRect(),o=r.default.id("WebViewer"+this.postfix).getBoundingClientRect();n.height>o.height&&(i.style.height=o.height+"px",n=i.getBoundingClientRect()),n.bottom>o.bottom&&(i.style.top=o.bottom-n.bottom+"px")}r.default.stopBubble(t)}},t.prototype.hideEditTag=function(t){t.target.classList.contains("changeTagLi")&&r.default.id("editTags"+this.postfix).classList.add("DVS_nodisplay")},t.prototype.toggleSelectedTag=function(t){var e=null;if(t.target.parentNode.classList.contains("editTags")?e=t.target:t.target.parentNode.parentNode.classList.contains("editTags")?e=t.target.parentNode:t.target.classList.contains("changeTagLi")&&r.default.stopBubble(t),e){var i=!e.children[0].classList.toggle("DVS_hidden"),n=r.default.id("contextMenu"+this.postfix).DVS_uid,o=e.children[1].innerText;i?this.emit("_onAddImageTag",n,o):this.emit("_onRemoveImageTag",n,o),r.default.stopBubble(t)}},t.prototype.generateEditTags=function(){for(var t="",e=this._tagRender.tagList.map((function(t){return t.name})),i=r.default.id("contextMenu"+this.postfix).DVS_tags,n=0,o=e.length;n<o;n++)t+='<li>\n                <div class="iconfont icon-confire '+(-1===i.indexOf(e[n])?"DVS_hidden":"")+'" > </div>\n                <span> '+e[n]+" </span>\n                </li>";r.default.id("editTags"+this.postfix).innerHTML=t},t.prototype.hideContextMenu=function(){r.default.hiddenByQuery("#contextMenu"+this.postfix)},t.prototype.removeTag=function(t){if(t.target.classList.contains("removeTagBtn")){var e=r.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=r.default.id("tagLists"+this.postfix).children[e].dvs_name;this.emit("_onRemoveTag",i)}},t.prototype.emptyTag=function(t){if(t.target.classList.contains("emptyTagBtn")){var e=r.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=r.default.id("tagLists"+this.postfix).children[e].dvs_name;this.emit("_onEmptyTag",i)}},t.prototype.removeFile=function(t){var e=t.target;if(!e)return!1;if(e.classList.contains("removeFileBtn")){var i=r.default.id("contextMenu"+this.postfix).DVS_activeIndex,n=r.default.id("treeLists"+this.postfix).children[i];if(!n)return!1;var o=n.children[1].innerText,s=n.dvs_type;if("folder"===s)this.emit("_onRemoveFolder",o);else{if("file"!==s)return!1;this.emit("_onRemoveFile",o)}}},t.prototype.removeImage=function(t){try{if(t.target.classList.contains("removeImageBtn")){var e=r.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=this._thumbnailRender.selectedIndexes,n=void 0;n=-1!==i.indexOf(e)?i:[e],this.emit("_onRemove",n)}}catch(t){this._throwErr(d.ELEMENT_NOT_EXIST)}},t.prototype.removeAllImage=function(t){try{t.target.classList.contains("removeAllImageBtn")&&this.emit("_onRemoveAll")}catch(t){this._throwErr(d.ELEMENT_NOT_EXIST)}},t.prototype.copyImage=function(t){try{if(t.target.classList.contains("copyImageBtn")){var e=r.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=this._thumbnailRender.selectedIndexes,n=void 0;n=-1!==i.indexOf(e)?i:[e],this.emit("_thumbnailCopy",n)}}catch(t){this._throwErr(d.ELEMENT_NOT_EXIST)}},t.prototype.insertImgaeBefore=function(t){try{if(t.target.classList.contains("insertBeforeBtn")){var e=r.default.id("contextMenu"+this.postfix).DVS_activeIndex;this.emit("_insertBefore",e)}}catch(t){this._throwErr(d.ELEMENT_NOT_EXIST)}},t.prototype.insertImageAfter=function(t){try{if(t.target.classList.contains("insertAfterBtn")){var e=r.default.id("contextMenu"+this.postfix).DVS_activeIndex;this.emit("_insertAfter",e)}}catch(t){this._throwErr(d.ELEMENT_NOT_EXIST)}},t.prototype.generateContextTree=function(){var t=r.default.id("contextMenu"+this.postfix);"tree"!==this._contextType&&(this._contextType="tree",t.innerHTML="\n        <li>Copy</li>\n        <li>Cut</li>\n        <li>Paste</li>\n        <li class='removeFileBtn'>Remove</li>\n        <li class='renameFileBtn'>Rename</li>")},t.prototype.generateContextTag=function(){var t=r.default.id("contextMenu"+this.postfix);"tag"!==this._contextType&&(this._contextType="tag",t.innerHTML="\n        <li class='emptyTagBtn'>Empty</li>\n        <li class='renameTagBtn'>Rename</li>\n        <li class='removeTagBtn'>Remove</li>")},t.prototype.generateContextThumbnail=function(){var t=r.default.id("contextMenu"+this.postfix);"thumbnail"!==this._contextType&&(this._contextType="thumbnail",t.innerHTML="  \n        <li class='copyImageBtn'>Copy</li>\n        <li>Cut</li>\n        <li class='changeTagLi "+(this.viewer.uiConfig.tag.visibility?"":"DVS_disabled")+"'>\n            Tag\n            <div id='nextMenu"+this.postfix+"' class=\"iconfont icon-pageNext nextMenu\"></div>\n            <ul id='editTags"+this.postfix+"' class='editTags DVS_nodisplay'></ul>\n\n        </li>\n        <li class='insertBeforeBtn'>Insert Before</li>\n        <li class='insertAfterBtn'>Insert After</li>\n        <li class='removeImageBtn'>Remove</li>\n        <li class='removeAllImageBtn'>RemoveAll</li>")},t.prototype.tabChange=function(t){if("DIV"===t.target.tagName){var e=r.default.getIndex(t.target.parentNode);this._selectTab(e),t.target.parentNode.classList.add("activeTab");for(var i=r.default.id("paneShow"+this.postfix).children,n=0;n<i.length;n++)r.default.hiddenByDom(i[n]),n===e&&r.default.toggleDisplayByDom(i[n])}this.hideContextMenu(),r.default.stopBubble(t)},t.prototype._selectTab=function(t){for(var e=r.default.id("navChange"+this.postfix).children,i=r.default.id("besides"+this.postfix),n=!1,o=0,s=e.length;o<s;o++)o===t?(e[o].classList.add("activeTab"),n=!0):e[o].classList.remove("activeTab");return n?i.classList.remove("DVS_hiddenBesides"):i.classList.add("DVS_hiddenBesides"),!0},t.prototype.styleChange=function(){Window;var t=r.default.id("WebViewer"+this.postfix);if(!t)return!1;t.clientWidth,t.clientHeight;var e=r.default.id("topMenu"+this.postfix),i=r.default.id("topMenuRight"+this.postfix);this.viewer.uiConfig.buttonResize.ifResize&&(r.default.isMobile()||this.viewer.changeButtonSize(),t.classList.add("DWT_imageEditor")),i&&(e.style.paddingRight=i.getBoundingClientRect().width+"px"),this.setViewMode(),this._clearCropBoxes(),this._thumbnailRender.getPagerSize(),this._updateVideoSize(),this._sendThumbnailRect(),this.emit("_onCanvasResize"),this.emit("_onSendCropLimitArea")},t.prototype._throwErr=function(t,e){this.emit("dvs_error",t)},t.prototype._ok=function(){this.emit("dvs_error",d.OK)},t.prototype._windowResize=function(){r.default.stable(this.styleChange.bind(this),50,!1)(),this._cropRender.clearEditBoxes()},t.prototype._documentMouseUp=function(t){if(!r.default.id("WebViewer"+this.postfix))return!1;if(t.button&&0!==t.button)return!1;if(this._imageAreaSelected(t),this._thumbnailRender.cropItem&&this._thumbnailRender.cropItem._imageAreaSelected(t),t.changedTouches){var e=t.changedTouches[0];this.dragThumbUpMobile(e)}else{var i=r.default.id("stretchBar"+this.postfix),n=r.default.id("thumbnailStretchBarRight"+this.postfix);if(i&&i.classList.contains("DVS_streching")&&(this._thumbnailRender.stretchMouseUp(),this.styleChange()),n&&n.classList.contains("DVS_streching")){this._thumbnailRender.thumbnailStretchRightEnd();var o=r.default.id("Thumbnail"+this.postfix);o&&(this.viewer.thumbnailWidth=o.clientWidth),this.styleChange()}this.dragThumbUp(t)}},Object.defineProperty(t.prototype,"isMobile",{get:function(){return this._isMobile},set:function(t){var e=r.default.id("WebViewer"+this.postfix),i=r.default.id("stretchBar"+this.postfix),n=r.default.id("viewChange"+this.postfix),o=r.default.id("bottomMenu"+this.postfix),s=r.default.id("header"+this.postfix),a=r.default.id("loadImageBtn"+this.postfix),l=r.default.id("Thumbnail"+this.postfix),u=this.imageLayout.columnsCount,c=this.imageLayout.rowsCount;t!==this._isMobile&&(t?(e.classList.add("DVS_viewerMobile"),i.classList.add("DVS_nodisplay"),o&&n&&o.lastChild&&o.insertBefore(n,o.lastChild),n.scrollLeft=n.scrollWidth-80,a.innerText="Upload",this._selectTab(-1),this.setViewMode(c,-u),l.style.width=null,r.default.id("besides"+this.postfix).style.width="199px"):(e.classList.remove("DVS_viewerMobile"),i.classList.remove("DVS_nodisplay"),s&&n&&s.appendChild(n),a.innerText="Upload File",this._selectTab(0),this.setViewMode(-c,u),this.viewer.setThumbnailWidth(this.viewer.thumbnailWidth)),this._isMobile=t,this.emit("_onCanvasResize"))},enumerable:!0,configurable:!0}),t.prototype.switchThumbnailDirection=function(t,e){var i=r.default.id("showImageArea"+this.postfix),n=r.default.id("Thumbnail"+this.postfix);if(!i||!n)return this._throwErr(d.ELEMENT_NOT_EXIST),!1;if(this.viewer.uiConfig.thumbnail.direction!==t){var o=this.imageLayout,s=o.rowsCount,a=o.columnsCount;if("row"===t)i.style.flexDirection="row",this.setViewMode(-a,s);else{if("column"!==t)return this._throwErr(d.PARAMETER_RANGE),!1;i.style.flexDirection="column",n.style.width=null,this.setViewMode(a,-s)}this.viewer.uiConfig.thumbnail.direction=t}return void 0!==e&&(n.style.order=e,this.viewer.uiConfig.thumbnail.sequence=e),!0},t.prototype._onOpenAll=function(){this.emit("_onOpenAll")},t.prototype.getTabItem=function(t){this._tabItem=t,this._thumbnailRender.tabItem=t},t.prototype._onSave=function(){r.default.id("saveSettingBox"+this.postfix).classList.toggle("DVS_nodisplay")},t.prototype.togglePaneBox=function(){r.default.toggleDisplayByQuery("#navigationPane"+this.postfix,!0)},t.prototype.toggleThumbnail=function(){this.viewer.toggleMainContent("Thumbnail"+this.postfix),this.styleChange()},t.prototype.updateVideoContainer=function(t){var e=this,i=r.default.id("videoImage"+this.postfix);return i?(i.src=t,i.onload=function(){e._videoSize&&e._videoSize.imageWidth===i.naturalWidth&&e._videoSize.imageHeight===i.naturalHeight&&e._videoSize.imageBoxWidth===i.width&&e._videoSize.imageBoxHeight===i.height||(e._videoSize={imageWidth:i.naturalWidth,imageHeight:i.naturalHeight,imageBoxWidth:i.width,imageBoxHeight:i.height},e._updateVideoSize())},i.onerror=function(t){e._throwErr(d.URL_INVALID,"updateVideoContainer")},!0):(this._throwErr(d.ELEMENT_NOT_EXIST,"updateVideoContainer"),!1)},t.prototype._updateVideoSize=function(){if(this._videoSize){var t=r.default.id("videoContainer"+this.postfix),e=r.default.id("videoImage"+this.postfix),i=t.clientWidth,n=t.clientHeight,o=this._videoSize,s=o.imageWidth,a=o.imageHeight;if(i/s-1<n/a-1){var l=i/s;e.style.width=i+"px",e.style.height=a*l+"px"}else{l=n/a;e.style.width=s*l+"px",e.style.height=n+"px"}}},t.prototype._onSetOperationMode=function(t){if(1===t)this._cropRender.isCrop=!0,this.emit("_onCanvasResize"),this.emit("_onSendCropLimitArea"),this._thumbnailRender.isCropMode=!0;else{var e=this._thumbnailRender.selectedIndexes.slice(0).pop(),i=this._cropRender.cropBoxes;i&&i.length>0&&this.emit("imageAreaUnselected",e),this._cropRender.isCrop=!1,this._thumbnailRender.isCropMode=!1}this._thumbnailRender.selectThumbByIndex()},t.prototype._onGetCropLimitArea=function(t){this._cropRender.limitArea=t},t.prototype._changeCanvasSize=function(t){this._scrollRender.getImageSize(t)&&this.emit("_onCanvasResize")},t.prototype.getRemoveIndexes=function(t){if(0===t.length)return this.emit("topImageChange",-1,!1),!0;var e=this._getTopImageIndex();return e=e<0?0:e,this._topImageIndex=e,this.emit("topImageChange",e,!1),!0},t.prototype.sendThumbnailConfig=function(){this._thumbnailRender.thumbnailConfig=this.viewer.uiConfig.thumbnail},t.prototype._clearCropBoxes=function(){this._cropRender.clearEditBoxes();var t=this._thumbnailRender.cropItem;t&&t.clearEditBoxes()},t}();e.UiEventControl=p},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(0)),s=o(i(4)),a=function(){function t(t,e){this._pubSub=e,this.postfix=t,this.tagInit()}return t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},t.prototype.getTargetDom=function(t){var e;if("SPAN"===t.target.tagName?e=t.target.parentNode:"LI"===t.target.tagName&&(e=t.target),e&&!e.classList.contains("createBox"))return e},t.prototype.updateTagList=function(t){r.default.isArray(t)||(t=[]),this.tagList=t;for(var e=[],i=0,n=t.length;i<n;i++){var o=t[i].name,a=s.default.createVnode("LI",{dvs_name:o,key:t[i].tagId},[s.default.createVnode("SPAN",{},[],null,o),s.default.createVnode("DIV",{className:"editDelBox  DVS_nodisplay"},[s.default.createVnode("DIV",{className:"DVS_quickEdit icon-pencil iconfont"}),s.default.createVnode("DIV",{className:"DVS_quickDel icon-delete iconfont"})])]);e.push(a)}var l=r.default.id("tagLists"+this.postfix),u=s.default.createVnode("UL",{},e,l);this.content=s.default.patch(this.content,u),this.bindHoverEvent()},t.prototype.addNewTag=function(t){var e=s.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix},[s.default.createVnode("INPUT",{id:"tagInput"+this.postfix}),s.default.createVnode("DIV",{className:"judgeBox"},[s.default.createVnode("DIV",{className:"confirmTag iconfont icon-confire"}),s.default.createVnode("DIV",{className:"cancelTag iconfont icon-cancle"})])]);s.default.addOneVnode(this.content,0,e),r.default.id("tagInput"+this.postfix).focus(),t.target.style.pointerEvents="none",r.default.stopBubble(t)},t.prototype.renameTag=function(t){if(t.target.classList.contains("renameTagBtn")){var e=r.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=r.default.id("tagLists"+this.postfix).children[e].children[0].innerText,n=r.default.deepClone(this.content),o=s.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix,dvs_oldName:i},[s.default.createVnode("INPUT",{id:"tagInput"+this.postfix,value:i}),s.default.createVnode("DIV",{className:"judgeBox"},[s.default.createVnode("DIV",{className:"renameConfireTag iconfont icon-confire"}),s.default.createVnode("DIV",{className:"cancelTag iconfont icon-cancle"})])]);n.children.splice(e,1,o),this.content=s.default.patch(this.content,n);var a=r.default.id("tagInput"+this.postfix);a.focus(),a.select()}},t.prototype.quickRenameTag=function(t){var e=t.target;if(e&&e.classList.contains("DVS_quickEdit")){var i=e.parentNode.parentNode;if(!i)return!1;var n=i.dvs_name,o=r.default.getIndex(i),a=r.default.deepClone(this.content),l=s.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix,dvs_oldName:n},[s.default.createVnode("INPUT",{id:"tagInput"+this.postfix,value:n}),s.default.createVnode("DIV",{className:"judgeBox"},[s.default.createVnode("DIV",{className:"renameConfireTag iconfont icon-confire"}),s.default.createVnode("DIV",{className:"cancelTag iconfont icon-cancle"})])]);a.children.splice(o,1,l),this.content=s.default.patch(this.content,a);var u=r.default.id("tagInput"+this.postfix);u.focus(),u.select()}},t.prototype.quickDelTag=function(t){var e=t.target;if(e&&e.classList.contains("DVS_quickDel")){var i=e.parentNode.parentNode;if(!i)return!1;var n=i.dvs_name;this.emit("_onRemoveTag",n)}},t.prototype.selectTagByName=function(t){var e=this;Array.from(r.default.id("tagLists"+this.postfix).children).forEach((function(i){i.children[0].innerText===t?(i.classList.add("DVS_activeTag"),i.children[1].classList.remove("DVS_nodisplay"),r.default.id("defaultTag"+e.postfix).classList.remove("DVS_activeAllImage")):(i.classList.remove("DVS_activeTag"),i.children[1].classList.add("DVS_nodisplay"))}))},t.prototype.confirmTag=function(t){var e=t.target.parentNode.parentNode.children[0].value;if(""!==e)return r.default.id("addTag"+this.postfix).style.pointerEvents="auto",{tagName:e};alert("The tag name can not be empty!")},t.prototype.bindHoverEvent=function(){var t=r.default.id("tagLists"+this.postfix);if(!t)return!1;var e=t.children;if(e&&e.length)for(var i=function(t){var i=e[t],n=i.children[1];i.onmouseenter=function(t){n.classList.remove("DVS_nodisplay")},i.onmouseleave=function(t){i.classList.contains("DVS_activeTag")||n.classList.add("DVS_nodisplay")}},n=0;n<e.length;n++)i(n)},t.prototype.addEventTag=function(){},t.prototype.tagInit=function(){var t=r.default.id("tagLists"+this.postfix);this.content=s.default.createVnode("UL",{className:"tagLists",id:"tagLists"+this.postfix},[],t)},t}();e.TagRender=a},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)),r=function(){function t(t,e,i,n,o){return this.createVNode(t,e,i,n,o)}return t.prototype.createVNode=function(t,e,i,n,o){void 0===e&&(e={}),void 0===i&&(i=[]),void 0===n&&(n=null),void 0===o&&(o="");var r={el:n,tagName:t,sel:"",data:e,children:i,text:o};return this._updateVNode(r)},t.prototype._updateVNode=function(t){var e=this;if(o.default.isObject(t.data)||(t.data={}),o.default.isArray(t.children)||(t.children=[]),t.el){for(var i=[],n=t.el.childNodes,r=0,s=n.length;r<s;r++)3===n[r].nodeType&&i.push(n[r].nodeValue);t.text=i.join("")}else{var a=document.createElement(t.tagName);t.el=a,a.textContent=t.text}if(t.el){var l=(a=t.el).classList,u=a.id,c=a.tagName;if(u)c+="#"+u,t.sel=c;else if(l.length){for(var h=0;h<l.length;h++)c+="."+l[h];t.sel=c}}return t.children.forEach((function(t){return e._updateVNode(t)})),t},t}();e.VNode=r},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(0)),s=o(i(4)),a=i(32),l=function(){function t(t,e,i,n){this._isThumbnailMove=!1,this.cropIndex=-1,this.isCropMode=!1,this.fullThumbnail=!1,this.thumbMoveOption={napX:0,napY:0,target:null},this._tabItemChange=!1,this.selectedIndexes=[],this.thumbnailContent=[],this.postfix=e,this._pubSub=i,this.imageLayout=n,this.cropItem=null,this.cropRatio={ratio:0},this.thumbnailConfig=t,this.thumbnailInit(),this.ismoving=!1,this.isdrag=!1,this.needClick=!0,this.isClick=!0,this.viewMode="single",this.selectedIndexes=[],this.updataContent(),this.on("_onGetMiniImgSize",this._getImageSize)}return t.prototype.on=function(t,e){this._pubSub.on(t,e.bind(this))},t.prototype.off=function(t,e){this._pubSub.off(t,e)},t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},t.prototype.preventAllCrop=function(){this.cropItem&&this.cropItem.preventCrop()},t.prototype.getTargetDom=function(t){var e;if(t.target.classList.contains("DVS_thumbnailCropArea"))return!1;var i=t.target.parentNode;if(i&&i.classList&&i.classList.contains("thumbLists"))e=t.target;else{if(!(i.parentNode&&i.parentNode.classList&&i.parentNode.classList.contains("thumbLists")))return!1;e=i}return!e.classList.contains("DVS_replaceBlock")&&e},t.prototype.getImageItem=function(t){var e,i=t.target.parentNode;if(i&&i.classList&&i.classList.contains("thumbLists"))e=t.target;else{if(!(i.parentNode&&i.parentNode.classList&&i.parentNode.classList.contains("thumbLists")))return!1;e=i}return!e.classList.contains("DVS_replaceBlock")&&e},t.prototype._getImageSize=function(t){if(this.cropItem){var e=this.selectedIndexes.slice(0).pop();if(r.default.isNumber(e)&&e>=0){var i=t.width,n=t.height;0!==i&&0!==n&&(this.cropItem.naturalImageSize=t)}}},t.prototype.getPagerSize=function(){var t=r.default.id("thumbLists"+this.postfix);if(t&&t.children.length){var e=t.children,i=t.children[0].getBoundingClientRect(),n=i.width<i.height?i.width:i.height;this.pageSize=n/5;for(var o=0;o<e.length;o++){var s=e[o],a=s.children[0],l=s.children[1],u=n/5;u=(u=u>40?40:u)<20?20:u,a.style.fontSize=u/2+"px",a.style.width=u+"px",a.style.height=u+"px",l.style.fontSize=2*u/3+"px",l.style.width=2*u/3+"px",l.style.height=2*u/3+"px"}}},Object.defineProperty(t.prototype,"tabItem",{get:function(){return this._tabItem},set:function(t){this._tabItem=t,this._tabItemChange=!0},enumerable:!0,configurable:!0}),t.prototype.enterMutipleMode=function(){r.default.id("thumbControl"+this.postfix).classList.add("DVS_nodisplay"),r.default.id("mutiControl"+this.postfix).classList.remove("DVS_nodisplay"),this.viewMode="mutiple"},t.prototype.exitMutipleMode=function(){r.default.id("thumbControl"+this.postfix).classList.remove("DVS_nodisplay"),r.default.id("mutiControl"+this.postfix).classList.add("DVS_nodisplay"),this.viewMode="single"},t.prototype.selectAllImage=function(){for(var t=r.default.id("thumbLists"+this.postfix).children,e=!0,i=0,n=t.length;i<n;i++)if(!t[i].classList.contains("DVS_activeThumb")){e=!1;break}this.selectedIndexes=[];for(i=0,n=t.length;i<n;i++)e?t[i].classList.remove("DVS_activeThumb"):(t[i].classList.add("DVS_activeThumb"),this.selectedIndexes.push(i))},t.prototype.tagImage=function(t){var e=r.default.id("existTag"+this.postfix);e.insertBefore(t,e.children[0])},t.prototype.removeImageTag=function(t){var e=r.default.id("availTag"+this.postfix);e.insertBefore(t,e.children[0])},t.prototype.updataContent=function(t){void 0===t&&(t=[]);var e=r.default.id("thumbLists"+this.postfix);if(!e)return!1;(this._tabItemChange||0===this.thumbnailContent.length)&&(this._tabItemChange=!1,this.isTopImageChange(t));var i=[];t.forEach((function(t,e){var n=s.default.createVnode("LI",{DVS_tags:t.tags,DVS_uid:t.uid,DVS_defaultIndex:e,key:t.uid},[s.default.createVnode("DIV",{className:"thumbPage"},[],null,e+1),s.default.createVnode("DIV",{className:"iconfont icon-unselected"},[])]),o=s.default.createVnode("IMG",{src:t.data},[]),r=o.el;r&&(r.setAttribute("width","auto"),r.setAttribute("height","auto")),n.children.push(o),i.push(n)}));var n=s.default.createVnode("UL",{},i,e);this.content=s.default.patch(this.content,n),this.thumbnailContent=t},t.prototype.isTopImageChange=function(t){var e=this.imageLayout;e.rowsCount,e.columnsCount;t.length>0&&this.emit("topImageChange",0)},t.prototype.selectThumb=function(t){if(t){var e=r.default.getIndex(t);if("single"===this.viewMode)this.selectedIndexes=[e];else if("mutiple"===this.viewMode)if(t.classList.contains("DVS_activeThumb")){var i=this.selectedIndexes.indexOf(e);-1!==i&&this.selectedIndexes.splice(i,1)}else this.selectedIndexes.push(e);return this.selectedIndexes.slice(0)}},t.prototype.selectThumbByIndex=function(t){t||(t=this.selectedIndexes);var e=r.default.id("thumbLists"+this.postfix);if(!e)return!1;var i=e.children;this.clearAbsolute();var n=i.length;if(i&&n){for(var o=!1,s=0;s<n;s++){var l=i[s],u=l.children[3];if(-1!==t.indexOf(s)){if(l.classList.add("DVS_activeThumb"),l.children&&l.children[1])(p=l.children[1]).classList.remove("icon-unselected"),p.classList.add("icon-selected1");l.style.borderColor=this.thumbnailConfig.selectedBorderColor,l.style.backgroundColor=this.thumbnailConfig.selectedBackgroundColor;var c=this.imageLayout,h=c.rowsCount,d=c.columnsCount;1===h&&1===d&&this.isCropMode?(u||(this.cropItem&&this.cropItem.cropBoxes.length&&this.emit("imageAreaUnselected",this.cropIndex),u=document.createElement("div"),this._bindCropEvent(u),l.appendChild(u),this.cropItem=new a.thumbnailCropRender(u,this.postfix,this._pubSub,this.cropRatio),this.cropIndex=s),o=!0):u&&l.removeChild(u)}else{var p;if(u&&l.removeChild(u),l.classList.remove("DVS_activeThumb"),l.children&&l.children[1])(p=l.children[1]).classList.add("icon-unselected"),p.classList.remove("icon-selected1");l.style.borderColor=this.thumbnailConfig.imageBorderColor,l.style.backgroundColor=this.thumbnailConfig.imageBackgroundColor}}o||(this.cropItem=null,this.cropIndex=-1)}},t.prototype._bindCropEvent=function(t){var e=this;t.className="DVS_thumbnailCropArea",t.onclick=function(i){var n=t.parentNode,o=r.default.getIndex(n);e.emit("imageClick",o,i)},t.ondblclick=function(i){var n=t.parentNode,o=r.default.getIndex(n);e.emit("imageDoubleClick",o,i)}},t.prototype.dragThumbnai=function(t){var e=this;if(0!==t.button)return!1;r.default.id("contextMenu"+this.postfix).classList.add("DVS_nodisplay");var i=this.getTargetDom(t);if(!i)return!1;this.isClick=!0;var n=this.imageLayout,o=n.rowsCount,s=n.columnsCount;if(1===o&&1===s)return!1;i.classList.contains("DVS_activeThumb")||(this.selectThumb(i),this.selectThumbByIndex(),this.needClick=!1);var a=r.default.id("thumbLists"+this.postfix),l=i.getBoundingClientRect(),u=t.clientX-l.left,c=t.clientY-l.top;return r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb").forEach((function(t){var i=document.createElement("li");i.className="DVS_replaceBlock",i.style.backgroundColor=e.thumbnailConfig.placeholderBackgroundColor,i.style.margin=t.style.margin,i.style.flexBasis=t.style.flexBasis,i.style.msFlexPreferredSize=t.style.msFlexPreferredSize,i.style.width=t.style.width,i.style.height=t.style.height,a.insertBefore(i,t)})),a.classList.add("hideReplaceBlock"),this.thumbMoveOption={napX:u,napY:c,target:i},this._clickPosition={clickX:t.pageX,clickY:t.pageY},this.isdrag=!0,!0},t.prototype.dragStartMobile=function(t){var e=this;r.default.id("contextMenu"+this.postfix).classList.add("DVS_nodisplay"),t=t.changedTouches[0];var i=this.getTargetDom(t);if(!i)return!1;this.isClick=!0;var n=this.imageLayout,o=n.rowsCount,s=n.columnsCount;return(1!==o||1!==s)&&(this.timer=setTimeout((function(){document.addEventListener("touchmove",r.default.preventDefault,{passive:!1}),i.classList.contains("DVS_activeThumb")||(e.selectThumb(i),e.selectThumbByIndex(),e.needClick=!1);var n=r.default.id("thumbLists"+e.postfix),o=i.getBoundingClientRect(),s=t.clientX-o.left,a=t.clientY-o.top;r.default.queryAll("#thumbLists"+e.postfix+">li.DVS_activeThumb").forEach((function(t){var i=document.createElement("li");i.className="DVS_replaceBlock",i.style.backgroundColor=e.thumbnailConfig.placeholderBackgroundColor,i.style.margin=t.style.margin,i.style.width=t.style.width,i.style.height=t.style.height,n.insertBefore(i,t)})),n.classList.add("hideReplaceBlock"),e.thumbMoveOption={napX:s,napY:a,target:i},e.isdrag=!0,e.isClick=!1}),300),!0)},t.prototype.dragMove=function(t){var e=this;if(this.isdrag){var i=this._clickPosition,n=i.clickX,o=i.clickY,s=t.pageX,a=t.pageY;if(Math.abs(s-n)<15&&Math.abs(a-o)<15)return;this.isClick=!1;var l=r.default.id("thumbLists"+this.postfix),u=l.scrollTop,c=l.scrollLeft,h=this.thumbMoveOption,d=h.napX,p=h.napY,f=h.target.getBoundingClientRect();r.default.queryAll("#thumbLists"+this.postfix+">li:not(.DVS_activeThumb):not(.DVS_replaceBlock)").forEach((function(t){var i=t.getBoundingClientRect(),n=i.left-f.left,o=i.top-f.top;if(Math.abs(n)<=f.width/2&&Math.abs(o)<=f.height/2){var s=r.default.getIndex(t),a=r.default.getIndex(r.default.query("#thumbLists"+e.postfix+">li.DVS_replaceBlock"));return r.default.queryAll("#thumbLists"+e.postfix+">li.DVS_replaceBlock").forEach((function(e){s<a?l.insertBefore(e,t):r.default.insertAfter(e,t)})),l.scrollTop=u,l.scrollLeft=c,!0}}));var g=l.getBoundingClientRect(),m=t.clientY-g.top-p,_=t.clientX-g.left-d+c,v=m+u;l.classList.remove("hideReplaceBlock"),r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb").forEach((function(t,i){t.classList.add("DVS_absolute"),t.style.width=e.imageInfo.width,t.style.height=e.imageInfo.height,t.style.left=_+5*i+"px",t.style.top=v+5*i+"px",t.style.margin=0,t.style.zIndex=1})),r.default.preventDefault(t)}},t.prototype.dragMoveMobile=function(t){var e=this;if(t=t.changedTouches[0],this.isClick=!1,clearTimeout(this.timer),this.isdrag){var i=r.default.id("thumbLists"+this.postfix),n=i.scrollTop,o=i.scrollLeft,s=this.thumbMoveOption,a=s.napX,l=s.napY,u=s.target,c=i.getBoundingClientRect(),h=t.clientY-c.top-l,d=t.clientX-c.left-a+o,p=h+n;i.classList.remove("hideReplaceBlock"),r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb").forEach((function(t,i){t.classList.add("DVS_absolute"),t.style.width=e.imageInfo.width,t.style.height=e.imageInfo.height,t.style.left=d+5*i+"px",t.style.top=p+5*i+"px",t.style.margin=0,t.style.zIndex=1})),r.default.queryAll("#thumbLists"+this.postfix+">li:not(.DVS_activeThumb):not(.DVS_replaceBlock)").forEach((function(t){var o=t.getBoundingClientRect(),s=u.getBoundingClientRect(),a=o.left-s.left,l=o.top-s.top;if(Math.abs(a)<=s.width/2&&Math.abs(l)<=s.height/2){var c=r.default.getIndex(t),h=r.default.getIndex(r.default.query("#thumbLists"+e.postfix+">li.DVS_replaceBlock"));r.default.queryAll("#thumbLists"+e.postfix+">li.DVS_replaceBlock").forEach((function(e){c<h?i.insertBefore(e,t):r.default.insertAfter(e,t)})),i.scrollTop=n}}))}},t.prototype.dragUp=function(t){var e=r.default.id("thumbLists"+this.postfix),i=this.thumbMoveOption.target;if(!i)return!1;if(this.clearAbsolute(),this.thumbMoveOption.target=null,this.isClick)this.needClick?t.ctrlKey||t.shiftKey||t.metaKey||this.selectThumb(i):this.needClick=!0;else{for(var n=this.selectedIndexes.slice(0),o=0;o<e.children.length;o++){var s=e.children[o];if(!s.classList.contains("DVS_replaceBlock")){if(s.classList.contains("DVS_activeThumb")){var a=s.DVS_defaultIndex,l=n.indexOf(a);-1!==l&&(n[l]=o)}s.children[0].innerText=o+1}}this.selectedIndexes=n}return this.isdrag=!1,!this.isClick},t.prototype.dragUpMobile=function(t){document.removeEventListener("touchmove",r.default.preventDefault);var e=r.default.id("thumbLists"+this.postfix),i=this.getTargetDom(t);if(clearTimeout(this.timer),this.clearAbsolute(),this.isClick&&i)this.needClick?this.selectThumb(i):this.needClick=!0;else{for(var n=this.selectedIndexes.slice(0),o=0;o<e.children.length;o++){var s=e.children[o];if(!s.classList.contains("DVS_replaceBlock")){if(s.classList.contains("DVS_activeThumb")){var a=s.DVS_defaultIndex,l=n.indexOf(a);-1!==l&&(n[l]=o)}s.children[0].innerText=o+1}}this.selectedIndexes=n}var u=this.isdrag;return this.isdrag=!1,u},t.prototype.clearAbsolute=function(){var t=this,e=r.default.id("thumbLists"+this.postfix);if(!e)return!1;if(this.isdrag){var i=r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_replaceBlock");if(i.length>0){var n=i[0].style.margin;r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb").forEach((function(o,r){e.insertBefore(o,i[r]),o.style.width=t.imageInfo.oldWidth,o.style.height=t.imageInfo.oldHeight,o.style.margin=n,o.style.zIndex=0})),i.forEach((function(t){e.removeChild(t)}))}}var o=r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_absolute");o.length>0&&o.forEach((function(t){t.classList.remove("DVS_absolute"),t.style.left=null,t.style.top=null}))},t.prototype.getDefaultIndexes=function(){var t=[];return r.default.queryAll("#thumbLists"+this.postfix+">li").forEach((function(e,i){t.push(e.DVS_defaultIndex),e.DVS_defaultIndex=i})),t},t.prototype.changePadding=function(){var t=r.default.id("thumbLists"+this.postfix),e=t.children.length;if(e){var i=t.clientWidth-1,n=t.children[0].getBoundingClientRect().width+2*this.thumbnailConfig.imageSpace,o=i/n,s=Math.floor(o)>e?e:Math.floor(o),a=n*(o-s)/2;a=o>1?a:0,t.style.padding="5px "+a+"px",this.columnsCount=s}},t.prototype.stretchMouseDown=function(t){r.default.id("stretchBar"+this.postfix).classList.add("DVS_streching"),this.ismoving=!0,r.default.preventDefault(t)},t.prototype.stretchMouseMove=function(t){if(this.ismoving){var e=r.default.id("besides"+this.postfix).getBoundingClientRect().left;this.width=t.clientX-e>0?t.clientX-e:0,r.default.id("stretchBar"+this.postfix).style.left=this.width-5+"px",r.default.preventDefault(t)}},t.prototype.stretchMouseUp=function(){if(this.ismoving){var t=r.default.id("stretchBar"+this.postfix);this.ismoving=!1;var e=this.width/r.default.id("body"+this.postfix).clientWidth*100;e=e>100?100:e,this.setSideBarPercent(e),t.style.left=null,t.classList.remove("DVS_streching")}},t.prototype.thumbnailStretchRightStart=function(t){this.fullThumbnail||(r.default.id("thumbnailStretchBarRight"+this.postfix).classList.add("DVS_streching"),this._isThumbnailMove=!0,r.default.preventDefault(t))},t.prototype.thumbnailStretchRightMove=function(t){if(this._isThumbnailMove){var e=r.default.id("Thumbnail"+this.postfix).getBoundingClientRect().left,i=t.clientX-e>0?t.clientX-e:0;r.default.id("thumbnailStretchBarRight"+this.postfix).style.left=i+"px",r.default.preventDefault(t)}},t.prototype.thumbnailStretchRightEnd=function(){if(this._isThumbnailMove){var t=r.default.id("thumbnailStretchBarRight"+this.postfix);this._isThumbnailMove=!1;var e=parseInt(t.style.left)/r.default.id("showImageArea"+this.postfix).clientWidth*100;e=e>100?100:e,this.setThumbnailPercent(e),t.style.left=null,t.classList.remove("DVS_streching")}},t.prototype.setSideBarPercent=function(t){var e=r.default.id("besides"+this.postfix);e.style.flex="0 0 "+t+"%",e.style.msFlex="0 0 "+t+"%",e.style.width=t+"%"},t.prototype.setThumbnailPercent=function(t){var e=r.default.id("Thumbnail"+this.postfix);e.style.flex="0 0 "+t+"%",e.style.msFlex="0 0 "+t+"%",this.cropItem&&this.cropItem.clearEditBoxes()},t.prototype.setHoverColor=function(t){var e=this.getTargetDom(t);e&&(e.classList.contains("DVS_activeThumb")||(e.style.backgroundColor=this.thumbnailConfig.hoverBackgroundColor,e.style.borderColor=this.thumbnailConfig.hoverBorderColor))},t.prototype.setImageColor=function(t){var e=this.getTargetDom(t);e&&(e.classList.contains("DVS_activeThumb")?(e.style.backgroundColor=this.thumbnailConfig.selectedBackgroundColor,e.style.borderColor=this.thumbnailConfig.selectedBorderColor):(e.style.backgroundColor=this.thumbnailConfig.imageBackgroundColor,e.style.borderColor=this.thumbnailConfig.imageBorderColor))},t.prototype.thumbnailInit=function(){var t=r.default.id("thumbLists"+this.postfix);this.content=s.default.createVnode("UL",{style:"backgroundColor='"+this.thumbnailConfig.backgroundColor+"'"},[],t)},t}();e.ThumbnailRender=l},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(0)),s=function(){function t(t,e,i,n){this.cropBoxes=[],this.thumbnailCropRatio={ratio:0},this._dragMoveOption={},this._cropMoveOption={},this.isCropMove=!1,this._isDraging=!1,this._isCroping=!1,this.cropEl=t,this.postfix=e,this._pubSub=i,this.thumbnailCropRatio=n,this._addEvent()}return t.prototype.initCropEditBox=function(){var t=this,e=document.createElement("div");e.className="DVS_cropEditBox",e.innerHTML="\n            <div class='tlr rowBorder' style='top:-2px;left:-2px;'></div>\n            <div class='tlc columnBorder' style='top:-2px;left:-2px;'></div>\n            <div class='tlDragArea corner' style='top:-5%;left:-5%;'></div>\n\n            <div class='t rowBorder' style='top:-2px;left:35%;'></div>\n            <div class='tDragArea' style='top:-5%;left:35%;'></div>\n\n            <div class='trr rowBorder' style='top:-2px;right:-2px;'></div>\n            <div class='trc columnBorder' style='top:-2px;right:-2px;'></div>\n            <div class='trDragArea corner' style='top:-5%;right:-5%;'></div>\n\n            <div class='l columnBorder' style='left:-2px;top:35%;'></div>\n            <div class='lDragArea' style='left:-5%;top:35%;'></div>\n\n            <div class='r columnBorder' style='right:-2px;top:35%;'></div>\n            <div class='rDragArea' style='right:-5%;top:35%;'></div>\n\n            <div class='blr rowBorder' style='left:-2px;bottom:-2px;'></div>\n            <div class='blc columnBorder' style='left:-2px;bottom:-2px;'></div>\n            <div class='blDragArea corner' style='bottom:-5%;left:-5%;'></div>\n\n            <div class='b rowBorder' style='bottom:-2px;left:35%;'></div>\n            <div class='bDragArea' style='bottom:-5%;left:35%;'></div>\n\n            <div class='brr rowBorder' style='bottom:-2px;right:-2px;'></div>\n            <div class='brc columnBorder' style='bottom:-2px;right:-2px;'></div>\n            <div class='brDragArea corner' style='bottom:-5%;right:-5%;'></div>\n\n        ",this.cropEl.appendChild(e);for(var i=e.children,n=0;n<i.length;n++)"ontouchstart"in document.documentElement?r.default.addEvent(i[n],"touchstart",(function(e){t._editBoxStartMobile(e)})):r.default.addEvent(i[n],"mousedown",(function(e){t._editBoxStart(e)}));return"ontouchstart"in document.documentElement?r.default.addEvent(e,"touchstart",(function(e){t._dragBoxStartMobile(e)})):r.default.addEvent(e,"mousedown",(function(e){t._dragBoxStart(e)})),e},t.prototype.setCropArea=function(t,e,i,n,o){void 0===o&&(o=!1);try{var r=this.cropEl.parentNode;if(!r||!r.children[2])return!1;var s=r.children[2],a=s.getBoundingClientRect();if(this.emit("_onSendMiniImgSize",s),!this.naturalImageSize)return!1;var l=this.naturalImageSize.width,u=a.width/l;t*=u,e*=u,i*=u,n*=u;var c=this.cropEl.getBoundingClientRect(),h={x:a.left-c.left,y:a.top-c.top,width:a.width,height:a.height},d=c.width,p=c.height;if(t<0||e<0||t+i>d||e+n>p)return!1;if(t+i>h.width||e+n>h.height)return!1;if(t=h.width>d?t:h.x+t,e=h.height>p?e:h.y+e,o||this.clearEditBoxes(),0==i||0==n)return!0;var f={left:t,top:e,width:i,height:n},g=this.initCropEditBox();return g.classList.add("DVS_selectedBox"),g.style.left=t+"px",g.style.top=e+"px",g.style.width=i+"px",g.style.height=n+"px",g.style.cursor="move",this.cropBoxes.push(f),this.limitArea=h,!0}catch(t){return!1}},t.prototype.setCropRatio=function(t){return!!r.default.isNumber(t)&&(this.thumbnailCropRatio.ratio=t,!0)},t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},t.prototype.clearEditBoxes=function(){for(var t=this.cropEl.children,e=0;e<t.length;e++){var i=t[e];i.parentNode&&i.parentNode.removeChild(i),e--}this.cropBoxes=[]},t.prototype.preventCrop=function(){this._isCroping=!1},t.prototype._editBoxStart=function(t){return this._editBoxStartFun(t)},t.prototype._editBoxStartMobile=function(t){if(1!==t.touches.length)return!1;var e=t.touches[0];return this._editBoxStartFun(e)},t.prototype._editBoxStartFun=function(t){var e=t.target;if(e){var i=e.parentNode.getBoundingClientRect();return this._currentEditOption={currentBorder:e,editRect:i},r.default.stopBubble(t),!0}return!1},t.prototype._editBoxMove=function(t){return this._editBoxMoveFun(t)},t.prototype._editBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;var e=t.touches[0];return this._editBoxMoveFun(e)},t.prototype._editBoxMoveFun=function(t){var e=this._currentEditOption;if(e){this.isCropMove=!0;var i=e.currentBorder,n=e.editRect,o=n.width,s=n.height,a=n.left,l=n.right,u=n.top,c=n.bottom,h=i.parentNode,d=(h.getBoundingClientRect(),this.cropEl),p=d.getBoundingClientRect(),f=t.clientX,g=t.clientY,m=o,_=s,v=a,y=u;if(i.classList.contains("trDragArea")?(v=f<a?f:a,y=g<c?g:c,m=Math.abs(f-a),_=Math.abs(g-c),d.style.cursor="ne-resize"):i.classList.contains("tlDragArea")?(v=f<l?f:l,y=g<c?g:c,m=Math.abs(f-l),_=Math.abs(g-c),d.style.cursor="se-resize"):i.classList.contains("blDragArea")?(v=f<l?f:l,y=g<u?g:u,m=Math.abs(f-l),_=Math.abs(g-u),d.style.cursor="ne-resize"):i.classList.contains("brDragArea")?(v=f<a?f:a,y=g<u?g:u,m=Math.abs(f-a),_=Math.abs(g-u),d.style.cursor="se-resize"):i.classList.contains("tDragArea")?(y=g<c?g:c,_=Math.abs(g-c),d.style.cursor="s-resize"):i.classList.contains("bDragArea")?(y=g<u?g:u,_=Math.abs(g-u),d.style.cursor="s-resize"):i.classList.contains("lDragArea")?(v=f<l?f:l,m=Math.abs(f-l),d.style.cursor="w-resize"):i.classList.contains("rDragArea")&&(v=f<a?f:a,m=Math.abs(f-a),d.style.cursor="w-resize"),f<p.left||f>p.right||g<p.top||g>p.bottom)return!1;var b=this.limitArea,C=b.x+b.width-2,T=b.y+b.height,x=v+m,E=y+_,w=v-p.left,S=y-p.top;w<b.x&&(w=b.x,m=f<a?x-b.x-p.left:f-b.x-p.left),w+m>C&&(m=C-w),S<b.y&&(S=b.y,_=g<u?E-b.y-p.top:g-b.y-p.top),S+_>T&&(_=T-S),w>C||S>T||w<b.x||S<b.y?h.classList.add("DVS_nodisplay"):h.classList.remove("DVS_nodisplay"),h.style.width=m-2+"px",h.style.height=_-2+"px",h.style.left=w+"px",h.style.top=S+"px";var I={left:parseInt(h.style.left)-b.x,top:parseInt(h.style.top)-b.y,width:m,height:_},R=r.default.getIndex(h);return this.cropBoxes.splice(R,1,I),this.currentCropBox=I,r.default.preventDefault(t),!0}return!1},t.prototype.editBoxEnd=function(){return this._editBoxEndFun()},t.prototype.editBoxEndMobile=function(){return this._editBoxEndFun()},t.prototype._editBoxEndFun=function(){return!!this._currentEditOption&&(this._currentEditOption=null,this.cropEl.style.cursor="crosshair",!0)},t.prototype._dragBoxStart=function(t){return this._dragBoxStartFun(t)},t.prototype._dragBoxStartMobile=function(t){if(1!==t.touches.length)return!1;r.default.stopBubble(t);var e=t.touches[0];return this._dragBoxStartFun(e)},t.prototype._dragBoxStartFun=function(t){var e=t.target;if(e&&e.classList.contains("DVS_cropEditBox")){var i=e.getBoundingClientRect();this._isDraging=!0;var n=t.clientX-i.left,o=t.clientY-i.top;this._dragMoveOption={napLeft:n,napTop:o,target:e};var s=r.default.getIndex(e);return this.cropBoxes.splice(s,1),r.default.stopBubble(t),!0}return!1},t.prototype._dragBoxMove=function(t){return this._dragBoxMoveFun(t)},t.prototype._dragBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;var e=t.touches[0];return this._dragBoxMoveFun(e)},t.prototype._dragBoxMoveFun=function(t){if(this._isDraging){this.isCropMove=!0;var e=this._dragMoveOption,i=e.napLeft,n=e.napTop,o=e.target,s=o.getBoundingClientRect(),a=this.cropEl.getBoundingClientRect(),l=(r.default.id("cropMask"+this.postfix).getBoundingClientRect(),t.clientX-i-a.left),u=t.clientY-n-a.top;if(l=l<0?0:l+s.width>a.width?a.width-s.width:l,u=u<0?0:u+s.height>a.height?a.height-s.height:u,o){var c=this.limitArea,h=c.x+c.width-2,d=c.y+c.height;l=(l=l<c.x?c.x:l)+s.width>h?h-s.width:l,u=(u=u<c.y?c.y:u)+s.height>d?d-s.height:u,o.style.left=l+"px",o.style.top=u+"px"}return r.default.preventDefault(t),!0}return!1},t.prototype.dragBoxEnd=function(){return this._dragBoxEndFun()},t.prototype.dragBoxEndMobile=function(){return this._dragBoxEndFun()},t.prototype._dragBoxEndFun=function(){var t=this._dragMoveOption.target;if(this._isDraging&&t){this._isDraging=!1;var e=t.getBoundingClientRect(),i=this.limitArea,n=r.default.getIndex(t),o={left:parseInt(t.style.left)-i.x,top:parseInt(t.style.top)-i.y,width:e.width,height:e.height};return this.cropBoxes.splice(n,0,o),this.currentCropBox=o,!0}return!1},t.prototype.cropStart=function(t){return(!t.button||0===t.button)&&(this._cropStartFun(t),!0)},t.prototype.cropStartMobile=function(t){if(1!==t.touches.length)return!1;var e=t.touches[0];return!!e&&(this._cropStartFun(e),!0)},t.prototype._cropStartFun=function(t){var e=this.cropEl.getBoundingClientRect(),i=this.cropEl.parentNode;if(!i||!i.children[2])return!1;this.naturalImageSize||this.emit("_onSendMiniImgSize");var n=i.children[2].getBoundingClientRect(),o=i.getBoundingClientRect();this.limitArea={x:n.left-o.left,y:n.top-o.top,width:n.width,height:n.height},t.ctrlKey||this.clearEditBoxes();var r=this.initCropEditBox(),s=t.clientX-e.left,a=t.clientY-e.top;return r.style.left=s+"px",r.style.top=a+"px",r.classList.add("DVS_nodisplay"),this._cropMoveOption={left:s,top:a,target:r},this._isCroping=!0,this.currentCropBox=null,!0},t.prototype.cropMove=function(t){return r.default.preventDefault(t),this._cropMoveFun(t)},t.prototype._cropMoveMobile=function(t){if(1!==t.touches.length)return!1;var e=t.touches[0];return this._cropMoveFun(e),r.default.preventDefault(t),!0},t.prototype._cropMoveFun=function(t){if(this._isCroping){this.isCropMove=!0;var e=this._cropMoveOption,i=e.left,n=e.top,o=e.target,r=this.cropEl.getBoundingClientRect();o.classList.remove("DVS_nodisplay");var s=t.clientX-r.left,a=t.clientY-r.top;s=s<0?0:s,a=a<0?0:a;var l=Math.abs(s-i),u=Math.abs(a-n),c=s<i?s:i,h=a<n?a:n;l=s>r.width?r.width-c:l,u=a>r.height?r.height-h:u;var d=this.limitArea,p=d.x+d.width-2,f=d.y+d.height-1;if(c<d.x&&(c=d.x,l=s<i?i-d.x:s-d.x),c+l>p&&(l=p-c),h<d.y&&(h=d.y,u=a<n?n-d.y:a-d.y),h+u>f&&(u=f-h),this.thumbnailCropRatio.ratio){var g=this.thumbnailCropRatio.ratio,m=l/g;s>i?(h=n<d.y?d.y:n)+m>=f?l=l*(u=f-h)/m:u=m:(u=m,n>f?d.height<=m&&(l=(u=d.height)*g,c=i<p?i-l:p-l):n-d.y<=m&&(l=(u=n-d.y)*g,c=i<p?i-l:p-l),h=n<f?n-u:f-u)}return l<=3||u<=3?o.classList.add("DVS_nodisplay"):o.classList.remove("DVS_nodisplay"),o.style.width=l+"px",o.style.height=u+"px",o.style.left=c-1+"px",o.style.top=h+"px",!0}return!1},t.prototype.cropEnd=function(){return this._cropEndFun()},t.prototype.cropEndMobile=function(){return this._cropEndFun()},t.prototype._cropEndFun=function(){var t=this._cropMoveOption.target;if(this._isCroping&&t){if(this._isCroping=!1,this.isCropMove){var e=t.getBoundingClientRect(),i=this.limitArea,n=this.cropEl.getBoundingClientRect(),o={left:e.left-i.x-n.left,top:e.top-i.y-n.top,width:e.width,height:e.height};t.classList.add("DVS_selectedBox"),t.style.cursor="move",this.cropBoxes.push(o),this.currentCropBox=o}return!0}return!1},t.prototype._imageAreaUnselected=function(t){var e=this.cropEl.parentNode,i=r.default.getIndex(e),n=this.cropBoxes,o=n&&n.length>0;void 0!==t.button?(this.cropStart(t),t.ctrlKey||o&&this.emit("imageAreaUnselected",i)):(this.cropStartMobile(t),o&&this.emit("imageAreaUnselected",i))},t.prototype._imageAreaSelected=function(t){var e=this.isCropMove;if(void 0!==t.button?(this.cropEnd(),this.editBoxEnd(),this.dragBoxEnd()):(this.cropEndMobile(),this.editBoxEndMobile(),this.dragBoxEndMobile()),e){this.isCropMove=!1;var i=this.currentCropBox;if(i){var n=this.cropEl.parentNode;if(!n||!n.children||!n.children[2])return!1;var o=this.limitArea.width,s=this.naturalImageSize;if(!s)return!1;var a=s.width/o,l=r.default.getIndex(n),u=-1;this.cropBoxes.forEach((function(t,e){t===i&&(u=e)})),-1!==u&&this.emit("imageAreaSelected",{index:l,x:i.left>0?i.left*a:0,y:i.top>0?i.top*a:0,width:i.width*a,height:i.height*a,areaIndex:u})}}},t.prototype._addEvent=function(){var t=this;"ontouchstart"in document.documentElement?(r.default.addEvent(this.cropEl,"touchmove",(function(e){t._cropMoveMobile(e),t._editBoxMoveMobile(e),t._dragBoxMoveMobile(e)})),r.default.addEvent(this.cropEl,"touchstart",(function(e){t._imageAreaUnselected(e)})),r.default.addEvent(this.cropEl,"touchend",(function(e){t._imageAreaSelected(e)}))):(r.default.addEvent(this.cropEl,"mousemove",(function(e){t.cropMove(e),t._editBoxMove(e),t._dragBoxMove(e)})),r.default.addEvent(this.cropEl,"mousedown",(function(e){t._imageAreaUnselected(e)})),r.default.addEvent(this.cropEl,"mouseup",(function(e){t._imageAreaSelected(e)}))),this.naturalImageSize||this.emit("_onSendMiniImgSize")},t}();e.thumbnailCropRender=s},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)),r=n(i(4)),s=function(){function t(t){this.postfix=t,this.treeInit()}return t.prototype.updataDirectory=function(t){var e=o.default.id("treeLists"+this.postfix);if(!e)return!1;var i=r.default.createVnode("UL",{},[],e);"root"!==t.name&&i.children.push(r.default.createVnode("LI",{className:"backTree",dvs_type:"back"},[r.default.createVnode("DIV",{className:"iconfont icon-folderopen"}),r.default.createVnode("SPAN",{},[],null,".....")]));for(var n=t.children,s=0,a=n.length;s<a;s++){var l=n[s];i.children.push(r.default.createVnode("LI",{title:l.name,dvs_type:l.type,dvs_fileName:l.name},[r.default.createVnode("DIV",{className:"iconfont "+("folder"===l.type?"icon-tree":"icon-file")}),r.default.createVnode("SPAN",{},[],null,l.name)]))}this.treeList=r.default.patch(this.treeList,i)},t.prototype.getChildIndex=function(t){var e=o.default.getIndex(t),i=t.parentNode.children[0];return"back"===i.type&&e--,i.classList.contains("createBox")&&e--,e},t.prototype.getTargetDom=function(t){var e,i=t.target;return!!i&&("LI"===i.tagName&&i.dvs_fileName?e=i:i.parentNode.dvs_type&&(e=i.parentNode),e)},t.prototype.addNewFolder=function(t){var e=o.default.id("treeLists"+this.postfix),i=r.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix},[r.default.createVnode("DIV",{className:"iconfont icon-tree"}),r.default.createVnode("INPUT",{id:"folderInput"+this.postfix}),r.default.createVnode("DIV",{className:"judgeBox"},[r.default.createVnode("DIV",{className:"confirmFolder iconfont icon-confire"}),r.default.createVnode("DIV",{className:"cancelFolder iconfont icon-cancle"})])]);e.children.length&&"back"===e.children[0].dvs_type?r.default.addOneVnode(this.treeList,1,i):r.default.addOneVnode(this.treeList,0,i),o.default.id("folderInput"+this.postfix).focus(),o.default.id("addFolder"+this.postfix).style.pointerEvents="none"},t.prototype.renameFile=function(t){if(t.target.classList.contains("renameFileBtn")){var e=o.default.id("contextMenu"+this.postfix).DVS_activeIndex,i=o.default.id("treeLists"+this.postfix).children[e],n=i.children[1].innerText,s=o.default.deepClone(this.treeList),a=r.default.createVnode("LI",{className:"createBox",id:"createBox"+this.postfix,dvs_fileName:n,dvs_type:i.dvs_type},[r.default.createVnode("DIV",{className:"iconfont icon-tree"}),r.default.createVnode("INPUT",{id:"folderInput"+this.postfix,value:n}),r.default.createVnode("DIV",{className:"judgeBox"},[r.default.createVnode("DIV",{className:"renameConfirmFile iconfont icon-confire"}),r.default.createVnode("DIV",{className:"cancelFolder iconfont icon-cancle"})])]);s.children.splice(e,1,a),this.treeList=r.default.patch(this.treeList,s);var l=o.default.id("folderInput"+this.postfix);l.focus(),l.select()}},t.prototype.selectFileByName=function(t){var e=this;Array.from(o.default.id("treeLists"+this.postfix).children).forEach((function(i){i.children[1].innerText===t?(i.classList.add("DVS_activeFile"),o.default.id("defaultTag"+e.postfix).classList.remove("DVS_activeAllImage")):i.classList.remove("DVS_activeFile")}))},t.prototype.confirmFolder=function(t){if(t.target.classList.contains("confirmFolder")){var e=t.target.parentNode.parentNode.children[1].value;if(""!==e)return o.default.id("addFolder"+this.postfix).style.pointerEvents="auto",e;alert("The folder name can not be empty!")}},t.prototype.addTreeEvent=function(){},t.prototype.treeInit=function(){var t=o.default.id("treeLists"+this.postfix);this.treeList=r.default.createVnode("UL",{},[],t)},t}();e.DirectoryRender=s},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)),r=function(){function t(t,e){this.cropBoxes=[],this.containerId="",this.isCropMove=!1,this._isCrop=!1,this._isCroping=!1,this._isMoving=!1,this.currentRatio=0,this.postfix=t,this.cropOption=e,this._cropRatios=e.ratios,this.initCropMask(),this.cropInit()}return Object.defineProperty(t.prototype,"isCrop",{get:function(){return this._isCrop},set:function(t){var e=o.default.id("cropBar"+this.postfix),i=o.default.id("cropMask"+this.postfix),n=o.default.id("cropEditArea"+this.postfix);e&&(t?(this.cropOption.cropBar&&e.classList.remove("DVS_nodisplay"),this.cropOption.cropMask&&i.classList.remove("DVS_nodisplay"),n.classList.remove("DVS_nodisplay"),this.drawCropMask()):(e.classList.add("DVS_nodisplay"),i.classList.add("DVS_nodisplay"),n.classList.add("DVS_nodisplay"),this.clearEditBoxes(),this._clearCurrentCropRatio()),this._isCrop=t)},enumerable:!0,configurable:!0}),t.prototype.initCropMask=function(){var t=document.createElement("canvas");t.className="DVS_cropMask DVS_nodisplay",t.id="cropMask"+this.postfix,this.cropMask=t},t.prototype.initCropEditBox=function(){var t=this,e=document.createElement("div");e.className="DVS_cropEditBox",e.innerHTML="\n            <div class='tlr rowBorder' style='top:0px;left:0px;'></div>\n            <div class='tlc columnBorder' style='top:0px;left:0px;'></div>\n            <div class='tlDragArea corner' style='top:-5%;left:-5%;'></div>\n\n            <div class='t rowBorder' style='top:0px;left:35%;'></div>\n            <div class='tDragArea' style='top:-5%;left:35%;'></div>\n\n            <div class='trr rowBorder' style='top:0px;right:0px;'></div>\n            <div class='trc columnBorder' style='top:0px;right:0px;'></div>\n            <div class='trDragArea corner' style='top:-5%;right:-5%;'></div>\n\n            <div class='l columnBorder' style='left:0px;top:35%;'></div>\n            <div class='lDragArea' style='left:-5%;top:35%;'></div>\n\n            <div class='r columnBorder' style='right:0px;top:35%;'></div>\n            <div class='rDragArea' style='right:-5%;top:35%;'></div>\n\n            <div class='blr rowBorder' style='left:0px;bottom:0px;'></div>\n            <div class='blc columnBorder' style='left:0px;bottom:0px;'></div>\n            <div class='blDragArea corner' style='bottom:-5%;left:-5%;'></div>\n\n            <div class='b rowBorder' style='bottom:0px;left:35%;'></div>\n            <div class='bDragArea' style='bottom:-5%;left:35%;'></div>\n\n            <div class='brr rowBorder' style='bottom:0px;right:0px;'></div>\n            <div class='brc columnBorder' style='bottom:0px;right:0px;'></div>\n            <div class='brDragArea corner' style='bottom:-5%;right:-5%;'></div>\n\n        ",o.default.id("cropEditArea"+this.postfix).appendChild(e);for(var i=e.children,n=0;n<i.length;n++)"ontouchstart"in document.documentElement?o.default.addEvent(i[n],"touchstart",(function(e){t._editBoxStartMobile(e)})):o.default.addEvent(i[n],"mousedown",(function(e){t._editBoxStart(e)}));return"ontouchstart"in document.documentElement?o.default.addEvent(e,"touchstart",(function(e){t._dragBoxStartMobile(e)})):o.default.addEvent(e,"mousedown",(function(e){t._dragBoxStart(e)})),e},t.prototype.setCropArea=function(t,e,i,n,r){void 0===r&&(r=!1);try{var s=o.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),a=s.width,l=s.height;if(t<0||e<0||t+i>a||e+n>l)return!1;var u=this.limitArea;if(t+i>u.width||e+n>u.height)return!1;if(t=u.width>a?t:u.x+t,e=u.height>l?e:u.y+e,r||this.clearEditBoxes(),0==i||0==n)return!0;var c={left:t,top:e,width:i,height:n},h=this.initCropEditBox();return h.classList.add("DVS_selectedBox"),h.style.left=t+"px",h.style.top=e+"px",h.style.width=i+"px",h.style.height=n+"px",h.style.cursor="move",this.cropBoxes.push(c),this._drawFinalMask(),!0}catch(t){return!1}},t.prototype.bindCropMask=function(t){var e=o.default.id(t);e&&(this.containerId=t,e.appendChild(this.cropMask))},t.prototype.unbindCropMask=function(){var t=o.default.id(this.containerId);t&&(t.removeChild(this.cropMask),this.containerId="")},t.prototype.clearEditBoxes=function(){var t=o.default.id("cropEditArea"+this.postfix);if(!t)return!1;for(var e=t.children,i=0;i<e.length;i++){var n=e[i];o.default.id("cropEditArea"+this.postfix).removeChild(n),i--}this.cropBoxes=[],this._drawFinalMask()},t.prototype.drawCropMask=function(){var t=o.default.id("WebViewer"+this.postfix).getBoundingClientRect(),e=this.cropMask;e.width=t.width,e.height=t.height;var i=e.getContext("2d");i.fillStyle="rgba(166, 166, 166, 0.4)",i.fillRect(0,0,e.width,e.height)},t.prototype.preventCrop=function(){this._isCroping=!1},t.prototype._clearCropMask=function(){for(var t=o.default.id("cropMask"+this.postfix).getContext("2d"),e=o.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),i=o.default.id("cropMask"+this.postfix).getBoundingClientRect(),n=e.top-i.top,r=e.left-i.left,s=this.cropBoxes,a=0;a<s.length;a++){var l=s[a],u=l.left,c=l.top,h=l.width,d=l.height;t.clearRect(u+r,c+n,h,d)}},t.prototype._drawFinalMask=function(){try{return this.drawCropMask(),this._clearCropMask(),!0}catch(t){return!1}},t.prototype.setCropRatio=function(t){var e=this,i=t.target;if(i&&i.classList.contains("DVS_cropRatio")){var n=o.default.getIndex(i);o.default.queryAll("#ratioList"+this.postfix+">div.DVS_cropRatio").forEach((function(t,i){if(i===n){var o=t.classList.toggle("DVS_activeRate");e.currentRatio=o?e._cropRatios[n][0]/e._cropRatios[n][1]:0}else t.classList.remove("DVS_activeRate")}))}},t.prototype.setCropRatioFun=function(t){return!!o.default.isNumber(t)&&(this.currentRatio=t,!0)},t.prototype._clearCurrentCropRatio=function(){this.currentRatio=0,o.default.queryAll("#ratioList"+this.postfix+">div.DVS_cropRatio").forEach((function(t){t.classList.remove("DVS_activeRate")}))},t.prototype._editBoxStart=function(t){return this._editBoxStartFun(t)},t.prototype._editBoxStartMobile=function(t){if(1!==t.touches.length)return!1;o.default.stopBubble(t);var e=t.changedTouches[0];return this._editBoxStartFun(e)},t.prototype._editBoxStartFun=function(t){var e=t.target;if(e){var i=e.parentNode.getBoundingClientRect();return this._currentEditOption={currentBorder:e,editRect:i},o.default.stopBubble(t),!0}return!1},t.prototype._editBoxMove=function(t){return this._editBoxMoveFun(t)},t.prototype._editBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;o.default.preventDefault(t);var e=t.touches[0];return this._editBoxMoveFun(e)},t.prototype._editBoxMoveFun=function(t){var e=this._currentEditOption;if(e){this.isCropMove=!0;var i=e.currentBorder,n=e.editRect,r=n.width,s=n.height,a=n.left,l=n.right,u=n.top,c=n.bottom,h=i.parentNode,d=o.default.id("cropEditArea"+this.postfix),p=d.getBoundingClientRect(),f=t.clientX,g=t.clientY,m=r,_=s,v=a,y=u,b=m/_;if(i.classList.contains("trDragArea")){if(v=f<a?f:a,y=g<c?g:c,m=Math.abs(f-a),_=Math.abs(g-c),t.shiftKey){var C=m/b;f<a&&c+C>p.bottom&&(v=a-(m=(C=p.bottom-c)*b)),f>a&&c-C<p.top&&(m=(C=c-p.top)*b),_=C,y=f>a?c-C:c}d.style.cursor="ne-resize"}else if(i.classList.contains("tlDragArea")){if(v=f<l?f:l,y=g<c?g:c,m=Math.abs(f-l),_=Math.abs(g-c),t.shiftKey){C=m/b;f>l&&c+C>p.bottom&&(m=(C=p.bottom-c)*b),f<l&&c-C<p.top&&(v=l-(m=(C=c-p.top)*b)),_=C,y=f<l?c-C:c}d.style.cursor="se-resize"}else if(i.classList.contains("blDragArea")){if(v=f<l?f:l,y=g<u?g:u,m=Math.abs(f-l),_=Math.abs(g-u),t.shiftKey){C=m/b;f<l&&u+C>p.bottom&&(v=l-(m=(C=p.bottom-u)*b)),f>l&&u-C<p.top&&(m=(C=u-p.top)*b),_=C,y=f>l?u-C:u}d.style.cursor="ne-resize"}else if(i.classList.contains("brDragArea")){if(v=f<a?f:a,y=g<u?g:u,m=Math.abs(f-a),_=Math.abs(g-u),t.shiftKey){C=m/b;f>a&&u+C>p.bottom&&(m=(C=p.bottom-u)*b),f<a&&u-C<p.top&&(v=a-(m=(C=u-p.top)*b)),_=C,y=f<a?u-C:u}d.style.cursor="se-resize"}else i.classList.contains("tDragArea")?(y=g<c?g:c,_=Math.abs(g-c),d.style.cursor="s-resize"):i.classList.contains("bDragArea")?(y=g<u?g:u,_=Math.abs(g-u),d.style.cursor="s-resize"):i.classList.contains("lDragArea")?(v=f<l?f:l,m=Math.abs(f-l),d.style.cursor="w-resize"):i.classList.contains("rDragArea")&&(v=f<a?f:a,m=Math.abs(f-a),d.style.cursor="w-resize");if(f<p.left||f>p.right||g<p.top||g>p.bottom)return!1;var T=this.limitArea,x=T.x+T.width,E=T.y+T.height,w=v+m,S=y+_,I=v-p.left,R=y-p.top;I<T.x&&(I=T.x>0?T.x:0,m=w-T.x-p.left),I+m>x&&(m=x-I),R<T.y&&(R=T.y,_=S-T.y-p.top),R+_>E&&(_=E-R),I>x||R>E?h.classList.add("DVS_nodisplay"):h.classList.remove("DVS_nodisplay"),h.style.width=m+"px",h.style.height=_+"px",h.style.left=I<T.x?T.x<1?0:T.x-1:I+"px",h.style.top=R+"px";var L={left:parseInt(h.style.left),top:parseInt(h.style.top),width:m,height:_};this.currentCropBox=L;var A=o.default.getIndex(h);return this.cropBoxes.splice(A,1,L),this._drawFinalMask(),!0}return!1},t.prototype.editBoxEnd=function(){return this._editBoxEndFun()},t.prototype.editBoxEndMobile=function(){return this._editBoxEndFun()},t.prototype._editBoxEndFun=function(){return!!this._currentEditOption&&(this._currentEditOption=null,o.default.id("cropEditArea"+this.postfix).style.cursor="crosshair",!0)},t.prototype._dragBoxStart=function(t){return this._dragBoxStartFun(t)},t.prototype._dragBoxStartMobile=function(t){if(o.default.stopBubble(t),1!==t.touches.length)return!1;var e=t.changedTouches[0];return this._dragBoxStartFun(e)},t.prototype._dragBoxStartFun=function(t){var e=t.target;if(e&&e.classList.contains("DVS_cropEditBox")){var i=e.getBoundingClientRect();this._isMoving=!0;var n=t.clientX-i.left,r=t.clientY-i.top;this._dragMoveOption={napLeft:n,napTop:r,target:e},o.default.stopBubble(t);var s=o.default.getIndex(e);return this.cropBoxes.splice(s,1),!0}return!1},t.prototype._dragBoxMove=function(t){return this._dragBoxMoveFun(t)},t.prototype._dragBoxMoveMobile=function(t){if(1!==t.touches.length)return!1;o.default.preventDefault(t);var e=t.changedTouches[0];return this._dragBoxMoveFun(e)},t.prototype._dragBoxMoveFun=function(t){if(this._isMoving){this.isCropMove=!0;var e=this._dragMoveOption,i=e.napLeft,n=e.napTop,r=e.target,s=r.getBoundingClientRect(),a=o.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),l=o.default.id("cropMask"+this.postfix).getBoundingClientRect(),u=t.clientX-i-a.left,c=t.clientY-n-a.top;if(u=u<0?0:u+s.width>a.width?a.width-s.width:u,c=c<0?0:c+s.height>a.height?a.height-s.height:c,r){var h=this.limitArea,d=h.x+h.width,p=h.y+h.height;u=(u=u<h.x?h.x<0?0:h.x:u)+s.width>d?d-s.width:u,c=(c=c<h.y?h.y:c)+s.height>p?p-s.height:c,r.style.left=u+"px",r.style.top=c+"px",s=r.getBoundingClientRect(),o.default.id("cropMask"+this.postfix).getContext("2d").clearRect(s.left-l.left,s.top-l.top,s.width,s.height)}return this._clearCropMask(),!0}return!1},t.prototype.dragBoxEnd=function(){return this._dragBoxEndFun()},t.prototype.dragBoxEndMobile=function(){return this._dragBoxEndFun()},t.prototype._dragBoxEndFun=function(){if(this._isMoving){this._isMoving=!1;var t=this._dragMoveOption.target,e=t.getBoundingClientRect(),i=o.default.getIndex(t),n={left:parseInt(t.style.left),top:parseInt(t.style.top),width:e.width,height:e.height};return this.cropBoxes.splice(i,0,n),this.currentCropBox=n,this._drawFinalMask(),this._dragMoveOption={},!0}return this._dragMoveOption={},!1},t.prototype.cropStart=function(t){return(!t.button||0===t.button)&&(this._cropStartFun(t),!0)},t.prototype.cropStartMobile=function(t){if(1!==t.touches.length)return!1;var e=t.changedTouches[0];return!!e&&(this._cropStartFun(e),!0)},t.prototype._cropStartFun=function(t){var e=o.default.id("thumbLists"+this.postfix);if(!e||!e.children||e.children.length<=0)return!1;var i=o.default.id("cropEditArea"+this.postfix).getBoundingClientRect();t.ctrlKey||this.clearEditBoxes(),this._drawFinalMask();var n=this.initCropEditBox(),r=t.clientX-i.left,s=t.clientY-i.top;return n.style.left=r+"px",n.style.top=s+"px",n.classList.add("DVS_nodisplay"),this._cropMoveOption={left:r,top:s,target:n},this._isCroping=!0,this.currentCropBox=null,!0},t.prototype.cropMove=function(t){return this._cropMoveFun(t)},t.prototype._cropMoveMobile=function(t){if(1!==t.touches.length)return!1;o.default.preventDefault(t),o.default.stopBubble(t);var e=t.changedTouches[0];return this._cropMoveFun(e),!0},t.prototype._cropMoveFun=function(t){if(this._isCroping){this.isCropMove=!0;var e=this._cropMoveOption,i=e.left,n=e.top,r=e.target,s=o.default.id("cropEditArea"+this.postfix),a=s.getBoundingClientRect(),l=o.default.id("cropMask"+this.postfix).getBoundingClientRect(),u=r.getBoundingClientRect();r.classList.remove("DVS_nodisplay");var c=t.clientX-a.left,h=t.clientY-a.top;c=c<0?0:c,h=h<0?0:h;var d=Math.abs(c-i),p=Math.abs(h-n),f=c<i?c:i,g=h<n?h:n;d=c>s.clientWidth?s.clientWidth-f:d,p=h>s.clientHeight?s.clientHeight-g:p;var m=this.limitArea,_=m.x+m.width,v=m.y+m.height;if(f<m.x&&(f=m.x,d=c<i?i-m.x:c-m.x),f+d>_&&(d=_-f),g<m.y&&(g=m.y,p=h<n?n-m.y:h-m.y),g+p>v&&(p=v-g),this.currentRatio){var y=this.currentRatio,b=d/y;c>i?(g=n<m.y?m.y:n)+b>=v?d=d*(p=v-g)/b:p=b:(p=b,n>v?m.height<=b&&(d=(p=m.height)*y,f=i<_?i-d:_-d):n-m.y<=b&&(d=(p=n-m.y)*y,f=i<_?i-d:_-d),g=n<v?n-p:v-p)}return d<=3||p<=3?r.classList.add("DVS_nodisplay"):r.classList.remove("DVS_nodisplay"),r.style.width=d+"px",r.style.height=p+"px",r.style.left=f+"px",r.style.top=g+"px",u=r.getBoundingClientRect(),o.default.id("cropMask"+this.postfix).getContext("2d").clearRect(u.left-l.left,u.top-l.top,u.width,u.height),this._clearCropMask(),!0}return!1},t.prototype.cropEnd=function(){return this._cropEndFun()},t.prototype.cropEndMobile=function(){return this._cropEndFun()},t.prototype._cropEndFun=function(){if(this._isCroping){this._isCroping=!1;var t=this._cropMoveOption.target;if(t&&this.isCropMove){var e=t.getBoundingClientRect(),i=o.default.id("cropEditArea"+this.postfix).getBoundingClientRect(),n={left:e.left-i.left,top:e.top-i.top,width:e.width,height:e.height};t.classList.add("DVS_selectedBox"),t.style.cursor="move",this.cropBoxes.push(n),this.currentCropBox=n}return this._drawFinalMask(),this._cropMoveOption={},!0}return this._cropMoveOption={},!1},t.prototype._addEvent=function(){},t.prototype.cropInit=function(){this.bindCropMask("WebViewer"+this.postfix);var t=this.isCrop;this.isCrop=t},t}();e.CropRender=r},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)),r=function(){function t(t){this._xOver=!1,this._yOver=!1,this.isMyScroll=!1,this.buttonMove=!1,this._isButtonScroll=!1,this._postfix=t,this._addButtonScroll()}return t.prototype.getImageSize=function(t){var e=this.setOuterSize(t.width,t.height);return this.setScroller(t.x,t.y),e&&this.setViewPort(),e},t.prototype.setScroller=function(t,e){var i=o.default.id("outer"+this._postfix);if(!i)return!1;var n=i.scrollLeft,r=i.scrollTop;return n===t&&r===e||(this.isMyScroll=!0),i.scrollLeft=t,i.scrollTop=e,!0},t.prototype.setOuterSize=function(t,e){var i=o.default.id("outer"+this._postfix),n=o.default.id("inner"+this._postfix),r=!1,s=!1;if(!i||!n)return!1;t>i.offsetWidth?(i.style.overflowX="auto",r=!0):i.style.overflowX="hidden",e>i.offsetHeight?(i.style.overflowY="auto",s=!0):i.style.overflowY="hidden",n.style.width=t+"px",n.style.height=e+"px";var a=this._xOver!==r,l=this._yOver!==s;return this._xOver=r,this._yOver=s,a||l},t.prototype.setViewPort=function(){var t=o.default.id("outer"+this._postfix),e=o.default.id("viewPort"+this._postfix);if(!t||!e)return!1;var i=t.offsetWidth-t.clientWidth,n=t.offsetHeight-t.clientHeight;e.style.width="calc(100% - "+i+"px)",e.style.height="calc(100% - "+n+"px)"},t.prototype._addButtonScroll=function(){var t=this;o.default.queryAll(".DVS_groupType").forEach((function(e){"ontouchstart"in document.documentElement?(o.default.addEvent(e,"touchstart",(function(e){t.buttonScrollStartMobile(e)})),document.addEventListener("touchmove",(function(e){t.buttonScrollMoveMobile(e)})),document.addEventListener("touchend",(function(){t.buttonScrollEndFun()}))):(o.default.addEvent(e,"mousedown",(function(e){t.buttonScrollStart(e)})),document.addEventListener("mousemove",(function(e){t.buttonScrollMove(e)})),document.addEventListener("mouseup",(function(){t.buttonScrollEndFun()})))}))},t.prototype.buttonScrollStart=function(t){return(!t.button||0===t.button)&&(this._buttonScrollStartFun(t),!0)},t.prototype.buttonScrollStartMobile=function(t){var e=t.changedTouches[0];return!!e&&(this._buttonScrollStartFun(e),!0)},t.prototype._buttonScrollStartFun=function(t){var e;if(t.target&&t.target.classList.contains("DVS_groupType"))e=t.target;else{if(!(t.target&&t.target.parentNode&&t.target.parentNode.classList.contains("DVS_groupType")))return!1;e=t.target.parentNode}document.addEventListener("touchmove",o.default.preventDefault,{passive:!1}),this._isButtonScroll=!0,this._scrollStartInfo={x:t.clientX,y:t.clientY,left:e.scrollLeft,top:e.scrollTop,item:e}},t.prototype.buttonScrollMove=function(t){return this._buttonScrollMoveFun(t),!0},t.prototype.buttonScrollMoveMobile=function(t){var e=t.changedTouches[0];return!!e&&(this._buttonScrollMoveFun(e),!0)},t.prototype._buttonScrollMoveFun=function(t){if(!this._isButtonScroll)return!1;var e=this._scrollStartInfo,i=e.x,n=e.y,r=e.left,s=e.top,a=e.item;if(a.scrollWidth>a.clientWidth){var l=t.clientX-i,u=t.clientY-n;(Math.abs(l)>5||Math.abs(u)>5)&&(this.buttonMove=!0,a.scrollLeft=r-l,a.scrollTop=s-u,o.default.preventDefault(t),o.default.stopBubble(t))}},t.prototype.buttonScrollEndFun=function(){this._isButtonScroll=!1,this._scrollStartInfo={},document.removeEventListener("touchmove",o.default.preventDefault)},t}();e.ScrollRender=r},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(0)).default.uid,r=function(){function t(){}return t.prototype.loadImage=function(t){var e=t.type,i=t.param,n={fromurl:function(t){return new Promise((function(t,e){}))},frominput:function(){var t=document.createElement("input");return t.type="file",t.accept="image/png,image/jpeg,image/jpg,image/gif,image/webp,image/bmp",t.style.position="fixed",t.style.background="transparent",new Promise((function(e,i){t.addEventListener("change",(function(n){var o=t.files[0];if(o){var r=new Blob([o],{type:o.type}),s={name:o.name,fileType:o.type,contents:[{minData:null,originalData:r,tags:[]}]};e(s)}else i()}),!0),t.click()}))}};return function(t,e){return n["from"+t]&&n["from"+t](e)}(e,i)},t.prototype._formatData=function(t){return{uid:o(11),content:t}},t}();e.LoadImage=r},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(0)),s=o(i(1)).default.errorMessages,a=function(){function t(t,e,i){this.showPageNumber=!1,this.showSelectBox=!1,this.showTopMenu=!0,this.topMenuColor="#3a393b",this.showHeader=!0,this.headerColor="#2a292b",this.showSideBar=!1,this.showAside=!0,this.showThumbnail=!0,this.showMain=!0,this.showFooter=!0,this.footerColor="#434246",this.showThumbnailControl=!0,this.showVideoContainer=!1,this.fullThumbnail=!1,this.viewerBorderColor="#1b1b1d",this.sidebarWidth=199,this.thumbnailWidth=180,this.width="100%",this.height="100%",this.canvasBackgroundColor="pink",this.mainContentList={},this.mouseShape="default",this.defaultUiConfig={component:{header:!0,topMenu:!0,asideMenu:!1,bottomMenu:!0},group:{global:{visibility:!0,location:"header",sequence:1},viewerCorner:{visibility:!0,location:"header",sequence:2},viewMenu:{visibility:!0,location:"topMenu",sequence:1},topMenuRight:{visibility:!0,location:"topMenu",sequence:2},pager:{visibility:!0,location:"bottomMenu",sequence:1},viewChange:{visibility:!0,location:"header",sequence:4}},buttons:{loadImage:{visibility:!0,location:"viewerCorner",iconClass:"icon-file",sequence:2,onButtonClick:"onLoadImage"},panelChange:{visibility:!0,location:"global",iconClass:"icon-list",sequence:1,onButtonClick:"onPanelChange"},readDirection:{visibility:!1,location:"global",iconClass:"icon-readType",sequence:3,onButtonClick:"onReadDirection"},blank1:{visibility:!1,location:"global",sequence:4},flip:{visibility:!0,location:"viewMenu",iconClass:"icon-mirror",sequence:1,onButtonClick:"onFlip"},mirror:{visibility:!0,location:"viewMenu",iconClass:"icon-flip",sequence:2,onButtonClick:"onMirror"},rotate:{visibility:!0,location:"viewMenu",iconClass:"icon-rotateLeft",sequence:3,onButtonClick:"onRotate"},rotateAll:{visibility:!0,location:"viewMenu",iconClass:"icon-rotateAll",sequence:4,onButtonClick:"onRotateAll"},crop:{visibility:!0,location:"viewMenu",iconClass:"icon-crop",sequence:5,onButtonClick:"onCrop"},wipe:{visibility:!0,location:"viewMenu",iconClass:"icon-wipe",sequence:6,onButtonClick:"onWipe"},undo:{visibility:!1,location:"viewMenu",iconClass:"icon-undo",sequence:7,onButtonClick:"onUndo"},redo:{visibility:!1,location:"viewMenu",iconClass:"icon-redo",sequence:8,onButtonClick:"onRedo"},zoomIn:{visibility:!0,location:"viewMenu",iconClass:"icon-magnifyImage",sequence:9,onButtonClick:"onZoomIn"},zoomOut:{visibility:!0,location:"viewMenu",iconClass:"icon-shrinkImage",sequence:10,onButtonClick:"onZoomOut"},reset:{visibility:!0,location:"viewMenu",iconClass:"icon-reset",sequence:11,onButtonClick:"onReset"},remove:{visibility:!0,location:"topMenuRight",iconClass:"icon-delete menuRight",sequence:1,onButtonClick:"onRemove"},print:{visibility:!1,location:"topMenuRight",iconClass:"icon-print menuRight",sequence:2,onButtonClick:"onPrint"},save:{visibility:!0,location:"topMenuRight",iconClass:"icon-save menuRight",sequence:3,onButtonClick:"onSave"},firstPage:{visibility:!0,location:"pager",iconClass:"icon-pageStart",sequence:1,onButtonClick:"onFirstPage"},previousPage:{visibility:!0,location:"pager",iconClass:"icon-pagePre",sequence:2,onButtonClick:"onPreviousPage"},pagination:{visibility:!0,location:"pager"},nextPage:{visibility:!0,location:"pager",iconClass:"icon-pageNext",sequence:4,onButtonClick:"onNextPage"},lastPage:{visibility:!0,location:"pager",iconClass:"icon-pageEnd",sequence:5,onButtonClick:"onLastPage"},autoFit:{visibility:!0,location:"viewChange",iconClass:"icon-autoFit",sequence:.5,onButtonClick:"onAutoFit"},fitHeight:{visibility:!0,location:"viewChange",iconClass:"icon-fitHeight",sequence:1,onButtonClick:"onFitHeight"},fitWidth:{visibility:!0,location:"viewChange",iconClass:"icon-fitWidth",sequence:2,onButtonClick:"onFitWidth"},fullPage:{visibility:!0,location:"viewChange",iconClass:"icon-fullWeb",sequence:3,onButtonClick:"onFullPage"},fullScreen:{visibility:!0,location:"viewChange",iconClass:"icon-fullDevice",sequence:4,onButtonClick:"onFullScreen"}},tipsConfig:{loadImage:"loadImage",panelChange:"panelChange",readDirection:"readDirection",flip:"flip",mirror:"mirror",rotate:"rotate",rotateAll:"rotateAll",crop:"crop",wipe:"wipe",undo:"undo",redo:"redo",zoomIn:"zoomIn",zoomOut:"zoomOut",reset:"reset",remove:"remove",print:"print",save:"save",firstPage:"firstPage",previousPage:"previousPage",pagination:"pagination",nextPage:"nextPage",lastPage:"lastPage",autoFit:"fitWindow",fitHeight:"fitHeight",fitWidth:"fitWidth",fullPage:"fullPage",fullScreen:"fullScreen"},content:{visibility:!0,besides:{visibility:!0,sequence:1},viewPort:{visibility:!0,sequence:2},allImage:{visibility:!0,displayName:"All Images"}},thumbnail:{visibility:!0,iconClass:"icon-thumbnail",selectedBorderColor:"rgba(255, 0, 0, 1)",selectedBackgroundColor:"rgba(127, 133, 251, 1)",imageBackgroundColor:"rgba(0,0,0,0)",imageBorderColor:"rgba(128, 128, 128, 1)",hoverBackgroundColor:"rgba(196, 250, 248, 1)",hoverBorderColor:"rgba(255, 255, 0, 1)",placeholderBackgroundColor:"rgba(255, 192, 203, 1)",backgroundColor:"rgba(67, 66, 70, 1)",thumbnailBorderColor:"rgba(27, 27, 29, 1)",imageSpace:10,showPageNumber:!1,showThumbnailControl:!0,mouseShape:"pointer",direction:"row",imageDirection:"row",sequence:0},tree:{visibility:!0,iconClass:"icon-tree",selectedColor:"#0000ff",goToThumbnail:!0},tag:{visibility:!0,iconClass:"icon-tags",selectedColor:"#0000ff",goToThumbnail:!0,displayMode:""},cropStyle:{ratios:[[1,1],[3,2],[4,3],[5,4],[7,5],[16,9]],cropMask:!1,cropBar:!0},buttonResize:{ifResize:!1,maxSize:26,minSize:14},skinColor:{topMenuBackground:"#000000",asideBackground:"#ffffff",canvasBackground:"rgba(67,66,70,1)",bottomMenuBackground:"#000000"},presetMode:"basic",theme:"basic"};Window;this.postfix=t,this._pubSub=i,this.buttonList=[],this.groupList=[],this.templateObj={},this.uiConfig=r.default.deepClone(this.defaultUiConfig),e&&r.default.mergeJSON(e,this.uiConfig)}return t.prototype.initUI=function(t,e){if(!t||!r.default.id(t))return this._throwErr(s.ELEMENT_NOT_EXIST),!1;if(e&&!r.default.isObject(e))return this._throwErr(s.PARAMETER_TYPE),!1;void 0!==e&&(this.uiConfig=e),this._btnListInit(),this._groupListInit(),this._templateObjInit();var i='<div id="WebViewer'+this.postfix+"\" style='border-color:"+this.viewerBorderColor+"' class='DVS_WebViewer'>\n      "+this.templateObj.header+"\n      <div id='body"+this.postfix+'\' class="DVS_body">\n    ';i+=this._besidesMenuInit(),i+=this._contentInit(),i+="</div>",i+=this._hiddenBoxInit(),i+="</div>";var n=this.uiConfig;r.default.id(t).innerHTML=i,this.setViewerWidth(this.width),this.setViewerHeight(this.height),this.setThumbnailBackground(n.thumbnail.backgroundColor),this.setThumbnailWidth(this.thumbnailWidth),this.setSelectedImageBorderColor(n.thumbnail.selectedBorderColor),this.setSelectedBackgroundColor(n.thumbnail.selectedBackgroundColor),this.setImageBackgroundColor(n.thumbnail.imageBackgroundColor),this.setImageBorderColor(n.thumbnail.imageBorderColor),this.setHoverBorderColor(n.thumbnail.hoverBorderColor),this.setHoverBackgroundColor(n.thumbnail.hoverBackgroundColor),this.setPlaceholderBackgroundColor(n.thumbnail.placeholderBackgroundColor),this.setShowAside(n.component.asideMenu),this.setShowThumbnail(n.thumbnail.visibility),this.setShowFooter(n.component.bottomMenu),this.setFooterColor(this.footerColor),this.setShowHeader(n.component.header),this.setHeaderColor(this.headerColor),this.setShowTopMenu(n.component.topMenu),this.setTopMenuColor(this.topMenuColor),this.setShowMain(n.content.visibility),this.setShowSideBar(n.content.besides.visibility),this.setshowVideoContainer(this.showVideoContainer),this.setSidebarWidth(this.sidebarWidth),this.emit("_onAddLog",r.default.formatLog("uiInit",!0))},t.prototype._btnListInit=function(){try{var t=this.uiConfig,e=t.buttons,i=t.group;for(var n in i)this.buttonList[n]=[];for(var n in e){var o=e[n].location;if(o&&i[o]){var r=e[n];r.name=n,this._insertMenuArr(o,r,this.buttonList)}}return!0}catch(t){return!1}},t.prototype._groupListInit=function(){try{var t=this.uiConfig,e=t.component,i=t.group;for(var n in e)r.default.isString(n)&&(this.groupList[n]=[]);for(var n in i){var o=i[n];if(r.default.isObject(o)){var s=o.location;if(!s)continue;o.name=n,s&&this._insertMenuArr(s,o,this.groupList)}}return!0}catch(t){return!1}},t.prototype._templateObjInit=function(){for(var t=this.uiConfig.component,e=Object.keys(t),i=0;i<e.length;i++){var n='<div id="'+(e[i]+this.postfix)+"\" class='"+(t[e[i]]?"":"DVS_disabled")+" DVS_"+e[i]+"'>";n+=this._getcomponentInnerTemp(e[i]),n+="</div>",this.templateObj[e[i]]=n}},t.prototype._insertMenuArr=function(t,e,i){var n=i[t];if(n.length)for(var o=0;o<n.length;o++)if(n[o].sequence>e.sequence)return n.splice(o,0,e),o;return n.push(e),n.length-1},t.prototype._getGroupInnerTemp=function(t){for(var e=this.buttonList[t],i="",n=(this.uiConfig,0);n<e.length;n++){var o=e[n].name,r=e[n].iconClass;"pagination"===e[n].name?i+="\n          <label id='pagination"+this.postfix+"' class='DVS_pagination "+(e[n]&&e[n].visibility?"":"DVS_disabled")+"'>\n            <input id =\"pageInput"+this.postfix+'" type ="text" value ="0"/>\n            <span>| </span>\n            <label id ="pageLabel'+this.postfix+'" for= "pageInput'+this.postfix+'"> 0 </label>\n          </label>\n        ':i+='<div class="'+(e[n]&&e[n].visibility?"":"DVS_disabled")+"\n        "+(r?"loadImage"===o?"DVS_uploadFile":"iconfont "+r:"DVS_emptyBtn")+'"\n        id="'+o+"Btn"+this.postfix+'" \n        '+(this.uiConfig.tipsConfig[o]?"title='"+this.uiConfig.tipsConfig[o]+"'":"")+">\n        "+("loadImage"===o?"Upload File":"")+"\n        </div>"}return i},t.prototype._getcomponentInnerTemp=function(t){for(var e="",i=this.groupList[t],n=0,o=i.length;n<o;n++){var r=i[n].name;"pager"===r?e+=this._pagerInit():(e+='<div id="'+(r+this.postfix)+'" class="'+(i[n]&&i[n].visibility?"":"DVS_disabled")+"  DVS_"+r+' DVS_groupType">',e+=this._getGroupInnerTemp(r),e+="</div>")}return e},t.prototype._besidesMenuInit=function(){var t=this.uiConfig,e=0,i=t.tree&&t.tree.visibility,n=t.tag&&t.tag.visibility,o='<div id="besides'+this.postfix+'" style="order:'+t.content.besides.sequence+'"\n    class="DVS_besides '+(t.content.besides.visibility&&(i||n)?"":"DVS_disabled")+'">',r='<ul id="navChange'+this.postfix+'" class="DVS_navChange">',s="<div id='defaultTag"+this.postfix+"' class='DVS_defaultTag DVS_activeAllImage "+(t.content.allImage&&t.content.allImage.visibility?"":"DVS_disabled")+"'>\n    "+t.content.allImage.displayName+"</div>",a='<ul id="paneShow'+this.postfix+'"  class="DVS_paneShow">';return r+='<li id="DirctoryTreeNav'+this.postfix+'" class="DVS_DirctoryTreeNav'+(0===e?" activeTab":"")+" "+(i?"":"DVS_disabled")+'">\n    <div class="iconfont '+t.tree.iconClass+'"></div>\n    </li>',a+='<li id="DirctoryTree'+this.postfix+'" class="DVS_DirctoryTree'+(e?" DVS_nodisplay":"")+" "+(i?"":"DVS_disabled")+'">\n        <ul class="treeLists" id="treeLists'+this.postfix+"\"></ul>\n        <div id='addFolderBox"+this.postfix+"' class='DVS_addFolderBox'>\n          <div id='addFolder"+this.postfix+"' class='DVS_addFolder'>Add folder</div>\n        </div>\n        </li>\n        ",i&&e++,r+='<li id="TagsNav'+this.postfix+'" class="DVS_TagsNav'+(0===e?" activeTab":"")+" "+(n?"":"DVS_disabled")+' ">\n    <div class="iconfont '+t.tag.iconClass+'"></div>\n    </li>',a+='<li id="Tags'+this.postfix+'" class="DVS_Tags'+(e?" DVS_nodisplay":"")+" "+(n?"":"DVS_disabled")+'">\n       \n        <ul id="tagLists'+this.postfix+'" class="tagLists"></ul>\n        <div id=\'addTagBox'+this.postfix+"' class='DVS_addTagBox'>\n          <div id='addTag"+this.postfix+"' class='DVS_addTag'>Add tag</div>\n        </div>\n        </li>",n&&e++,o+=(r+="</ul>")+s+(a+="</ul>"),o+='<div id="stretchBar'+this.postfix+'" class="DVS_stretchBar"></div>\n      </div>'},t.prototype._thumbnailInit=function(){var t=this.uiConfig,e=t.thumbnail&&t.thumbnail.visibility;return'\n    <div id="Thumbnail'+this.postfix+'" class="DVS_Thumbnail '+(e?"":"DVS_disabled")+" \" style='border:1px solid "+this.viewerBorderColor+";\n    order:"+this.uiConfig.thumbnail.sequence+"'>\n        <div id='thumbnailStretchBarLeft"+this.postfix+"' class='DVS_stretchBar DVS_stretchLeft'></div>\n        <div id='thumbnailStretchBarRight"+this.postfix+"' class='DVS_stretchBar DVS_stretchRight'></div>\n        <div id=\"thumbControl"+this.postfix+'" class="DVS_thumbControl '+(t.thumbnail.showThumbnailControl?"":"DVS_disabled")+'">\n          <div id="mutiSelect'+this.postfix+"\" class='DVS_mutipleSelect'>\n            <span>Select Mode</span>\n          </div>\n        </div>\n        <div id=\"mutiControl"+this.postfix+'" class="DVS_mutiControl DVS_nodisplay '+(t.thumbnail.showThumbnailControl?"":"DVS_disabled")+'">\n            <div id="selectAll'+this.postfix+'" class="iconfont icon-selected"></div>\n            <div id="exitMutiple'+this.postfix+'" class="iconfont icon-exitMutiple"></div>\n        </div>\n        <ul id="thumbLists'+this.postfix+"\" style='flex-direction:"+t.thumbnail.imageDirection+";\n        "+("row"===t.thumbnail.imageDirection?"overflow-x: hidden;overflow-y: auto;":"overflow-x: auto;overflow-y: hidden;")+"' class=\"thumbLists "+(t.thumbnail.showPage?"showPage":"")+"\"></ul>\n        <div id='zoomThumbnail"+this.postfix+"' class='DVS_zoomThumbnail "+(t.thumbnail.showThumbnailControl?"":"DVS_disabled")+"'>\n          <div id=\"magnifyImage"+this.postfix+'" class="iconfont icon-magnifyImage"></div>\n          <div id="shrinkImage'+this.postfix+'" class="iconfont icon-shrinkImage"></div>\n        </div>              \n    </div>'},t.prototype._contentInit=function(){var t="<div id='showImageArea"+this.postfix+"' class='DVS_showImageArea' \n    style=\"order:"+this.uiConfig.content.viewPort.sequence+";flex-direction:"+this.uiConfig.thumbnail.direction+'">';t+=this._thumbnailInit(),t+="<div style='border-color:"+this.viewerBorderColor+"' id=\"content"+this.postfix+"\" class='"+(this.uiConfig.content&&this.uiConfig.content.visibility?"":"DVS_disabled")+" DVS_content'>",t+=this.templateObj.topMenu,t+='<div id="middle'+this.postfix+"\"  style='border-color:"+this.viewerBorderColor+"' class='DVS_middle'>",t+=this.templateObj.asideMenu,t+="\n      <div id='container"+this.postfix+"' class='DVS_container'>\n          <div id='outer"+this.postfix+"' class='DVS_outer'>\n            <div id='inner"+this.postfix+"' class='DVS_inner'></div> \n          </div>\n          <div id=\"viewPort"+this.postfix+'" \n            class="'+(this.uiConfig.content.viewPort&&this.uiConfig.content.viewPort.visibility?"":"DVS_disabled")+"  DVS_viewPort\">\n              <div id='cropEditArea"+this.postfix+"' class='DVS_cropEditArea DVS_nodisplay'></div>\n          </div>\n          <div id='videoContainer"+this.postfix+"' class='DVS_videoContainer DVS_nodisplay' style=''>\n            <img id='videoImage"+this.postfix+"' src=''></img>\n          </div>\n      </div>",t+="</div>",t+="<div id='cropBar"+this.postfix+"' class='DVS_cropBar DVS_nodisplay'>\n      <ul id='ratioList"+this.postfix+"' class='DVS_ratioList'>\n  ";for(var e=0;e<this.uiConfig.cropStyle.ratios.length;e++){var i=this.uiConfig.cropStyle.ratios[e];t+="<div class='DVS_cropRatio'>"+i[0]+":"+i[1]+"</div>"}return t+="</ul>\n    <div id='cropConfirmBox"+this.postfix+"' class='DVS_cropConfirmBox'>\n        <div id='confirmCropBtn"+this.postfix+"' class='iconfont icon-confire DVS_confirmCropBtn'></div>\n        <div id='cancleCropBtn"+this.postfix+"' class='iconfont icon-cancle DVS_cancleCropBtn'></div>\n      </div>\n    </div>\n    ",t+=this.templateObj.bottomMenu,t+="</div>\n    </div>"},t.prototype._pagerInit=function(){var t=this.uiConfig,e="",i=this.buttonList.pager;e=' <div id="pager'+this.postfix+'" class="DVS_pager '+(t.group.pager&&t.group.pager.visibility?"":"DVS_disabled")+' DVS_groupType">';for(var n=0;n<i.length;n++){var o=i[n]&&i[n].visibility;"pagination"===i[n].name?(e+='<input id ="pageInput'+this.postfix+'" autocomplete=\'off\' type ="text" value ="0" class=\''+(o?"":"DVS_disabled")+"'/>",e+="<span class='"+(o?"":"DVS_disabled")+"'>| </span>",e+='<label id ="pageLabel'+this.postfix+'" for= "pageInput'+this.postfix+"\" class='"+(o?"":"DVS_disabled")+"'> 0 </label>"):e+='<div id ="'+i[n].name+"Btn"+this.postfix+"\" title='"+t.tipsConfig[i[n].name]+"' \n        class=\""+(o?"":"DVS_disabled")+" iconfont "+i[n].iconClass+'" > </div>'}return e+="</div>"},t.prototype._hiddenBoxInit=function(){var t=this.uiConfig,e="";return e+='<div  id="hiddenBoxs'+this.postfix+'" class="DVS_hiddenBoxs">\n    <ul  id="loadFileType'+this.postfix+'" class="loadFileType DVS_nodisplay">\n        <li  id="load'+this.postfix+'" class="fileBtn">\n            <div class="iconfont icon-file"></div>\n            <span>File</span>\n        </li>\n        <li  id="albumBtn'+this.postfix+'" class="albumBtn">\n            <div class="iconfont icon-file"></div>\n            <span>Album</span>\n        </li>\n        <li  id="cameraBtn'+this.postfix+'" class="cameraBtn">\n            <div class="iconfont icon-file"></div>\n            <span>Camera</span>\n        </li>\n        <li  id="urlBtn'+this.postfix+'" class="urlBtn">\n            <div class="iconfont icon-file"></div>\n            <span>URL</span>\n        </li>\n    </ul>\n    <div  id="saveSettingBox'+this.postfix+'" class="saveSettingBox DVS_nodisplay">\n        <div class="settingBox">\n          <div class=\'DVS_saveFomat\'>\n            <div class="fileNameSetting">\n                <label for="fileNameInput'+this.postfix+'">FileName:</label>\n                <input type="text" id="fileNameInput'+this.postfix+'">\n            </div>\n            <div class="formatSetting">\n                <label for="formatselect'+this.postfix+'">Format:</label>\n                <select name="formatselect" id="formatselect'+this.postfix+'">\n                  <option value="1">PDF</option>\n                  <option value="2">JPEG</option>\n                </select>\n            </div>\n          </div>\n          <div class=\'DVS_pageFormat\'>\n            <div class="pagesSetting">\n                <div class="pageSelect">\n                    <label>Pages:</label>\n                    <input type="radio" name="pages" id="allPage'+this.postfix+'">\n                    <label for="allPage'+this.postfix+'">All</label>\n                    <input type="radio" name="pages" id="currentPage'+this.postfix+'">\n                    <label for="currentPage'+this.postfix+'">Current</label>\n                </div>\n                <input type="text" value="1-10">\n            </div>\n          </div>\n          <div class=\'DVS_qualityFormat\'>\n            <div class="qualitySetting">\n                <label for="qualityInput'+this.postfix+'">Quality:</label>\n                <div class=\'qualityControl\'>\n                  <div>+</div>\n                  <input type="text" id="qualityInput'+this.postfix+'" value="80%">\n                  <div>-</div>\n                </div>\n            </div>\n          </div>\n        </div>\n        <div id="confirmSaveBox'+this.postfix+'" class="confirmSaveBox">\n            <div id="cancleSaveBtn'+this.postfix+'" class="cancleSaveBtn">Cancle</div>\n            <div id="confirmSaveBtn'+this.postfix+'" class="confirmSaveBtn">Save</div>\n        </div>\n    </div>\n    <div id="navigationPane'+this.postfix+'" class="navigationPane DVS_nodisplay">\n        <div id="isShowPane'+this.postfix+'" class="isShowPane">\n            <div class="iconfont icon-selected"></div>\n            <span>Navigation pane</span>\n    </div>\n    <ul id="paneSelector'+this.postfix+'" class="paneSelector">\n            <li id="dirctoryTreePane'+this.postfix+'" class="dirctoryTreePane '+(t.tree&&t.tree.visibility?"":"DVS_disabled")+'">\n                <div class="iconfont icon-selected"></div>\n                <span>DirctoryTree</span>\n            </li>\n            <li  id="tagPane'+this.postfix+'" class="tagPane '+(t.tag&&t.tag.visibility?"":"DVS_disabled")+'">\n                <div class="iconfont icon-selected"></div>\n                <span>Tag</span>\n            </li>\n    </ul>\n    <div  id="thumbnailPane'+this.postfix+'" class="thumbnailPane '+(t.thumbnail&&t.thumbnail.visibility?"":"DVS_disabled")+'">\n            <div class="iconfont icon-selected"></div>\n            <span>Thumbnail</span>\n        </div>\n    </div>\n    <ul id="contextMenu'+this.postfix+"\" class=\"DVS_nodisplay DVS_contextMenu\">\n      <li>Copy</li>\n      <li>Cut</li>\n      <li>Paste</li>\n      <li class='removeFileBtn'>Remove</li>\n      <li class='renameFileBtn'>Rename</li>\n    </ul>\n    \n</div>\n    <div  id=\"confirmBox"+this.postfix+"\" class='DVS_confirmBox DVS_nodisplay'>\n      <div  id=\"shade"+this.postfix+'" class="DVS_shade"></div>\n      <div  id="removeFrame'+this.postfix+'" class="DVS_removeFrame">\n        <div class="frameTitle"><h2>Delete</h3></div>\n        <div class="frameContent">Delete the selected Image?</div>\n        <div class="optionBtns">\n          <div  id="cancelRemove'+this.postfix+'" class="cancelRemove">Cancel</div>\n          <div  id="confirmRemove'+this.postfix+'" class="confirmRemove">Done</div>\n        </div>\n    </div>\n</div>\n'},t.prototype.ID=function(t){return document.getElementById(t+this.postfix)},t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},t.prototype._throwErr=function(t){this.emit("dvs_error",t)},t.prototype._ok=function(){this.emit("dvs_error",s.OK)},t.prototype.setThemeColor=function(t){this.themeColor=t,r.default.query(".DVS_topMenu").style.background=t,r.default.query(".DVS_bottomMenu").style.background=t,r.default.query(".saveSettingBox").style.background=t,r.default.queryAll(".loadFileType>li").forEach((function(e){e.style.background=t})),r.default.queryAll(".DVS_navChange>li>div").forEach((function(e){e.style.color=t})),r.default.queryAll(".DVS_paneShow>li>div>div").forEach((function(e){e.style.color=t})),r.default.query(".DVS_WebViewer").style.borderColor=t,r.default.query(".DVS_navChange").style.borderColor=t,r.default.queryAll(".DVS_navChange>li").forEach((function(e){e.style.borderColor=t,e.style.borderBottomColor="#FFF"})),r.default.queryAll(".DVS_paneShow>li>div").forEach((function(e){e.style.borderBottomColor=t})),r.default.query(".DVS_besides").style.borderRightColor=t},t.prototype.changeMouseShape=function(t){this.mouseShape=t;var e=r.default.id("WebViewer"+this.postfix);return!!e&&(e.style.cursor=t||"default",e.style.cursor?(this._ok(),!0):(this._throwErr(s.PARAMETER_INVALID),!1))},t.prototype.changeButtonClass=function(t,e){var i=this.uiConfig.buttons,n=r.default.id(t+"Btn"+this.postfix);if(n){var o=i[t].iconClass?i[t].iconClass:"",a=n.classList.contains("DVS_disabled")?"DVS_disabled":"";return n.className="iconfont DVS_iconColor "+a+" "+o,n.classList.contains(e)||n.classList.add(e),this._ok(),!0}return this._throwErr(s.ELEMENT_NOT_EXIST),!1},t.prototype.changeButtonSize=function(){var t=r.default.id("WebViewer"+this.postfix);if(!t)return!1;t.classList.add("DVS_buttonResize");var e=t.clientWidth,i=t.clientHeight,n=36*(e/1920<i/1080?e/1920:i/1080)*window.devicePixelRatio,o=r.default.queryAll("#topMenu"+this.postfix+">div:not(.DVS_pager)>div"),s=r.default.queryAll("#bottomMenu"+this.postfix+">div>div"),a=this.uiConfig.buttonResize.maxSize,l=this.uiConfig.buttonResize.minSize;n=Math.floor(n>a?a:n<l?l:n);for(var u=Math.floor(n/2*3),c=Math.floor(u/4*5),h=[o,s],d=0;d<h.length;d++){h[d].forEach((function(t){t.classList.contains("DVS_emptyBtn")?(t.style.width=n+"px",t.style.height=n+"px",t.style.flexBasis=n+"px"):(t.style.fontSize=n+"px",t.style.width=u+"px",t.style.height=u+"px",t.style.flexBasis=u+"px")}))}r.default.id("topMenu"+this.postfix).style.flexBasis=c+"px",r.default.id("topMenu"+this.postfix).style.height=c+"px",r.default.id("bottomMenu"+this.postfix).style.flexBasis=c+"px",r.default.id("bottomMenu"+this.postfix).style.height=c+"px",r.default.id("bottomMenu"+this.postfix).style.justifyContent="flex-start"},t.prototype.setShowPageNumber=function(t){var e=r.default.id("thumbLists"+this.postfix);return this.showPageNumber=t,!!e&&(t?e.classList.add("showPage"):e.classList.remove("showPage"),this._ok(),!0)},t.prototype.setShowSelectBox=function(t){var e=r.default.id("thumbLists"+this.postfix);return this.showSelectBox=t,!!e&&(t?e.classList.add("DVS_mutipleMode"):e.classList.remove("DVS_mutipleMode"),this._ok(),!0)},t.prototype.setShowTopMenu=function(t){var e=r.default.id("topMenu"+this.postfix);return this.uiConfig.component.topMenu=t,this.showTopMenu=t,e?(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0):(this._throwErr(s.ELEMENT_NOT_EXIST),!1)},t.prototype.setTopMenuColor=function(t){var e=r.default.id("topMenu"+this.postfix);return this.topMenuColor=t,e&&(e.style.background=t),!0},t.prototype.setShowHeader=function(t){var e=r.default.id("header"+this.postfix);return this.uiConfig.component.header=t,this.showHeader=t,e?(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0):(this._throwErr(s.ELEMENT_NOT_EXIST),!1)},t.prototype.setHeaderColor=function(t){var e=r.default.id("header"+this.postfix);return this.headerColor=t,e&&(e.style.background=t),!0},t.prototype.setShowSideBar=function(t){var e=r.default.id("besides"+this.postfix);return this.uiConfig.content.besides.visibility=t,this.showSideBar=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},t.prototype.setShowThumbnail=function(t){var e=r.default.id("Thumbnail"+this.postfix);return this.uiConfig.thumbnail.visibility=t,this.showThumbnail=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},t.prototype.setShowAside=function(t){var e=r.default.id("asideMenu"+this.postfix);return this.uiConfig.component.asideMenu=t,this.showAside=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},t.prototype.setShowMain=function(t){var e=r.default.id("viewPort"+this.postfix);return this.uiConfig.content.viewPort.visibility=t,this.showMain=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this.emit("_onShowCanvas",t),this._ok(),!0)},t.prototype.setShowFooter=function(t){var e=r.default.id("bottomMenu"+this.postfix);return this.uiConfig.component.bottomMenu=t,this.showFooter=t,!!e&&(t?e.classList.remove("DVS_disabled"):e.classList.add("DVS_disabled"),this._ok(),!0)},t.prototype.setFooterColor=function(t){var e=r.default.id("bottomMenu"+this.postfix);return this.footerColor=t,e&&(e.style.background=t),!0},t.prototype.setShowThumbnailControl=function(t){var e=r.default.id("thumbControl"+this.postfix),i=r.default.id("mutiControl"+this.postfix),n=r.default.id("zoomThumbnail"+this.postfix);return this.uiConfig.thumbnail.showThumbnailControl=t,this.showThumbnailControl=t,!!(e&&i&&n)&&(t?(e.classList.remove("DVS_disabled"),i.classList.remove("DVS_disabled"),n.classList.remove("DVS_disabled")):(e.classList.add("DVS_disabled"),i.classList.add("DVS_disabled"),n.classList.add("DVS_disabled")),this._ok(),!0)},t.prototype.setViewerWidth=function(t){var e=r.default.id("WebViewer"+this.postfix);if(this.width=t,!e)return!1;if(r.default.isNumber(t)){if(t<0)return this._throwErr(s.PARAMETER_RANGE),!1;e.style.width=t+"px"}else{if(!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;if(!/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t))return this._throwErr(s.PARAMETER_TYPE),!1;e.style.width=t}return this._ok(),!0},t.prototype.getViewerWidth=function(){return r.default.id("WebViewer"+this.postfix).getBoundingClientRect().width},t.prototype.setViewerHeight=function(t){var e=r.default.id("WebViewer"+this.postfix);if(this.height=t,!e)return!1;if(r.default.isNumber(t)){if(t<0)return!1;e.style.height=t+"px"}else{if(!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;if(!/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t))return this._throwErr(s.PARAMETER_TYPE),!1;e.style.height=t}return this._ok(),!0},t.prototype.getViewerHeight=function(){return r.default.id("WebViewer"+this.postfix).getBoundingClientRect().height},t.prototype.setViewerBorderColor=function(t){var e=r.default.id("WebViewer"+this.postfix),i=r.default.id("Thumbnail"+this.postfix),n=r.default.id("content"+this.postfix),o=r.default.id("middle"+this.postfix);e&&(e.style.borderColor=t),i&&(i.style.borderColor=t),n&&(n.style.borderColor=t),o&&(o.style.borderColor=t)},t.prototype.setSelectedImageBorderColor=function(t){this.uiConfig.thumbnail.selectedBorderColor=t;var e=r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb");return e&&e.length&&e.forEach((function(e){e.style.borderColor=t})),this._ok(),!0},t.prototype.setSelectedBackgroundColor=function(t){this.uiConfig.thumbnail.selectedBackgroundColor=t;var e=r.default.queryAll("#thumbLists"+this.postfix+">li.DVS_activeThumb");return e&&e.length&&e.forEach((function(e){e.style.backgroundColor=t})),this._ok(),!0},t.prototype.setImageBackgroundColor=function(t){this.uiConfig.thumbnail.imageBackgroundColor=t;var e=r.default.id("thumbLists"+this.postfix);if(e&&e.children)for(var i=e.children,n=0;n<i.length;n++){var o=i[n];o.classList.contains("DVS_activeThumb")||(o.style.backgroundColor=t)}return this._ok(),!0},t.prototype.setImageBorderColor=function(t){this.uiConfig.thumbnail.imageBorderColor=t;var e=r.default.id("thumbLists"+this.postfix);if(e&&e.children)for(var i=e.children,n=0;n<i.length;n++){var o=i[n];o.classList.contains("DVS_activeThumb")||(o.style.borderColor=t)}return this._ok(),!0},t.prototype.setHoverBorderColor=function(t){return this.uiConfig.thumbnail.hoverBorderColor=t,this._ok(),!0},t.prototype.setHoverBackgroundColor=function(t){return this.uiConfig.thumbnail.hoverBackgroundColor=t,this._ok(),!0},t.prototype.setPlaceholderBackgroundColor=function(t){return this.uiConfig.thumbnail.placeholderBackgroundColor=t,this._ok(),!0},t.prototype.setThumbnailBackground=function(t){this.thumbnailBackground=t,this.uiConfig.thumbnail.backgroundColor=t;var e=this.ID("thumbLists");return e&&(e.style.background=t,e.style.backgroundSize="100% 100%"),this._ok(),!0},t.prototype.setThumbnailBorderColor=function(t){this.uiConfig.thumbnail.thumbnailBorderColor=t;var e=this.ID("Thumbnail");return e&&(e.style.borderColor=t),this._ok(),!0},t.prototype.setSidebarWidth=function(t){var e=r.default.id("besides"+this.postfix);if(!e)return!1;if(r.default.isNumber(t))return!(t<0)&&(e.style.flex="0 0 "+t+"px",e.style.width=t+"px",this.sidebarWidth=t,!0);if(!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;return/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t)?(e.style.flex="0 0 "+t,this.sidebarWidth=t,this._ok(),!0):(this._throwErr(s.PARAMETER_TYPE),!1)},t.prototype.setThumbnailWidth=function(t){var e=r.default.id("Thumbnail"+this.postfix);r.default.id("thumbnailStretchBarRight"+this.postfix);if(!e)return!1;if(this.fullThumbnail?(t="100%",e.style.border="none"):e.style.border=null,r.default.isNumber(t))return!(t<0)&&(e.style.flex="0 0 "+t+"px","row"===this.uiConfig.thumbnail.direction?(e.style.width=t+"px",e.style.height=null):(e.style.height=t+"px",e.style.width=null),this.fullThumbnail||(this.thumbnailWidth=t),!0);if(!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;return/^(100|[1-9]?\d(\.\d\d?\d?)?)%$|0$/.test(t)||this.fullThumbnail?(e.style.flexShrink=0,e.style.flexGrow=0,e.style.flexBasis=t,"row"===this.uiConfig.thumbnail.direction?(e.style.width=""+t,e.style.height=null):(e.style.height=""+t,e.style.width=null),this.fullThumbnail||(this.thumbnailWidth=t),this._ok(),!0):(this._throwErr(s.PARAMETER_TYPE),!1)},t.prototype.setFullThumbnail=function(t){return this.fullThumbnail=t,this.setThumbnailWidth(this.thumbnailWidth),this.emit("_onShowCanvas",!t),this._ok(),!0},t.prototype.setshowVideoContainer=function(t){var e=r.default.id("container"+this.postfix),i=e.children;if(!e||!i)return!1;for(var n=0;n<i.length;n++)i[n].classList.contains("DVS_videoContainer")?t?i[n].classList.remove("DVS_nodisplay"):i[n].classList.add("DVS_nodisplay"):t?i[n].classList.add("DVS_nodisplay"):i[n].classList.remove("DVS_nodisplay");return this.showVideoContainer=t,this._ok(),!0},t.prototype.fullScreen=function(){var t=r.default.id("WebViewer"+this.postfix),e=r.default.launchFullscreen(t);if(e){var i=r.default.id("fullScreenBtn"+this.postfix);i.classList.add("icon-exitFull"),i.classList.remove("icon-fullDevice"),this._ok()}else this._throwErr(s.ELEMENT_NOT_EXIST);return e},t.prototype.cancelFullScreen=function(){var t=r.default.isFullscreen()&&r.default.exitFullscreen();if(t){var e=r.default.id("fullScreenBtn"+this.postfix);e.classList.add("icon-fullDevice"),e.classList.remove("icon-exitFull"),this._ok()}else this._throwErr(s.ELEMENT_NOT_EXIST);return t},t.prototype.fullPage=function(){var t=r.default.id("WebViewer"+this.postfix),e=r.default.id("fullPageBtn"+this.postfix);return t?(t.classList.add("fitPage"),e.classList.add("icon-exitFullWeb"),e.classList.remove("icon-fullWeb"),this.cancelFullScreen(),this._ok(),!0):(this._throwErr(s.ELEMENT_NOT_EXIST),!1)},t.prototype.cancelFullPage=function(){var t=r.default.id("WebViewer"+this.postfix),e=r.default.id("fullPageBtn"+this.postfix);return t?(t.classList.remove("fitPage"),e.classList.add("icon-fullWeb"),e.classList.remove("icon-exitFullWeb"),this.cancelFullScreen(),this._ok(),!0):(this._throwErr(s.ELEMENT_NOT_EXIST),!1)},t.prototype.bindContent=function(t,e,i){this._contentContainer||(this._contentContainer={}),t||(t=this._contentContainer.containerId);var n=r.default.id("content"+this.postfix),o=r.default.id("header"+this.postfix),a=r.default.id(t);if(e&&i||(e=this._contentContainer.width,i=this._contentContainer.height),!a||!o||!n)return this._throwErr(s.ELEMENT_NOT_EXIST),!1;var l=document.createElement("div");return l.setAttribute("style","display:flex;flex-direction:column;width:100%;height:100%;"),l.id="contentContainer"+this.postfix,l.appendChild(o),l.appendChild(n),e>=0&&i>=0&&(l.style.width=e+"px",l.style.height=i+"px"),a.appendChild(l),this._contentContainer={containerId:t,width:e,height:i},this._ok(),!0},t.prototype.unbindContent=function(t){void 0===t&&(t=!1);try{var e=r.default.id("WebViewer"+this.postfix);if(!e)return!1;var i=r.default.id("content"+this.postfix),n=r.default.id("header"+this.postfix),o=r.default.id("showImageArea"+this.postfix),s=r.default.id("contentContainer"+this.postfix);return n&&e.insertBefore(n,e.children[0]),o&&i&&o.appendChild(i),s&&s.parentNode&&s.parentNode.removeChild(s),t||(this._contentContainer=null,i.style.width=null,i.style.height=null),this._ok(),!0}catch(t){return!1}},t.prototype.switchToTagTab=function(){var t=r.default.id("TagsNav"+this.postfix),e=t&&t.children[0];return!!e&&(e.click(),!0)},t.prototype.switchToTreeTab=function(){var t=r.default.id("DirctoryTreeNav"+this.postfix),e=t&&t.children[0];return!!e&&(e.click(),!0)},t.prototype.bindMainContent=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=!1),!r.default.isString(t)||!r.default.isNumber(e)||!r.default.isBoolean(i))return this._throwErr(s.PARAMETER_TYPE),!1;var n=r.default.id(t);if(!n)return this._throwErr(s.ELEMENT_NOT_EXIST),!1;var o=r.default.id("middle"+this.postfix);if(!o)return this._throwErr(s.ELEMENT_NOT_EXIST),!1;var a={nodeId:t,styleAttr:n.getAttribute("style"),sequence:e,isFull:i},l=n.parentNode;return l&&l!==o&&(l.id&&(a.parentId=l.id),a.nodeIndex=r.default.getIndex(n)),o.appendChild(n),n.style.order=e,i?n.classList.add("DVS_full"):n.classList.remove("DVS_full"),this.mainContentList[t]=a,this._ok(),!0},t.prototype.unbindMainContent=function(t,e){if(void 0===e&&(e=!1),!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;var i=r.default.id(t);if(!i)return this._throwErr(s.ELEMENT_NOT_EXIST),!1;if(!r.default.id("middle"+this.postfix))return this._throwErr(s.ELEMENT_NOT_EXIST),!1;var n=this.mainContentList[t];if(!n)return this._ok(),!e&&(this.mainContentList[t]=null),!0;var o=r.default.id(n.parentId);return o?(o.insertBefore(i,o.children[n.nodeIndex]),i.classList.remove("DVS_full"),i.setAttribute("style",n.styleAttr),this._ok(),!e&&(this.mainContentList[t]=null),!0):(i.parentNode.removeChild(i),this._ok(),!e&&(this.mainContentList[t]=null),!0)},t.prototype.toggleMainContent=function(t){if(!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;var e=r.default.id(t);return e?(e.classList.toggle("DVS_nodisplay"),this._ok(),!0):(this._throwErr(s.ELEMENT_NOT_EXIST),!1)},t.prototype.showMainContent=function(t){if(!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;var e=r.default.id(t);return e?(e.classList.remove("DVS_nodisplay"),this._ok(),!0):(this._throwErr(s.ELEMENT_NOT_EXIST),!1)},t.prototype.hideMainContent=function(t){if(!r.default.isString(t))return this._throwErr(s.PARAMETER_TYPE),!1;var e=r.default.id(t);return e?(e.classList.add("DVS_nodisplay"),this._ok(),!0):(this._throwErr(s.ELEMENT_NOT_EXIST),!1)},t.prototype.unbindAllMainContent=function(t){void 0===t&&(t=!1);var e=this.mainContentList;for(var i in e){e[i]&&this.unbindMainContent(i,t)}},t.prototype.bindAllMainContent=function(){var t=this.mainContentList;for(var e in t){var i=t[e];i&&this.bindMainContent(e,i.sequence,i.isFull)}},t}();e.Viewer=a},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=i(39),s=i(5),a=i(41),l=i(42),u=o(i(0)),c=o(i(1)),h=c.default.errorMessages,d=function(){function t(t){this.totalcount=0,this.pageWidth=0,this.pageHeight=0,this.ifAllowSlide=!0,this.scrollTop=0,this.scrollLeft=0,this._existImage=!1,this._lastZoom4Stretch=1,this._lastFitType4Stretch="window",this.zoomInStretch=!1,this.isClickToZoom=!1,this.zoom=1,this.realZoom=1,this.zoomInDelta=1.2,this.zoomOutDelta=1.2,this.canvasInnerWidth=375,this.canvasInnerHeight=667,this.fitType="window",this.lastFitType="window",this.viewMode="onePage",this.selectionRectAspectRatio=1,this.canvasContainer=null,this.mouseShape="default",this._isStretch=!1,this._minZoom=.1,this._maxZoom=8,this._slideMove=!1,this._isSliding=!1,this._isSingleTouch=!1,this._isProcessing=!1,this._isDecelerationComplete=!1,this._isDragging=!1,this._isDecelerating=!1,this._isAnimating=!1,this._outerLeft=0,this._outerTop=0,this._outerWidth=0,this._outerHeight=0,this._innerWidth=0,this._innerHeight=0,this._zoom=1,this._scrollLeft=0,this._scrollTop=0,this._maxScrollLeft=0,this._maxScrollTop=0,this._scheduledLeft=0,this._scheduledTop=0,this._scheduledZoom=0,this._lastTouchLeft=null,this._lastTouchTop=null,this._lastTouchStart=null,this._lastTouchMove=null,this._positions=null,this._minDecelerationScrollLeft=null,this._minDecelerationScrollTop=null,this._maxDecelerationScrollLeft=null,this._maxDecelerationScrollTop=null,this._decelerationVelocityX=null,this._decelerationVelocityY=null,this.scrollingX=!0,this.scrollingY=!0,this.animating=!1,this.animationDuration=250,this.bouncing=!0,this.locking=!1,this.zooming=!0,this.speedDelta=1,this.scrollingComplete=null,this.penetrationDeceleration=.03,this.penetrationAcceleration=.08,this.keepZoom=!1,this.useRelativeZoom=!0,this._tempImage=null,this.containerId=null,this._imgArr=[],this._renderUid=null,this._renderUrl=null,this._renderImage=null,this._editorStack=null,this.calcWidth=0,this.calcHeight=0,this.userZoom=1,this.isZoom=!1,this.scrollerWidth=0,this.scrollerHeight=0,this.newRect={x:0,y:0,width:0,height:0},this.originZoomX=1,this.originZoomY=1,this._firstZoomAngle=null,this.isScrollerBar=!1,this.tempCanvas=null,this.fitZoom={zoomX:1,zoomY:1},this.cropAndEraseNum=0,this.curImageUid=null,this._freeCropStartX=0,this._freeCropStartY=0,this._easeOutCubic=function(t){return Math.pow(t-1,3)+1},this._easeInOutCubic=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},this._pubSub=t.pubsub,this.emit("_onAddLog","Initialization canvas."),this.canvasCssHeight=t.canvasCssHeight||0,this.canvasCssWidth=t.canvasCssWidth||0,this.backgroundColor=t.backgroundColor||"rgba(67,66,70,1)",this.scaleCoefficient=t.scaleCoefficient||1,this._scrollerConfig=t.scrollerConfig,this._initDevicePixelRatio(),this._initAnimation(),this._initCanvas(),this._initScroller(t.scrollerConfig),this._initTransformStack(),this.on("publishScrollResult",function(t){this.scrollLeft=t.left,this.scrollTop=t.top,this.zoom=t.zoom}.bind(this)),this.on("_onCanvasScroll",function(t){this.scrollTo(t.left,t.top,!1),this.emit("render")}.bind(this)),this.on("_onImageAreaSelected",function(t){var e=this._getImageRelArea(t.x,t.y,t.width,t.height);this.emit("imageAreaSelected",{index:t.index,x:e.x,y:e.y,width:e.width,height:e.height,areaIndex:t.areaIndex})}.bind(this)),this.on("_getImageCountForCanvas",function(t){this._existImage=t>0}.bind(this)),this.on("getDrawImageData",function(t){this._imgArr=[];for(var e=t.length,i=0;i<e;i++){var n={};n.uid=t[i].uid,n.url=t[i].originalData,n.width=null,n.height=null,n.angle=0,n.naturalWidth=null,n.naturalHeight=null,this._imgArr.push(n)}}.bind(this)),this.on("resetTrnasform",function(){this._editorStack.reset(),this._zoom=1,this.originZoomX=1,this.originZoomY=1,this.isScrollerBar=!1,this._firstZoomAngle=0,this.newRect={x:0,y:0,width:0,height:0},this.isZoom=!1}.bind(this)),this.on("_onScrollWheel",function(t){this._onWheelHandler(t)}.bind(this)),this.emit("_onAddLog","Initialization canvas conpleted.")}return t.prototype._checkColor=function(t){if(!u.default.isString(t))return this._throwError(h.PARAMETER_TYPE),!1;return!!(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/.test(t)||/^[rR][gG][Bb][Aa]?[\(]([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}[\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?[\s]*(0\.\d{1,2}|1|0)?[\)]{1}$/g.test(t)||/^url\(.*\)$/g.test(t))||(this._throwError(h.PARAMETER_TYPE),!1)},t.prototype.onSetOperationMode=function(t){this.isClickToZoom=2===t},t.prototype._initTransformStack=function(){this._editorStack=new s.Transform2d},t.prototype._initCanvas=function(){var t=this;this.tempCanvas=new a.CanvasCache,this._canvas=new r.Canvas({canvasCssWidth:this.canvasCssWidth,canvasCssHeight:this.canvasCssHeight,devicePixelRatio:this.devicePixelRatio,backgroundColor:this.backgroundColor,scaleCoefficient:this.scaleCoefficient}),this._canvas.lowerContext.scale(this.devicePixelRatio,this.devicePixelRatio),this._canvas.upperContext.scale(this.devicePixelRatio,this.devicePixelRatio),this._getCanvasInnerSize();var e=this._canvas.upperCanvas;e.addEventListener("click",(function(e){t.emit("click",e)}),!1),e.addEventListener("mouseup",(function(e){2===e.button&&t.emit("rightClick",e)}),!1),e.addEventListener("dblclick",(function(e){t.emit("doubleClick",e)}),!1),e.addEventListener("mousemove",(function(e){t.emit("move",e)}),!1),e.addEventListener("touchmove",(function(e){t.emit("move",e)}),!1),this.emit("initCanvas")},t.prototype.resetScroller=function(){this._renderImage&&this.calcNewScrollArea(this._renderImage),this.keepZoom||this.zoomTo(1,!1),this.scrollTo(this._maxScrollLeft/2,this._maxScrollTop/2,!1)},t.prototype.resetScroller4FitType=function(){this._tempImage&&(this._calScrollerArea(0,0),this.calcNewScrollArea(this._tempImage),this.zoomTo(1,!1),this.scrollTo(this._maxScrollLeft/2,this._maxScrollTop/2,!1))},t.prototype._initScroller=function(t){if(t)for(var e=Object.keys(t),i=0,n=e.length;i<n;i++)this[e[i]]=t[e[i]];this.setValidArea(this.canvasCssWidth,this.canvasCssHeight,this.canvasCssWidth,this.canvasCssHeight),this._initScrollerPosition(),this._bindScrollerEvent()},t.prototype._initScrollerPosition=function(){var t=this.getUpperCanvasElement();if(!t)return!1;var e={left:0,top:0,right:0,bottom:0,width:0,height:0};try{e=t.getBoundingClientRect()}catch(t){}this.setPosition(e.left+window.pageXOffset+t.clientLeft,e.top+window.pageYOffset+t.clientTop)},t.prototype._initAnimation=function(){this._time=Date.now||function(){return+new Date},this._fps=60,this._running={},this._counter=1},t.prototype.render=function(t,e){var i=this,n=this._imgArr;if(0===n.length)return this.clearCanvas(),void(this._renderImage=null);if(null!=t&&!(t>=n.length)){var o=n[t].url,r=n[t].uid;this.curImageUid=r;var s=new Image;s.crossOrigin="anonymous",this._renderUid===r&&this._renderUrl===o&&null!==this._renderUrl&&null!==this._renderImage?(s=this._renderImage,this._render(s,!1),this.emit("_onSendCropLimitArea")):(this._renderImage=null,this._renderImage=s,s.src=o,s.onload=function(){var t=this;this.resetScroller(),clearTimeout(this._renderTimer),this._renderTimer=setTimeout((function(){if(t._renderUid!==r&&t._renderUrl!==o&&(t.cropAndEraseNum=0),t._renderUid!==r||t._renderUrl!==o){t._renderUrl=o,t._renderUid=r;var e=t.isZoom,i=t._zoom;t.emit("resetTrnasform"),t.keepZoom&&e&&(t.isZoom=!0,t._zoom=i)}t._render(s,!0),t.emit("_onSendCropLimitArea")}),0)}.bind(this),s.onerror=function(){i._renderUrl=null,i.clearCanvas(),i.emit("dvs_error",c.default.errorMessages.IMG_LOAD_FAILED)})}},t.prototype.calcNewScrollArea=function(t){if(null!==t){this._tempImage={naturalHeight:t.naturalHeight,naturalWidth:t.naturalWidth},this.calcWidth=t.naturalWidth,this.calcHeight=t.naturalHeight,this._canvas.clearCanvas(-this.canvasInnerWidth*this.devicePixelRatio,-this.canvasInnerHeight*this.devicePixelRatio,this.canvasInnerWidth*this.devicePixelRatio*2,this.canvasInnerHeight*this.devicePixelRatio*2);var e=this._editorStack.rectangleRotate(0,0,t.naturalWidth,t.naturalHeight,this._editorStack.totalAngle),i=this._calPosition(e.width,e.height,this.lastFitType);this.fitZoom=i,this.newRect=e,this.isZoom||(this.originZoomX=i.zoomX,this.originZoomY=i.zoomY),this.isZoom&&null===this._firstZoomAngle&&(this._firstZoomAngle=this._editorStack.totalAngle);var n=this.newRect.width*this.originZoomX*this._zoom,o=this.newRect.height*this.originZoomY*this._zoom;if(n>this.canvasCssWidth&&o>this.canvasCssHeight?this.isScrollerBar=!0:this.isScrollerBar=!1,this.isScrollerBar){var r=this._editorStack.rectangleRotate(0,0,t.naturalWidth,t.naturalHeight,this._firstZoomAngle);this._calPosition(r.width,r.height,this.lastFitType);this.originZoomX=i.zoomX,this.originZoomY=i.zoomY}this._calScrollerArea(e.width*this.originZoomX,e.height*this.originZoomY)}},t.prototype._render=function(t,e){this.calcNewScrollArea(t);var i=this._editorStack.calcTranslateDis(this.scrollLeft-this._maxScrollLeft/2,this.scrollTop-this._maxScrollTop/2),n=this._canvas.lowerContext,o=this._zoom*this.originZoomX,r=this._zoom*this.originZoomY;return n.save(),this._editorStack.setTransform(this._canvas.lowerContext),n.scale(o,r),this._canvas.render(t,0,0,t.naturalWidth,t.naturalHeight,-i.x/this.originZoomX/this._zoom-t.naturalWidth/2,-i.y/this.originZoomY/this._zoom-t.naturalHeight/2,t.naturalWidth,t.naturalHeight),n.restore(),!0},t.prototype.tempCanvasRender=function(t){var e=this._editorStack.rectangleRotate(0,0,t.naturalWidth,t.naturalHeight,this._editorStack.totalAngle);this.tempCanvas.setCanvasSize(e.width,e.height);var i=this.tempCanvas.context;i.clearRect(0,0,e.width,e.height),i.save(),i.transform(1,0,0,1,e.width/2,e.height/2),this._editorStack.setTransform(i),i.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,-t.naturalWidth/2,-t.naturalHeight/2,t.naturalWidth,t.naturalHeight),i.restore()},t.prototype.tempCanvasCrop=function(t,e,i,n){var o=this,r=this.tempCanvas.context,s=r.getImageData(t,e,i,n);this.tempCanvas.setCanvasSize(i,n),r.clearRect(0,0,i,n),r.putImageData(s,0,0),s=null;var a=this.curImageUid;r.canvas.toBlob((function(t){var e=!1;o.cropAndEraseNum>1&&(e=!0),o.emit("_onUpdateImage",a,{originalData:t,minData:t},e),o.emit("_onUpdateMetaData",i,n)})),this.tempCanvas.setCanvasSize()},t.prototype.changeMouseShape=function(t){this.mouseShape=t,this._canvas.setMouseShape(t),this.mouseShape=t},t.prototype.setCanvasBackgroundColor=function(t){if(u.default.isColor(t))return this.backgroundColor=t,this._canvas.setBackgroundColor(t)},t.prototype.clearCanvas=function(){this._canvas.clearCanvas(-this.canvasInnerWidth,-this.canvasInnerHeight,2*this.canvasInnerWidth,2*this.canvasInnerHeight)},t.prototype.clearUpperCanvas=function(){this._canvas.clearUpperCanvas(-this.canvasInnerWidth,-this.canvasInnerHeight,2*this.canvasInnerWidth,2*this.canvasInnerHeight)},t.prototype.getCanvas=function(){return this._canvas},t.prototype.getLowerCanvasElement=function(){return this._canvas.lowerCanvas},t.prototype.getUpperCanvasElement=function(){return this._canvas.upperCanvas},t.prototype._initDevicePixelRatio=function(){this.devicePixelRatio=u.default.devicePixelRatio()||1},t.prototype.zoomIn=function(){if("stretch"===this.fitType)return!1;this.isZoom=!0;var t=this.zoom;return(t*=this.zoomInDelta)>this.minZoom&&t<this.maxZoom&&(this.zoomTo(t,!1),this.emit("render")),this.emit("_onClearCropBoxes"),!0},t.prototype.zoomOut=function(t,e){if("stretch"===this.fitType)return!1;this.isZoom=!0;var i=this.zoom;return(i/=this.zoomOutDelta)>this.minZoom&&i<this.maxZoom&&(this.zoomTo(i,!1),this.emit("render",!0)),this.emit("_onClearCropBoxes"),!0},t.prototype.mirror=function(){alert("待实现...")},t.prototype.flip=function(t){t=void 0===t?0:t;var e=this._canvas.lowerContext;return this._editorStack.flip(t),this.clearCanvas(),e.save(),this.emit("render"),e.restore(),!0},t.prototype.rotate=function(t,e){var i=this._canvas.lowerContext;this._editorStack.rotate(t);this._editorStack.getLatestResult();return this.clearCanvas(),i.save(),this.emit("_onCanvasZoom",this._getCropLimitAreaForScroll()),this.emit("render"),i.restore(),!0},t.prototype.crop=function(t,e,i,n){return this.cropAndEraseNum+=1,this.tempCanvasRender(this._renderImage),this.tempCanvasCrop(t,e,i,n),this.emit("resetTransform"),!0},t.prototype.erase=function(t,e,i,n,o){var r=this;this.cropAndEraseNum+=1,this.tempCanvasRender(this._renderImage);var s=this.tempCanvas.context;s.save(),s.fillStyle=o,s.clearRect(t,e,i,n),s.fillRect(t,e,i,n),s.restore();var a=this.curImageUid;return s.canvas.toBlob((function(t){var e={originalData:t,minData:t},i=!1;r.cropAndEraseNum>1&&(i=!0),r.emit("_onUpdateImage",a,e,i)})),this.tempCanvas.setCanvasSize(),this.emit("resetTransform"),!0},t.prototype.saveTransformResult=function(){var t=this;if(!this._renderImage)return!0;this.tempCanvasRender(this._renderImage);var e=this._editorStack.rectangleRotate(0,0,this._renderImage.naturalWidth,this._renderImage.naturalHeight,this._editorStack.totalAngle);this._renderImage=null,this.cropAndEraseNum=0;var i=this.curImageUid;return this.tempCanvas.canvas.toBlob((function(n){t.emit("_onUpdateImage",i,{originalData:n,minData:n},!0),t.emit("_onUpdateMetaData",e.width,e.height)})),this.tempCanvas.setCanvasSize(),this.emit("resetTransform"),!0},t.prototype._getImageRelArea=function(t,e,i,n){return{x:t=(t-(this.canvasCssWidth/2-this.newRect.width*this.originZoomX*this._zoom/2-(this.scrollLeft-this._maxScrollLeft/2)))/this._zoom/this.originZoomX,y:e=(e-(this.canvasCssHeight/2-this.newRect.height*this.originZoomY*this._zoom/2-(this.scrollTop-this._maxScrollTop/2)))/this._zoom/this.originZoomY,width:i=i/this._zoom/this.originZoomX,height:n=n/this._zoom/this.originZoomY}},t.prototype.getCropAreaRelativeToImage=function(t,e,i,n){return!!this._tempImage&&{x:t=t*this.originZoomX*this._zoom-this.scrollLeft,y:e=e*this.originZoomY*this._zoom-this.scrollTop,width:i=i*this.originZoomX*this._zoom,height:n=n*this.originZoomY*this._zoom}},t.prototype.setZoom=function(t){if(this.isZoom=!0,"stretch"===this.fitType)return!1;t>this._maxZoom&&(t=this._maxZoom),t<this._minZoom&&(t=this._minZoom),this.useRelativeZoom||(t/=this.originZoomX),this.zoomTo(t,!1),this.emit("render"),this.emit("_onClearCropBoxes")},t.prototype.setMinZoom=function(t){this._minZoom=t},t.prototype.getMinZoom=function(){return this._minZoom},t.prototype.setMaxZoom=function(t){this._maxZoom=t},t.prototype.getMaxZoom=function(){return this._maxZoom},Object.defineProperty(t.prototype,"minZoom",{get:function(){return this._minZoom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxZoom",{get:function(){return this._maxZoom},enumerable:!0,configurable:!0}),t.prototype.setFitType=function(t){-1!==["window","width","height","stretch","origin","none"].indexOf(t)&&(this.isZoom=!1,this.fitType=t,"none"!==t&&("stretch"!==t&&(this._lastFitType4Stretch=t,this._lastZoom4Stretch=this.zoom),this.lastFitType=t))},t.prototype.stretchImage=function(){this._startX=0,this._startY=0,this._drawWidth=this.canvasInnerWidth,this._drawHeight=this.canvasInnerHeight,this._isStretch=!0,this.emit("render")},t.prototype._getCropLimitAreaForScroll=function(){var t=this.newRect;return{x:this.scrollLeft,y:this.scrollTop,width:t.width*this.originZoomX*this._zoom,height:t.height*this.originZoomY*this._zoom}},t.prototype._getCropLimitAreaForCrop=function(){var t=this.newRect.width*this.originZoomX*this._zoom,e=this.newRect.height*this.originZoomY*this._zoom,i=(this.canvasCssWidth-t)/2,n=(this.canvasCssHeight-e)/2;return{x:(i-=this.scrollLeft-this._maxScrollLeft/2)<0?0:i,y:(n-=this.scrollTop-this._maxScrollTop/2)<0?0:n,width:t>this.canvasCssWidth?this.canvasInnerWidth:t,height:e>this.canvasCssHeight?this.canvasInnerHeight:e}},t.prototype.setSelectionRectAspectRatio=function(t){u.default.isNumber(t)&&t>0&&(this.selectionRectAspectRatio=t)},t.prototype._calFitWidth=function(t,e){var i=1;return{zoomX:i=t<=this.canvasCssWidth?1:this.canvasCssWidth/t,zoomY:i}},t.prototype._calFitHeight=function(t,e){var i=1;return{zoomX:i=e<=this.canvasCssHeight?1:this.canvasCssHeight/e,zoomY:i}},t.prototype._calFitWindow=function(t,e){return t<=this.canvasCssWidth&&e<=this.canvasCssHeight?this._calFitWidth(t,e):t>this.canvasCssWidth&&e<=this.canvasCssHeight?this._calFitWidth(t,e):t<=this.canvasCssWidth&&e>this.canvasCssHeight?this._calFitHeight(t,e):t/this.canvasCssWidth>=e/this.canvasCssHeight?this._calFitWidth(t,e):this._calFitHeight(t,e)},t.prototype._calFitStretch=function(t,e){return{zoomX:this.canvasCssWidth/t,zoomY:this.canvasCssHeight/e}},t.prototype._calFitOrigin=function(t,e){return{zoomX:1,zoomY:1}},t.prototype._calPosition=function(t,e,i){this._getCanvasInnerSize();var n=null;if("width"===i)n=this._calFitWidth(t,e);else if("height"===i)n=this._calFitHeight(t,e);else if("window"===i)n=this._calFitWindow(t,e);else if("origin"===i)n=this._calFitOrigin(t,e);else{if("stretch"!==i)throw new Error("The fitType is error.");n=this._calFitStretch(t,e)}return this.realZoom=n.zoomX,n},t.prototype._calStartPoint=function(){var t=this.zoom;return{startX:this._drawWidth*t<this.canvasInnerWidth?(this.canvasInnerWidth-this._drawWidth*t)/2:0,startY:this._drawHeight*t<this.canvasInnerHeight?(this.canvasInnerHeight-this._drawHeight*t)/2:0}},t.prototype._calScrollerArea=function(t,e){this._initScrollerPosition(),this.setValidArea(this.canvasCssWidth,this.canvasCssHeight,t,e)},t.prototype.onCanvasResize=function(){document.getElementById(this.containerId)&&(this.setCanvasSize(),this._getCanvasInnerSize(),this._initScrollerPosition(),this.emit("_onSendCropLimitArea"),this.emit("render"))},t.prototype.setCanvasSize=function(){var t=document.getElementById(this.containerId);this.canvasCssWidth=t.getBoundingClientRect().width,this.canvasCssHeight=t.getBoundingClientRect().height,this._canvas.setCanvasSize(this.canvasCssWidth,this.canvasCssHeight)},t.prototype._getCanvasInnerSize=function(){this.canvasInnerWidth=this._canvas.innerWidth,this.canvasInnerHeight=this._canvas.innerHeight},t.prototype.unbindCanvasContainer=function(){document.getElementById(this.containerId).addEventListener("touchmove",(function(t){t.preventDefault(),t.stopPropagation()}));var t=document.getElementById("canvasWrrapper");t&&(t.removeChild(this._canvas.lowerCanvas),t.removeChild(this._canvas.upperCanvas))},t.prototype.bindCanvasContainer=function(t){if(t){this.containerId=t;var e=document.getElementById(t);if(e){var i=document.createElement("div");return i.id="canvasWrapper",i.appendChild(this._canvas.lowerCanvas),i.appendChild(this._canvas.upperCanvas),e.appendChild(i),this.emit("_onCanvasResize"),!0}return this._throwError(h.ELEMENT_NOT_EXIST),!1}return this._throwError(h.PARAMETER_TYPE),!1},t.prototype._throwError=function(t){this.emit("dvs_error",t)},t.prototype._calDistance=function(t){return Math.sqrt(Math.pow(t[0].pageX-t[1].pageX,2)+Math.pow(t[0].pageY-t[1].pageY,2))},t.prototype._bindScrollerEvent=function(){var t=this;if("ontouchstart"in window)this.getUpperCanvasElement().addEventListener("touchstart",(function(e){e.preventDefault(),e.touches[0]&&e.touches[0].target&&e.touches[0].target.tagName.match(/input|textarea|select/i)||(t._pageX=e.pageX,t._pageY=e.pageY,"stretch"!==t.fitType&&(e.touches.length>1&&(t._startDistance=t._calDistance(e.touches)),t._touchStartHandler(e.touches,e.timeStamp)))}),!1),document.addEventListener("touchmove",(function(e){if("stretch"!==t.fitType){var i=1;if(e.touches.length>1)i=t._calDistance(e.touches)/t._startDistance;e.scale&&(i=e.scale),t._touchMoveHandler(e.touches,e.timeStamp,i),t.emit("_onExistImage"),t._existImage&&(t.emit("_onCanvasZoom",t._getCropLimitAreaForScroll()),t.emit("render"))}}),!1),document.addEventListener("touchend",(function(e){if(t._startDistance=0,"stretch"!==t.fitType){if(t.isClickToZoom){var i=e.changedTouches[0];t._pageX===i.pageX&&t._pageY===i.pageY&&(t.isZoom=!0,t.zoomTo(t._zoom*t.zoomInDelta,!1,i.pageX-t._outerLeft,i.pageY-t._outerTop),t.emit("render"))}t._toucheEndHandler(e.timeStamp)}}),!1),document.addEventListener("touchcancel",(function(e){t._startDistance=0,"stretch"!==t.fitType&&t._toucheEndHandler(e.timeStamp)}),!1);else{var e=!1;this.getUpperCanvasElement().addEventListener("mousedown",(function(i){i.target.tagName.match(/input|textarea|select/i)||(t._pageX=i.pageX,t._pageY=i.pageY,"stretch"!==t.fitType&&t._touchStartHandler([{pageX:i.pageX,pageY:i.pageY}],i.timeStamp),i.preventDefault(),e=!0)}),!1),document.addEventListener("mousemove",(function(i){e&&("stretch"!==t.fitType&&(t._touchMoveHandler([{pageX:i.pageX,pageY:i.pageY}],i.timeStamp),t.emit("_onExistImage"),t._existImage&&0!==t.scrollLeft&&0!==t.scrollTop&&t.emit("render")),i.preventDefault(),e=!0)}),!1),document.addEventListener("mouseup",(function(i){e&&("stretch"!==t.fitType&&(t.isClickToZoom&&t._pageX===i.pageX&&t._pageY===i.pageY&&(t.isZoom=!0,t.userZoom*=t.zoomInDelta,t.zoomTo(t._zoom*t.zoomInDelta,!1,i.pageX-t._outerLeft,i.pageY-t._outerTop),t.emit("render")),t._toucheEndHandler(i.timeStamp)),i.preventDefault(),e=!1)}),!1),this.getUpperCanvasElement().addEventListener("wheel",(function(e){t._onWheelHandler(e)}),!1)}},t.prototype._onWheelHandler=function(t){t.preventDefault();var e=1,i=0;e=t.wheelDelta?t.wheelDelta:-t.deltaY,t.ctrlKey&&"stretch"!==this.fitType?(i=e>0?1.05:.95,this.isZoom=!0,this.userZoom*=i,this._mouseZoomHandler(e,t.timeStamp,t.pageX,t.pageY),this.emit("render")):t.shiftKey?(i=e<0?30:-30,this.scrollTo(this._scrollLeft+i,this._scrollTop,!1),this.emit("render")):(i=e<0?30:-30,this.scrollTo(this._scrollLeft,this._scrollTop+i,!1),this.emit("render"))},t.prototype.on=function(t,e){this._pubSub.on(t,e)},t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];(e=this._pubSub).emit.apply(e,n([t],i))},t.prototype.off=function(t,e){this._pubSub.off(t,e)},t.prototype.setValidArea=function(t,e,i,n){t===+t&&(this._outerWidth=t),e===+e&&(this._outerHeight=e),i===+i&&(this._innerWidth=i),n===+n&&(this._innerHeight=n),this._calMaxScroll()},t.prototype.setPosition=function(t,e){this._outerLeft=t||0,this._outerTop=e||0},t.prototype.getValues=function(){return{left:this._scrollLeft,top:this._scrollTop,zoom:this._zoom}},t.prototype.getScrollMax=function(){return{left:this._maxScrollLeft,top:this._maxScrollTop}},t.prototype.zoomTo=function(t,e,i,n,o){if(!u.default.isNumber(t))return this._throwError(h.PARAMETER_TYPE),!1;if(t<=0)return this._throwError(h.PARAMETER_RANGE),!1;if(!this.zooming)throw new Error("Zooming is not enabled!");o&&(this._zoomComplete=o),this._isDecelerating&&(this._stop(this._isDecelerating),this._isDecelerating=!1);var r=this._zoom;null==i&&(i=this._outerWidth/2),null==n&&(n=this._outerHeight/2),t=Math.max(Math.min(t,this.maxZoom),this.minZoom),this._calMaxScroll(t);var s=(i+this._scrollLeft)*t/r-i,a=(n+this._scrollTop)*t/r-n;return s>this._maxScrollLeft?s=this._maxScrollLeft:s<0&&(s=0),a>this._maxScrollTop?a=this._maxScrollTop:a<0&&(a=0),this._innerWidth*r<this._outerWidth&&(s=this._maxScrollLeft/2),this._innerHeight*r<this._outerHeight&&(a=this._maxScrollTop/2),this._publish(s,a,t,e),this.emit("_onCanvasZoom",this._getCropLimitAreaForScroll()),!0},t.prototype.zoomBy=function(t,e,i,n,o){this.zoomTo(this._zoom*t,e,i,n,o)},t.prototype.scrollTo=function(t,e,i,n){this._isDecelerating&&(this._stop(this._isDecelerating),this._isDecelerating=!1),null!=n&&n!==this._zoom?this.zooming&&(t*=n,e*=n,this._calMaxScroll(n)):n=this._zoom,this.scrollingX||(t=this._scrollLeft),this.scrollingY||(e=this._scrollTop),t=Math.max(Math.min(this._maxScrollLeft,t),0),e=Math.max(Math.min(this._maxScrollTop,e),0),t===this._scrollLeft&&e===this._scrollTop&&(i=!1),this._isProcessing||(this._publish(t,e,n,i),this.emit("_onExistImage"),this._existImage&&this.emit("_onCanvasZoom",this._getCropLimitAreaForScroll()))},t.prototype.scrollBy=function(t,e,i){var n=this._isAnimating?this._scheduledLeft:this._scrollLeft,o=this._isAnimating?this._scheduledTop:this._scrollTop;this.scrollTo(n+(t||0),o+(e||0),i)},t.prototype._mouseZoomHandler=function(t,e,i,n){var o=t>0?1.05:.95;return this.zoomTo(this._zoom*o,!1,i-this._outerLeft,n-this._outerTop)},t.prototype._touchStartHandler=function(t,e){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var i,n;this._interruptedAnimation=!0,this._isDecelerating&&(this._stop(this._isDecelerating),this._isDecelerating=!1),this._isAnimating&&(this._stop(this._isAnimating),this._isAnimating=!1),this._isSingleTouch=1===t.length,this._isSingleTouch?(i=t[0].pageX,n=t[0].pageY):(i=Math.abs(t[0].pageX+t[1].pageX)/2,n=Math.abs(t[0].pageY+t[1].pageY)/2),this._initialTouchLeft=i,this._initialTouchTop=n,this._zoomStart=this._zoom,this._lastTouchLeft=i,this._lastTouchTop=n,this._lastTouchMove=e,this._lastTouchStart=e,this._lastZoom=1,this._enableScrollX=!this._isSingleTouch&&this.scrollingX,this._enableScrollY=!this._isSingleTouch&&this.scrollingY,this._isProcessing=!0,this._isDecelerationComplete=!1,this._isDragging=!this._isSingleTouch,this._positions=[]},t.prototype._touchMoveHandler=function(t,e,i){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);if(this._isProcessing){var n,o;2===t.length?(n=Math.abs(t[0].pageX+t[1].pageX)/2,o=Math.abs(t[0].pageY+t[1].pageY)/2):(n=t[0].pageX,o=t[0].pageY);var r=this._positions;if(this._isDragging){var s=n-this._lastTouchLeft,a=o-this._lastTouchTop,l=this._scrollLeft,u=this._scrollTop,c=this._zoom;if(null!=i&&this.zooming&&!this._isSliding){var h=c;if(c=c/this._lastZoom*i,h!==(c=Math.max(Math.min(c,this.maxZoom),this.minZoom))){var d=n-this._outerLeft,p=o-this._outerTop;l=(d+l)*c/h-d,u=(p+u)*c/h-p,this._calMaxScroll(c)}}if(this._enableScrollX){l-=s*this.speedDelta;var f=this._maxScrollLeft;l>f&&(l=f),l<0&&(l=0)}if(this._enableScrollY){u-=a*this.speedDelta;var g=this._maxScrollTop;u>g&&(u=g),u<0&&(u=0)}r.length>60&&r.splice(0,30),r.push(l,u,e),this._publish(l,u,c)}else{var m=this.locking?3:0,_=Math.abs(n-this._initialTouchLeft),v=Math.abs(o-this._initialTouchTop);this._enableScrollX=this.scrollingX&&_>=m,this._enableScrollY=this.scrollingY&&v>=m,r.push(this._scrollLeft,this._scrollTop,e),this._isDragging=(this._enableScrollX||this._enableScrollY)&&(_>=5||v>=5),this._isDragging&&(this._interruptedAnimation=!1)}this._lastTouchLeft=n,this._lastTouchTop=o,this._lastTouchMove=e,this._lastZoom=i,t.length<=1&&this.ifAllowSlide&&this._zoom<=1&&0===this.scrollTop&&0===this.scrollLeft&&this._renderImage&&(this._slideMove=!0,this._pageChangeMoveHandler())}},t.prototype._toucheEndHandler=function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);if(this._isProcessing){if(this._isProcessing=!1,this._isDragging)if(this._isDragging=!1,this.ifAllowSlide&&this._pageChangeHandler(t),this._isSingleTouch&&this.animating&&t-this._lastTouchMove<=100){for(var e=this._positions,i=e.length-1,n=i,o=i;o>0&&e[o]>this._lastTouchMove-100;o-=3)n=o;if(n!==i){var r=e[i]-e[n],s=this._scrollLeft-e[n-2],a=this._scrollTop-e[n-1];this._decelerationVelocityX=s/r*(1e3/60),this._decelerationVelocityY=a/r*(1e3/60);Math.abs(this._decelerationVelocityX)>1||Math.abs(this._decelerationVelocityY)>1?this._startDeceleration(t):this.emit("scrollingComplete")}else this.emit("scrollingComplete")}else t-this._lastTouchMove>100&&this.emit("scrollingComplete");this._isDecelerating||((this._interruptedAnimation||this._isDragging)&&this.emit("scrollingComplete"),this.scrollTo(this._scrollLeft,this._scrollTop,!0,this._zoom)),this._positions.length=0}},t.prototype._pageChangeMoveHandler=function(){var t=this._canvas.lowerCanvas.parentNode;if(t&&this._slideMove){var e=this._lastTouchLeft-this._initialTouchLeft;t.style.transform="translate3d("+e+"px,0,0)",this._isSliding=!0}},t.prototype._pageChangeHandler=function(t){if(!this._slideMove)return!1;this._slideMove=!1;var e=this._lastTouchLeft-this._initialTouchLeft,i=Math.abs(e/(t-this._lastTouchStart)*1e3);e>=this._outerWidth/2||e>0&&i>200?this.emit("slideSwitch","left"):(-e>=this._outerWidth/2||e<0&&i>200)&&this.emit("slideSwitch","right");var n=this._canvas.lowerCanvas.parentNode;n&&(n.style.transform="none"),this._isSliding=!1},t.prototype._publish=function(t,e,i,n){var o=this,r=this._isAnimating;if(r&&(this._stop(r),this._isAnimating=!1),n&&this.animating){this._scheduledLeft=t,this._scheduledTop=e,this._scheduledZoom=i;var s=this._scrollLeft,a=this._scrollTop,l=this._zoom,u=t-s,c=e-a,h=i-l;this._isAnimating=this._start((function(t,e,i){i&&(o._scrollLeft=s+u*t,o._scrollTop=a+c*t,o._zoom=l+h*t,o.emit("publishScrollResult",{left:o.scrollLeft,top:o.scrollTop,zoom:o._zoom}))}),(function(t){return o._isAnimating===t}),(function(t,e,i){e===o._isAnimating&&(o._isAnimating=!1),(o._isDecelerationComplete||i)&&o.emit("scrollingComplete"),o.zooming&&(o._calMaxScroll(),o._zoomComplete&&(o._zoomComplete(),o._zoomComplete=null))}),this.animationDuration,r?this._easeOutCubic:this._easeInOutCubic)}else this._scheduledLeft=this._scrollLeft=t,this._scheduledTop=this._scrollTop=e,this._scheduledZoom=this._zoom=i,this.emit("publishScrollResult",{left:t,top:e,zoom:i}),this.zooming&&(this._calMaxScroll(),this._zoomComplete&&(this._zoomComplete(),this._zoomComplete=null))},t.prototype._calMaxScroll=function(t){null==t&&(t=this._zoom),this._maxScrollLeft=Math.max(this._innerWidth*t-this._outerWidth,0),this._maxScrollTop=Math.max(this._innerHeight*t-this._outerHeight,0)},t.prototype._startDeceleration=function(t){var e=this;this._minDecelerationScrollLeft=0,this._minDecelerationScrollTop=0,this._maxDecelerationScrollLeft=this._maxScrollLeft,this._maxDecelerationScrollTop=this._maxScrollTop;this._isDecelerating=this._start((function(t,i,n){e._stepThroughDeceleration(n)}),(function(){return Math.abs(e._decelerationVelocityX)>=.001||Math.abs(e._decelerationVelocityY)>=.001||(e._isDecelerationComplete=!0,!1)}),(function(t,i,n){e._isDecelerating=!1,e._isDecelerationComplete&&e.emit("scrollingComplete"),e.scrollTo(e._scrollLeft,e._scrollTop,!1)}))},t.prototype._stepThroughDeceleration=function(t){var e=this._scrollLeft+this._decelerationVelocityX,i=this._scrollTop+this._decelerationVelocityY,n=Math.max(Math.min(this._maxDecelerationScrollLeft,e),this._minDecelerationScrollLeft);n!==e&&(e=n,this._decelerationVelocityX=0);var o=Math.max(Math.min(this._maxDecelerationScrollTop,i),this._minDecelerationScrollTop);o!==i&&(i=o,this._decelerationVelocityY=0),t?this._publish(e,i,this._zoom):(this._scrollLeft=e,this._scrollTop=i);this._decelerationVelocityX*=.95,this._decelerationVelocityY*=.95},t.prototype._stop=function(t){var e=null!=this._running[t];return e&&(this._running[t]=null),e},t.prototype._isRunning=function(t){return null!=this._running[t]},t.prototype._start=function(t,e,i,n,o){var r=this,s=this._time(),a=s,l=0,c=0,h=this._counter++;if(h%16==0){var d={};for(var p in this._running)d[p]=!0;this._running=d}var f=function(d){var p=!0!==d,g=r._time();if(!r._running[h]||e&&!e(h))return r._running[h]=null,void(i&&i(r._fps-c/((g-s)/1e3),h,!1));if(p)for(var m=Math.round((g-a)/(1e3/r._fps))-1,_=0;_<Math.min(m,4);_++)f(!0),c++;n&&(l=(g-s)/n)>1&&(l=1);var v=o?o(l):l;!1!==t(v,g,p)&&1!==l||!p?p&&(a=g,u.default.requestAnimationFrame(f)):(r._running[h]=null,i&&i(r._fps-c/((g-s)/1e3),h,1===l||null==n))};return this._running[h]=!0,u.default.requestAnimationFrame(f),h},t.prototype.drawRectangle=function(t,e,i,n,o,r,s,a,u,c){e=e||0,i=i||0,n=n||0,o=o||0,r=r||"#000000",s=s||"#000000",a=a||0,l.Rectangle.draw(t,e,i,n,o,r,s,a,u,c)},t}();e.Graphic=d},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e){var i=t.call(this,e)||this;return i.initUpperCanvas(),i.initCanvasSize(i.upperCanvas),i.initCanvasScale(i.upperCanvas),i}return o(e,t),e.prototype.initUpperCanvas=function(){this.upperCanvas=this.createCanvasElement("upperCanvas"),this.upperContext=this.upperCanvas.getContext("2d")},e.prototype.setCanvasSize=function(e,i){t.prototype.setCanvasSize.call(this,e,i),this.initCanvasSize(this.upperCanvas),this.upperContext.transform(1,0,0,1,this.innerWidth/2,this.innerHeight/2),this.upperContext.scale(this.devicePixelRatio,this.devicePixelRatio)},e.prototype.setMouseShape=function(t){this.upperCanvas.style.cursor=t,this.lowerCanvas.style.cursor=t},e.prototype.clearLowerCanvas=function(e,i,n,o){t.prototype.clearCanvas.call(this,e,i,n,o),this.upperContext.clearRect(e,i,n,o)},e.prototype.clearUpperCanvas=function(t,e,i,n){this.upperContext.clearRect(t,e,i,n)},e.prototype.render=function(t,e,i,n,o,r,s,a,l){this.lowerContext.clearRect(-this.innerWidth,-this.innerHeight,2*this.innerWidth,2*this.innerHeight),this.lowerContext.drawImage(t,e,i,n,o,r,s,a,l)},e.prototype.pointRotate=function(t,e,i,n,o){return o=o/180*Math.PI,{x:(t-i)*Math.cos(o)-(e-n)*Math.sin(o)+i,y:(t-i)*Math.sin(o)-(e-n)*Math.cos(o)+n}},e.prototype.rectangleRotate=function(t,e,i,n,o){var r=t+i/2,s=e+n/2,a=this.pointRotate(t,e,r,s,o),l=this.pointRotate(t+i,e,r,s,o),u=this.pointRotate(t+i,e+n,r,s,o),c=this.pointRotate(t,e+n,r,s,o),h=[a.x,l.x,u.x,c.x].sort((function(t,e){return t-e})),d=[a.y,l.y,u.y,c.y].sort((function(t,e){return t-e}));return{x:h[0],y:d[0],width:h[3]-h[0],height:d[3]-d[0]}},e}(i(40).BasicCanvas);e.Canvas=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.cssWidth=0,this.cssHeight=0,this.devicePixelRatio=1,this.cssWidth=t.canvasCssWidth,this.cssHeight=t.canvasCssHeight,this.devicePixelRatio=t.devicePixelRatio,this.backgroundColor=t.backgroundColor,this.initCanvas(),this.setCanvasInnerSize(),this.initCanvasSize(this.lowerCanvas),this.inintCanvasBackground(this.lowerCanvas),this.initCanvasScale(this.lowerCanvas)}return t.prototype.initCanvas=function(){this.lowerCanvas=this.createCanvasElement("lowerCanvas"),this.lowerContext=this.lowerCanvas.getContext("2d")},t.prototype.initCanvasSize=function(t){t.width=this.innerWidth,t.height=this.innerHeight,t.style.width=this.cssWidth+"px",t.style.height=this.cssHeight+"px"},t.prototype.inintCanvasBackground=function(t){t.style.background=this.backgroundColor},t.prototype.initCanvasScale=function(t){this.lowerContext.scale(this.devicePixelRatio,this.devicePixelRatio)},t.prototype.setBackgroundColor=function(t){this.lowerCanvas.style.background=t},t.prototype.clearCanvas=function(t,e,i,n){this.lowerContext.clearRect(t,e,i,n)},t.prototype.setCanvasInnerSize=function(){this.innerWidth=this.cssWidth*this.devicePixelRatio,this.innerHeight=this.cssHeight*this.devicePixelRatio},t.prototype.setCanvasSize=function(t,e){this.cssWidth=t,this.cssHeight=e,this.setCanvasInnerSize(),this.initCanvasSize(this.lowerCanvas),this.lowerContext.transform(1,0,0,1,this.innerWidth/2,this.innerHeight/2),this.lowerContext.scale(this.devicePixelRatio,this.devicePixelRatio)},t.prototype.createCanvasElement=function(t){var e=document.createElement("canvas");return e.setAttribute("id",t),e.style.position="absolute",e.style.top="0px",e.style.left="0px",e},t.prototype.getLowerContext=function(){return this.lowerContext},t.prototype.getPixelRatio=function(){return this.devicePixelRatio},t.prototype.setPixelRatio=function(t){t&&(this.devicePixelRatio=t)},t.prototype.setWidth=function(t){this.cssWidth=t,this.lowerCanvas.width=t},t.prototype.setHeight=function(t){this.cssHeight=t,this.lowerCanvas.height=t},t.prototype.getWidth=function(){return this.cssWidth},t.prototype.getHeight=function(){return this.cssHeight},t.prototype.getScale=function(){return this.scaleCoefficient},t.prototype.setScale=function(t){t&&(this.scaleCoefficient=t)},t.prototype.setSize=function(t,e){},t.prototype.toDataURL=function(t,e){},t.prototype.rotate=function(){},t.prototype.renderAll=function(){},t}();e.BasicCanvas=n},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=r(i(0)),a=i(5),l=function(){function t(){this._editorStack=null,this.width=0,this.height=0,this.init()}return t.prototype.init=function(){this.canvas=s.default.createCanvas().canvas,this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1},t.prototype._initTransformStack=function(){this._editorStack=new a.Transform2d},t.prototype.setCanvasSize=function(t,e){this.canvas.width=t||300,this.canvas.height=e||150},t.prototype.resetCanvas=function(){this.setCanvasSize(300,150),this.width=300,this.height=150,this.imageData=null},t.prototype.getImageData=function(t){this._editorStack.setTransform(this.context),this.context.drawImage(t,0,0,this.width,this.height,0,0,this.width,this.height),this.imageData=this.context.getImageData(0,0,this.width,this.height)},t.prototype.getImageBlob=function(){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e,i){t.canvas.toBlob((function(t){e(t)}))}))];case 1:return[2,e.sent()]}}))}))},t}();e.CanvasCache=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Rectangle={draw:function(t,e,i,n,o,r,s,a,l,u){t.save(),t.globalAlpha=u,t.fillStyle=s,t.fillRect(e+a,i+a,n-a,o-a),a&&(t.globalAlpha=l,t.lineWidth=a,t.strokeStyle=r,t.strokeRect(e+a/2,i+a/2,n,o)),t.restore()}}},function(t,e,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this._events=[]}return t.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)},t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var r=this._events[t];if(!r||0===r.length)return!1;for(var s=r.length,a=0;a<s;a++)(e=r[a]).call.apply(e,n([null],i))},t.prototype.off=function(t,e){var i=this._events[t];if(!i)return!1;if(e)for(var n=i.length,o=0;o<n;o++){i[o]===e&&i.splice(o,1)}else i&&(i.length=0)},t}();e.PublishSubscribe=o},function(t,e,i){},function(t,e,i){}]);