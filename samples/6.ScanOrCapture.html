<!DOCTYPE html>
<html>

<head>
  <title>Acquire Images From Scanners and Cameras</title>
  <script src="../dist/dynamsoft.webtwain.min.js"></script>
</head>

<body>
  <div id="notMobile">
    <h1>Acquire Images From Scanners and Cameras</h1>
    <select id="source"></select><br />
    <input type="button" id="btn-switch" value="Hide Video" onclick="SwitchViews();" />
    <input type="button" id="btn-grab" value="Acquire From a Scanner" onclick="CaptureImage();" /> Or
    <input type="button" value="Load Images or PDFs" onclick="LoadImages();" />
    <br />
    <br />
    <div id="dwtcontrolContainer"></div>
  </div>
  <h1 id="mobiel" style="margin:10vmin; display: none;">
    Camera Support is coming in versino 16.1, stay tuned!
  </h1>
  <script type="text/javascript">
    Dynamsoft.WebTwainEnv.ResourcesPath = "../dist";
    Dynamsoft.WebTwainEnv.ProductKey = 't01025gAAALk9jAMRgcJZFeF/gOx+dqYJ3DovvmHp0V6A9i0SXwywSvj6C/IA4WBjouCI0I0qQxkHyWUeoj8qjcnMWhka+HONSZMxNZjQGQ1AqAKWdut4+8zM5nJnlieTxV7TqCeRzy30';
    Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady);
    window.onload = function () {
      if (Dynamsoft && Dynamsoft.Lib.env.bWin) {
        Dynamsoft.WebTwainEnv.Load();
      }
      else {
        if (Dynamsoft.Lib.env.bMobile) {
          document.getElementById('notMobile').style.display = "none";
          document.getElementById('mobiel').style.display = "";
        } else
          alert("Please note that your current browser doesn't support the OCR add-on, please use modern browsers like Chrome, Firefox.");
      }
    };
    var DWObject;
    var webCamStartingIndex; //This is used to separate scanners and webcams
    var DWObject;
    var isVideoOn = true;

    function Dynamsoft_OnReady() {
      DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer');
      document.getElementById('source').onchange = function () {
        if (document.getElementById('source').selectedIndex < webCamStartingIndex) {
          DWObject.Addon.Webcam.StopVideo();
          isVideoOn = false;
          document.getElementById("btn-grab").style.backgroundColor = "";
          document.getElementById('btn-grab').value = 'Acquire From a Scanner';
          document.getElementById("btn-switch").style.display = 'none';
        } else {
          DWObject.Addon.Webcam.SelectSource(document.getElementById("source").options[document
            .getElementById("source").selectedIndex].text);
          SetIfWebcamPlayVideo(true);
          document.getElementById('btn-grab').value = 'Acquire From a Webcam';
          document.getElementById("btn-switch").style.display = '';
        }
        document.getElementById("btn-grab").disabled = "";
      }
      if (DWObject) {
        if (!Dynamsoft.Lib.product.bChromeEdition) {
          DWObject.Height = 350;
          DWObject.Width = 270;
        }
        document.getElementById('source').options.length = 0;
        var count = DWObject.SourceCount;
        for (var i = 0; i < count; i++) {
          document.getElementById('source').options.add(new Option(DWObject.GetSourceNameItems(i),
            i));
        }
        webCamStartingIndex = i;

        var arySource = DWObject.Addon.Webcam.GetSourceList();
        for (var i = 0; i < arySource.length; i++)
          document.getElementById("source").options.add(new Option(arySource[i]), i +
            webCamStartingIndex); // Get Webcam Source names and put them in a drop-down box
        document.getElementById('source').onchange();
      }
    }

    function SetIfWebcamPlayVideo(bShow) {
      if (bShow) {
        DWObject.Addon.Webcam.StopVideo();
        setTimeout(function () {
          DWObject.Addon.Webcam.PlayVideo(DWObject, 80, function () { });
          isVideoOn = true;
          document.getElementById("btn-grab").style.backgroundColor = "";
          document.getElementById("btn-grab").disabled = "";
          document.getElementById("btn-switch").value = "Hide Video";
        }, 30);
      } else {
        DWObject.Addon.Webcam.StopVideo();
        isVideoOn = false;
        document.getElementById("btn-grab").style.backgroundColor = "#aaa";
        document.getElementById("btn-grab").disabled = "disabled";
        document.getElementById("btn-switch").value = "Show Video";
      }
    }

    function SwitchViews() {
      if (isVideoOn == false) {
        // continue the video
        SetIfWebcamPlayVideo(true);
      } else {
        // stop the video
        SetIfWebcamPlayVideo(false);
      }
    }

    function CaptureImage() {
      if (DWObject) {
        if (document.getElementById('source').selectedIndex < webCamStartingIndex) {
          DWObject.IfShowUI = true;
          DWObject.IfDisableSourceAfterAcquire = true;
          DWObject.SelectSourceByIndex(document.getElementById('source').selectedIndex);
          DWObject.CloseSource();
          DWObject.OpenSource();
          DWObject.AcquireImage();
        } else {
          var funCaptureImage = function () {
            setTimeout(function () {
              SetIfWebcamPlayVideo(false);
            }, 50);
          };
          DWObject.Addon.Webcam.CaptureImage(funCaptureImage, funCaptureImage);
        }
      }
    }

    function LoadImages() {
      if (DWObject) {
        if (DWObject.Addon && DWObject.Addon.PDF) {
          DWObject.Addon.PDF.SetResolution(300);
          DWObject.Addon.PDF.SetConvertMode(EnumDWT_ConvertMode.CM_RENDERALL);
        }
        DWObject.IfShowFileDialog = true;
        DWObject.LoadImageEx("", 5,
          function () { },
          function (errorCode, errorString) {
            alert('Load Image:' + errorString);
          }
        );
      }
    }
  </script>
</body>

</html>